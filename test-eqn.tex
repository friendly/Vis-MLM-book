% Options for packages loaded elsewhere
% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  10pt,
  krantz2,
  titlepage,
  letterpaper]{krantz}
\usepackage{xcolor}
\usepackage{amsmath,amssymb}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother


\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother





\setlength{\emergencystretch}{3em} % prevent overfull lines

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}



 


%%%%%%%%%%%%%%%  Start of preamble.tex %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%  --------------------- %%%%%%%%%%%%%%%%%%
\usepackage{booktabs}
\usepackage{longtable}
\usepackage[bf,singlelinecheck=off]{caption}
\usepackage{url}

\usepackage{framed}
\usepackage{color}  % is this needed?
\definecolor{shadecolor}{RGB}{248,248,248}
\usepackage[cmyk]{xcolor} % CRC wants CMYK
% custom colors
\definecolor{darkgreen}{RGB}{1,50,32}

%%%% section headings %%%%


% https://tex.stackexchange.com/questions/750528/how-to-change-color-of-section-title-in-the-krantz-cls/750529#750529
\renewcommand\SectionHeadFont{\color{blue}\fontsize{12}{14}\sffamily\bfseries\selectfont}
\renewcommand\SubsectionHeadFont{\color{blue}\fontsize{11}{13}\sffamily\bfseries\selectfont}
\renewcommand\SubsubsectionHeadFont{\color{blue}\fontsize{10}{12}\sffamily\bfseries\selectfont}


% Define a custom color
% dark greenish-brown color, with a hexadecimal equivalent of #1A7F33
\definecolor{mygreen}{rgb}{0.1, 0.5, 0.2} 

%%%% Page headers %%%%%%
% override krantz default to use chapter/section headers
\makeatletter
\def\HeadingsChapterSection{%
  \def\chaptermark##1{%
    \markboth{%
      \thechapter. ##1}{}}%
  \def\sectionmark##1{%
    \markright{%
      \thesection: ##1}}}
\HeadingsChapterSection


% block quotes
\definecolor{quotecolor}{RGB}{0,0,100} % Example: blue
\renewenvironment{quote}
{%
  \list{}{\rightmargin=\leftmargin}%
  \item\relax\color{quotecolor}% <-- Apply the color here
}
{%
  \endlist
}

%--- Cover page
% Run:
%   pdftk A=images/cover-ellipse.pdf B=index.pdf cat A1 B2-end output index-cover.pdf
%   BUT: this changes the structure of the PDF-- no bookmarks, etc.,
%   What is needed is to open index.pdf and INSERT the cover as the first page.
%   pdftk A=index.pdf B=images/cover-ellipse.pdf cat A0 B1 A2-end output index-cover.pdf
%   --> Did this manually in Adobe Acrobat Pro WORKED

% floats
\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

% for tinytable / modelsummary
\usepackage{tabularray}
\usepackage{float}
\usepackage{graphicx}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\UseTblrLibrary{booktabs}
\UseTblrLibrary{siunitx}
% \newcommand{\tinytableTabularrayUnderline}[1]{\underline{#1}}
% \newcommand{\tinytableTabularrayStrikeout}[1]{\sout{#1}}
% \NewTableCommand{\tinytableDefineColor}[3]{\definecolor{#1}{#2}{#3}}


% krantz VF format is ugly!
%\renewenvironment{quote}{\begin{VF}}{\end{VF}}

% Make \href{} into a footnote --- does this work??
\let\oldhref\href
\providecommand{\href}[2]{#2\footnote{\url{#1}}}
  
% is this needed???
% \makeatletter
% \newenvironment{kframe}{%
%   \medskip{}
%   \setlength{\fboxsep}{.8em}
%   \def\at@end@of@kframe{}%
%   \ifinner\ifhmode%
%   \def\at@end@of@kframe{\end{minipage}}%
%   \begin{minipage}{\columnwidth}%
%   \fi\fi%
%   \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
%   \colorbox{shadecolor}{##1}\hskip-\fboxsep
%     % There is no \\@totalrightmargin, so:
%       \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
%   \MakeFramed {\advance\hsize-\width
%     \@totalleftmargin\z@ \linewidth\hsize
%     \@setminipage}}%
% {\par\unskip\endMakeFramed%
%   \at@end@of@kframe}
% \makeatother
% 
% \renewenvironment{Shaded}{\begin{kframe}}{\end{kframe}}

% Suppress underfull \hbox \vbox
\setlength{\hbadness}{1000pt}
\setlength{\vbadness}{1000pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Index generation
% Indexentry for a word/phrase (Word inserted into the text)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{makeidx}
\makeindex

\usepackage[small,firstabbrev]{authorindex}
\aimaxauthors{5}   % maximum number of authors to index

\newcommand{\IX}[1]{\index{#1}#1}
\newcommand{\ix}[1]{\index{#1}}
\newcommand{\ixmain}[1]{\index{#1|textbf}}
\newcommand{\ixon}[1]{\index{#1|(}}
\newcommand{\ixoff}[1]{\index{#1|)}}

% R functions
\newcommand{\ixfunc}[1]{%
  \index{#1@\texttt{#1()}}%
 }

% R packages:  indexed under both package name and packages!
\newcommand{\ixp}[1]{%
   \index{#1@\textsf{#1} package}%
   \index{packages!#1@\texttt{#1}}%
	}

% data sets: 
\newcommand{\ixd}[1]{%
  \index{#1}
  \index{datasets!#1}
  % \index{datasets!@\texttt{#1}}
  % \index{@\texttt{#1} dataset}
  }


\urlstyle{tt}

\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}

% Fix for modelsummary problem with \num{}
\renewcommand*{\num}[1]{#1}


\makeatother

% This doesn't work
% l.300 \includegraphics
%                       [width=\textwidth]{images/cover-ellipse.jpg}

%\includegraphics[width=\textwidth]{images/cover-ellipse.jpg}

\frontmatter
  
%%%%%%%%%%%%%%%  End of preamble.tex %%%%%%%%%%%%%%%%%%%%  
%%%%%%%%%%%%%%%  ------------------- %%%%%%%%%%%%%%%%%%%%
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Quarto test-- eqn cross refs},
  pdfauthor={Michael Friendly},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{Quarto test-- eqn cross refs}
\author{Michael Friendly}
\date{2025-09-27}
\begin{document}
\maketitle


\subsection{Unresolved cross-references in aligned
equations}\label{unresolved-cross-references-in-aligned-equations}

Aligned equations, using equation labels, like:
\texttt{\textbackslash{}begin\{align*\}\ equation\ \textbackslash{}end\{align\}\{\#eq-glm\}}
work in HTML, \emph{but not in PDF}. That is, they generate equation
numbers which can be cross-referenced in HTML, but generate warnings in
PDF and the cross-refs print as \texttt{?@eq-glm}.

In Quarto, constructs like this already imply an equation environment in
LaTeX, so they cannot be included within \texttt{\$\$\ ...\ \$\$}

There is discussion of this in
\href{https://github.com/quarto-dev/quarto-cli/issues/2275}{Quarto-dev}

An example is:

\begin{verbatim}
\begin{align*}
\mathbf{y} & = \beta_0 + \beta_1 \mathbf{x}_1 + \beta_2 \mathbf{x}_2 + \cdots + \beta_p \mathbf{x}_p + \boldsymbol{\epsilon} \\
           & = \left[ \mathbf{1},\; \mathbf{x}_1,\; \mathbf{x}_2,\; \dots ,\; \mathbf{x}_p \right] \; \boldsymbol{\beta} + \boldsymbol{\epsilon} \\
\end{align*} {#eq-glm}
\end{verbatim}

Try this out:

\begin{align*}
\mathbf{y} & = \beta_0 + \beta_1 \mathbf{x}_1 + \beta_2 \mathbf{x}_2 + \cdots + \beta_p \mathbf{x}_p + \boldsymbol{\epsilon} \\
           & = \left[ \mathbf{1},\; \mathbf{x}_1,\; \mathbf{x}_2,\; \dots ,\; \mathbf{x}_p \right] \; \boldsymbol{\beta} + \boldsymbol{\epsilon} \\
\end{align*} \{\#eq-glm\}

As you see in Equation~\ref{eq-glm} \ldots{}

Try surrounding this in \texttt{\$\$}

\begin{equation}\phantomsection\label{eq-glm}{
\begin{align*}
\mathbf{y} & = \beta_0 + \beta_1 \mathbf{x}_1 + \beta_2 \mathbf{x}_2 + \cdots + \beta_p \mathbf{x}_p + \boldsymbol{\epsilon} \\
           & = \left[ \mathbf{1},\; \mathbf{x}_1,\; \mathbf{x}_2,\; \dots ,\; \mathbf{x}_p \right] \; \boldsymbol{\beta} + \boldsymbol{\epsilon} \\
\end{align*} 
}\end{equation}




\end{document}
