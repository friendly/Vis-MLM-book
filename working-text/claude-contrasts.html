<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ask Claude</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="claude-contrasts_files/libs/clipboard/clipboard.min.js"></script>
<script src="claude-contrasts_files/libs/quarto-html/quarto.js"></script>
<script src="claude-contrasts_files/libs/quarto-html/popper.min.js"></script>
<script src="claude-contrasts_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="claude-contrasts_files/libs/quarto-html/anchor.min.js"></script>
<link href="claude-contrasts_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="claude-contrasts_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="claude-contrasts_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="claude-contrasts_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="claude-contrasts_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Ask Claude</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Help me write a section for a tutorial article on coding of factor variables in R and contrast matrices. Begin with a general description of how the coding of factors affects the parameters in a linear model. Then, take the default, contrast.treatment for a 4 level factor with levels a, b, c, d. Express this in matrix notation.</p>
<hr>
<section id="understanding-factor-coding-and-contrast-matrices-in-r" class="level1">
<h1>Understanding Factor Coding and Contrast Matrices in R</h1>
<section id="how-factor-coding-affects-linear-model-parameters" class="level2">
<h2 class="anchored" data-anchor-id="how-factor-coding-affects-linear-model-parameters">How Factor Coding Affects Linear Model Parameters</h2>
<p>When fitting linear models in R, categorical predictors (factors) must be translated into a numerical representation that can be used in the model matrix. This process, known as “coding” or “parameterization,” directly affects how we interpret the model parameters (coefficients) in the output.</p>
<p>The way a factor is coded determines:</p>
<ol type="1">
<li>The specific hypothesis tests that are performed</li>
<li>The interpretation of individual model coefficients</li>
<li>The reference level against which other levels are compared</li>
<li>The underlying design matrix used in the model computation</li>
</ol>
<p>Each coding scheme represents the same model in terms of fitted values and overall significance, but they differ in how the coefficients are parameterized and interpreted. This is crucial to understand because the coefficients directly answer different research questions depending on the coding scheme used.</p>
<p>For a factor with k levels, we typically need k-1 parameters to represent its effect in a model. This is because with k levels, one level is used as a reference or baseline (to avoid perfect multicollinearity). The specific coding scheme determines what these k-1 parameters actually mean.</p>
</section>
<section id="common-coding-schemes-in-r" class="level2">
<h2 class="anchored" data-anchor-id="common-coding-schemes-in-r">Common Coding Schemes in R</h2>
<p>R provides several coding schemes through the <code>contrasts()</code> function:</p>
<ul>
<li><code>contr.treatment</code>: Compares each level to a reference level (default in R)</li>
<li><code>contr.sum</code>: Compares each level to the grand mean</li>
<li><code>contr.helmert</code>: Compares each level to the mean of previous levels</li>
<li><code>contr.poly</code>: For ordered factors, creates orthogonal polynomial contrasts</li>
</ul>
</section>
<section id="treatment-contrasts-in-detail" class="level2">
<h2 class="anchored" data-anchor-id="treatment-contrasts-in-detail">Treatment Contrasts in Detail</h2>
<p>Let’s examine R’s default coding scheme, <code>contr.treatment</code> (also called dummy coding), for a factor with 4 levels: a, b, c, and d.</p>
<section id="treatment-contrasts-in-matrix-notation" class="level3">
<h3 class="anchored" data-anchor-id="treatment-contrasts-in-matrix-notation">Treatment Contrasts in Matrix Notation</h3>
<p>For a factor with 4 levels (a, b, c, d), where ‘a’ is the reference level, the contrast matrix is:</p>
<p><span class="math display">\[
\mathbf{C} =
\begin{pmatrix}
0 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
\]</span></p>
<p>Each row represents a level of the factor (a, b, c, d), and each column represents a contrast (b-a, c-a, d-a).</p>
<p>In the design matrix of a linear model, this creates three dummy variables. If we denote these as <span class="math inline">\(X_b\)</span>, <span class="math inline">\(X_c\)</span>, and <span class="math inline">\(X_d\)</span>, then:</p>
<p><span class="math display">\[
X_b = \begin{cases}
1 &amp; \text{if factor = b} \\
0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p><span class="math display">\[
X_c = \begin{cases}
1 &amp; \text{if factor = c} \\
0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p><span class="math display">\[
X_d = \begin{cases}
1 &amp; \text{if factor = d} \\
0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
</section>
<section id="interpretation-of-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-coefficients">Interpretation of Coefficients</h3>
<p>With treatment contrasts, the model coefficients have the following interpretation:</p>
<ul>
<li>Intercept (<span class="math inline">\(\beta_0\)</span>): The mean response for the reference level ‘a’</li>
<li>Coefficient for level b (<span class="math inline">\(\beta_b\)</span>): The difference in mean response between level ‘b’ and reference level ‘a’</li>
<li>Coefficient for level c (<span class="math inline">\(\beta_c\)</span>): The difference in mean response between level ‘c’ and reference level ‘a’</li>
<li>Coefficient for level d (<span class="math inline">\(\beta_d\)</span>): The difference in mean response between level ‘d’ and reference level ‘a’</li>
</ul>
<p>Thus, the expected response for each level is: - Level a: <span class="math inline">\(\beta_0\)</span> - Level b: <span class="math inline">\(\beta_0 + \beta_b\)</span> - Level c: <span class="math inline">\(\beta_0 + \beta_c\)</span> - Level d: <span class="math inline">\(\beta_0 + \beta_d\)</span></p>
</section>
<section id="example-in-r" class="level3">
<h3 class="anchored" data-anchor-id="example-in-r">Example in R</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a factor with 4 levels</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>factor_example <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View the contrast matrix for this factor</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(factor_example)  <span class="co"># By default, uses contr.treatment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output would be:</p>
<pre><code>  b c d
a 0 0 0
b 1 0 0
c 0 1 0
d 0 0 1</code></pre>
<p>This matches our matrix representation above. Each column represents a parameter in the model, and each row shows how that parameter contributes to modeling observations from each level.</p>
<p>In a linear model such as <code>y ~ factor_example</code>, R will create this design matrix internally, with the first level ‘a’ being used as the reference level by default.</p>
<hr>
<p>MF: Can you revise the matrix expression for C to also include the column of 1s for the intercept and show how multiplying this by the symbolic vector mu &lt;- matrix(paste0(“\mu_”, letters[1:4]), 4, 1) expresses the means for the factor levels</p>
</section>
</section>
<section id="treatment-contrasts-in-detail-1" class="level2">
<h2 class="anchored" data-anchor-id="treatment-contrasts-in-detail-1">Treatment Contrasts in Detail</h2>
<p>Let’s examine R’s default coding scheme, <code>contr.treatment</code> (also called dummy coding), for a factor with 4 levels: a, b, c, and d.</p>
<section id="treatment-contrasts-in-matrix-notation-1" class="level3">
<h3 class="anchored" data-anchor-id="treatment-contrasts-in-matrix-notation-1">Treatment Contrasts in Matrix Notation</h3>
<p>For a factor with 4 levels (a, b, c, d), where ‘a’ is the reference level, the full design matrix including the intercept is:</p>
<p><span class="math display">\[
\mathbf{X} =
\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\]</span></p>
<p>The first column represents the intercept (always 1), and the remaining columns correspond to the contrasts (b-a, c-a, d-a). Each row represents a level of the factor (a, b, c, d).</p>
<p>If we denote the parameter vector as:</p>
<p><span class="math display">\[
\boldsymbol{\beta} =
\begin{pmatrix}
\beta_0 \\
\beta_b \\
\beta_c \\
\beta_d
\end{pmatrix}
\]</span></p>
<p>Where <span class="math inline">\(\beta_0\)</span> is the intercept (mean of reference level ‘a’), and the remaining parameters represent the differences between each level and the reference level.</p>
<p>In the design matrix of a linear model, this creates three dummy variables. If we denote these as <span class="math inline">\(X_b\)</span>, <span class="math inline">\(X_c\)</span>, and <span class="math inline">\(X_d\)</span>, then:</p>
<p><span class="math display">\[
X_b = \begin{cases}
1 &amp; \text{if factor = b} \\
0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p><span class="math display">\[
X_c = \begin{cases}
1 &amp; \text{if factor = c} \\
0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p><span class="math display">\[
X_d = \begin{cases}
1 &amp; \text{if factor = d} \\
0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
</section>
<section id="relationship-between-contrast-matrix-and-factor-level-means" class="level3">
<h3 class="anchored" data-anchor-id="relationship-between-contrast-matrix-and-factor-level-means">Relationship Between Contrast Matrix and Factor Level Means</h3>
<p>To understand how the design matrix relates to the actual means of each factor level, we can use a symbolic vector of means:</p>
<p><span class="math display">\[
\boldsymbol{\mu} =
\begin{pmatrix}
\mu_a \\
\mu_b \\
\mu_c \\
\mu_d
\end{pmatrix}
\]</span></p>
<p>Where <span class="math inline">\(\mu_a\)</span>, <span class="math inline">\(\mu_b\)</span>, <span class="math inline">\(\mu_c\)</span>, and <span class="math inline">\(\mu_d\)</span> represent the true population means for each factor level.</p>
<p>The relationship between these means and the model parameters can be expressed through the design matrix:</p>
<p>$ = $</p>
<p>Which gives us:</p>
<p><span class="math display">\[
\begin{pmatrix}
\mu_a \\
\mu_b \\
\mu_c \\
\mu_d
\end{pmatrix} =
\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\begin{pmatrix}
\beta_0 \\
\beta_b \\
\beta_c \\
\beta_d
\end{pmatrix}
\]</span></p>
<p>Multiplying these matrices:</p>
<p><span class="math display">\[
\begin{pmatrix}
\mu_a \\
\mu_b \\
\mu_c \\
\mu_d
\end{pmatrix} =
\begin{pmatrix}
\beta_0 \\
\beta_0 + \beta_b \\
\beta_0 + \beta_c \\
\beta_0 + \beta_d
\end{pmatrix}
\]</span></p>
</section>
<section id="interpretation-of-coefficients-1" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-coefficients-1">Interpretation of Coefficients</h3>
<p>From this matrix multiplication, we can clearly see the interpretation of the coefficients:</p>
<ul>
<li>Intercept (<span class="math inline">\(\beta_0\)</span>): The mean response for the reference level ‘a’ (i.e., <span class="math inline">\(\mu_a = \beta_0\)</span>)</li>
<li>Coefficient for level b (<span class="math inline">\(\beta_b\)</span>): The difference in mean response between level ‘b’ and reference level ‘a’ (i.e., <span class="math inline">\(\mu_b = \beta_0 + \beta_b\)</span> or <span class="math inline">\(\beta_b = \mu_b - \mu_a\)</span>)</li>
<li>Coefficient for level c (<span class="math inline">\(\beta_c\)</span>): The difference in mean response between level ‘c’ and reference level ‘a’ (i.e., <span class="math inline">\(\mu_c = \beta_0 + \beta_c\)</span> or <span class="math inline">\(\beta_c = \mu_c - \mu_a\)</span>)</li>
<li>Coefficient for level d (<span class="math inline">\(\beta_d\)</span>): The difference in mean response between level ‘d’ and reference level ‘a’ (i.e., <span class="math inline">\(\mu_d = \beta_0 + \beta_d\)</span> or <span class="math inline">\(\beta_d = \mu_d - \mu_a\)</span>)</li>
</ul>
<p>Thus, the expected response for each level is: - Level a: <span class="math inline">\(\beta_0\)</span> - Level b: <span class="math inline">\(\beta_0 + \beta_b\)</span> - Level c: <span class="math inline">\(\beta_0 + \beta_c\)</span> - Level d: <span class="math inline">\(\beta_0 + \beta_d\)</span></p>
</section>
<section id="example-in-r-1" class="level3">
<h3 class="anchored" data-anchor-id="example-in-r-1">Example in R</h3>
<p>Let’s see how this works in R:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a factor with 4 levels</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>factor_example <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View the contrast matrix for this factor</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(factor_example)  <span class="co"># By default, uses contr.treatment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output would be:</p>
<pre><code>  b c d
a 0 0 0
b 1 0 0
c 0 1 0
d 0 0 1</code></pre>
<p>This matches the non-intercept portion of our design matrix. Each column represents a parameter in the model, and each row shows how that parameter contributes to modeling observations from each level.</p>
<p>Now, let’s demonstrate how the design matrix relates to the factor level means:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the symbolic means vector</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">mu_"</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]), <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the full design matrix (including intercept)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="fu">diag</span>(<span class="dv">3</span>)[<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span> <span class="dv">1</span>, ])</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the design matrix</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This would output:</p>
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    1    1    0    0
[3,]    1    0    1    0
[4,]    1    0    0    1</code></pre>
<p>Now we can symbolically express the relationship:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the symbolic parameter vector</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">beta_0"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">beta_b"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">beta_c"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">beta_d"</span>), <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show that X * beta = mu</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>X <span class="sc">%*%</span> beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This would yield the symbolic representation:</p>
<pre><code>     [,1]
[1,] "\\beta_0"
[2,] "\\beta_0 + \\beta_b"
[3,] "\\beta_0 + \\beta_c"
[4,] "\\beta_0 + \\beta_d"</code></pre>
<p>Which matches our mathematical expression for the factor level means in terms of the model parameters.</p>
<p>In a linear model such as <code>y ~ factor_example</code>, R will create this design matrix internally, with the first level ‘a’ being used as the reference level by default. The estimated coefficients directly correspond to our ? parameters.</p>
<hr>
<p>MF: Can you now do an example in R showing how this works for Helmert contrasts</p>
</section>
</section>
<section id="helmert-contrasts" class="level2">
<h2 class="anchored" data-anchor-id="helmert-contrasts">Helmert Contrasts</h2>
<p>Helmert contrasts provide an alternative way to parameterize categorical factors. Unlike treatment contrasts which compare each level to a reference level, Helmert contrasts compare each level with the mean of the previous levels.</p>
<section id="helmert-contrasts-in-matrix-notation" class="level3">
<h3 class="anchored" data-anchor-id="helmert-contrasts-in-matrix-notation">Helmert Contrasts in Matrix Notation</h3>
<p>For a factor with 4 levels (a, b, c, d), the Helmert contrast matrix is:</p>
<p><span class="math display">\[
\mathbf{C}_{Helmert} =
\begin{pmatrix}
-1 &amp; -1 &amp; -1 \\
1 &amp; -1 &amp; -1 \\
0 &amp; 2 &amp; -1 \\
0 &amp; 0 &amp; 3
\end{pmatrix}
\]</span></p>
<p>This is typically scaled for easier interpretation:</p>
<p><span class="math display">\[
\mathbf{C}_{Helmert\,scaled} =
\begin{pmatrix}
-1 &amp; -1/2 &amp; -1/3 \\
1 &amp; -1/2 &amp; -1/3 \\
0 &amp; 1 &amp; -1/3 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
\]</span></p>
<p>With the intercept included, the full design matrix becomes:</p>
<p><span class="math display">\[
\mathbf{X}_{Helmert} =
\begin{pmatrix}
1 &amp; -1 &amp; -1/2 &amp; -1/3 \\
1 &amp; 1 &amp; -1/2 &amp; -1/3 \\
1 &amp; 0 &amp; 1 &amp; -1/3 \\
1 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\]</span></p>
</section>
<section id="interpretation-of-helmert-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-helmert-contrasts">Interpretation of Helmert Contrasts</h3>
<p>With Helmert contrasts, the model coefficients have the following interpretation:</p>
<ul>
<li>Intercept (<span class="math inline">\(\beta_0\)</span>): The grand mean across all factor levels</li>
<li>Coefficient 1 (<span class="math inline">\(\beta_1\)</span>): The difference between level ‘b’ and level ‘a’</li>
<li>Coefficient 2 (<span class="math inline">\(\beta_2\)</span>): The difference between level ‘c’ and the mean of levels ‘a’ and ‘b’</li>
<li>Coefficient 3 (<span class="math inline">\(\beta_3\)</span>): The difference between level ‘d’ and the mean of levels ‘a’, ‘b’, and ‘c’</li>
</ul>
</section>
<section id="example-in-r-with-helmert-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="example-in-r-with-helmert-contrasts">Example in R with Helmert Contrasts</h3>
<p>Let’s demonstrate Helmert contrasts in R:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a factor with 4 levels</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>factor_example <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set contrasts to Helmert</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(factor_example) <span class="ot">&lt;-</span> <span class="fu">contr.helmert</span>(<span class="dv">4</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View the contrast matrix</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(factor_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output would be:</p>
<pre><code>  [,1] [,2] [,3]
a   -1   -1   -1
b    1   -1   -1
c    0    2   -1
d    0    0    3</code></pre>
<p>Now, let’s demonstrate how the design matrix relates to the factor level means:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the symbolic means vector</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">mu_"</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]), <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Helmert design matrix (including intercept)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>X_helmert <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="fu">contr.helmert</span>(<span class="dv">4</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the design matrix</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>X_helmert</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This would output:</p>
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1   -1   -1   -1
[2,]    1    1   -1   -1
[3,]    1    0    2   -1
[4,]    1    0    0    3</code></pre>
</section>
<section id="relationship-between-helmert-contrasts-and-factor-level-means" class="level3">
<h3 class="anchored" data-anchor-id="relationship-between-helmert-contrasts-and-factor-level-means">Relationship Between Helmert Contrasts and Factor Level Means</h3>
<p>If we denote the parameter vector as:</p>
<p><span class="math display">\[
\boldsymbol{\beta}_{Helmert} =
\begin{pmatrix}
\beta_0 \\
\beta_1 \\
\beta_2 \\
\beta_3
\end{pmatrix}
\]</span></p>
<p>Then the relationship to the means is:</p>
<p><span class="math display">\[
\begin{pmatrix}
\mu_a \\
\mu_b \\
\mu_c \\
\mu_d
\end{pmatrix} =
\begin{pmatrix}
1 &amp; -1 &amp; -1 &amp; -1 \\
1 &amp; 1 &amp; -1 &amp; -1 \\
1 &amp; 0 &amp; 2 &amp; -1 \\
1 &amp; 0 &amp; 0 &amp; 3
\end{pmatrix}
\begin{pmatrix}
\beta_0 \\
\beta_1 \\
\beta_2 \\
\beta_3
\end{pmatrix}
\]</span></p>
<p>Let’s verify this in R:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the symbolic parameter vector for Helmert contrasts</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>beta_helmert <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">beta_0"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">beta_1"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">beta_2"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">beta_3"</span>), <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Symbolic multiplication</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">4</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  terms <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(X_helmert[i,j] <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>      term <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X_helmert[i,j] <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste0</span>(beta_helmert[j]), </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste0</span>(X_helmert[i,j], <span class="st">"*"</span>, beta_helmert[j]))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      terms <span class="ot">&lt;-</span> <span class="fu">c</span>(terms, term)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(terms, <span class="at">collapse=</span><span class="st">" + "</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the symbolic representation</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Level =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>), </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">Mean =</span> <span class="fu">c</span>(<span class="st">"?_a"</span>, <span class="st">"?_b"</span>, <span class="st">"?_c"</span>, <span class="st">"?_d"</span>), </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">Expression =</span> result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This would yield:</p>
<pre><code>  Level Mean                   Expression
1     a  ?_a     ?0 - ?1 - ?2 - ?3
2     b  ?_b     ?0 + ?1 - ?2 - ?3
3     c  ?_c     ?0 + 2*?2 - ?3
4     d  ?_d     ?0 + 3*?3</code></pre>
<p>From this, we can solve for the coefficients in terms of means:</p>
<ul>
<li><span class="math inline">\(\beta_0 = (\mu_a + \mu_b + \mu_c + \mu_d)/4\)</span> (Grand mean)</li>
<li><span class="math inline">\(\beta_1 = (\mu_b - \mu_a)/2\)</span></li>
<li><span class="math inline">\(\beta_2 = (\mu_c - (\mu_a + \mu_b)/2)/3\)</span></li>
<li><span class="math inline">\(\beta_3 = (\mu_d - (\mu_a + \mu_b + \mu_c)/3)/4\)</span></li>
</ul>
</section>
<section id="scaled-helmert-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="scaled-helmert-contrasts">Scaled Helmert Contrasts</h3>
<p>R actually uses a scaled version of Helmert contrasts by default, which makes interpretation more straightforward:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the scaled Helmert contrasts that R uses by default</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>scaled_helmert <span class="ot">&lt;-</span> <span class="fu">contr.helmert</span>(<span class="dv">4</span>, <span class="at">contrasts =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>scaled_helmert</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The scaled contrasts make it easier to interpret the parameters directly as differences between a level and the mean of previous levels.</p>
<hr>
<p>MF: Can you create a matrix expression to show the contrast matrices, C{treat}, C{sum}, and C_{Helmert} to show the result of contrast.treatment(4), contrast.sum(4) and contrast.Helmert(4) side by side</p>
</section>
</section>
</section>
<section id="comparison-of-contrast-matrices-in-r" class="level1">
<h1>Comparison of Contrast Matrices in R</h1>
<section id="treatment-sum-and-helmert-contrasts-side-by-side" class="level2">
<h2 class="anchored" data-anchor-id="treatment-sum-and-helmert-contrasts-side-by-side">Treatment, Sum, and Helmert Contrasts Side by Side</h2>
<p>For a factor with 4 levels (a, b, c, d), the three most common contrast matrices are:</p>
<section id="contrast-matrices-without-intercept" class="level3">
<h3 class="anchored" data-anchor-id="contrast-matrices-without-intercept">Contrast Matrices Without Intercept</h3>
<p><span class="math display">\[
\mathbf{C}_{treat} =
\begin{pmatrix}
0 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
\quad
\mathbf{C}_{sum} =
\begin{pmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1 \\
-1 &amp; -1 &amp; -1
\end{pmatrix}
\quad
\mathbf{C}_{Helmert} =
\begin{pmatrix}
-1 &amp; -1 &amp; -1 \\
1 &amp; -1 &amp; -1 \\
0 &amp; 2 &amp; -1 \\
0 &amp; 0 &amp; 3
\end{pmatrix}
\]</span></p>
<p>These matrices correspond to the R functions <code>contr.treatment(4)</code>, <code>contr.sum(4)</code>, and <code>contr.helmert(4)</code> respectively.</p>
</section>
<section id="full-design-matrices-with-intercept" class="level3">
<h3 class="anchored" data-anchor-id="full-design-matrices-with-intercept">Full Design Matrices with Intercept</h3>
<p>When we include the intercept column, the full design matrices become:</p>
<p><span class="math display">\[
\mathbf{X}_{treat} =
\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\quad
\mathbf{X}_{sum} =
\begin{pmatrix}
1 &amp; 1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 1 \\
1 &amp; -1 &amp; -1 &amp; -1
\end{pmatrix}
\quad
\mathbf{X}_{Helmert} =
\begin{pmatrix}
1 &amp; -1 &amp; -1 &amp; -1 \\
1 &amp; 1 &amp; -1 &amp; -1 \\
1 &amp; 0 &amp; 2 &amp; -1 \\
1 &amp; 0 &amp; 0 &amp; 3
\end{pmatrix}
\]</span></p>
</section>
</section>
<section id="r-code-for-direct-comparison" class="level2">
<h2 class="anchored" data-anchor-id="r-code-for-direct-comparison">R Code for Direct Comparison</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and compare contrast matrices</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">4</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>sum_contrast <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">4</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>helmert <span class="ot">&lt;-</span> <span class="fu">contr.helmert</span>(<span class="dv">4</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the contrast matrices</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Treatment Contrasts (contr.treatment):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(treatment)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Sum Contrasts (contr.sum):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sum_contrast)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Helmert Contrasts (contr.helmert):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(helmert)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create full design matrices (with intercept)</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>X_treat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, treatment)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>X_sum <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, sum_contrast)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>X_helmert <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, helmert)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example data</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">12</span>)  <span class="co"># Example means for levels a, b, c, d</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models with different contrasts</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>factor_treat <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>))</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>factor_sum <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>))</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>factor_helmert <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>))</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Set contrasts for each factor</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(factor_treat) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">4</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(factor_sum) <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">4</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(factor_helmert) <span class="ot">&lt;-</span> <span class="fu">contr.helmert</span>(<span class="dv">4</span>)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame with one observation per level</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">treat =</span> factor_treat,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">sum =</span> factor_sum,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">helmert =</span> factor_helmert</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models using each contrast</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>model_treat <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> treat, <span class="at">data =</span> data)</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>model_sum <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> sum, <span class="at">data =</span> data)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>model_helmert <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> helmert, <span class="at">data =</span> data)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare coefficients</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Treatment Contrast Coefficients:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">coef</span>(model_treat))</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Sum Contrast Coefficients:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">coef</span>(model_sum))</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Helmert Contrast Coefficients:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">coef</span>(model_helmert))</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify that all models produce the same fitted values</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Fitted values (should be identical for all models):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">Original =</span> y,</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">Treatment =</span> <span class="fu">fitted</span>(model_treat),</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sum =</span> <span class="fu">fitted</span>(model_sum),</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">Helmert =</span> <span class="fu">fitted</span>(model_helmert)</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="interpretation-of-coefficients-2" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-of-coefficients-2">Interpretation of Coefficients</h2>
<p>The key difference between these contrasts is in how the coefficients are interpreted:</p>
<section id="treatment-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="treatment-contrasts">1. Treatment Contrasts</h3>
<ul>
<li><strong>Intercept (<span class="math inline">\(\beta_0\)</span>):</strong> Mean of reference level ‘a’</li>
<li><strong>Coefficients:</strong> Differences from reference level
<ul>
<li><span class="math inline">\(\beta_1 = \mu_b - \mu_a\)</span></li>
<li><span class="math inline">\(\beta_2 = \mu_c - \mu_a\)</span></li>
<li><span class="math inline">\(\beta_3 = \mu_d - \mu_a\)</span></li>
</ul></li>
</ul>
</section>
<section id="sum-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="sum-contrasts">2. Sum Contrasts</h3>
<ul>
<li><strong>Intercept (<span class="math inline">\(\beta_0\)</span>):</strong> Grand mean across all levels</li>
<li><strong>Coefficients:</strong> Deviations from the grand mean
<ul>
<li><span class="math inline">\(\beta_1 = \mu_a - \bar{\mu}\)</span></li>
<li><span class="math inline">\(\beta_2 = \mu_b - \bar{\mu}\)</span></li>
<li><span class="math inline">\(\beta_3 = \mu_c - \bar{\mu}\)</span></li>
<li>(and <span class="math inline">\(\mu_d - \bar{\mu} = -(\beta_1 + \beta_2 + \beta_3)\)</span>)</li>
</ul></li>
</ul>
</section>
<section id="helmert-contrasts-1" class="level3">
<h3 class="anchored" data-anchor-id="helmert-contrasts-1">3. Helmert Contrasts</h3>
<ul>
<li><strong>Intercept (<span class="math inline">\(\beta_0\)</span>):</strong> Grand mean across all levels</li>
<li><strong>Coefficients:</strong> Compare each level to mean of previous levels
<ul>
<li><span class="math inline">\(\beta_1\)</span> relates to <span class="math inline">\(\mu_b - \mu_a\)</span></li>
<li><span class="math inline">\(\beta_2\)</span> relates to <span class="math inline">\(\mu_c - \frac{\mu_a + \mu_b}{2}\)</span></li>
<li><span class="math inline">\(\beta_3\)</span> relates to <span class="math inline">\(\mu_d - \frac{\mu_a + \mu_b + \mu_c}{3}\)</span></li>
</ul></li>
</ul>
</section>
</section>
<section id="relationship-with-mean-values" class="level2">
<h2 class="anchored" data-anchor-id="relationship-with-mean-values">Relationship with Mean Values</h2>
<p>For all three contrast types, we can express the relationship between the parameter vector <span class="math inline">\(\boldsymbol{\beta}\)</span> and the means vector <span class="math inline">\(\boldsymbol{\mu}\)</span> as:</p>
<p><span class="math display">\[\boldsymbol{\mu} = \mathbf{X}\boldsymbol{\beta}\]</span></p>
<p>This means each factor level mean can be expressed as a linear combination of the model parameters, but the specific formula differs based on the contrast type.</p>
<p>When using the symbolic vector of means <span class="math inline">\(\boldsymbol{\mu} = (\mu_a, \mu_b, \mu_c, \mu_d)^\top\)</span>, we get:</p>
<section id="for-treatment-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="for-treatment-contrasts">For Treatment Contrasts:</h3>
<p><span class="math display">\[\mu_a = \beta_0\]</span> <span class="math display">\[\mu_b = \beta_0 + \beta_1\]</span> <span class="math display">\[\mu_c = \beta_0 + \beta_2\]</span> <span class="math display">\[\mu_d = \beta_0 + \beta_3\]</span></p>
</section>
<section id="for-sum-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="for-sum-contrasts">For Sum Contrasts:</h3>
<p><span class="math display">\[\mu_a = \beta_0 + \beta_1\]</span> <span class="math display">\[\mu_b = \beta_0 + \beta_2\]</span> <span class="math display">\[\mu_c = \beta_0 + \beta_3\]</span> <span class="math display">\[\mu_d = \beta_0 - \beta_1 - \beta_2 - \beta_3\]</span></p>
</section>
<section id="for-helmert-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="for-helmert-contrasts">For Helmert Contrasts:</h3>
<p><span class="math display">\[\mu_a = \beta_0 - \beta_1 - \beta_2 - \beta_3\]</span> <span class="math display">\[\mu_b = \beta_0 + \beta_1 - \beta_2 - \beta_3\]</span> <span class="math display">\[\mu_c = \beta_0 + 2\beta_2 - \beta_3\]</span> <span class="math display">\[\mu_d = \beta_0 + 3\beta_3\]</span></p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>