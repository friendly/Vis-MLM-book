<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>13&nbsp; Multiviate Influence and Robust Estimation – Visualizing Multivariate Data and Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./14-case-studies.html" rel="next">
<link href="./12-eqcov.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-17e746a5a36f38a88c5f5cc681d9ba3d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-hotelling.html">Multivariate Linear Models</a></li><li class="breadcrumb-item"><a href="./13-infl-robust.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiviate Influence and Robust Estimation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-hotelling.html">Multivariate Linear Models</a></li><li class="breadcrumb-item"><a href="./13-infl-robust.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiviate Influence and Robust Estimation</span></a></li></ol></nav>
      <h1 class="title"><span id="sec-influence-robust" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiviate Influence and Robust Estimation</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-Author.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Author</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Orienting Ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-Prelude.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Warm-up Exercises</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Exploratory Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Univariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for Univariate Response Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Multivariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-infl-robust.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiviate Influence and Robust Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Case Studies</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">End Matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./95-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-multivariate-influence" id="toc-sec-multivariate-influence" class="nav-link active" data-scroll-target="#sec-multivariate-influence"><span class="header-section-number">13.1</span> Multivariate influence</a>
  <ul class="collapse">
<li><a href="#notation" id="toc-notation" class="nav-link" data-scroll-target="#notation"><span class="header-section-number">13.1.1</span> Notation</a></li>
  <li><a href="#hat-values-and-residuals" id="toc-hat-values-and-residuals" class="nav-link" data-scroll-target="#hat-values-and-residuals"><span class="header-section-number">13.1.2</span> Hat values and residuals</a></li>
  <li><a href="#cooks-distance" id="toc-cooks-distance" class="nav-link" data-scroll-target="#cooks-distance"><span class="header-section-number">13.1.3</span> Cook’s distance</a></li>
  <li><a href="#leverage-and-residual-components" id="toc-leverage-and-residual-components" class="nav-link" data-scroll-target="#leverage-and-residual-components"><span class="header-section-number">13.1.4</span> Leverage and residual components</a></li>
  </ul>
</li>
  <li>
<a href="#the-mysterious-case-9" id="toc-the-mysterious-case-9" class="nav-link" data-scroll-target="#the-mysterious-case-9"><span class="header-section-number">13.2</span> The Mysterious Case 9</a>
  <ul class="collapse">
<li><a href="#sec-cookd-multivar" id="toc-sec-cookd-multivar" class="nav-link" data-scroll-target="#sec-cookd-multivar"><span class="header-section-number">13.2.1</span> Cook’s D</a></li>
  <li><a href="#dfbetas" id="toc-dfbetas" class="nav-link" data-scroll-target="#dfbetas"><span class="header-section-number">13.2.2</span> DFBETAS</a></li>
  </ul>
</li>
  <li><a href="#example-nlsy-data" id="toc-example-nlsy-data" class="nav-link" data-scroll-target="#example-nlsy-data"><span class="header-section-number">13.3</span> Example: NLSY data</a></li>
  <li><a href="#sec-peng-mvinfluence" id="toc-sec-peng-mvinfluence" class="nav-link" data-scroll-target="#sec-peng-mvinfluence"><span class="header-section-number">13.4</span> Example: Penguin data</a></li>
  <li><a href="#sec-robust-estimation" id="toc-sec-robust-estimation" class="nav-link" data-scroll-target="#sec-robust-estimation"><span class="header-section-number">13.5</span> Robust Estimation</a></li>
  <li><a href="#sec-peng-robust" id="toc-sec-peng-robust" class="nav-link" data-scroll-target="#sec-peng-robust"><span class="header-section-number">13.6</span> Example: Penguin data</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- \require{newcommand} --><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \providecommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- \newcommand*{\E}{\mathcal{E}} --><!-- Index generation --><!-- % R packages:  indexed under both package name and packages! --><!-- % data sets:  --><!-- % R stuff --><!--
::: {.callout-note}
This chapter may be moved from the printed PDF copy to an online Appendix.
:::
--><p>In the analysis of linear models, the identification and treatment of outliers and influential observations represents one of the most critical, yet challenging, aspects of statistical modeling. As you saw earlier (<a href="#sec-leverage" class="quarto-xref"><span class="quarto-unresolved-ref">sec-leverage</span></a>), even a single “bad” observation can completely alter the results of a linear model fit by ordinary least squares. In the analysis of the dataset <code><a href="https://friendly.github.io/heplots/reference/schooldata.html">heplots::schooldata</a></code> (<a href="#sec-multivar-infl" class="quarto-xref"><span class="quarto-unresolved-ref">sec-multivar-infl</span></a>), we found a collection of cases that exerted undue influence on the fitted model and its’ interpretation. In this chapter, I extend the earlier discussion of multivariate influence and introduce some methods of robust estimation to deal with unruly observations.</p>
<p>Univariate influence diagnostics have been well-established since the pioneering work of <span class="citation" data-cites="Cook:77">Cook (<a href="#ref-Cook:77" role="doc-biblioref">1977</a>)</span> and others (<span class="citation" data-cites="Belsley-etal:80">Belsley et al. (<a href="#ref-Belsley-etal:80" role="doc-biblioref">1980</a>)</span>; <span class="citation" data-cites="CookWeisberg:82">Cook &amp; Weisberg (<a href="#ref-CookWeisberg:82" role="doc-biblioref">1982</a>)</span>). Their wide implementation in R packages such as <span style="color: brown;"><strong>stats</strong></span> and <span style="color: brown;"><strong>car</strong></span>makes these readily accessible in statistical practice.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Thus, if you seek statistical advice regarding a perplexing model, one that defies interpretation or has inconsistencies, your consultant may very well ask you:</p>
<blockquote class="blockquote">
<p><em>Did you make any influence or other diagnostic plots?</em></p>
</blockquote>
<p>However, the extension to multivariate response models introduces additional complexity that goes far beyond simply applying univariate methods to each response variable separately. The multivariate case requires consideration of the <em>joint influence</em> structure across all responses simultaneously, accounting for the correlation patterns among dependent variables and the potential for observations to be influential in some linear combinations of responses while appearing benign when examined multivariate.</p>
<p>This multivariate perspective can reveal influence patterns that would otherwise remain hidden, as an observation might exert substantial leverage on the overall model fit through subtle but systematic effects across multiple responses. Detecting outliers and influential observations has now progressed to the point where the methods described below (<a href="#sec-multivariate-influence" class="quarto-xref"><span class="quarto-unresolved-ref">sec-multivariate-influence</span></a>) can usefully be applied to multivariate linear models.</p>
<p>Having found some troublesome cases, the question arises: what should you do about them? We are generally reluctant to simply ignore them, unless there is evidence of a gross data error (as in the <code>Davis</code> data, <a href="#sec-davis" class="quarto-xref"><span class="quarto-unresolved-ref">sec-davis</span></a>). Instead, a large class of <strong>robust</strong> methods, which reduce the impact of outliers on the analysis, have been developed. These are described for multivariate models in <a href="#sec-robust-estimation" class="quarto-xref"><span class="quarto-unresolved-ref">sec-robust-estimation</span></a> below. The <a href="https://CRAN.R-project.org/view=Robust">CRAN Task View on Robust Estimation</a> provides a comprehensive overview of R packages for robust estimation.</p>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://friendly.github.io/heplots/">heplots</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/candisc/">candisc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/mvinfluence">mvinfluence</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-multivariate-influence" class="level2" data-number="13.1"><h2 data-number="13.1" class="anchored" data-anchor-id="sec-multivariate-influence">
<span class="header-section-number">13.1</span> Multivariate influence</h2>
<p>An elegant extension of the ideas behind leverage, studentized residuals and measures of influence to the case of multivariate response data is due to <span class="citation" data-cites="BarrettLing:92">Barrett &amp; Ling (<a href="#ref-BarrettLing:92" role="doc-biblioref">1992</a>)</span>, and illustrated in <span class="citation" data-cites="Barrett:2003">Barrett (<a href="#ref-Barrett:2003" role="doc-biblioref">2003</a>)</span>. These methods have been implemented in the <span style="color: brown;"><strong>mvinfluence</strong></span> package <span class="citation" data-cites="R-mvinfluence">(<a href="#ref-R-mvinfluence" role="doc-biblioref">Friendly, 2025</a>)</span> which makes available several forms of influence plots to visualize the results.</p>
<p>As in the univariate case, the measures of multivariate influence stem from the <em>case-deletion</em> idea: comparing some statistic calculated from the <em>full sample</em> to that statistic calculated when case <span class="math inline">\(i\)</span> is deleted. The Barrett-Ling approach generalized this to the case of deleting a set <span class="math inline">\(I\)</span> of <span class="math inline">\(m \ge 1\)</span> cases. This can be useful because some cases can “mask” the influence of others in the sense that when one is deleted, others become much more influential. However, in most cases the default of deleting individual observations (<span class="math inline">\(m=1\)</span>) is sufficient.</p>
<section id="notation" class="level3" data-number="13.1.1"><h3 data-number="13.1.1" class="anchored" data-anchor-id="notation">
<span class="header-section-number">13.1.1</span> Notation</h3>
<p>To explain the extension of influence diagnostics to the multivariate case, it is useful to define some notation used to designate terms in the model calculated from the <em>complete</em> dataset versus those calculated with one or more observations <em>excluded</em>. As before, let <span class="math inline">\(\mathbf{X}\)</span> be the model matrix in the multivariate linear model, <span class="math inline">\(\mathbf{Y}_{n \times p} = \mathbf{X}_{n \times q} \; \mathbf{B}_{q \times p} + \mathbf{E}_{n \times p}\)</span>. As we know, the usual least squares estimate of <span class="math inline">\(\mathbf{B}\)</span> is given by <span class="math inline">\(\mathbf{B} = (\mathbf{X}^\top \mathbf{X})^{-1}  \mathbf{X}^\top \mathbf{Y}\)</span>.</p>
<p>Then let:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{X}_I\)</span> be the <em>submatrix</em> of <span class="math inline">\(\mathbf{X}\)</span> whose <span class="math inline">\(m\)</span> rows are indexed by <span class="math inline">\(I\)</span>,</li>
<li>
<span class="math inline">\(\mathbf{X}_{(-I)}\)</span> is the <em>complement</em>, the submatrix of <span class="math inline">\(\mathbf{X}\)</span> with the <span class="math inline">\(m\)</span> rows in <span class="math inline">\(I\)</span> deleted,</li>
</ul>
<p>Matrices <span class="math inline">\(\mathbf{Y}_I\)</span>, <span class="math inline">\(\mathbf{Y}_{(-I)}\)</span> are defined similarly, denoting the submatrix of <span class="math inline">\(m\)</span> rows of <span class="math inline">\(\mathbf{Y}\)</span> and the submatrix with those rows deleted, respectively.</p>
<p>The calculation of regression coefficients when the cases indexed by <span class="math inline">\(I\)</span> have been removed has the form <span class="math inline">\(\mathbf{B}_{(-I)} = (\mathbf{X}_{(-I)}^\top \mathbf{X}_{(-I)})^{-1} \mathbf{X}_{(-I)}^\top \mathbf{Y}_{I}\)</span>. The corresponding residuals are expressed as <span class="math inline">\(\mathbf{E}_{(-I)} = \mathbf{Y}_{(-I)} - \mathbf{X}_{(-I)} \mathbf{B}_{(-I)}\)</span>.</p>
</section><section id="hat-values-and-residuals" class="level3" data-number="13.1.2"><h3 data-number="13.1.2" class="anchored" data-anchor-id="hat-values-and-residuals">
<span class="header-section-number">13.1.2</span> Hat values and residuals</h3>
<p>The influence measures defined by <span class="citation" data-cites="BarrettLing:92">Barrett &amp; Ling (<a href="#ref-BarrettLing:92" role="doc-biblioref">1992</a>)</span> are functions of two matrices <span class="math inline">\(\mathbf{H}_I\)</span> and <span class="math inline">\(\mathbf{Q}_I\)</span> corresponding to hat values and residuals, defined as follows:</p>
<ul>
<li>For the full data set, the “hat matrix”, <span class="math inline">\(\mathbf{H}\)</span>, is given by <span class="math inline">\(\mathbf{H} = \mathbf{X} (\mathbf{X}^\top \mathbf{X})^{-1} \mathbf{X}^\top\)</span>,</li>
<li>
<span class="math inline">\(\mathbf{H}_I\)</span> is the <span class="math inline">\(m \times m\)</span> the submatrix of <span class="math inline">\(\mathbf{H}\)</span> corresponding to the index set <span class="math inline">\(I\)</span>, <span class="math inline">\(\mathbf{H}_I = \mathbf{X} (\mathbf{X}_I^\top \mathbf{X}_I)^{-1} \mathbf{X}^\top\)</span>,</li>
<li>
<span class="math inline">\(\mathbf{Q}\)</span> is the analog of <span class="math inline">\(\mathbf{H}\)</span> defined for the residual matrix <span class="math inline">\(\mathbf{E}\)</span>, that is, <span class="math inline">\(\mathbf{Q} = \mathbf{E} (\mathbf{E}^\top \mathbf{E})^{-1} \mathbf{E}^\top\)</span>, with corresponding submatrix <span class="math inline">\(\mathbf{Q}_I = \mathbf{E} \, (\mathbf{E}_I^\top \mathbf{E}_I)^{-1} \, \mathbf{E}^\top\)</span>,</li>
</ul>
<p>Based on these quantitites, Barrett and Ling <span class="citation" data-cites="BarrettLing:92">(<a href="#ref-BarrettLing:92" role="doc-biblioref">1992</a>)</span> defined multivariate analogs of nearly all univariate measures suggested in the literature. I only consider their Cook’s D measure here.</p>
</section><section id="cooks-distance" class="level3" data-number="13.1.3"><h3 data-number="13.1.3" class="anchored" data-anchor-id="cooks-distance">
<span class="header-section-number">13.1.3</span> Cook’s distance</h3>
<p>Multivariate analogs of all the usual influence diagnostics (Cook’s D, CovRatio, …) can be defined in terms of <span class="math inline">\(\mathbf{H}\)</span> and <span class="math inline">\(\mathbf{Q}\)</span>. For instance, Cook’s distance is defined for a univariate response by</p>
<p><span class="math display">\[
D_I = (\mathbf{b} - \mathbf{b}_{(-I)})^T (\mathbf{X}^T \mathbf{X}) (\mathbf{b} - \mathbf{b}_{(-I)}) / p s^2 \; ,
\]</span></p>
<p>a measure of the squared distance between the coefficients <span class="math inline">\(\mathbf{b}\)</span> for the full data set and those <span class="math inline">\(\mathbf{b}_{(-I)}\)</span> obtained when the cases in <span class="math inline">\(I\)</span> are deleted.</p>
<p>In the multivariate case, Cook’s distance is obtained by replacing the vector of coefficients <span class="math inline">\(\mathbf{b}\)</span> by <span class="math inline">\(\mathrm{vec} (\mathbf{B})\)</span>, which is the result of stringing out the coefficients for all responses in a single <span class="math inline">\((n \times p)\)</span>-length vector.</p>
<p><span class="math display">\[
D_I = \frac{1}{p} \; [\mathrm{vec} (\mathbf{B} - \mathbf{B}_{(-I)})]^T \; (S^{-1} \otimes \mathbf{X}^T \mathbf{X}) \; \mathrm{vec} (\mathbf{B} - \mathbf{B}_{(-I)})  \; ,
\]</span> where <span class="math inline">\(\otimes\)</span> is the Kronecker (direct) product and <span class="math inline">\(\mathbf{S} = \mathbf{E}^T \mathbf{E} / (n-p)\)</span> is the covariance matrix of the residuals.</p>
</section><section id="leverage-and-residual-components" class="level3" data-number="13.1.4"><h3 data-number="13.1.4" class="anchored" data-anchor-id="leverage-and-residual-components">
<span class="header-section-number">13.1.4</span> Leverage and residual components</h3>
<p>We gain further insight by considering how far we can generalize from the case for a univariate response. For single-case deletions (<span class="math inline">\(m = 1\)</span>), Cook’s distance can be re-written as a product of leverage and residual components as:</p>
<p><span class="math display">\[
D_i = \left(\frac{n-p}{p} \right) \frac{h_{ii} q_{ii}}{(1 - h_{ii})^2  } \;.
\]</span></p>
<p>This suggests that we can factor that to define a <em>leverage component</em> <span class="math inline">\(L_i\)</span> and <em>residual component</em> <span class="math inline">\(R_i\)</span> as the product of two terms,</p>
<p><span class="math display">\[
L_i = \frac{h_{ii}}{1 - h_{ii}} \quad\quad R_i = \frac{q_{ii}}{1 - h_{ii}} \;.
\]</span></p>
<p><span class="math inline">\(R_i\)</span> is the studentized residual here. Thus <span class="math inline">\(D_i \propto L_i \times R_i\)</span>. This idea is used to define a new version of influence plot, as illustrated in the following (<a href="#sec-cookd-multivar" class="quarto-xref"><span class="quarto-unresolved-ref">sec-cookd-multivar</span></a>).</p>
<p>In the general, multivariate case there are analogous matrix expressions for <span class="math inline">\(\mathbf{L}\)</span> and <span class="math inline">\(\mathbf{R}\)</span>. When <span class="math inline">\(m &gt; 1\)</span>, the quantities <span class="math inline">\(\mathbf{H}_I\)</span>, <span class="math inline">\(\mathbf{Q}_I\)</span>, <span class="math inline">\(\mathbf{L}_I\)</span>, and <span class="math inline">\(\mathbf{R}_I\)</span> are <span class="math inline">\(m \times m\)</span> matrices. Where scalar quantities are needed, the <span style="color: brown;"><strong>mvinfluence</strong></span> functions apply a function, <code>FUN</code>, either <code><a href="https://rdrr.io/r/base/det.html">det()</a></code> or <code><a href="http://friendly.github.io/mvinfluence/reference/tr.html">tr()</a></code> to calculate a measure of “size”. This is done as:</p>
<pre data-code-line-numbers=""><code>H &lt;- sapply(x$H, FUN)
Q &lt;- sapply(x$Q, FUN)
L &lt;- sapply(x$L, FUN)
R &lt;- sapply(x$R, FUN)</code></pre>
<p>This is the same trick used in the calculation of the various multivariate test statistics like Wilks’ Lambda and Pillai’s trace. In this way, the full range of multivariate influence measures discussed by <span class="citation" data-cites="Barrett:2003">Barrett (<a href="#ref-Barrett:2003" role="doc-biblioref">2003</a>)</span> can be calculated.</p>
</section></section><section id="the-mysterious-case-9" class="level2" data-number="13.2"><h2 data-number="13.2" class="anchored" data-anchor-id="the-mysterious-case-9">
<span class="header-section-number">13.2</span> The Mysterious Case 9</h2>
<p>To illustrate these ideas this toy example, from <span class="citation" data-cites="Barrett:2003">Barrett (<a href="#ref-Barrett:2003" role="doc-biblioref">2003</a>)</span>, considers the simplest case, of one predictor (<code>x</code>) and two response variables, <code>y1</code> and <code>y2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Toy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>   case <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,</span>
<span>   x <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,    <span class="fl">1</span>,    <span class="fl">2</span>,    <span class="fl">2</span>,    <span class="fl">3</span>,    <span class="fl">3</span>,    <span class="fl">4</span>,    <span class="fl">4</span>,    <span class="fl">10</span><span class="op">)</span>,</span>
<span>   y1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">1.90</span>, <span class="fl">1.00</span>, <span class="fl">2.95</span>, <span class="fl">2.10</span>, <span class="fl">4.00</span>, <span class="fl">2.95</span>, <span class="fl">4.95</span>, <span class="fl">10.00</span><span class="op">)</span>,</span>
<span>   y2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">1.80</span>, <span class="fl">1.00</span>, <span class="fl">2.93</span>, <span class="fl">2.00</span>, <span class="fl">4.10</span>, <span class="fl">3.05</span>, <span class="fl">4.93</span>, <span class="fl">10.00</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A quick peek (<a href="#fig-toy-scatmat" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-toy-scatmat</span></a>) at the data indicates that <code>y1</code> and <code>y2</code> are nearly perfectly correlated with each other. Both of these are also strongly linear with <code>x</code> and there is one extreme point (case 9). The data is pecuiliar, but looking at these pairwise plots doesn’t suggest that anything is terribly wrong. In the plots of <code>y1</code> and <code>y2</code> against <code>x</code>, case 9 simply looks like a good leverage point (<a href="#sec-leverage" class="quarto-xref"><span class="quarto-unresolved-ref">sec-leverage</span></a>).</p>
<!-- fig.code: R/mvinfluence-Toy.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">y1</span> <span class="op">+</span> <span class="va">y2</span> <span class="op">+</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">Toy</span>, </span>
<span>  cex<span class="op">=</span><span class="fl">2</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>  regLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-toy-scatmat" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-toy-scatmat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-toy-scatmat-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-toy-scatmat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.1: Scatterplot matrix for the toy example.
</figcaption></figure>
</div>
</div>
</div>
<p>For this example, we fit the univariate models with <code>y1</code> and <code>y2</code> separately and then the multivariate model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Toy.lm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y1</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">Toy</span><span class="op">)</span></span>
<span><span class="va">Toy.lm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y2</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">Toy</span><span class="op">)</span></span>
<span><span class="va">Toy.mlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">Toy</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-cookd-multivar" class="level3" data-number="13.2.1"><h3 data-number="13.2.1" class="anchored" data-anchor-id="sec-cookd-multivar">
<span class="header-section-number">13.2.1</span> Cook’s D</h3>
<p>First, let’s examine the Cook’s D statistics for the models. Note that the function <code><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance()</a></code> invokes <code><a href="https://rdrr.io/r/stats/influence.measures.html">stats::cooks.distance.lm()</a></code> for the univariate response models, but invokes <code><a href="http://friendly.github.io/mvinfluence/reference/cooks.distance.mlm.html">mvinfluence::cooks.distance.mlm()</a></code> for the multivariate model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">Toy</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">D1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">Toy.lm1</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">D2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">Toy.lm2</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">D12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">Toy.mlm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co"># # A tibble: 9 × 7</span></span>
<span><span class="co">#    case     x    y1    y2      D1      D2    D12</span></span>
<span><span class="co">#   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co"># 1     1     1  0.1   0.1  0.121   0.118   0.125 </span></span>
<span><span class="co"># 2     2     1  1.9   1.8  0.124   0.103   0.298 </span></span>
<span><span class="co"># 3     3     2  1     1    0.0901  0.0886  0.0906</span></span>
<span><span class="co"># 4     4     2  2.95  2.93 0.0829  0.0819  0.0831</span></span>
<span><span class="co"># 5     5     3  2.1   2    0.0548  0.0673  0.182 </span></span>
<span><span class="co"># 6     6     3  4     4.1  0.0692  0.0852  0.232 </span></span>
<span><span class="co"># 7     7     4  2.95  3.05 0.0793  0.0651  0.203 </span></span>
<span><span class="co"># 8     8     4  4.95  4.93 0.0665  0.0643  0.0690</span></span>
<span><span class="co"># 9     9    10 10    10    0.00159 0.00830 3.22</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The only thing remarkable here is for case 9: The univariate Cook’s <span class="math inline">\(D\)</span>s, <code>D1</code> and <code>D2</code>, are very small, yet the multivariate statistic, <code>D12=3.22</code> is over 10 times the next largest value.</p>
<p>Let’s see how case 9 stands out in the influence plots (<a href="#fig-toy-inflplots" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-toy-inflplots</span></a>). It has an extreme hat value. But, because it’s residual is very small, it does not have much influence on the fitted models for either <code>y1</code> or <code>y2</code>. Neither of these plots suggest that anything is terribly wrong with the univariate models—none of the points are in the “danger” zones of the upper- and lower-right corners.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ip1</span> <span class="op">&lt;-</span> <span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">Toy.lm1</span>, </span>
<span>                          id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>, cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">ip2</span> <span class="op">&lt;-</span> <span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">Toy.lm2</span>, </span>
<span>                          id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>, cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-toy-inflplots" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-toy-inflplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-toy-inflplots-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-toy-inflplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.2: Influence plots for the univariate models for <code>y1</code> and <code>y2</code>
</figcaption></figure>
</div>
</div>
</div>
<p><strong>TODO</strong>: Check how these are defined in mvinfluence</p>
<p>Contrast these results with what we get for the model for <code>y1</code> and <code>y2</code> jointly (<a href="#fig-toy-inflplot-mlm-stres" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-toy-inflplot-mlm-stres</span></a>) In the multivariate version, <code><a href="http://friendly.github.io/mvinfluence/reference/influencePlot.mlm.html">mvinfluence::influencePlot.mlm()</a></code> plots the squared studentized residual (denoted <code>R</code> in the output) against the hat value; this is referred to as a `type = “stres” plot.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Case 9 stands in <a href="#fig-toy-inflplot-mlm-stres" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-toy-inflplot-mlm-stres</span></a> out as wildly influential on the joint regression model. But there’s more: The cases in <a href="#fig-toy-inflplots" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-toy-inflplots</span></a> with large Cook’s D (bubble size) have only tiny influence in the multivariate model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">Toy.mlm</span>, type <span class="op">=</span> <span class="st">"stres"</span>,</span>
<span>              id.n<span class="op">=</span><span class="fl">2</span>, id.cex <span class="op">=</span> <span class="fl">1.3</span>,</span>
<span>              cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co">#       H     Q CookD     L     R</span></span>
<span><span class="co"># 1 0.202 0.177 0.125 0.253 0.222</span></span>
<span><span class="co"># 2 0.202 0.422 0.298 0.253 0.529</span></span>
<span><span class="co"># 6 0.113 0.587 0.232 0.127 0.662</span></span>
<span><span class="co"># 9 0.852 1.082 3.225 5.750 7.301</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-toy-inflplot-mlm-stres" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-toy-inflplot-mlm-stres-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-toy-inflplot-mlm-stres-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-toy-inflplot-mlm-stres-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.3: Studentized residual influence plot for the multivariate model <code>(y1, y2) ~ x</code>. Dotted vertical lines mark large hat values, <span class="math inline">\(H &gt; {2, 3} p/n\)</span>. The dotted horizontal line marks large values of the squared studentized residual.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Theory into Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory into Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>Chairman Mao said, “Theory into practice”, but <span class="citation" data-cites="Tukey:59">Tukey (<a href="#ref-Tukey:59" role="doc-biblioref">1959</a>)</span> said that, “The practical power of a statistical test is the product of its’ statistical power and the probability of use”. The story for multivariate influence here illustrates a nice feature of the connections between statistical theory, graphic development and implemented in software here.</p>
<p>A statistical development proposes a new way of thinking about a problem. Someone with a graphical bent looks at this and think, “How can I visualize this?”. A software developer then solves the remaining problem of how to incorporate that into easy-to-use functions or applications. If only this was easy. But sometimes, all three roles appear within a given person as was the case here.</p>
</div>
</div>
<p>The general formulation of <span class="citation" data-cites="Barrett:2003">Barrett (<a href="#ref-Barrett:2003" role="doc-biblioref">2003</a>)</span> suggests an alternative form of the multivariate influence plot (<a href="#fig-toy-inflplot-mlm-LR" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-toy-inflplot-mlm-LR</span></a>) that uses the leverage (<code>L</code>) and residual (<code>R</code>) components directly, specified as <code>type = "LR"</code>.</p>
<p>Because influence is the product of leverage and residual, a plot of <span class="math inline">\(\log(L)\)</span> versus <span class="math inline">\(\log(R)\)</span> has the attractive property that contours of constant Cook’s distance fall on diagonal lines with slope = -1. Adjacent reference lines represent constant <em>multiples</em> of influence. Further from the origin implies greater influence, as opposed to other forms, where conventional cutoffs are used to show regions of high influence.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">Toy.mlm</span>, type<span class="op">=</span><span class="st">"LR"</span>,</span>
<span>              id.n<span class="op">=</span><span class="fl">2</span>, id.cex <span class="op">=</span> <span class="fl">1.3</span>,</span>
<span>              cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">infl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-toy-inflplot-mlm-LR" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-toy-inflplot-mlm-LR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-toy-inflplot-mlm-LR-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-toy-inflplot-mlm-LR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.4: LR plot of <span class="math inline">\(\log(L)\)</span> versus <span class="math inline">\(\log(R)\)</span> for the multivariate model <code>(y1, y2) ~ x</code>. Dotted lines show contours of constant Cook’s distance.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="dfbetas" class="level3" data-number="13.2.2"><h3 data-number="13.2.2" class="anchored" data-anchor-id="dfbetas">
<span class="header-section-number">13.2.2</span> DFBETAS</h3>
<p>The DFBETAS statistics give the estimated change in the regression coefficients when each case is deleted in turn. We can gain some insight as to why case 9 is unremarkable in the univariate regressions by plotting these, shown in <a href="#fig-toy-dfbetas" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-toy-dfbetas</span></a>. The values come from <code><a href="https://rdrr.io/r/stats/influence.measures.html">stats::dfbetas()</a></code> and return the standardized values.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">db1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">dfbetas</a></span><span class="op">(</span><span class="va">Toy.lm1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gg1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">db1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">`(Intercept)`</span>, y<span class="op">=</span><span class="va">x</span>, label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">db1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span>, fill<span class="op">=</span><span class="st">"pink"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Deletion Intercept  "</span>, <span class="va">b</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Deletion Slope  "</span>, <span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"dfbetas for y1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">dfbetas</a></span><span class="op">(</span><span class="va">Toy.lm2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">db2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">`(Intercept)`</span>, y<span class="op">=</span><span class="va">x</span>, label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">db2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span>, fill<span class="op">=</span><span class="st">"pink"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Deletion Intercept  "</span>, <span class="va">b</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Deletion Slope  "</span>, <span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"dfbetas for y2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg1</span> <span class="op">+</span> <span class="va">gg2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-toy-dfbetas" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="100%">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-toy-dfbetas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-toy-dfbetas-1.png" id="fig-toy-dfbetas" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-toy-dfbetas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.5
</figcaption></figure>
</div>
</div>
</div>
<p>The values for case 9 are nearly (0, 0) in both plots, indicating that deleting this case has negligible effect in both <em>univariate</em> regressions. Yet, case 9 appeared very influential in the multivariate model. Why did this happen?</p>
<p>In this contrived example, the problem arose from the very high correlation between <code>y1</code> and <code>y2</code>, <span class="math inline">\(r = 0.9997\)</span> as can be seen in the (y1, y2) panel in <a href="#fig-toy-scatmat" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-toy-scatmat</span></a>. Although each of the <code>y1</code> and <code>y2</code> values for the high-leverage cases are in-line with the univariate regressions (and thus have small univariate Cook’s Ds), the ill-conditioning magnifies small discrepancies in their positions, making the multivariate Cook’s D larger. And that’s the solution to the <em>Case of the Mysterious Case 9</em>.</p>
</section></section><section id="example-nlsy-data" class="level2" data-number="13.3"><h2 data-number="13.3" class="anchored" data-anchor-id="example-nlsy-data">
<span class="header-section-number">13.3</span> Example: NLSY data</h2>
<p>The <code><a href="https://friendly.github.io/heplots/reference/NLSY.html">heplots::NLSY</a></code> data introduced in <a href="#sec-NLSY-mmra" class="quarto-xref"><span class="quarto-unresolved-ref">sec-NLSY-mmra</span></a> provides a more realistic example of how the <em>multivariate</em> influence measures and their plots contribute to understanding multivariate data. Some plots were suggested there (<a href="#fig-NLSY-scat1" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-NLSY-scat1</span></a>) to identify “noteworthy” points. The model <code>NLSY.mod1</code> fits the child’s reading and math scores using parents’ education:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">NLSY</span>, package <span class="op">=</span> <span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="va">NLSY.mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">read</span>, <span class="va">math</span><span class="op">)</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">educ</span>, </span>
<span>                data <span class="op">=</span> <span class="va">NLSY</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For influence plots, the <code>id.method = "noteworthy"</code> method for point labeling selects observations with large values for <em>any</em> of the standardized residual, hat value or Cook’s D, so 6 points are labeled in <a href="#fig-NLSY-inflplot1" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-NLSY-inflplot1</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">NLSY.mod1</span>,</span>
<span>              id.method <span class="op">=</span> <span class="st">"noteworthy"</span>,</span>
<span>              id.n <span class="op">=</span> <span class="fl">3</span>, id.cex <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>              cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co">#           H        Q   CookD       L        R</span></span>
<span><span class="co"># 12  0.01547 0.090101 0.11149 0.01571 0.091516</span></span>
<span><span class="co"># 19  0.14656 0.004801 0.05629 0.17173 0.005625</span></span>
<span><span class="co"># 54  0.16602 0.016554 0.21986 0.19907 0.019849</span></span>
<span><span class="co"># 142 0.00509 0.208258 0.08478 0.00511 0.209323</span></span>
<span><span class="co"># 152 0.00422 0.049821 0.01682 0.00424 0.050032</span></span>
<span><span class="co"># 221 0.05707 0.000873 0.00399 0.06053 0.000926</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NLSY-inflplot1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-NLSY-inflplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-NLSY-inflplot1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NLSY-inflplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.6: Influence plot for the NLSY data…
</figcaption></figure>
</div>
</div>
</div>
<p>There is an interesting configuration of the points in <a href="#fig-NLSY-inflplot1" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-NLSY-inflplot1</span></a>. One group of points (152, 12, 142) is apparent at the left side. These have relatively low leverage (hat value), and increasingly large residuals. Another group of points (221, 19, 54) have small residuals but increasingly large hat values. You should take a moment and compare these points with their positions in <a href="#fig-NLSY-scat1" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-NLSY-scat1</span></a>. However, with <code>id.n = 2</code> only two points are flagged: 54 and 142.</p>
<p>The LR plot is also instructive here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">NLSY.mod1</span>, type <span class="op">=</span> <span class="st">"LR"</span>,</span>
<span>              id.method <span class="op">=</span> <span class="st">"noteworthy"</span>,</span>
<span>              id.n <span class="op">=</span> <span class="fl">3</span>, id.cex <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>              cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co">#           H        Q   CookD       L        R</span></span>
<span><span class="co"># 12  0.01547 0.090101 0.11149 0.01571 0.091516</span></span>
<span><span class="co"># 19  0.14656 0.004801 0.05629 0.17173 0.005625</span></span>
<span><span class="co"># 54  0.16602 0.016554 0.21986 0.19907 0.019849</span></span>
<span><span class="co"># 142 0.00509 0.208258 0.08478 0.00511 0.209323</span></span>
<span><span class="co"># 152 0.00422 0.049821 0.01682 0.00424 0.050032</span></span>
<span><span class="co"># 221 0.05707 0.000873 0.00399 0.06053 0.000926</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NLSY-inflplot2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-NLSY-inflplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-NLSY-inflplot2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NLSY-inflplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.7: Influence plot for the NLSY data…
</figcaption></figure>
</div>
</div>
</div>
<p>In <a href="#fig-NLSY-inflplot2" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-NLSY-inflplot2</span></a> the noteworthy points are arrayed within a diagonal band corresponding to contours of equal Cook’s D, and this statistic increases multiplicatively with each step away from the origin. Cases 54 and 142 stand out somewhat here.</p>
</section><section id="sec-peng-mvinfluence" class="level2" data-number="13.4"><h2 data-number="13.4" class="anchored" data-anchor-id="sec-peng-mvinfluence">
<span class="header-section-number">13.4</span> Example: Penguin data</h2>
<p>Another example illustrates the appearance of influence plots with factors as predictors. Earlier chapters (<a href="#sec-multnorm-penguin" class="quarto-xref"><span class="quarto-unresolved-ref">sec-multnorm-penguin</span></a>, <a href="#sec-dsq-penguin" class="quarto-xref"><span class="quarto-unresolved-ref">sec-dsq-penguin</span></a>) presented a variety of plots (<a href="#fig-peng-cqplot" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-peng-cqplot</span></a>, <a href="#fig-peng-ggplot-out" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-peng-ggplot-out</span></a>, <a href="#fig-peng-out-biplot2" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-peng-out-biplot2</span></a>) for the Penguin data in which a few cases were identified as unusual in exploratory analysis. But, are any of them influential in the context of a multivariate model?</p>
<p>Let’s consider the simple model predicting <code>species</code> from the numeric variables</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">peng</span>, package<span class="op">=</span><span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="va">peng.mlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bill_length</span>, <span class="va">bill_depth</span>, <span class="va">flipper_length</span>, <span class="va">body_mass</span><span class="op">)</span> <span class="op">~</span></span>
<span>                 <span class="va">species</span>, data<span class="op">=</span><span class="va">peng</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the influence plot (<a href="#fig-peng-inflplot1" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-peng-inflplot1</span></a>) the predictor <code>species</code> if of course discrete, so there are only three distinct hat-values and the values for each species appear as columns of points in this plot. For ease of interpretation, I use a little <code>dplyr</code> magic to label the species and their sample sizes.</p>
<!-- fig.code: R/peng-manova.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">peng.mlm</span>, id.n<span class="op">=</span><span class="fl">3</span>, type<span class="op">=</span><span class="st">"stres"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">CookD</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#          H      Q  CookD      L      R</span></span>
<span><span class="co"># 283 0.0147 0.0919 0.1486 0.0149 0.0932</span></span>
<span><span class="co"># 286 0.0147 0.0322 0.0520 0.0149 0.0327</span></span>
<span><span class="co"># 179 0.0084 0.0512 0.0474 0.0085 0.0517</span></span>
<span><span class="co"># 10  0.0068 0.0562 0.0424 0.0069 0.0566</span></span>
<span><span class="co"># 268 0.0147 0.0079 0.0129 0.0149 0.0081</span></span>
<span><span class="co"># 267 0.0147 0.0037 0.0061 0.0149 0.0038</span></span>
<span><span class="co"># 266 0.0147 0.0021 0.0034 0.0149 0.0021</span></span>
<span></span>
<span><span class="co"># labels for species, adding sample n</span></span>
<span><span class="va">loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">peng</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">add_count</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, </span>
<span>             <span class="va">res</span>, </span>
<span>             by <span class="op">=</span> <span class="st">"row.names"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">H</span>, <span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{species}\n(n={n})"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">loc</span><span class="op">$</span><span class="va">H</span>, <span class="fl">0.10</span>, <span class="va">loc</span><span class="op">$</span><span class="va">label</span>, xpd<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-peng-inflplot1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-inflplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-peng-inflplot1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-inflplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.8: Influence plot for the Penguin data, showing the squared studentized residual vs.&nbsp;hat value. Unusual points on either variable or on the Cook’s D statistic are identified with their case number.
</figcaption></figure>
</div>
</div>
</div>
<p>We know that hat-values are proportional to how unusual the observations are from the means of the predictors, but what is this for a factor, like <code>species</code>? The answer is that <span class="math inline">\(H_j \propto 1 / n_j\)</span>, so Chinstrap with the smallest sample size (<span class="math inline">\(n=68\)</span>) is the most unusual.</p>
<p>The most influential case (283) here is our Chinstrap friend “Cyrano” (see <a href="#fig-peng-ggplot-out" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-peng-ggplot-out</span></a>). Among the others, case 10 is the Adelie bird we labeled “Hook Nose”. To better understand <em>why</em> these cases are influential, we can make plots of the data in data space or in PCA space as we did earlier.</p>
<!--
The "LR" plot: **Omit this**, or make it an exercise

::: {.cell layout-align="center"}

```{.r .cell-code  code-fold="true" code-summary="Show the code"}
res <- influencePlot(peng.mlm, id.n=3, type="LR")
loc <- merge(peng, res, 
             by = "row.names") |>
  group_by(species) |>
  slice(1) |>
  ungroup() |>
  select(species, L) |>
  mutate(logL = log(L))
text(loc$logL, -2, loc$species, xpd=TRUE)
```

::: {.cell-output-display}
![Influence plot for the Penguin data...](figs/Ch13/fig-peng-inflplot2-1.png){#fig-peng-inflplot2 fig-align='center' width=80%}
:::
:::

-->
</section><section id="sec-robust-estimation" class="level2" data-number="13.5"><h2 data-number="13.5" class="anchored" data-anchor-id="sec-robust-estimation">
<span class="header-section-number">13.5</span> Robust Estimation</h2>
<p>Robust methods for multivariate linear models aim to provide reliable parameter estimates and inference procedures that remain stable in the presence of outlying observations. As noted by <span class="citation" data-cites="Rousseeuw2004">Rousseeuw et al. (<a href="#ref-Rousseeuw2004" role="doc-biblioref">2004</a>)</span>, “<em>The main advantage of robust regression is that it provides reliable results even when some of the assumptions of classical regression are violated.</em>” But this advantage comes at the cost of increased computational complexity.</p>
<p>Robust regression is a compromise between excluding “bad” data points entirely from analysis vs.&nbsp;including all the data and treating them equally in classical OLS regression. The essential idea of robust regression is to weight the observations differently based on how well behaved these observations are. Roughly speaking, it is a form of <em>weighted</em> least squares regression. But because the weights are derived from the data, this must be done iteratively, requiring more computation.</p>
<p>Several general approaches have been developed for robust multivariate regression. These include M-estimators, S-estimators <span class="citation" data-cites="Rousseeuw1984">(<a href="#ref-Rousseeuw1984" role="doc-biblioref">Rousseeuw &amp; Yohai, 1984</a>)</span>, and MM-estimators <span class="citation" data-cites="Yohai1987">(<a href="#ref-Yohai1987" role="doc-biblioref">Yohai, 1987</a>)</span>. Each approach offers different trade-offs between robustness properties, computational efficiency, and statistical efficiency under ideal conditions. See the <a href="https://cran.r-project.org/web/views/Robust.html">CRAN Task View: Robust Statistical Methods</a> for an extensive list of robust methods in R and the <a href="https://cran.r-project.org/web/packages/rrcov/vignettes/rrcov.pdf">vignette</a> for the <a href="https://cran.r-project.org/package=rrcov">rrcov package</a> for a general overview of multivariate robust methods. </p>
<p>The method implemented in the <code><a href="https://friendly.github.io/heplots/reference/robmlm.html">heplots::robmlm()</a></code> function belongs to the class of <strong>M-estimators</strong>. This generalizes OLS estimation by replacing the least squares criterion with a more robust version. The key idea is to relax the least squares criterion of minimizing <span class="math inline">\(Q(\mathbf{e}) = \Sigma e_i^2 = \Sigma (y_i - \hat{y}_i)^2\)</span> by considering more general functions <span class="math inline">\(Q(\mathbf{e}, \rho)\)</span>, where the function <span class="math inline">\(\rho (e_i)\)</span> can be chosen to reduce the impact of large outliers. In these terms,</p>
<ul>
<li>OLS uses <span class="math inline">\(\rho(e_i) = e_i^2\)</span>
</li>
<li>
<span class="math inline">\(L_1\)</span> estimation uses <span class="math inline">\(\rho(e_i) = \vert e_i \vert\)</span>, the least absolute values</li>
<li>A bit more complicated, the <strong>biweight</strong> function uses a squared measure of error up to some value <span class="math inline">\(c\)</span> and then levels off thereafter,</li>
</ul>
<p><span class="math display">\[
\rho(e_i) =
\begin{cases}
\left[ 1 - \left( \frac{e_i}{c} \right)^2 \right]^2 &amp; |e_i| \leq c, \\
1 &amp; |e_i| &gt; c.
\end{cases}
\]</span></p>
<p>These functions are more easily understood in a graph (<a href="#fig-weight-fns" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-weight-fns</span></a>). The biweight function (ref?) has a property like Windsorizing— the squared error remains constant for residuals <span class="math inline">\(e_i &gt; c\)</span>, with the tuning constant <span class="math inline">\(c = 4.685\)</span> for <code><a href="https://rdrr.io/pkg/MASS/man/rlm.html">MASS::psi.bisquare()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-weight-fns" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-weight-fns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/weight-functions.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-weight-fns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.9: Diagram plotting the function <span class="math inline">\(\rho(e_i)\)</span> of the contributions of the residuals <span class="math inline">\(e_i\)</span> to what is minimized in various fitting methods.
</figcaption></figure>
</div>
</div>
</div>
<p>But, there is a problem here, in that weighted least squares is designed for situations where the observation weights are <em>known in advance</em>, for instance, when data points have unequal variances or when some observations are more reliable than others.</p>
<p>The solution, called <em>iteratively reweighted least squares</em> (IRLS), is to substitute computation for theory, and iterate between estimating the coefficients (with given weights) and determining weights for the observations in the next iteration. This is implemented in <code><a href="https://friendly.github.io/heplots/reference/robmlm.html">heplots::robmlm()</a></code>, which generalizes the methods used in <code><a href="https://rdrr.io/pkg/MASS/man/rlm.html">MASS::rlm()</a></code>. …</p>
</section><section id="sec-peng-robust" class="level2" data-number="13.6"><h2 data-number="13.6" class="anchored" data-anchor-id="sec-peng-robust">
<span class="header-section-number">13.6</span> Example: Penguin data</h2>
<!-- r.code: R/peng.manova.R -->
<p>In earlier analyses of the Penguin data, a few points appeared unusual for their species in various plots (<a href="#fig-peng-bagplot" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-peng-bagplot</span></a>, <a href="#fig-peng-ggplot-out" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-peng-ggplot-out</span></a>) and a few were deemed overly influential in <a href="#sec-peng-mvinfluence" class="quarto-xref"><span class="quarto-unresolved-ref">sec-peng-mvinfluence</span></a> for the simple model <code>peng.mlm</code> predicting <code>species</code>. What effect does fitting a robust MANOVA have on the results? We can just substitute <code><a href="https://friendly.github.io/heplots/reference/robmlm.html">robmlm()</a></code> for <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. to fit the robust model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">peng.rlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://friendly.github.io/heplots/reference/robmlm.html">robmlm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bill_length</span>, <span class="va">bill_depth</span>, <span class="va">flipper_length</span>, <span class="va">body_mass</span><span class="op">)</span> <span class="op">~</span></span>
<span>                    <span class="va">species</span>, data<span class="op">=</span><span class="va">peng</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method for a <code>"robmlm"</code> object give an index plot of the observation weights in the final iteration. I take some care here to color the points by species, label the points with the lowest weights and add my names for a couple of birds.</p>
<!-- **TODO**: ~~Use heplots 1.7.9 to label axis automatically.~~ -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"penguin"</span>, <span class="st">"penguin-colors.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">=</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span><span class="op">[</span><span class="va">peng</span><span class="op">$</span><span class="va">species</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">peng.rlm</span>, </span>
<span>     segments <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     id.weight <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>     col <span class="op">=</span> <span class="va">col</span>,</span>
<span>     cex.lab <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span></span>
<span>  <span class="co"># label old friends</span></span>
<span><span class="va">notables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">283</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HookNose"</span>, <span class="st">"Cyrano"</span><span class="op">)</span>,</span>
<span>  wts <span class="op">=</span> <span class="va">peng.rlm</span><span class="op">$</span><span class="va">weights</span><span class="op">[</span><span class="va">id</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">notables</span><span class="op">$</span><span class="va">id</span>, <span class="va">notables</span><span class="op">$</span><span class="va">wts</span>, </span>
<span>     label <span class="op">=</span> <span class="va">notables</span><span class="op">$</span><span class="va">name</span>, pos <span class="op">=</span> <span class="fl">3</span>,</span>
<span>     xpd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># label species in axis at the top</span></span>
<span><span class="va">ctr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">peng</span><span class="op">)</span><span class="op">)</span>, <span class="va">peng</span><span class="op">$</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">3</span>, at<span class="op">=</span><span class="va">ctr</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ctr</span><span class="op">)</span>, cex.axis<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-peng-robmlm-plot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-robmlm-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/Ch13/fig-peng-robmlm-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-robmlm-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.10: Index plot of the observation weights for the robust model, <code>peng.rlm</code>. Observations with weights &lt; 0.5 are labeled with their case number.
</figcaption></figure>
</div>
</div>
</div>
<p>The observations that are labeled here are among those which stood out as notable in other plots. In <a href="#fig-peng-robmlm-plot" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-peng-robmlm-plot</span></a>, the lowest four points are down-weighted considerably. Our friend “Cyrano” (283), the greatest outlier, gets a weight of exactly zero, so is effectively excluded from the model; “Hook Nose” (10) gets a weight of 0.13, and so he can’t do much damage.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">124</span>, <span class="fl">179</span>, <span class="fl">283</span><span class="op">)</span></span>
<span><span class="va">lowwt</span> <span class="op">&lt;-</span> <span class="va">peng.rlm</span><span class="op">$</span><span class="va">weights</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lowwt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cases</span></span>
<span><span class="va">lowwt</span></span>
<span><span class="co">#    10   124   179   283 </span></span>
<span><span class="co"># 0.137 0.367 0.287 0.000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another way to assess the effect of using a robust model is to examine its’ effects on the model coefficients. <code><a href="https://friendly.github.io/heplots/reference/rel_diff.html">heplots::rel_diff()</a></code> calculates the relative difference, <span class="math inline">\(\vert x - y \vert / x\)</span>, expressed here as percent of change. As you can see below, the changes in most of the coefficients is rather small.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/rel_diff.html">rel_diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">peng.mlm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">peng.rlm</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#                  bill_length bill_depth flipper_length body_mass</span></span>
<span><span class="co"># (Intercept)            0.083       0.26          0.092      0.43</span></span>
<span><span class="co"># speciesChinstrap       0.572      78.10          8.053     76.20</span></span>
<span><span class="co"># speciesGentoo          0.857      -0.51          0.089      0.12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The largest differences are for the coefficients for <code>Chinstrap</code>, particularly for <code>bill_depth</code> and <code>body_mass</code>, which reflect the dramatic effect of effectively removing “Cyrano” from the analysis.</p>
<p>If you accept the premise of down-weighting cases with large residuals in robust methods, <code><a href="https://friendly.github.io/heplots/reference/robmlm.html">robmlm()</a></code> provides a principled way to handle them. Bye-bye Cyrano; it’s been fun, but we can get along nicely without you.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-Barrett:2003" class="csl-entry" role="listitem">
Barrett, B. E. (2003). Understanding influence in multivariate regression. <em>Communications in Statistics - Theory and Methods</em>, <em>32</em>(3), 667–680. <a href="https://doi.org/10.1081/STA-120018557">https://doi.org/10.1081/STA-120018557</a>
</div>
<div id="ref-BarrettLing:92" class="csl-entry" role="listitem">
Barrett, B. E., &amp; Ling, R. F. (1992). General classes of influence measures for multivariate regression. <em>Journal of the American Statistical Association</em>, <em>87</em>(417), 184–191. <a href="https://www.jstor.org/stable/i314301">https://www.jstor.org/stable/i314301</a>
</div>
<div id="ref-Belsley-etal:80" class="csl-entry" role="listitem">
Belsley, D. A., Kuh, E., &amp; Welsch, R. E. (1980). <em>Regression diagnostics: Identifying influential data and sources of collinearity</em>. John Wiley; Sons.
</div>
<div id="ref-Cook:77" class="csl-entry" role="listitem">
Cook, R. D. (1977). Detection of influential observation in linear regression. <em>Technometrics</em>, <em>19</em>(1), 15–18. <a href="https://doi.org/10.1080/00401706.1977.10489493">https://doi.org/10.1080/00401706.1977.10489493</a>
</div>
<div id="ref-CookWeisberg:82" class="csl-entry" role="listitem">
Cook, R. D., &amp; Weisberg, S. (1982). <em>Residuals and influence in regression</em>. Chapman; Hall.
</div>
<div id="ref-R-mvinfluence" class="csl-entry" role="listitem">
Friendly, M. (2025). <em>Mvinfluence: Influence measures and diagnostic plots for multivariate linear models</em>. <a href="https://github.com/friendly/mvinfluence">https://github.com/friendly/mvinfluence</a>
</div>
<div id="ref-R-olsrr" class="csl-entry" role="listitem">
Hebbali, A. (2024). <em>Olsrr: Tools for building OLS regression models</em>. <a href="https://doi.org/10.32614/CRAN.package.olsrr">https://doi.org/10.32614/CRAN.package.olsrr</a>
</div>
<div id="ref-R-HLMdiag" class="csl-entry" role="listitem">
Loy, A., &amp; Hofmann, H. (2014). HLMdiag: A suite of diagnostics for hierarchical linear models in r. <em>Journal of Statistical Software</em>, <em>56</em>(5), 1–28. <a href="https://doi.org/10.18637/jss.v056.i05">https://doi.org/10.18637/jss.v056.i05</a>
</div>
<div id="ref-Rousseeuw2004" class="csl-entry" role="listitem">
Rousseeuw, P. J., Van Aelst, S., Van Driessen, K., &amp; Gulló, J. A. (2004). Robust multivariate regression. <em>Technometrics</em>, <em>46</em>(3), 293–305. <a href="https://doi.org/10.1198/004017004000000329">https://doi.org/10.1198/004017004000000329</a>
</div>
<div id="ref-Rousseeuw1984" class="csl-entry" role="listitem">
Rousseeuw, P. J., &amp; Yohai, V. J. (1984). Robust regression by means of <span>S</span>-estimators. In J. Franke, W. Härdle, &amp; D. Martin (Eds.), <em>Robust and nonlinear time series analysis</em> (Vol. 26, pp. 256–272). Springer.
</div>
<div id="ref-Tukey:59" class="csl-entry" role="listitem">
Tukey, J. W. (1959). A quick, compact, two sample test to <span class="nocase">Duckworth’s</span> specifications. <em>Technometrics</em>, <em>1</em>, 31–48. <a href="https://doi.org/10.2307/1266308">https://doi.org/10.2307/1266308</a>
</div>
<div id="ref-Yohai1987" class="csl-entry" role="listitem">
Yohai, V. J. (1987). High breakdown-point and high efficiency robust estimates for regression. <em>The Annals of Statistics</em>, <em>15</em>(2), 642–656.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Among other packages providing influence diagnostic plots for univariate response models, <span style="color: brown;"><strong>olsrr</strong></span> <span class="citation" data-cites="R-olsrr">(<a href="#ref-R-olsrr" role="doc-biblioref">Hebbali, 2024</a>)</span> provides a wide variety of measures. However, the graphic methods for these are mostly limited to simple index plots of the measure against case number. For <em>hierarchical</em> linear models, where observations are not independent, but are clustered within larger groups, the <span style="color: brown;"><strong>HLMdiag</strong></span> <span class="citation" data-cites="R-HLMdiag">(<a href="#ref-R-HLMdiag" role="doc-biblioref">Loy &amp; Hofmann, 2014</a>)</span> provides functions like <code>hlm_influence()</code> and <code>hlm_augment()</code> to generate influence diagnostics and combine them with residuals.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Similar to the univariate version, hat values greater than 2 or 3 times their average, <span class="math inline">\(\bar{h} = p/n\)</span> here, are considered large in the multivariate case. Values of the squared studentized residual <span class="math inline">\(R_i\)</span> are calibrated by the Beta distribution, <span class="math inline">\(\text{Beta}(\alpha=0.95, q/2, (n-p-q)/2)\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/friendly\.github\.io\/Vis-MLM-book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./12-eqcov.html" class="pagination-link" aria-label="Visualizing Equality of Covariance Matrices">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./14-case-studies.html" class="pagination-link" aria-label="Case Studies">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Case Studies</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>