<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>3&nbsp; Plots of Multivariate Data – Visualizing Multivariate Data and Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-pca-biplot.html" rel="next">
<link href="./02-getting_started.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-multivariate_plots.html">Exploratory Methods</a></li><li class="breadcrumb-item"><a href="./03-multivariate_plots.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-multivariate_plots.html">Exploratory Methods</a></li><li class="breadcrumb-item"><a href="./03-multivariate_plots.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></a></li></ol></nav>
      <h1 class="title"><span id="sec-multivariate_plots" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Orienting Ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Exploratory Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Univariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Multivariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">End matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./95-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-bivariate_summaries" id="toc-sec-bivariate_summaries" class="nav-link active" data-scroll-target="#sec-bivariate_summaries"><span class="header-section-number">3.1</span> Bivariate summaries</a>
  <ul class="collapse">
<li><a href="#smoothers" id="toc-smoothers" class="nav-link" data-scroll-target="#smoothers"><span class="header-section-number">3.1.1</span> Smoothers</a></li>
  <li><a href="#stratifiers" id="toc-stratifiers" class="nav-link" data-scroll-target="#stratifiers"><span class="header-section-number">3.1.2</span> Stratifiers</a></li>
  <li><a href="#conditioning" id="toc-conditioning" class="nav-link" data-scroll-target="#conditioning"><span class="header-section-number">3.1.3</span> Conditioning</a></li>
  </ul>
</li>
  <li>
<a href="#sec-data-ellipse" id="toc-sec-data-ellipse" class="nav-link" data-scroll-target="#sec-data-ellipse"><span class="header-section-number">3.2</span> Data Ellipses</a>
  <ul class="collapse">
<li><a href="#ellipse-properties" id="toc-ellipse-properties" class="nav-link" data-scroll-target="#ellipse-properties"><span class="header-section-number">3.2.1</span> Ellipse properties</a></li>
  <li><a href="#r-functions-for-data-ellipses" id="toc-r-functions-for-data-ellipses" class="nav-link" data-scroll-target="#r-functions-for-data-ellipses"><span class="header-section-number">3.2.2</span> R functions for data ellipses</a></li>
  <li><a href="#sec-prestige" id="toc-sec-prestige" class="nav-link" data-scroll-target="#sec-prestige"><span class="header-section-number">3.2.3</span> Example: Canadian occupational prestige</a></li>
  <li><a href="#sec-penguins" id="toc-sec-penguins" class="nav-link" data-scroll-target="#sec-penguins"><span class="header-section-number">3.2.4</span> Example: Penguins data</a></li>
  </ul>
</li>
  <li><a href="#simpsons-paradox-marginal-and-conditional-relationships" id="toc-simpsons-paradox-marginal-and-conditional-relationships" class="nav-link" data-scroll-target="#simpsons-paradox-marginal-and-conditional-relationships"><span class="header-section-number">3.3</span> Simpson’s paradox: marginal and conditional relationships</a></li>
  <li>
<a href="#sec-multivar-normality" id="toc-sec-multivar-normality" class="nav-link" data-scroll-target="#sec-multivar-normality"><span class="header-section-number">3.4</span> Multivariate normality and outliers</a>
  <ul class="collapse">
<li><a href="#galton-data" id="toc-galton-data" class="nav-link" data-scroll-target="#galton-data"><span class="header-section-number">3.4.1</span> Galton data</a></li>
  <li><a href="#sec-multnorm-penguin" id="toc-sec-multnorm-penguin" class="nav-link" data-scroll-target="#sec-multnorm-penguin"><span class="header-section-number">3.4.2</span> Penguin data</a></li>
  </ul>
</li>
  <li>
<a href="#sec-scatmat" id="toc-sec-scatmat" class="nav-link" data-scroll-target="#sec-scatmat"><span class="header-section-number">3.5</span> Scatterplot matrices</a>
  <ul class="collapse">
<li><a href="#visual-thinning" id="toc-visual-thinning" class="nav-link" data-scroll-target="#visual-thinning"><span class="header-section-number">3.5.1</span> Visual thinning</a></li>
  </ul>
</li>
  <li><a href="#sec-corrgram" id="toc-sec-corrgram" class="nav-link" data-scroll-target="#sec-corrgram"><span class="header-section-number">3.6</span> Corrgrams</a></li>
  <li><a href="#sec-ggpairs" id="toc-sec-ggpairs" class="nav-link" data-scroll-target="#sec-ggpairs"><span class="header-section-number">3.7</span> Generalized pairs plots</a></li>
  <li><a href="#sec-parcoord" id="toc-sec-parcoord" class="nav-link" data-scroll-target="#sec-parcoord"><span class="header-section-number">3.8</span> Parallel coordinate plots</a></li>
  <li>
<a href="#animated-tours" id="toc-animated-tours" class="nav-link" data-scroll-target="#animated-tours"><span class="header-section-number">3.9</span> Animated tours</a>
  <ul class="collapse">
<li><a href="#projections" id="toc-projections" class="nav-link" data-scroll-target="#projections"><span class="header-section-number">3.9.1</span> Projections</a></li>
  <li><a href="#touring-methods" id="toc-touring-methods" class="nav-link" data-scroll-target="#touring-methods"><span class="header-section-number">3.9.2</span> Touring methods</a></li>
  </ul>
</li>
  <li>
<a href="#sec-network" id="toc-sec-network" class="nav-link" data-scroll-target="#sec-network"><span class="header-section-number">3.10</span> Network diagrams</a>
  <ul class="collapse">
<li><a href="#crime-data" id="toc-crime-data" class="nav-link" data-scroll-target="#crime-data"><span class="header-section-number">3.10.1</span> Crime data</a></li>
  <li><a href="#sec-partial-cor" id="toc-sec-partial-cor" class="nav-link" data-scroll-target="#sec-partial-cor"><span class="header-section-number">3.10.2</span> Partial correlations</a></li>
  <li><a href="#sec-pvPlot" id="toc-sec-pvPlot" class="nav-link" data-scroll-target="#sec-pvPlot"><span class="header-section-number">3.10.3</span> Visualizing partial correlations</a></li>
  </ul>
</li>
  <li><a href="#multivariate-thinking-and-visualization" id="toc-multivariate-thinking-and-visualization" class="nav-link" data-scroll-target="#multivariate-thinking-and-visualization"><span class="header-section-number">3.11</span> Multivariate thinking and visualization</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- \require{newcommand} --><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \newcommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- \newcommand*{\E}{\mathcal{E}} --><!-- Index generation --><!-- % R packages:  indexed under both package name and packages! --><!-- % data sets:  --><!-- % R stuff --><blockquote class="blockquote">
<p>There is no excuse for failing to plot and look.</p>
<p>The greatest value of a picture is when it forces us to notice what we never expected to see. — John W. Tukey, <em>Exploratory Data Analysis</em>, 1977</p>
</blockquote>
<p>These quotes from John Tukey remind us that data analysis should nearly always start with graphs to help us understand the main features of our data. It is important to understand the general <em>patterns</em> and <em>trends</em>: Are relationships increasing or decreasing? Are they approximately linear or non-linear? But it is also important to spot <em>anomalies</em>: “unusual” observations, groups of points that seem to differ from the rest, and so forth. As we saw with Anscombe’s quartet (<a href="02-getting_started.html#sec-anscombe" class="quarto-xref"><span>Section 2.1.1</span></a>) numerical summaries hide features that are immediately apparent in a plot.</p>
<p>This chapter introduces a toolbox of basic graphical methods for visualizing multivariate datasets. It starts with some simple techniques to enhance the basic scatterplot with graphical <em>annotations</em> such as fitted lines, curves and data ellipses to <em>summarize</em> the relation between two variables.</p>
<p>To visualize more than two variables, we can view all pairs of variables in a scatterplot matrix or shift gears entirely to show multiple variables along a set of parallel axes. As the number of variables increases, we may need to suppress details with stronger summaries for a high-level reconnaissance of our data terrain, as we do by zooming out on a map. For example, we can simply remove the data points or make them nearly transparent to focus on the visual summaries provided by fitted lines or other graphical summaries.</p>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot">corrplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://kwstat.github.io/corrgram/">corrgram</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/">GGally</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jamesotto852.github.io/ggdensity/">ggdensity</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/heike/ggpcp">ggpcp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ggobi/tourr">tourr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://friendly.github.io/heplots/">heplots</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-bivariate_summaries" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="sec-bivariate_summaries">
<span class="header-section-number">3.1</span> Bivariate summaries</h2>
<p>The basic scatterplot is the workhorse of multivariate data visualization, showing how one variable, <span class="math inline">\(y\)</span>, often an outcome to be explained by or varies with another, <span class="math inline">\(x\)</span>. It is a building block for many useful techniques, so it is helpful to understand how it can be used as a tool for thinking in a wider, multivariate context.</p>
<p>The essential idea is that we can start with a simple version of the scatterplot and add annotations to show interesting features more clearly. We consider the following here:</p>
<ul>
<li>
<strong>Smoothers</strong>: Showing overall trends, perhaps in several forms, as visual summaries such as fitted regression lines or curves and nonparametric smoothers.</li>
<li>
<strong>Stratifiers</strong>: Using color, shape or other features to identify subgroups; more generally, <em>conditioning</em> on other variables in multi-panel displays;</li>
<li>
<strong>Data ellipses</strong>: A compact 2D visual summary of bivariate linear relations and uncertainty assuming normality; more generally, contour plots of bivariate density.</li>
</ul>
<p><strong>Example: Academic salaries</strong></p>
<p>Let’s start with data on the academic salaries of faculty members collected at a U.S. college for the purpose of assessing salary differences between male and female faculty members, and perhaps address anomalies in compensation. The dataset <code><a href="https://rdrr.io/pkg/carData/man/Salaries.html">carData::Salaries</a></code> gives data on nine-month salaries and other variables for 397 faculty members in the 2008-2009 academic year.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Salaries</span>, package <span class="op">=</span> <span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Salaries</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':  397 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ rank         : Factor w/ 3 levels "AsstProf","AssocProf",..: 3 3 1 3 3 2 3 3 3 3 ...</span></span>
<span><span class="co">#&gt;  $ discipline   : Factor w/ 2 levels "A","B": 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ yrs.since.phd: int  19 20 4 45 40 6 30 45 21 18 ...</span></span>
<span><span class="co">#&gt;  $ yrs.service  : int  18 16 3 39 41 6 23 45 20 18 ...</span></span>
<span><span class="co">#&gt;  $ sex          : Factor w/ 2 levels "Female","Male": 2 2 2 2 2 2 2 2 2 1 ...</span></span>
<span><span class="co">#&gt;  $ salary       : int  139750 173200 79750 115000 141500 97000 175000 147765 119250 129000 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The most obvious, but perhaps naive, predictor of <code>salary</code> is <code>years.since.phd</code>. For simplicity, I’ll refer to this as years of “experience.” Before looking at differences between males and females, we would want consider faculty <code>rank</code> (related also to <code>yrs.service</code>) and <code>discipline</code>, recorded here as <code>"A"</code> (“theoretical” departments) or <code>"B"</code> (“applied” departments). But, for a basic plot, we will ignore these for now to focus on what can be learned from plot annotations.</p>
<!-- figure-code: `R/Salaries-scatterplots.R`  -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">gg1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/dollar_format.html">dollar_format</a></span><span class="op">(</span></span>
<span>    prefix<span class="op">=</span><span class="st">"$"</span>, scale <span class="op">=</span> <span class="fl">0.001</span>, suffix <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Years since PhD"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Salary"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">gg1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"jitter"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Salaries-scat" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Salaries-scat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Salaries-scat-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Salaries-scat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Naive scatterplot of Salary vs.&nbsp;years since PhD, ignoring other variables, and without graphical annotations.
</figcaption></figure>
</div>
</div>
</div>
<p>There is quite a lot we can see “just by looking” at this simple plot, but the main things are:</p>
<ul>
<li>Salary increases generally from 0 - 40 years since the PhD, but then maybe begins to drop off (partial retirement?);</li>
<li>Variability in salary increases among those with the same experience, a “fan-shaped” pattern that signals a violation of homogeneity of variance in simple regression;</li>
<li>Data beyond 50 years is thin, but there are some quite low salaries there. Adding rug plots to the X and Y axes is a simple but effective way to show the marginal distributions of the observations. Jitter and transparency helps to avoid overplotting due to discrete values.</li>
</ul>
<section id="smoothers" class="level3" data-number="3.1.1"><h3 data-number="3.1.1" class="anchored" data-anchor-id="smoothers">
<span class="header-section-number">3.1.1</span> Smoothers</h3>
<p>Smoothers are among the most useful graphical annotations you can add to such plots, giving a visual summary of how <span class="math inline">\(y\)</span> changes with <span class="math inline">\(x\)</span>. The most common smoother is a line showing the linear regression for <span class="math inline">\(y\)</span> given <span class="math inline">\(x\)</span>, expressed in math notation as <span class="math inline">\(\mathbb{E} (y | x) = b_0 + b_1 x\)</span>. If there is doubt that a linear relation is an adequate summary, you can try a quadratic or other polynomial smoothers.</p>
<p>In <span style="color: brown;"><strong>ggplot2</strong></span>, these are easily added to a plot using <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> with <code>method = "lm"</code>, and a model <code>formula</code>, which (by default) is <code>y ~ x</code> for a linear relation or <code>y ~ poly(x, k)</code> for a polynomial of degree <span class="math inline">\(k\)</span>.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gg1</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"red"</span>, fill<span class="op">=</span> <span class="st">"pink"</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ poly(x,2)"</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"darkgreen"</span>, fill <span class="op">=</span> <span class="st">"lightgreen"</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-Salaries-lm" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Salaries-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Salaries-lm-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Salaries-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Scatterplot of Salary vs.&nbsp;years since PhD, showing <span style="color: red;">linear</span> and <span style="color: darkgreen;">quadratic</span> smooths with 95% confidence bands.
</figcaption></figure>
</div>
</div>
</div>
<!--# UA: This is a fantastic graph. My only (very minor) suggestion is to replace one of the colours because the most common type of colour vision deficiency makes it hard to tell the difference between red and green. So, maybe green and purple (purple would match the inline code highlight colour)-->
<p>This serves to highlight some of our impressions from the basic scatterplot shown in <a href="#fig-Salaries-scat" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>, making them more apparent. And that’s precisely the point: the regression smoother draws attention to a possible pattern that we can consider as a visual summary of the data. You can think of this as showing what a linear (or quadratic) regression “sees” in the data. Statistical tests <!--# (secref?) --> can help you decide if there is more evidence for a quadratic fit compared to the simpler linear relation. <!--# UA: Great paragraph!--></p>
<p>It is useful to also show some indication of <em>uncertainty</em> (or inversely, <em>precision</em>) associated with the predicted values. Both the linear and quadratic trends are shown in <a href="#fig-Salaries-lm" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> with 95% pointwise confidence bands.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> These are necessarily narrower in the center of the range of <span class="math inline">\(x\)</span> where there is typically more data; they get wider toward the highest values of experience where the data are thinner.</p>
<section id="non-parametric-smoothers" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="non-parametric-smoothers">Non-parametric smoothers</h4>
<p>The most generally useful idea is a smoother that tracks an average value, <span class="math inline">\(\mathbb{E} (y | x)\)</span>, of <span class="math inline">\(y\)</span> as <span class="math inline">\(x\)</span> varies across its’ range <em>without</em> assuming any particular functional form, and so avoiding the necessity to choose among <code>y ~ poly(x, 1)</code>, or <code>y ~ poly(x, 2)</code>, or <code>y ~ poly(x, 3)</code>, etc.</p>
<p>Non-parametric smoothers attempt to estimate <span class="math inline">\(\mathbb{E} (y | x) = f(x)\)</span> where <span class="math inline">\(f(x)\)</span> is some smooth function. These typically use a collection of weighted <em>local regressions</em> for each <span class="math inline">\(x_i\)</span> within a window centered at that value. In the method called <em>lowess</em> or <em>loess</em> <span class="citation" data-cites="Cleveland:79 ClevelandDevlin:88">(<a href="95-references.html#ref-Cleveland:79" role="doc-biblioref">Cleveland, 1979</a>; <a href="95-references.html#ref-ClevelandDevlin:88" role="doc-biblioref">Cleveland &amp; Devlin, 1988</a>)</span>, a weight function is applied, giving greatest weight to <span class="math inline">\(x_i\)</span> and a weight of 0 outside a window containing a certain fraction, <span class="math inline">\(s\)</span>, called <em>span</em>, of the nearest neighbors of <span class="math inline">\(x_i\)</span>. The fraction, <span class="math inline">\(s\)</span>, is usually within the range <span class="math inline">\(1/3 \le s \le 2/3\)</span>, and it determines the smoothness of the resulting curve; smaller values produce a wigglier curve and larger values giving a smoother fit (an optimal span can be determined by <span class="math inline">\(k\)</span>-fold cross-validation to minimize a measure of overall error of approximation).</p>
<p>Non-parametric regression is a broad topic; see <span class="citation" data-cites="Fox:2016:ARA">Fox (<a href="95-references.html#ref-Fox:2016:ARA" role="doc-biblioref">2016</a>)</span>, Ch. 18 for a more general treatment including smoothing splines, and <span class="citation" data-cites="Wood:2006">Wood (<a href="95-references.html#ref-Wood:2006" role="doc-biblioref">2006</a>)</span> for generalized additive models, fit using <code>method = "gam"</code> in <strong>ggplot2</strong>, which is the default when the largest group has more than 1,000 observations.</p>
<p><a href="#fig-Salaries-loess" class="quarto-xref">Figure&nbsp;<span>3.3</span></a> shows the addition of a loess smooth to the plot in <a href="#fig-Salaries-lm" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>, suppressing the confidence band for the linear regression. The loess fit is nearly coincident with the quadratic fit, but has a slightly wider confidence band.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gg1</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html">muted</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ poly(x,2)"</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"darkgreen"</span>, fill <span class="op">=</span> <span class="st">"lightgreen"</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-Salaries-loess" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Salaries-loess-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Salaries-loess-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Salaries-loess-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: Scatterplot of Salary vs.&nbsp;years since PhD, adding the loess smooth. The loess smooth curve and confidence band in <span style="color: green;">green</span> is nearly indistinguishable from a quadratic fit in <span style="color: blue;">blue</span>.
</figcaption></figure>
</div>
</div>
</div>
<p>But now comes an important question: is it reasonable that academic salary should increase up to about 40 years since the PhD degree and then decline? The predicted salary for someone still working 50 years after earning their degree is about the same as a person at 15 years. What else is going on here?</p>
</section></section><section id="stratifiers" class="level3" data-number="3.1.2"><h3 data-number="3.1.2" class="anchored" data-anchor-id="stratifiers">
<span class="header-section-number">3.1.2</span> Stratifiers</h3>
<p>Very often, we have a main relationship of interest, but various groups in the data are identified by discrete factors (like faculty <code>rank</code> and <code>sex</code>, their type of <code>discipline</code> here), or there are quantitative predictors for which the main relation might vary. In the language of statistical models such effects are <em>interaction</em> terms, as in <code>y ~ group + x + group:x</code>, where the term <code>group:x</code> fits a different slope for each group and the grouping variable is often called a <em>moderator</em> variable. Common moderator variables are ethnicity, health status, social class and level of education. Moderators can also be continuous variables as in <code>y ~ x1 + x2 + x1:x2</code>.</p>
<p>I call these <em>stratifiers</em>, recognizing that we should consider breaking down the overall relation to see whether and how it changes over such “other” variables. Such variables are most often factors, but we can cut a continuous variable into ranges (<em>shingles</em>) and do the same graphically. There are two general stratifying graphical techniques:</p>
<ul>
<li><p><strong>Grouping</strong>: Identify subgroups in the data by assigning different visual attributes, such as color, shape, line style, etc. within a single plot. This is quite natural for factors; quantitative predictors can be accommodated by cutting their range into ordered intervals. Grouping has the advantage that the levels of a grouping variable can be shown within the same plot, facilitating direct comparison.</p></li>
<li><p><strong>Conditioning</strong>: Showing subgroups in different plot panels. This has the advantages that relations for the individual groups more easily discerned and one can easily stratify by two (or more) other variables jointly, but visual comparison is more difficult because the eye must scan from one panel to another.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="History Corner">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
History Corner
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recognition of the roles of visual grouping by factors within a panel and conditioning in multi-panel displays was an important advance in the development of modern statistical graphics. It began at A.T.&amp;T. Bell Labs in Murray Hill, NJ in conjunction with the <strong>S</strong> language, the mother of R.</p>
<p>Conditioning displays (originally called <em>coplots</em> <span class="citation" data-cites="ChambersHastie1991">(<a href="95-references.html#ref-ChambersHastie1991" role="doc-biblioref">Chambers &amp; Hastie, 1991</a>)</span>) are simply a collection of 1D, 2D or 3D plots separate panels for subsets of the data broken down by one or more factors, or, for quantitative variables, subdivided into a factor with several overlapping intervals (<em>shingles</em>). The first implementation was in <em>Trellis</em> plots <span class="citation" data-cites="Becker:1996:VDC Cleveland:85">(<a href="95-references.html#ref-Becker:1996:VDC" role="doc-biblioref">Becker et al., 1996</a>; <a href="95-references.html#ref-Cleveland:85" role="doc-biblioref">Cleveland, 1985</a>)</span>.</p>
<p>Trellis displays were extended in the <span style="color: brown;"><strong>lattice</strong></span> package <span class="citation" data-cites="R-lattice">(<a href="95-references.html#ref-R-lattice" role="doc-biblioref">Sarkar, 2024</a>)</span>, which offered:</p>
<ul>
<li>A <strong>graphing syntax</strong> similar to that used in statistical model formulas: <code>y ~ x | g</code> conditions the data by the levels of <code>g</code>, with <code>|</code> read as “given”; two or more conditioning are specified as <code>y ~ x | g1 + g2 + ...</code>, with <code>+</code> read as “and”.</li>
<li>
<strong>Panel functions</strong> define what is plotted in a given panel. <code>panel.xyplot()</code> is the default for scatterplots, plotting points, but you can add <code>panel.lmline()</code> for regression lines, <code><a href="https://rdrr.io/pkg/latticeExtra/man/panel.smoother.html">latticeExtra::panel.smoother()</a></code> for loess smooths and a wide variety of others.</li>
</ul>
<p>The <span style="color: brown;"><strong>car</strong></span> package <span class="citation" data-cites="R-car">(<a href="95-references.html#ref-R-car" role="doc-biblioref">Fox et al., 2023</a>)</span> supports this graphing syntax in many of its functions. <span style="color: brown;"><strong>ggplot2</strong></span> does not; it uses aesthetics (<code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>), which map variables in the data to visual characteristics in displays.</p>
</div>
</div>
<p>The most obvious variable that affects academic salary is <code>rank</code>, because faculty typically get an increase in salary with a promotion that carries through in their future salary. What can we see if we group by <code>rank</code> and fit a separate smoothed curve for each?</p>
<p>In <code>ggplot2</code> thinking, grouping is accomplished simply by adding an aesthetic, such as <code>color = rank</code>. What happens then is that points, lines, smooths and other <code>geom_*()</code> inherit the feature that they are differentiated by color. In the case of <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code>, we get a separate fit for each subset of the data, according to <code>rank</code>.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># make some re-useable pieces to avoid repetitions</span></span>
<span><span class="va">scale_salary</span> <span class="op">&lt;-</span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>  labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/dollar_format.html">dollar_format</a></span><span class="op">(</span>prefix<span class="op">=</span><span class="st">"$"</span>, </span>
<span>                                 scale <span class="op">=</span> <span class="fl">0.001</span>, </span>
<span>                                 suffix <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># position the legend inside the plot</span></span>
<span><span class="va">legend_pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>                    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">0.95</span><span class="op">)</span>, </span>
<span>                    legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, </span>
<span>           color <span class="op">=</span> <span class="va">rank</span>, shape <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">scale_salary</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Years since PhD"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Salary"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">rank</span><span class="op">)</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, </span>
<span>                  linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="va">legend_pos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-Salaries-rank" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Salaries-rank-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Salaries-rank-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Salaries-rank-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: Scatterplot of Salary vs.&nbsp;years since PhD, grouped by rank.
</figcaption></figure>
</div>
</div>
</div>
<p>Well, there is a different story here. Salaries generally occupy separate vertical levels, increasing with academic rank. The horizontal extents of the smoothed curves show their ranges. Within each rank there is some initial increase after promotion, and then some tendency to decline with increasing years. But, by and large, years since the PhD doesn’t make as much difference once we’ve taken academic rank into account.</p>
<p>What about the <code>discipline</code> which is classified, perhaps peculiarly, as “theoretical” vs.&nbsp;“applied”? The values are just <code>"A"</code> and <code>"B"</code>, so I map these to more meaningful labels before making the plot.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Salaries</span> <span class="op">&lt;-</span> <span class="va">Salaries</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>discipline <span class="op">=</span> </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">discipline</span>, </span>
<span>                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A: Theoretical"</span>, <span class="st">"B: Applied"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Salaries</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, color <span class="op">=</span> <span class="va">discipline</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">scale_salary</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">discipline</span> <span class="op">)</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, </span>
<span>                linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Years since PhD"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Salary"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">legend_pos</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-Salaries-discipline" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Salaries-discipline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Salaries-discipline-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Salaries-discipline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: Scatterplot of Salary vs.&nbsp;years since PhD, grouped by discipline.
</figcaption></figure>
</div>
</div>
</div>
<p>The story in <a href="#fig-Salaries-discipline" class="quarto-xref">Figure&nbsp;<span>3.5</span></a> is again different. Faculty in applied disciplines on average earn about 10,000$ more per year on average than their theoretical colleagues.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Salaries</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">discipline</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">salary</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   discipline        mean</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 A: Theoretical 108548.</span></span>
<span><span class="co">#&gt; 2 B: Applied     118029.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For both groups, there is an approximately linear relation up to about 30–40 years, but the smoothed curves then diverge into the region where the data is thinner.</p>
<p>This result is more surprising than differences among faculty ranks. The effect of annotation with smoothed curves as visual summaries is apparent, and provides a stimulus to think about <em>why</em> these differences (if they are real) exist between theoretical and applied professors, and maybe <em>should</em> theoreticians be paid more!</p>
</section><section id="conditioning" class="level3" data-number="3.1.3"><h3 data-number="3.1.3" class="anchored" data-anchor-id="conditioning">
<span class="header-section-number">3.1.3</span> Conditioning</h3>
<p>The previous plots use grouping by color to plot the data for different subsets inside the same plot window, making comparison among groups easier, because they can be directly compared along a common vertical scale <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. This gets messy, however, when there are more than just a few levels, or worse—when there are two (or more) variables for which we want to show separate effects. In such cases, we can plot separate panels using the <code>ggplot2</code> concept of <em>faceting</em>. There are two options: <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> takes one or more conditioning variables and produces a ribbon of plots for each combination of levels; <code>facet_grid(row ~ col)</code> takes two or more conditioning variables and arranges the plots in a 2D array identified by the <code>row</code> and <code>col</code> variables.</p>
<p>Let’s look at salary broken down by the combinations of discipline and rank. Here, I chose to stratify using color by rank within each of panels faceting by discipline. Because there is more going on in this plot, a linear smooth is used to represent the trend.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Salaries</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, </span>
<span>             color <span class="op">=</span> <span class="va">rank</span>, shape <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">scale_salary</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Years since PhD"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Salary"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">rank</span><span class="op">)</span>,</span>
<span>              method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>, </span>
<span>              linewidth <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">discipline</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">legend_pos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-Salaries-faceted" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Salaries-faceted-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Salaries-faceted-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Salaries-faceted-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6: Scatterplot of Salary vs.&nbsp;years since PhD, grouped by rank, with separate panels for discipline.
</figcaption></figure>
</div>
</div>
</div>
<p>Once both of these factors are taken into account, there does not seem to be much impact of years of service. Salaries in theoretical disciplines are noticeably greater than those in applied disciplines at all ranks, and there are even greater differences among ranks.</p>
<p>Finally, to shed light on the question that motivated this example— are there anomalous differences in salary for men and women— we can look at differences in salary according to sex, when discipline and rank are taken into account. To do this graphically, condition by both variables, but use <code>facet_grid(discipline ~ rank)</code> to arrange their combinations in a grid whose rows are the levels of <code>discipline</code> and columns are those of <code>rank</code>. I want to make the comparison of males and females most direct, so I use <code>color = sex</code> to stratify the panels. The smoothed regression lines and error bands are calculated separately for each combination of discipline, rank and sex.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Salaries</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">scale_salary</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Years since PhD"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Salary"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>              method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">discipline</span> <span class="op">~</span> <span class="va">rank</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">legend_pos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-Salaries-facet-sex" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Salaries-facet-sex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Salaries-facet-sex-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Salaries-facet-sex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.7: Scatterplot of Salary vs.&nbsp;years since PhD, grouped by sex, faceted by discipline and rank.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-data-ellipse" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="sec-data-ellipse">
<span class="header-section-number">3.2</span> Data Ellipses</h2>
<p>The <em>data ellipse</em> <span class="citation" data-cites="Monette:90">(<a href="95-references.html#ref-Monette:90" role="doc-biblioref">Monette, 1990</a>)</span>, or <em>concentration ellipse</em> <span class="citation" data-cites="Dempster:69">(<a href="95-references.html#ref-Dempster:69" role="doc-biblioref">Dempster, 1969</a>)</span> is a remarkably simple and effective display for viewing and understanding bivariate relationships in multivariate data. The data ellipse is typically used to add a visual summary to a scatterplot, that shows all together the means, standard deviations, correlation, and slope of the regression line for two variables, perhaps stratified by another variable. Under the classical assumption that the data are bivariate normally distributed, the data ellipse is also a <strong>sufficient</strong> visual summary, in the sense that it captures <strong>all</strong> relevant features of the data. See <span class="citation" data-cites="Friendly-etal:ellipses:2013">Friendly et al. (<a href="95-references.html#ref-Friendly-etal:ellipses:2013" role="doc-biblioref">2013</a>)</span> for a complete discussion of the role of ellipsoids in statistical data visualization.</p>
<p>It is based on the idea that in a bivariate normal distribution, the contours of equal probability form a series of concentric ellipses. If the variables were uncorrelated and had the same variances, these would be circles, and Euclidean distance would measure the distance of each observation from the mean. When the variables are correlated, a different measure, <em>Mahalanobis distance</em> is the proper measure of how far a point is from the mean, taking the correlation into account.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-mahalanobis" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mahalanobis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/mahalanobis.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mahalanobis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.8: 2D data with curves of constant distance from the centroid. The blue solid ellipse shows a contour of constant Mahalanobis distance, taking the correlation into account; the dashed red circle is a contour of equal Euclidean distance. Given the data points, Which of the points <strong>A</strong> and <strong>B</strong> is further from the mean (X)? <em>Source</em>: Re-drawn from <a href="https://ouzhang.rbind.io/2020/11/16/outliers-part4/">Ou Zhang</a>
</figcaption></figure>
</div>
</div>
</div>
<!--
This doesn't work
#| fig-cap: !expr paste("2D data with curves of constant distance from the centroid. The", colorize('blue'), "solid ellipse shows a contour of constant Mahalanobis distance, taking the correlation into account; the dashed", colorize('blue'), "circle is a contour of equal Euclidean distance. Given the data points,  Which of the points **A** and **B** is further from the mean (X)? _Source_: Re-drawn from [Ou Zhang](https://ouzhang.rbind.io/2020/11/16/outliers-part4/)")
-->
<p>To illustrate, <a href="#fig-mahalanobis" class="quarto-xref">Figure&nbsp;<span>3.8</span></a> shows a scatterplot with labels for two points, “A” and “B”. Which is further from the mean, “X”? A contour of constant Euclidean distance, shown by the <span style="color: red;">red</span> dashed circle, ignores the apparent negative correlation, so point “A” is further. The <span style="color: blue;">blue</span> ellipse for Mahalanobis distance takes the correlation into account, so point “B” has a greater distance from the mean.</p>
<p>Mathematically, Euclidean (squared) distance for <span class="math inline">\(p\)</span> variables, <span class="math inline">\(j = 1, 2, \dots , p\)</span>, is just a generalization of the square of a univariate standardized (<span class="math inline">\(z\)</span>) score, <span class="math inline">\(z^2 = [(y - \bar{y}) / s]^2\)</span>,</p>
<p><span class="math display">\[
D_E^2 (\mathbf{y}) = \sum_j^p z_j^2 = \mathbf{z}^\textsf{T}  \mathbf{z} = (\mathbf{y} - \bar{\mathbf{y}})^\textsf{T} \operatorname{diag}(\mathbf{S})^{-1} (\mathbf{y} - \bar{\mathbf{y}}) \; ,
\]</span> where <span class="math inline">\(\mathbf{S}\)</span> is the sample variance-covariance matrix, <span class="math inline">\(\mathbf{S} = ({n-1})^{-1} \sum_{i=1}^n (\mathbf{y}_i - \bar{\mathbf{y}})^\textsf{T} (\mathbf{y}_i - \bar{\mathbf{y}})\)</span>.</p>
<p>Mahalanobis’ distance takes the correlations into account simply by using the covariances as well as the variances, <span id="eq-Dsq"><span class="math display">\[
D_M^2 (\mathbf{y}) = (\mathbf{y} - \bar{\mathbf{y}})^\mathsf{T} S^{-1} (\mathbf{y} - \bar{\mathbf{y}}) \; .
\tag{3.1}\]</span></span></p>
<p>In <a href="#eq-Dsq" class="quarto-xref">Equation&nbsp;<span>3.1</span></a>, the inverse <span class="math inline">\(S^{-1}\)</span> serves to “divide” the matrix <span class="math inline">\((\mathbf{y} - \bar{\mathbf{y}})^\mathsf{T} (\mathbf{y} - \bar{\mathbf{y}})\)</span> of squared distances by the variances (and covariances) of the variables, as in the univariate case.</p>
<p>For <span class="math inline">\(p\)</span> variables, the data <em>ellipsoid</em> <span class="math inline">\(\mathcal{E}_c\)</span> of size <span class="math inline">\(c\)</span> is a <span class="math inline">\(p\)</span>-dimensional ellipse, defined as the set of points <span class="math inline">\(\mathbf{y} = (y_1, y_2, \dots y_p)\)</span> whose squared Mahalanobis distance, <span class="math inline">\(D_M^2 ( \mathbf{y} )\)</span> is less than or equal to <span class="math inline">\(c^2\)</span>, <span class="math display">\[
\mathcal{E}_c (\bar{\mathbf{y}}, \mathbf{S}) := \{ D_M^2 (\mathbf{y}) \le c^2 \} \; .
\]</span> A computational definition recognizes that the boundary of the ellipsoid can be found by transforming a unit sphere <span class="math inline">\(\mathcal{P}\)</span> centered at the origin, <span class="math inline">\(\mathcal{P} := \{ \mathbf{x}^\textsf{T} \mathbf{x}= 1\}\)</span>, by <span class="math inline">\(\mathbf{S}^{1/2}\)</span> and then shifting that to centroid of the data,</p>
<p><span class="math display">\[
\mathcal{E}_c (\bar{\mathbf{y}}, \mathbf{S}) = \bar{\mathbf{y}} \; \oplus \; \mathbf{S}^{1/2} \, \mathcal{P} \:\: ,
\]</span> where <span class="math inline">\(\mathbf{S}^{1/2}\)</span> represents a rotation and scaling and the notation <span class="math inline">\(\oplus\)</span> represents translation to a new centroid, <span class="math inline">\(\bar{\mathbf{y}}\)</span> here. The matrix <span class="math inline">\(\mathbf{S}^{1/2}\)</span> is commonly computed as the Choleski factor of <span class="math inline">\(\mathbf{S}\)</span>. Slightly abusing notation and taking the unit sphere <span class="math inline">\(\mathcal{P}\)</span> as given (like an identity matrix <span class="math inline">\(\mathbf{I}\)</span>), we can write the data ellipsoid as simply:</p>
<p><span id="eq-ellE"><span class="math display">\[
\mathcal{E}_c (\bar{\mathbf{y}}, \mathbf{S}) = \bar{\mathbf{y}} \; \oplus \; c\, \sqrt{\mathbf{S}} \:\: .
\tag{3.2}\]</span></span></p>
<p>When <span class="math inline">\(\mathbf{y}\)</span> is (at least approximately) bivariate normal, <span class="math inline">\(D_M^2(\mathbf{y})\)</span> has a large-sample <span class="math inline">\(\chi^2_2\)</span> distribution (<span class="math inline">\(\chi^2\)</span> with 2 df), so</p>
<ul>
<li>
<span class="math inline">\(c^2 = \chi^2_2 (0.68) = 2.28\)</span> gives a “1 standard deviation bivariate ellipse,” an analog of the standard interval <span class="math inline">\(\bar{y} \pm 1 s\)</span>, while</li>
<li>
<span class="math inline">\(c^2 = \chi^2_2 (0.95) = 5.99 \approx 6\)</span> gives a data ellipse of 95% coverage.</li>
</ul>
<p>In not-large samples, the radius <span class="math inline">\(c\)</span> of the ellipsoid is better approximated by a multiple of a <span class="math inline">\(F_{p, n-p}\)</span> distribution, becoming <span class="math inline">\(c =\sqrt{ 2 F_{2, n-2}^{1-\alpha} }\)</span> in the bivariate case (<span class="math inline">\(p=2\)</span>) for coverage <span class="math inline">\(1-\alpha\)</span>.</p>
<section id="ellipse-properties" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="ellipse-properties">
<span class="header-section-number">3.2.1</span> Ellipse properties</h3>
<p>The essential ideas of correlation and regression and their relation to ellipses go back to <span class="citation" data-cites="Galton:1886">Galton (<a href="95-references.html#ref-Galton:1886" role="doc-biblioref">1886</a>)</span>. Galton’s goal was to predict (or explain) how a heritable trait, <span class="math inline">\(Y\)</span>, (e.g., height) of children was related to that of their parents, <span class="math inline">\(X\)</span>. He made a semi-graphic table of the frequencies of 928 observations of the average height of father and mother versus the height of their child, shown in <a href="#fig-galton-corr" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>. (Today, we would put child height on the <span class="math inline">\(y\)</span> axis, but Galton was working from the table, so he organized it with parent height as the rows.) He then drew smoothed contour lines of equal frequencies and had the wonderful visual insight that these formed concentric shapes that were tolerably close to ellipses.</p>
<p>He then calculated summaries, <span class="math inline">\(\text{Ave}(Y | X)\)</span>, and, for symmetry, <span class="math inline">\(\text{Ave}(X | Y)\)</span>, and plotted these as lines of means on his diagram. Lo and behold, he had a second visual insight: the lines of means of (<span class="math inline">\(Y | X\)</span>) and (<span class="math inline">\(X | Y\)</span>) corresponded approximately to the loci of horizontal and vertical tangents to the concentric ellipses. To complete the picture, he added lines showing the major and minor axes of the family of ellipses (which turned out to be the principal components) with the result shown in <a href="#fig-galton-corr" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-galton-corr" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-galton-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/galton-corr.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-galton-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.9: Galton’s 1886 diagram, showing the relationship of height of children to the average of their parents’ height. The diagram is essentially an overlay of a geometrical interpretation on a bivariate grouped frequency distribution, shown as numbers.
</figcaption></figure>
</div>
</div>
</div>
<p>For two variables, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, the remarkable properties of the data ellipse are illustrated in <a href="#fig-galton-ellipse-r" class="quarto-xref">Figure&nbsp;<span>3.10</span></a>, a modern reconstruction of Galton’s diagram.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Partial code for this figure</summary><div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Galton</span>, package <span class="op">=</span> <span class="st">"HistData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/sunflowerplot.html">sunflowerplot</a></span><span class="op">(</span><span class="va">parent</span> <span class="op">~</span> <span class="va">child</span>, data<span class="op">=</span><span class="va">Galton</span>, </span>
<span>      xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">61</span>,<span class="fl">75</span><span class="op">)</span>, </span>
<span>      ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">61</span>,<span class="fl">75</span><span class="op">)</span>, </span>
<span>      seg.col<span class="op">=</span><span class="st">"black"</span>, </span>
<span>      xlab<span class="op">=</span><span class="st">"Child height"</span>, </span>
<span>      ylab<span class="op">=</span><span class="st">"Mid Parent height"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y.x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">parent</span> <span class="op">~</span> <span class="va">child</span>, data<span class="op">=</span><span class="va">Galton</span><span class="op">)</span>     <span class="co"># regression of y on x</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">y.x</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">x.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">child</span> <span class="op">~</span> <span class="va">parent</span>, data<span class="op">=</span><span class="va">Galton</span><span class="op">)</span>     <span class="co"># regression of x on y</span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">x.y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="op">-</span><span class="va">cc</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">cc</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">/</span><span class="va">cc</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Galton</span>, </span>
<span>     <span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">child</span>, <span class="va">parent</span>, </span>
<span>         plot.points<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>         levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.40</span>, <span class="fl">0.68</span>, <span class="fl">0.95</span><span class="op">)</span>, </span>
<span>         lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-galton-ellipse-r" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-galton-ellipse-r-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/galton-ellipse-r.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-galton-ellipse-r-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.10: Sunflower plot of Galton’s data on heights of parents and their children (in.), with 40%, 68% and 95% data ellipses and the regression lines of <span class="math inline">\(y\)</span> on <span class="math inline">\(x\)</span> (black) and <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> (grey).
</figcaption></figure>
</div>
</div>
</div>
<ul>
<li><p>The ellipses have the mean vector <span class="math inline">\((\bar{x}, \bar{y})\)</span> as their center.</p></li>
<li><p>The lengths of arms of the <span style="color: blue;">blue</span> dashed central cross show the standard deviations of the variables, which correspond to the shadows of the ellipse covering 40% of the data. These are the bivariate analogs of the standard intervals <span class="math inline">\(\bar{x} \pm 1 s_x\)</span> and <span class="math inline">\(\bar{y} \pm 1 s_y\)</span>.</p></li>
<li>
<p>More generally, shadows (projections) on the coordinate axes, or any linear combination of them, give any standard interval, <span class="math inline">\(\bar{x} \pm k s_x\)</span> and <span class="math inline">\(\bar{y} \pm k s_y\)</span>. Those with <span class="math inline">\(k=1, 1.5, 2.45\)</span>, have bivariate coverage 40%, 68% and 95% respectively, corresponding to these quantiles of the <span class="math inline">\(\chi^2\)</span> distribution with 2 degrees of freedom, i.e., <span class="math inline">\(\chi^2_2 (.40) \approx 1^2\)</span>, <span class="math inline">\(\chi^2_2 (.68) \approx 1.5^2\)</span>, and <span class="math inline">\(\chi^2_2 (.95) \approx 2.45\)</span>. The shadows of the 68% ellipse are the bivariate analog of a univariate <span class="math inline">\(\bar{x} \pm 1 s_x\)</span> interval.</p>
<!--# and univariate coverage 68\%, 87\% and 98.6\% respectively. -->
</li>
<li><p>The regression line predicting <span class="math inline">\(y\)</span> from <span class="math inline">\(x\)</span> goes through the points where the ellipses have vertical tangents. The <em>other</em> regression line, predicting <span class="math inline">\(x\)</span> from <span class="math inline">\(y\)</span> goes through the points of horizontal tangency.</p></li>
<li><p>The correlation <span class="math inline">\(r(x, y)\)</span> is the ratio of the vertical segment from the mean of <span class="math inline">\(y\)</span> to the regression line to the vertical segment going to the top of the ellipse as shown at the right of the figure. It is <span class="math inline">\(r = 0.46\)</span> in this example.</p></li>
<li><p>The residual standard deviation, <span class="math inline">\(s_e = \sqrt{MSE} = \sqrt{\Sigma (y - \bar{y})^2 / n-2}\)</span>, is the half-length of the ellipse at the mean <span class="math inline">\(\bar{x}\)</span>.</p></li>
</ul>
<p>Because Galton’s values of <code>parent</code> and <code>child</code> height were recorded in class intervals of 1 in., they are shown as sunflower symbols in <a href="#fig-galton-ellipse-r" class="quarto-xref">Figure&nbsp;<span>3.10</span></a>, with multiple ‘petals’ reflecting the number of observations at each location. This plot (except for annotations) is constructed using <code><a href="https://rdrr.io/r/graphics/sunflowerplot.html">sunflowerplot()</a></code> and <code><a href="https://rdrr.io/pkg/car/man/Ellipses.html">car::dataEllipse()</a></code> for the ellipses.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Galton</span>, package <span class="op">=</span> <span class="st">"HistData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/sunflowerplot.html">sunflowerplot</a></span><span class="op">(</span><span class="va">parent</span> <span class="op">~</span> <span class="va">child</span>, data<span class="op">=</span><span class="va">Galton</span>, </span>
<span>      xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">61</span>,<span class="fl">75</span><span class="op">)</span>, </span>
<span>      ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">61</span>,<span class="fl">75</span><span class="op">)</span>, </span>
<span>      seg.col<span class="op">=</span><span class="st">"black"</span>, </span>
<span>      xlab<span class="op">=</span><span class="st">"Child height"</span>, </span>
<span>      ylab<span class="op">=</span><span class="st">"Mid Parent height"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y.x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">parent</span> <span class="op">~</span> <span class="va">child</span>, data<span class="op">=</span><span class="va">Galton</span><span class="op">)</span>     <span class="co"># regression of y on x</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">y.x</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">x.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">child</span> <span class="op">~</span> <span class="va">parent</span>, data<span class="op">=</span><span class="va">Galton</span><span class="op">)</span>     <span class="co"># regression of x on y</span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">x.y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="op">-</span><span class="va">cc</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">cc</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">/</span><span class="va">cc</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Galton</span>, </span>
<span>     <span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">child</span>, <span class="va">parent</span>, </span>
<span>         plot.points<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>         levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.40</span>, <span class="fl">0.68</span>, <span class="fl">0.95</span><span class="op">)</span>, </span>
<span>         lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, as Galton noted in his diagram, the principal major and minor axes of the ellipse have important statistical properties. <span class="citation" data-cites="Pearson:1901">Pearson (<a href="95-references.html#ref-Pearson:1901" role="doc-biblioref">1901</a>)</span> would later show that their directions are determined by the eigenvectors <span class="math inline">\(\mathbf{v}_1, \mathbf{v}_2, \dots\)</span> of the covariance matrix <span class="math inline">\(\mathbf{S}\)</span> and their radii by the square roots, <span class="math inline">\(\sqrt{\mathbf{v}_1}, \sqrt{\mathbf{v}_1}, \dots\)</span> of the corresponding eigenvalues.</p>
</section><section id="r-functions-for-data-ellipses" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="r-functions-for-data-ellipses">
<span class="header-section-number">3.2.2</span> R functions for data ellipses</h3>
<p>A number of packages provide functions for drawing data ellipses in a scatterplot, with various features.</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/car/man/scatterplot.html">car::scatterplot()</a></code>: uses base R graphics to draw 2D scatterplots, with a wide variety of plot enhancements including linear and non-parametric smoothers (loess, gam), a formula method, e.g., <code>y ~ x | group</code>, and marking points and lines using symbol shape, color, etc. Importantly, the <span style="color: brown;"><strong>car</strong></span> package generally allows automatic identification of “noteworthy” points by their labels in the plot using a variety of methods. For example, <code>method = "mahal"</code> labels cases with the most extreme Mahalanobis distances; <code>method = "r"</code> selects points according to their value of <code>abs(y)</code>, which is appropriate in residual plots.</li>
<li>
<code><a href="https://rdrr.io/pkg/car/man/Ellipses.html">car::dataEllipse()</a></code>: plots classical or robust data (using <code>MASS::cov/trob()</code>) ellipses for one or more groups, with the same facilities for point identification.</li>
<li>
<code><a href="https://friendly.github.io/heplots/reference/covEllipses.html">heplots::covEllipses()</a></code>: draws classical or robust data ellipses for one or more groups in a one-way design and optionally for the pooled total sample, where the focus is on homogeneity of within-group covariance matrices.</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">ggplot2::stat_ellipse()</a></code>: uses the calculation methods of <code><a href="https://rdrr.io/pkg/car/man/Ellipses.html">car::dataEllipse()</a></code> to add unfilled (<code>geom = "path"</code>) or filled (<code>geom = polygon"</code>) data ellipses in a <code>ggplot</code> scatterplot, using inherited aesthetics.</li>
</ul></section><section id="sec-prestige" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="sec-prestige">
<span class="header-section-number">3.2.3</span> Example: Canadian occupational prestige</h3>
<p>These examples use the data on the prestige of 102 occupational categories and other measures from the 1971 Canadian Census, recorded in <code><a href="https://rdrr.io/pkg/carData/man/Prestige.html">carData::Prestige</a></code>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Our interest is in understanding how <code>prestige</code> (the <span class="citation" data-cites="PineoPorter2008">Pineo &amp; Porter (<a href="95-references.html#ref-PineoPorter2008" role="doc-biblioref">2008</a>)</span> prestige score for an occupational category, derived from a social survey) is related to census measures of the average education, income, percent women of incumbents in those occupations. Occupation <code>type</code> is a factor with levels <code>"bc"</code> (blue collar), <code>"wc"</code> (white collar) and <code>"prof"</code> (professional).</p>
<!-- figure-code: R/prestige.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Prestige</span>, package<span class="op">=</span><span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="co"># `type` is really an ordered factor. Make it so.</span></span>
<span><span class="va">Prestige</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">$</span><span class="va">type</span>,</span>
<span>                         levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bc"</span>, <span class="st">"wc"</span>, <span class="st">"prof"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':  102 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ education: num  13.1 12.3 12.8 11.4 14.6 ...</span></span>
<span><span class="co">#&gt;  $ income   : int  12351 25879 9271 8865 8403 11030 8258 14163 11377 11023 ...</span></span>
<span><span class="co">#&gt;  $ women    : num  11.16 4.02 15.7 9.11 11.68 ...</span></span>
<span><span class="co">#&gt;  $ prestige : num  68.8 69.1 63.4 56.8 73.5 77.6 72.6 78.1 73.1 68.8 ...</span></span>
<span><span class="co">#&gt;  $ census   : int  1113 1130 1171 1175 2111 2113 2133 2141 2143 2153 ...</span></span>
<span><span class="co">#&gt;  $ type     : Ord.factor w/ 3 levels "bc"&lt;"wc"&lt;"prof": 3 3 3 3 3 3 3 3 3 3 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I first illustrate the relation between <code>income</code> and <code>prestige</code> in <a href="#fig-Prestige-scatterplot-income1" class="quarto-xref">Figure&nbsp;<span>3.11</span></a> using <code><a href="https://rdrr.io/pkg/car/man/scatterplot.html">car::scatterplot()</a></code> with many of its bells and whistles, including marginal boxplots for the variables, the linear regression line, loess smooth and the 68% data ellipse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html">scatterplot</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span>, data<span class="op">=</span><span class="va">Prestige</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>  regLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  smooth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>smoother<span class="op">=</span><span class="va">loessLine</span>, </span>
<span>                lty.smooth <span class="op">=</span> <span class="fl">1</span>, lwd.smooth<span class="op">=</span><span class="fl">3</span>,</span>
<span>                col.smooth <span class="op">=</span> <span class="st">"darkgreen"</span>, </span>
<span>                col.var <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">4</span>, method <span class="op">=</span> <span class="st">"mahal"</span>, col<span class="op">=</span><span class="st">"black"</span>, cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; general.managers          lawyers        ministers       physicians </span></span>
<span><span class="co">#&gt;                2               17               20               24</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Prestige-scatterplot-income1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Prestige-scatterplot-income1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Prestige-scatterplot-income1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Prestige-scatterplot-income1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.11: Scatterplot of prestige vs.&nbsp;income, showing the linear regression line (<span style="color: red;">red</span>), the loess smooth with a confidence envelope (<span style="color: darkgreen;">darkgreen</span>) and a 68% data ellipse. Points with the 4 largest <span class="math inline">\(D^2\)</span> values are labeled.
</figcaption></figure>
</div>
</div>
</div>
<p>There is a lot that can be seen here:</p>
<ul>
<li>
<code>income</code> is positively skewed, as is often the case.</li>
<li>The loess smooth, on the scale of income, shows <code>prestige</code> increasing up to $15,000 (these are 1971 incomes), and then leveling off.</li>
<li>The data ellipse, centered at the means encloses approximately 68% of the data points. It adds visual information about the correlation and precision of the linear regression; but here, the non-linear trend for higher incomes strongly suggests a different approach.</li>
<li>The four points identified by their labels are those with the largest Mahalanobis distances. <code><a href="https://rdrr.io/pkg/car/man/scatterplot.html">scatterplot()</a></code> prints their labels to the console.</li>
</ul>
<p><a href="#fig-Prestige-scatterplot-educ1" class="quarto-xref">Figure&nbsp;<span>3.12</span></a> shows a similar plot for education, which from the boxplot appears to be reasonably symmetric. The smoothed curve is quite close to the linear regression, according to which <code>prestige</code> increases on average <code>coef(lm(prestige ~ education, data=Prestige))["education"]</code> = 5.361 with each year of education.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html">scatterplot</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span>, data<span class="op">=</span><span class="va">Prestige</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>  regLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  smooth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>smoother<span class="op">=</span><span class="va">loessLine</span>, </span>
<span>                lty.smooth <span class="op">=</span> <span class="fl">1</span>, lwd.smooth<span class="op">=</span><span class="fl">3</span>,</span>
<span>                col.smooth <span class="op">=</span> <span class="st">"darkgreen"</span>, </span>
<span>                col.var <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">4</span>, method <span class="op">=</span> <span class="st">"mahal"</span>, col<span class="op">=</span><span class="st">"black"</span>, cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  physicians file.clerks    newsboys     farmers </span></span>
<span><span class="co">#&gt;          24          41          53          67</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Prestige-scatterplot-educ1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Prestige-scatterplot-educ1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Prestige-scatterplot-educ1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Prestige-scatterplot-educ1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.12: Scatterplot of prestige vs.&nbsp;education, showing the linear regression line (<span style="color: red;">red</span>), the loess smooth with a confidence envelope (<span style="color: darkgreen;">darkgreen</span>) and a 68% data ellipse.
</figcaption></figure>
</div>
</div>
</div>
<p>In this plot, farmers, newsboys, file.clerks and physicians are identified as noteworthy, for being furthest from the mean by Mahalanobis distance. In relation to their typical level of education, these are mostly understandable, but it is nice that farmers are rated of higher prestige than their level of education would predict.</p>
<p>Note that the <code>method</code> argument for point identification can take a vector of case numbers indicating the points to be labeled. So, to label the observations with large absolute standardized residuals in the linear model <code>m</code>, you can use <code>method = which(abs(rstandard(m)) &gt; 2)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span>, data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html">scatterplot</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span>, data<span class="op">=</span><span class="va">Prestige</span>,</span>
<span>            pch <span class="op">=</span> <span class="fl">16</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>            boxplots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            regLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>            smooth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>smoother<span class="op">=</span><span class="va">loessLine</span>,</span>
<span>                          lty.smooth <span class="op">=</span> <span class="fl">1</span>, lwd.smooth<span class="op">=</span><span class="fl">3</span>,</span>
<span>                          col.smooth <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                          col.var <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>            ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>            id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">4</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                      col<span class="op">=</span><span class="st">"black"</span>, cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Prestige-scatterplot-educ2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Prestige-scatterplot-educ2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Prestige-scatterplot-educ2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Prestige-scatterplot-educ2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.13: Scatterplot of prestige vs.&nbsp;education, labeling points whose absolute standardized residual is &gt; 2.
</figcaption></figure>
</div>
</div>
</div>
<section id="sec-log-scale" class="level4" data-number="3.2.3.1"><h4 data-number="3.2.3.1" class="anchored" data-anchor-id="sec-log-scale">
<span class="header-section-number">3.2.3.1</span> Plotting on a log scale</h4>
<p>A typical remedy for the non-linear relationship of income to prestige is to plot income on a log scale. This usually makes sense, and expresses a belief that a <strong>multiple</strong> of or <strong>percentage increase</strong> in income has a constant impact on prestige, as opposed to the <strong>additive</strong> interpretation for income itself.</p>
<p>For example, the slope of the linear regression line in <a href="#fig-Prestige-scatterplot-income1" class="quarto-xref">Figure&nbsp;<span>3.11</span></a> is given by <code>coef(lm(prestige ~ income, data=Prestige))["income"]</code> = 0.003. Multiplying this by 1000 says that a $1000 increase in <code>income</code> is associated with with an average increase of <code>prestige</code> of 2.9.</p>
<p>In the plot below, <code>scatterplot(..., log = "x")</code> re-scales the x-axis to the <span class="math inline">\(\log_e()\)</span> scale. The slope, <code>coef(lm(prestige ~ log(income), data=Prestige))["log(income)"]</code> = 21.556 says that a 1% increase in salary is associated with an average change of 21.55 / 100 in prestige.</p>
<!-- removed: #| source-line-numbers: "2" -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html">scatterplot</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span>, data<span class="op">=</span><span class="va">Prestige</span>,</span>
<span>  log <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>  regLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  smooth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>smoother<span class="op">=</span><span class="va">loessLine</span>,</span>
<span>                lty.smooth <span class="op">=</span> <span class="fl">1</span>, lwd.smooth<span class="op">=</span><span class="fl">3</span>,</span>
<span>                col.smooth <span class="op">=</span> <span class="st">"darkgreen"</span>, col.var <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">4</span>, method <span class="op">=</span> <span class="st">"mahal"</span>, col<span class="op">=</span><span class="st">"black"</span>, cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; general.managers        ministers         newsboys      babysitters </span></span>
<span><span class="co">#&gt;                2               20               53               63</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Prestige-scatterplot2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Prestige-scatterplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Prestige-scatterplot2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Prestige-scatterplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.14: Scatterplot of prestige vs.&nbsp;log(income).
</figcaption></figure>
</div>
</div>
</div>
<p>The smoothed curve in <a href="#fig-Prestige-scatterplot2" class="quarto-xref">Figure&nbsp;<span>3.14</span></a> exhibits a slight tendency to bend upwards, but a linear relation is a reasonable approximation.</p>
</section><section id="sec-stratifying" class="level4" data-number="3.2.3.2"><h4 data-number="3.2.3.2" class="anchored" data-anchor-id="sec-stratifying">
<span class="header-section-number">3.2.3.2</span> Stratifying</h4>
<p>Before going further, it is instructive to ask what we could see in the relationship between income and prestige if we stratified by type of occupation, fitting separate regressions and smooths for blue collar, white collar and professional incumbents in these occupations.</p>
<p>The formula <code>prestige ~ income | type</code> (read: income <em>given</em> type) is a natural way to specify grouping by <code>type</code>; separate linear regressions and smooths are calculated for each group, applying the color and point shapes specified by the <code>col</code> and <code>pch</code> arguments.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html">scatterplot</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span> <span class="op">|</span> <span class="va">type</span>, data<span class="op">=</span><span class="va">Prestige</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">15</span><span class="op">:</span><span class="fl">17</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>coords<span class="op">=</span><span class="st">"bottomright"</span><span class="op">)</span>,</span>
<span>  regLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  smooth<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>smoother<span class="op">=</span><span class="va">loessLine</span>, </span>
<span>              var<span class="op">=</span><span class="cn">FALSE</span>, lwd.smooth<span class="op">=</span><span class="fl">2</span>, lty.smooth<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Prestige-scatterplot3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Prestige-scatterplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-Prestige-scatterplot3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Prestige-scatterplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.15: Scatterplot of prestige vs.&nbsp;income, stratified by occupational type. This implies a different interpretation, where occupation type is a moderator variable.
</figcaption></figure>
</div>
</div>
</div>
<p>This visual analysis offers a different interpretation of the dependence of prestige on income, which appeared to be non-linear when occupation type was ignored. Instead, <a href="#fig-Prestige-scatterplot3" class="quarto-xref">Figure&nbsp;<span>3.15</span></a> suggests an <em>interaction</em> of income by type. In a model formula this would be expressed as one of:</p>
<div class="sourceCode" id="cb19" data-code-line-numbers=""><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">type</span> <span class="op">+</span> <span class="va">income</span><span class="op">:</span><span class="va">type</span>, data <span class="op">=</span> <span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span> <span class="op">*</span> <span class="va">type</span>, data <span class="op">=</span> <span class="va">Prestige</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These models signify that there are different slopes (and intercepts) for the three occupational types. In this interpretation, <code>type</code> is a moderator variable, with a different story. The slopes of the fitted lines suggest that among blue collar workers, prestige increases sharply with their income. For white collar and professional workers, there is still an increasing relation of prestige with income, but the effect of income (slope) diminishes with higher occupational category. A different plot entails a different story.</p>
</section></section><section id="sec-penguins" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="sec-penguins">
<span class="header-section-number">3.2.4</span> Example: Penguins data</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-penguin-species" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-penguin-species-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/penguins-horst.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-penguin-species-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.16: Penguin species observed in the Palmer Archipelago. This is a cartoon, but it illustrates some features of penguin body size measurements, and the colors typically used for species. Image: Allison Horst
</figcaption></figure>
</div>
</div>
</div>
<p>The <code>penguins</code> dataset from the <span style="color: brown;"><strong>palmerpenguins</strong></span> package <span class="citation" data-cites="R-palmerpenguins">(<a href="95-references.html#ref-R-palmerpenguins" role="doc-biblioref">Horst et al., 2022</a>)</span> provides further instructive examples of plots and analyses of multivariate data. The data consists of measurements of body size (flipper length, body mass, bill length and depth) of 344 penguins collected at the <a href="https://pallter.marine.rutgers.edu/">Palmer Research Station</a> in Antarctica.</p>
<p>There were three different species of penguins (Adélie, Chinstrap &amp; Gentoo) collected from 3 islands in the Palmer Archipelago between 2007–2009 <span class="citation" data-cites="Gorman2014">(<a href="95-references.html#ref-Gorman2014" role="doc-biblioref">Gorman et al., 2014</a>)</span>. The purpose was to examine differences in size or appearance of these species, particularly differences among the sexes (sexual dimorphism) in relation to foraging and habitat.</p>
<p>Here, I use a slightly altered version of the dataset, <code>peng</code>, renaming variables to remove the units, making factors of character variables and deleting a few cases with missing data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">penguins</span>, package <span class="op">=</span> <span class="st">"palmerpenguins"</span><span class="op">)</span></span>
<span><span class="va">peng</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>    bill_length <span class="op">=</span> <span class="va">bill_length_mm</span>, </span>
<span>    bill_depth <span class="op">=</span> <span class="va">bill_depth_mm</span>, </span>
<span>    flipper_length <span class="op">=</span> <span class="va">flipper_length_mm</span>, </span>
<span>    body_mass <span class="op">=</span> <span class="va">body_mass_g</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>,</span>
<span>         island <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">island</span><span class="op">)</span>,</span>
<span>         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">sex</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">peng</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [333 × 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ species       : Factor w/ 3 levels "Adelie","Chinstrap",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ island        : Factor w/ 3 levels "Biscoe","Dream",..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span><span class="co">#&gt;  $ bill_length   : num [1:333] 39.1 39.5 40.3 36.7 39.3 38.9 39.2 41.1 38.6 34.6 ...</span></span>
<span><span class="co">#&gt;  $ bill_depth    : num [1:333] 18.7 17.4 18 19.3 20.6 17.8 19.6 17.6 21.2 21.1 ...</span></span>
<span><span class="co">#&gt;  $ flipper_length: int [1:333] 181 186 195 193 190 181 195 182 191 198 ...</span></span>
<span><span class="co">#&gt;  $ body_mass     : int [1:333] 3750 3800 3250 3450 3650 3625 4675 3200 3800 4400 ...</span></span>
<span><span class="co">#&gt;  $ sex           : Factor w/ 2 levels "f","m": 2 1 1 1 2 1 2 1 2 2 ...</span></span>
<span><span class="co">#&gt;  $ year          : int [1:333] 2007 2007 2007 2007 2007 2007 2007 2007 2007 2007 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are quite a few variables to choose for illustrating data ellipses in scatterplots. Here I focus on the measures of their bills, <code>bill_length</code> and <code>bill_depth</code> (indicating curvature) and show how to use <code>ggplot2</code> for these plots.</p>
<p>I’ll be using the penguins data quite a lot, so it is useful to set up custom colors like those used in <a href="#fig-penguin-species" class="quarto-xref">Figure&nbsp;<span>3.16</span></a>, and shown in <a href="#fig-peng-colors" class="quarto-xref">Figure&nbsp;<span>3.17</span></a> with their color codes. These are shades of:</p>
<ul>
<li>
<span style="color: orange;">Adelie</span>: <span style="color: orange;">orange</span>,</li>
<li>
<span style="color: purple;">Chinstrap</span>: <span style="color: purple;">purple</span>, and</li>
<li>
<span style="color: green;">Gentoo</span>: <span style="color: green;">green</span>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-colors" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-colors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/peng-colors.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-colors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.17: Color palettes used for penguin species.
</figcaption></figure>
</div>
</div>
</div>
<p>To use these in <code>ggplot2</code> I define a function <code>peng.colors()</code> that allows shades of light, medium and dark and then functions <code>scale_*_penguins()</code> for color and fill.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">peng.colors</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">shade</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"medium"</span>, <span class="st">"light"</span>, <span class="st">"dark"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">shade</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">shade</span><span class="op">)</span></span>
<span>  <span class="co">#             light      medium     dark</span></span>
<span>  <span class="va">oranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FDBF6F"</span>, <span class="st">"#F89D38"</span>, <span class="st">"#F37A00"</span><span class="op">)</span>  <span class="co"># Adelie</span></span>
<span>  <span class="va">purples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#CAB2D6"</span>, <span class="st">"#9A78B8"</span>, <span class="st">"#6A3D9A"</span><span class="op">)</span>  <span class="co"># Chinstrap</span></span>
<span>  <span class="va">greens</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#B2DF8A"</span>, <span class="st">"#73C05B"</span>, <span class="st">"#33a02c"</span><span class="op">)</span>  <span class="co"># Gentoo</span></span>
<span>  </span>
<span>  <span class="va">cols.vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">oranges</span>, <span class="va">purples</span>, <span class="va">greens</span><span class="op">)</span></span>
<span>  <span class="va">cols.mat</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">cols.vec</span>, <span class="fl">3</span>, <span class="fl">3</span>, </span>
<span>           byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span><span class="op">)</span>,</span>
<span>                           shade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"light"</span>, <span class="st">"medium"</span>, <span class="st">"dark"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># get shaded colors</span></span>
<span>  <span class="va">cols.mat</span><span class="op">[</span>, <span class="va">shade</span> <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define color and fill scales</span></span>
<span><span class="va">scale_fill_penguins</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">shade</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"medium"</span>, <span class="st">"light"</span>, <span class="st">"dark"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">shade</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">shade</span><span class="op">)</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/discrete_scale.html">discrete_scale</a></span><span class="op">(</span></span>
<span>    <span class="st">"fill"</span>,<span class="st">"penguins"</span>,</span>
<span>     <span class="fu">scales</span><span class="fu">:::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_manual.html">manual_pal</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="va">shade</span><span class="op">)</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">scale_colour_penguins</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">shade</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"medium"</span>, <span class="st">"light"</span>, <span class="st">"dark"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">shade</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">shade</span><span class="op">)</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/discrete_scale.html">discrete_scale</a></span><span class="op">(</span></span>
<span>    <span class="st">"colour"</span>,<span class="st">"penguins"</span>,</span>
<span>    <span class="fu">scales</span><span class="fu">:::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_manual.html">manual_pal</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="va">shade</span><span class="op">)</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">scale_color_penguins</span> <span class="op">&lt;-</span> <span class="va">scale_colour_penguins</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This is used to define a <code>theme_penguins()</code> function that I use to simply change the color and fill scales for plots below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theme_penguins</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">shade</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"medium"</span>, <span class="st">"light"</span>, <span class="st">"dark"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">shade</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">shade</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">scale_color_penguins</span><span class="op">(</span>shade<span class="op">=</span><span class="va">shade</span><span class="op">)</span>,</span>
<span>       <span class="fu">scale_fill_penguins</span><span class="op">(</span>shade<span class="op">=</span><span class="va">shade</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An initial plot using <code>ggplot2</code> shown in <a href="#fig-peng-ggplot1" class="quarto-xref">Figure&nbsp;<span>3.18</span></a> uses color and point shape to distinguish the three penguin species. I annotate the plot of points using the linear regression lines, loess smooths to check for non-linearity and 95% data ellipses to show precision of the linear relation.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">peng</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length</span>, y <span class="op">=</span> <span class="va">bill_depth</span>,</span>
<span>           color <span class="op">=</span> <span class="va">species</span>, shape <span class="op">=</span> <span class="va">species</span>, fill<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>              se<span class="op">=</span><span class="cn">FALSE</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>,  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.5</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, level <span class="op">=</span> <span class="fl">0.95</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-peng-ggplot1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-ggplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-ggplot1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-ggplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.18: Penguin bill length and bill depth according to species.
</figcaption></figure>
</div>
</div>
</div>
<p>Overall, the three species occupy different regions of this 2D space and for each species the relation between bill length and depth appears reasonably linear. Given this, we can suppress plotting the data points to get a visual summary of the data using the fitted regression lines and data ellipses, as shown in <a href="#fig-peng-ggplot2" class="quarto-xref">Figure&nbsp;<span>3.19</span></a>.</p>
<p>This idea, of <strong>visual thinning</strong> a graph to focus on what should be seen, becomes increasingly useful as the data becomes more complex. The <code>ggplot2</code> framework encourages this, because we can think of various components as layers, to be included or not. Here I chose to include only the regression line and add data ellipses of 40%, 68% and 95% coverage to highlight the increasing bivariate density around the group means.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">peng</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length</span>, y <span class="op">=</span> <span class="va">bill_depth</span>,</span>
<span>           color <span class="op">=</span> <span class="va">species</span>, shape <span class="op">=</span> <span class="va">species</span>, fill<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,  se<span class="op">=</span><span class="cn">FALSE</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, level <span class="op">=</span> <span class="fl">0.95</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, level <span class="op">=</span> <span class="fl">0.68</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, level <span class="op">=</span> <span class="fl">0.40</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-peng-ggplot2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-ggplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-ggplot2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-ggplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.19: <strong>Visual thinning</strong>: Suppressing the data points gives a visual summary of the relation between bill length and bill depth using the regression line and data ellipses.
</figcaption></figure>
</div>
</div>
</div>
<section id="nonparamtric-bivariate-density-plots" class="level4" data-number="3.2.4.1"><h4 data-number="3.2.4.1" class="anchored" data-anchor-id="nonparamtric-bivariate-density-plots">
<span class="header-section-number">3.2.4.1</span> Nonparamtric bivariate density plots</h4>
<p>While I emphasize data ellipses (because I like their beautiful geometry), other visual summaries of the bivariate density are possible and often useful.</p>
<p>For a single variable, <code><a href="https://rdrr.io/r/stats/density.html">stats::density()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">ggplot2::geom_density()</a></code> calculate a smoothed estimate of the density using nonparametric kernel methods <span class="citation" data-cites="Silverman:86">(<a href="95-references.html#ref-Silverman:86" role="doc-biblioref">Silverman, 1986</a>)</span> whose smoothness is controlled by a bandwidth parameter, analogous to the span in a loess smoother. This idea extends to two (and more) variables <span class="citation" data-cites="Scott1992">(<a href="95-references.html#ref-Scott1992" role="doc-biblioref">Scott, 1992</a>)</span>. For bivariate data, <code><a href="https://rdrr.io/pkg/MASS/man/kde2d.html">MASS::kde2d()</a></code> estimates the density on a square <span class="math inline">\(n \times n\)</span> grid over the ranges of the variables.</p>
<p><code>ggplot2</code> provides <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">geom_density_2d()</a></code> which uses <code><a href="https://rdrr.io/pkg/MASS/man/kde2d.html">MASS::kde2d()</a></code> and displays these as contours— horizontal slices of the 3D surface at equally-spaced heights and projects these onto the 2D plane. The <span style="color: brown;"><strong>ggdensity</strong></span> package <span class="citation" data-cites="R-ggdensity">(<a href="95-references.html#ref-R-ggdensity" role="doc-biblioref">Otto &amp; Kahle, 2023</a>)</span> extends this with <code><a href="https://jamesotto852.github.io/ggdensity/reference/geom_hdr.html">geom_hdr()</a></code>, computing the high density regions that bound given levels of probability and maps these to the <code>alpha</code> transparency aesthetic. A <code>method</code> argument allows you to specify various nonparametric (<code>method ="kde"</code> is the default) and parametric (<code>method ="mvnorm"</code> gives normal data ellipses) ways to estimate the underlying bivariate distribution.</p>
<p><a href="#fig-peng-ggdensity" class="quarto-xref">Figure&nbsp;<span>3.20</span></a> shows these side-by-side for comparison. With <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">geom_density_2d()</a></code> you can specify either the number of contour <code>bins</code> or the width of these bins (<code>binwidth</code>). For <code><a href="https://jamesotto852.github.io/ggdensity/reference/geom_hdr.html">geom_hdr()</a></code>, the <code>probs</code> argument gives a result that is easier to understand.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jamesotto852.github.io/ggdensity/">ggdensity</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">peng</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length</span>, y <span class="op">=</span> <span class="va">bill_depth</span>,</span>
<span>           color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,  se<span class="op">=</span><span class="cn">FALSE</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">geom_density_2d</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.1</span>, bins <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"geom_density_2d"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">peng</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length</span>, y <span class="op">=</span> <span class="va">bill_depth</span>,</span>
<span>           color <span class="op">=</span> <span class="va">species</span>, fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,  se<span class="op">=</span><span class="cn">FALSE</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://jamesotto852.github.io/ggdensity/reference/geom_hdr.html">geom_hdr</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.68</span>, <span class="fl">0.4</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"ggdensity::geom_hdr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-peng-ggdensity" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-ggdensity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-ggdensity-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:120.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-ggdensity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.20: <strong>Bivariate densities</strong> show the contours of the 3D surface representing the frequency in the joint distribution of bill length and bill depth.
</figcaption></figure>
</div>
</div>
</div>
</section></section></section><section id="simpsons-paradox-marginal-and-conditional-relationships" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="simpsons-paradox-marginal-and-conditional-relationships">
<span class="header-section-number">3.3</span> Simpson’s paradox: marginal and conditional relationships</h2>
<p>Because it provides a visual representation of means, variances, and correlations, the data ellipse is ideally suited as a tool for illustrating and explicating various phenomena that occur in the analysis of linear models. One class of simple, but important, examples concerns the difference between the <em>marginal relationship</em> between variables, ignoring some important factor or covariate, and the <em>conditional</em> relationship, adjusting (controlling) for that variable.</p>
<p>Simpson’s <span class="citation" data-cites="Simpson:51">(<a href="95-references.html#ref-Simpson:51" role="doc-biblioref">1951</a>)</span> paradox occurs when the marginal and conditional relationships differ in direction. That is, the overall correlation in a model <code>y ~ x</code> might be negative, while the within-group correlations in separate models for each group <code>y[g] ~ x[g]</code> might be positive, or vice versa.</p>
<p>This may be seen in the plots of bill length against bill depth for the penguin data shown in <a href="#fig-peng-simpsons" class="quarto-xref">Figure&nbsp;<span>3.21</span></a>. Ignoring penguin species, the marginal, total-sample correlation is slightly negative as seen in panel (a). The individual-sample ellipses in panel (b) show that the conditional, within-species correlations are all positive, with approximately equal regression slopes. However the group means have a negative relationship, accounting for the negative marginal correlation when species is ignored.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-simpsons" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-simpsons-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/peng-simpsons.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:120.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-simpsons-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.21: Marginal (a), conditional (b), and pooled within-sample (c) relationships of bill length and depth in the Penguins data. Each plot shows the 68% data ellipse and regression line(s) with 95% confidence bands.
</figcaption></figure>
</div>
</div>
</div>
<p>The regression line in panel (a) is that for the linear model <code>lm(bill_depth ~ bill_length)</code>, while the separate lines in panel (b) are those for the model <code>lm(bill_depth ~ bill_length * species)</code> which allows a different slope and intercept for each species.</p>
<p>A correct analysis of the (conditional) relationship between these variables, controlling or adjusting for mean differences among species, is based on the pooled within-sample covariance matrix, a weighted average of the individual within-group <span class="math inline">\(\mathbf{S}_i\)</span>, <span class="math display">\[
\mathbf{S}_{\textrm{within}}  =
\sum_{i=1}^g
(n_i - 1) \mathbf{S}_i \, / \, (N - g)
\:\: ,
\]</span> where <span class="math inline">\(N = \sum n_i\)</span>. The result is shown in panel (c) of <a href="#fig-peng-simpsons" class="quarto-xref">Figure&nbsp;<span>3.21</span></a>.</p>
<p>In this graph, the data for each species were first transformed to deviations from the species means on both variables and then translated back to the grand means. You can also see here that the shapes and sizes of the individual data ellipses are roughly comparable, but perhaps not identical. This visual idea of centering groups to a common mean will become important in <a href="12-eqcov.html" class="quarto-xref"><span>Chapter 12</span></a> when we want to test the assumption of equality of error covariances in multivariate models.</p>
<p>The <code>ggplot2</code> code for the panels in this figure are shown below. Note that for components that will be the same across panels, you can define elements (e.g., <code>labels</code>, <code>theme_penguins()</code>, <code>legend_position</code>) once, and then re-use these across several graphs.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">(a) Ignoring species</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">(b) By species</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">(c) Within species</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="st">"Bill length (mm)"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"Bill depth (mm)"</span>,</span>
<span>  color <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>  shape <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>  fill <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">peng</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">bill_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, </span>
<span>              se <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fl">0.68</span>, linewidth <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Ignoring species"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">labels</span></span>
<span></span>
<span><span class="va">plt1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">legend_position</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.83</span>, <span class="fl">0.16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">peng</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">bill_depth</span>,</span>
<span>                   color <span class="op">=</span> <span class="va">species</span>,</span>
<span>                   shape <span class="op">=</span> <span class="va">species</span>,</span>
<span>                   fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, </span>
<span>              se <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fl">0.68</span>, linewidth <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"By species"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">labels</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">legend_position</span> </span>
<span></span>
<span><span class="va">plt2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># center within groups, translate to grand means</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">peng</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">peng.centered</span> <span class="op">&lt;-</span> <span class="va">peng</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bill_length <span class="op">=</span> <span class="va">means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">bill_length</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>         bill_depth  <span class="op">=</span> <span class="va">means</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">bill_depth</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">peng.centered</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">bill_depth</span>,</span>
<span>                   color <span class="op">=</span> <span class="va">species</span>,</span>
<span>                   shape <span class="op">=</span> <span class="va">species</span>,</span>
<span>                   fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, </span>
<span>              se <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fl">0.68</span>, linewidth <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">labels</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Within species"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">legend_position</span> </span>
<span></span>
<span><span class="va">plt3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="sec-multivar-normality" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="sec-multivar-normality">
<span class="header-section-number">3.4</span> Multivariate normality and outliers</h2>
<p>The relation of the data ellipsoid for <span class="math inline">\(p\)</span> variables to the <span class="math inline">\(\chi^2_p\)</span> distribution with <span class="math inline">\(p\)</span> degrees of freedom described in <a href="#sec-data-ellipse" class="quarto-xref"><span>Section 3.2</span></a> is based on the assumption that the data in <span class="math inline">\(\mathbf{y}\)</span> is a sample from a multivariate normal distribution (MVN), with a mean vector <span class="math inline">\(\boldsymbol{\mu}\)</span> and variance-covariance matrix <span class="math inline">\(\boldsymbol{\Sigma}\)</span>, so each one implies the other: <span class="math display">\[
\mathbf{y}_{p \times 1} \sim \mathcal{N}(\boldsymbol{\mu}, \boldsymbol{\Sigma}) \Longleftrightarrow D^2_M (\mathbf{y}) \sim \chi^2_p\; .
\]</span> This fact can be used to assess whether sample data in <span class="math inline">\(\mathbf{y}\)</span> does indeed follow a MVN distribution by plotting the <em>quantiles</em><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> of the <em>sorted</em> sample <span class="math inline">\(D^2\)</span> values (denoted <span class="math inline">\(D^2_{(i)}\)</span>) calculated from <a href="#eq-Dsq" class="quarto-xref">Equation&nbsp;<span>3.1</span></a> against the corresponding <span class="math inline">\(\chi^2_p\)</span> quantiles found from <code>qchisq(df = p)</code>. This is called a <span class="math inline">\(\chi^2\)</span> QQ plot.</p>
<p>The essential idea is that the plotted points should then approximately fall along a 45<span class="math inline">\(^o\)</span> line of slope = 1 when the data are MVN (and axes are scaled equally). This also provides a simple method to identify potential outliers as those points which are furthest from the centroid; that is those for which <span class="math inline">\(D^2_{(i)}\)</span> is greater than the <span class="math inline">\(1 - \alpha\)</span> quantile of <span class="math inline">\(\chi^2_p\)</span>.</p>
<p>The topics of assessing multivariate normality and detecting multivariate outliers are larger than I consider here. These topics are also intertwined, because outliers inflate the variance (<span class="math inline">\(\mathbf{S}\)</span>) of the data, making extreme observations appear less extreme. A variety of <em>robust</em> methods described later (<strong>sec ??</strong>) work by down-weighting outliers, which is particularly important in assessing whether the residuals from a multivariate linear model are multivariate normal.</p>
<p>In this section, I focus on the <span class="math inline">\(\chi^2\)</span> QQ plot and graphical methods to relate the the points identified as potential outliers to plots in data space.</p>
<section id="galton-data" class="level3" data-number="3.4.1"><h3 data-number="3.4.1" class="anchored" data-anchor-id="galton-data">
<span class="header-section-number">3.4.1</span> Galton data</h3>
<p>Mahalanobis <span class="math inline">\(D^2\)</span> values are calculated by <code><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">heplots::Mahalanobis()</a></code>. I illustrate finding the largest <span class="math inline">\(D^2_{(i)}\)</span> for the <code>Galton</code> data as shown below. I’ve used <span class="math inline">\(\alpha = 0.01\)</span>, giving <span class="math inline">\(\chi^2_p (0.99) = 9.21\)</span> as an outlier cutoff, just for the sake of this example. With 928 cases, we would expect about 1% or 9 to have larger squared distances than this cutoff. (Normally, allowing for the fact that we are looking at the largest values in a sample of size <span class="math inline">\(n\)</span>, we would use a much smaller individual significance level, say <span class="math inline">\(\alpha = 0.001\)</span> or smaller still.) Three cases are identified here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Galton</span>, package <span class="op">=</span> <span class="st">"HistData"</span><span class="op">)</span></span>
<span><span class="va">DSQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">Mahalanobis</a></span><span class="op">(</span><span class="va">Galton</span><span class="op">)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span>, df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Galton</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9.21</span></span>
<span><span class="va">outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">DSQ</span> <span class="op">&gt;</span> <span class="va">cutoff</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   1  13 897</span></span>
<span><span class="va">GaltonD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Galton</span>, DSQ <span class="op">=</span> <span class="va">DSQ</span><span class="op">)</span></span>
<span><span class="va">GaltonD</span><span class="op">[</span><span class="va">outliers</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;     parent child   DSQ</span></span>
<span><span class="co">#&gt; 1     70.5  61.7 13.67</span></span>
<span><span class="co">#&gt; 13    70.5  63.2  9.45</span></span>
<span><span class="co">#&gt; 897   65.5  72.2  9.49</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\chi^2\)</span> QQ plots are constructed by <code><a href="https://friendly.github.io/heplots/reference/cqplot.html">heplots::cqplot()</a></code>. For the Galton data, the result is shown in <a href="#fig-galton-cqplot" class="quarto-xref">Figure&nbsp;<span>3.22</span></a>, where I’ve asked for the <code>id.n = 3</code> with the greatest <span class="math inline">\(D^2_{(i)}\)</span> values to be identified with their row numbers in the plot. The function returns (invisibly) the <span class="math inline">\(D^2_{(i)}\)</span> and corresponding <span class="math inline">\(\chi^2_2\)</span> quantile along with the upper-tail <span class="math inline">\(p\)</span>-value.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://friendly.github.io/heplots/reference/cqplot.html">cqplot</a></span><span class="op">(</span><span class="va">Galton</span>, id.n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#&gt;       DSQ quantile        p</span></span>
<span><span class="co">#&gt; 1   13.67     15.1 0.000539</span></span>
<span><span class="co">#&gt; 897  9.49     12.9 0.001616</span></span>
<span><span class="co">#&gt; 13   9.45     11.8 0.002694</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-galton-cqplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-galton-cqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-galton-cqplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-galton-cqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.22: Chi-square QQ plot of Galton’s data on heights of parents and their offspring, with a 95% pointwise confidence envelope
</figcaption></figure>
</div>
</div>
</div>
<p>In the typical use of QQ plots, it essential to have something in the nature of a confidence band around the points to be able to appreciate whether, and to what degree the observed data points differ from the reference distribution. For <code><a href="https://friendly.github.io/heplots/reference/cqplot.html">cqplot()</a></code>, this helps to assess whether the data are reasonably distributed as multivariate normal and also to flag potential outliers.</p>
<p>The pointwise 95% confidence envelope is calculated as <span class="math inline">\(D^2_{(i)} \pm 1.96 \times \text{se} ( D^2_{(i)} )\)</span> where the standard error is calculated <span class="citation" data-cites="Chambers-etal:83">(<a href="95-references.html#ref-Chambers-etal:83" role="doc-biblioref">Chambers et al., 1983, sec. 8.6</a>)</span> as</p>
<p><span class="math display">\[
\text{se} ( D^2_{(i)} ) = \frac{\hat{b}}{d ( q_i)} \times \sqrt{  p_i (1-p_i) / n }  \:\: .
\]</span> Here, <span class="math inline">\(\hat{b}\)</span> is an estimate of the <em>actual</em> slope of the reference line obtained from from the ratio of the interquartile range of the <span class="math inline">\(D^2\)</span> values to that of the corresponding <span class="math inline">\(\chi^2_p\)</span> distribution. <span class="math inline">\(d(q_i)\)</span> is the density of the chi square distribution at the quantile <span class="math inline">\(q_i\)</span> and <span class="math inline">\(p_i\)</span> is the corresponding percentile.</p>
<p>So, in <a href="#fig-galton-cqplot" class="quarto-xref">Figure&nbsp;<span>3.22</span></a>, you can see the same three points, with largest <span class="math inline">\(D^2\)</span> identified earlier. The confidence band shows that uncertainty increases a points get further from the mean, but by and large, nearly all the points lie within it. The fact that larger values fall <em>beneath</em> the reference line indicates that the sample <span class="math inline">\(D^2\)</span> are somewhat <em>less concentrated</em> (has a shorter upper tail) than values in the <span class="math inline">\(\chi^2_2\)</span> distribution.</p>
<p>To help understand what we are seeing in this example, it is helpful to view the data in a scatterplot equivalent of <a href="#fig-galton-ellipse-r" class="quarto-xref">Figure&nbsp;<span>3.10</span></a>, with the same three observations labeled and made distinctive in the plot. For this plot, because the heights are recorded in whole inches, I draw the data ellipses first without plotting the points and then draw the points using <code><a href="https://rdrr.io/r/base/jitter.html">jitter()</a></code> on top of the data ellipses.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">47</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">parent</span> <span class="op">~</span> <span class="va">child</span>, data <span class="op">=</span> <span class="va">GaltonD</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.68</span>, <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>            add <span class="op">=</span> <span class="cn">FALSE</span>, plot.points <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            center.pch <span class="op">=</span> <span class="st">"+"</span>, center.cex <span class="op">=</span> <span class="fl">3</span>,</span>
<span>            cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">GaltonD</span>,<span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">child</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">parent</span><span class="op">)</span>,</span>
<span>         col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">DSQ</span> <span class="op">&gt;</span> <span class="va">cutoff</span>, <span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>         pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">DSQ</span> <span class="op">&gt;</span> <span class="va">cutoff</span>, <span class="fl">16</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>         cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">DSQ</span> <span class="op">&gt;</span> <span class="va">cutoff</span>, <span class="fl">2</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">child</span><span class="op">[</span><span class="va">outliers</span><span class="op">]</span>, <span class="va">parent</span><span class="op">[</span><span class="va">outliers</span><span class="op">]</span>, labels <span class="op">=</span> <span class="va">outliers</span>, pos <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-galton-outliers" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-galton-outliers-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-galton-outliers-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-galton-outliers-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.23: Scatterplot of Galton’s data showing 68% and 95% data ellipses for the observations on parent and child height. The discrete points have been jittered to avoid overplotting. The three observations identified as having large <span class="math inline">\(D^2\)</span> values are labeled with their observation number and given distinctive size, color and shape.
</figcaption></figure>
</div>
</div>
</div>
<p>It is clear from this plot that case 897 is for an exceptionally tall child of quite short parents, while case 1 and 13 are from very short children of tall parents; you could call them poster children for regression toward the mean.</p>
</section><section id="sec-multnorm-penguin" class="level3" data-number="3.4.2"><h3 data-number="3.4.2" class="anchored" data-anchor-id="sec-multnorm-penguin">
<span class="header-section-number">3.4.2</span> Penguin data</h3>
<p>Let’s do a similar analysis to assess multivariate normality and identify possible outliers for the Penguin data. In the <code><a href="https://friendly.github.io/heplots/reference/cqplot.html">cqplot()</a></code> shown in <a href="#fig-peng-cqplot" class="quarto-xref">Figure&nbsp;<span>3.24</span></a>, I use the same point symbols and colors as in <a href="#fig-peng-ggplot1" class="quarto-xref">Figure&nbsp;<span>3.18</span></a>. For illustration, I again label the three most extreme points.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clr</span> <span class="op">&lt;-</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span></span>
<span><span class="va">pch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">17</span>, <span class="fl">15</span><span class="op">)</span>   <span class="co"># ggplot symbol defaults for a factor</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://friendly.github.io/heplots/reference/cqplot.html">cqplot</a></span><span class="op">(</span><span class="va">peng</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, </span>
<span>   id.n <span class="op">=</span> <span class="fl">3</span>,</span>
<span>   col <span class="op">=</span> <span class="va">clr</span><span class="op">[</span><span class="va">peng</span><span class="op">$</span><span class="va">species</span><span class="op">]</span>,</span>
<span>   pch <span class="op">=</span> <span class="va">pch</span><span class="op">[</span><span class="va">peng</span><span class="op">$</span><span class="va">species</span><span class="op">]</span>,</span>
<span>   ref.col <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>   what <span class="op">=</span> <span class="st">"Penguin numeric variables"</span>,</span>
<span>   cex.lab <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#&gt;      DSQ quantile       p</span></span>
<span><span class="co">#&gt; 283 27.8     17.6 0.00150</span></span>
<span><span class="co">#&gt; 10  13.3     15.1 0.00450</span></span>
<span><span class="co">#&gt; 35  12.4     13.9 0.00751</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-peng-cqplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-cqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-cqplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-cqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.24: Chi-square QQ plot of the Pengiun data. The three cases with the largest <span class="math inline">\(D^2\)</span> values are identified with their case numbers.
</figcaption></figure>
</div>
</div>
</div>
<p>One point (case 283) stands out as an extreme multivariate outlier. The other two (10, 35) are well within the confidence envelope.</p>
<p>To relate this to the data, we can plot the data, as in <a href="#fig-peng-ggplot1" class="quarto-xref">Figure&nbsp;<span>3.18</span></a>, and label the points identified as noteworthy.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">DSQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">Mahalanobis</a></span><span class="op">(</span><span class="va">peng</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">noteworthy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">DSQ</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 283  10  35</span></span>
<span></span>
<span><span class="va">peng_plot</span> <span class="op">&lt;-</span> <span class="va">peng</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>note <span class="op">=</span> <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">noteworthy</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">peng_plot</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length</span>, y <span class="op">=</span> <span class="va">bill_depth</span>,</span>
<span>           color <span class="op">=</span> <span class="va">species</span>, shape <span class="op">=</span> <span class="va">species</span>, fill<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size<span class="op">=</span><span class="va">note</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_size_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">peng_plot</span>, <span class="va">note</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>            nudge_y <span class="op">=</span> <span class="fl">.4</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>              se<span class="op">=</span><span class="cn">FALSE</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, level <span class="op">=</span> <span class="fl">0.95</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-peng-ggplot-out" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-ggplot-out-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-ggplot-out-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-ggplot-out-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.25: Plot of bill length and bill depth, with the noteworthy points labeled. Only one (case 283) is a true multivariate outlier.
</figcaption></figure>
</div>
</div>
</div>
<p>Two cases (10, 283) appear to be very unusual in this plot, in relation to other members of their species. But only case 283 is a true multivariate outlier, as shown in the cqplot <a href="#fig-peng-cqplot" class="quarto-xref">Figure&nbsp;<span>3.24</span></a>. We could call this long-billed penguin “Cyrano”. I’ll call case 10, with a very short and curved bill, “Hook Nose”.</p>
<p>Of course, we are only looking at the data in the 2D space of the bill variables, but possible outliers exist in four dimensional Penguin space. Case 35 is well inside the Adelie ellipse, so perhaps it is unusual on one of the other variables. It turns out that multivariate outliers can most often be easily seen as unusual observations in a projection of the data into the space of the <em>smallest</em> principal components. I return to this example in <a href="04-pca-biplot.html#sec-outlier-detection" class="quarto-xref"><span>Section 4.7</span></a>.</p>
<p>It bears noting that for linear models, multivariate normality is <strong>not required</strong> for the response variables or predictors, but rather is an assumption for the <em>residuals</em> from a model. As well, multivariate outliers in the responses may not turn out to be unusual when the predictor variables are taken into account. In this example, a multivariate model would include the effect of <code>species</code>,</p>
<div class="sourceCode" id="cb34" data-code-line-numbers=""><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">peng.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bill_length</span>, <span class="va">bill_depth</span>, <span class="va">flipper_length</span>, <span class="va">body_mass</span><span class="op">)</span> <span class="op">~</span> <span class="va">species</span>, </span>
<span>               data <span class="op">=</span> <span class="va">peng</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and there would be cause for concern if the residuals from this model, <code>residuals(peng.mod)</code> were highly non-normal or showed outliers.</p>
<!--
This example also illustrates why outlier detection requires a multivariate rather than univariate approach
and why it is necessary to take the correlations among variables into account with Malahanobis squared distance.
In the code below, I find the observations with the three largest $D^2_{(i)}$ and convert the numeric variables
to standardized $z$ scores, $z_i = (y_i - \bar{y}) / s_y$.








::: {.cell layout-align="center"}

```{.r .cell-code}
DSQ <- Mahalanobis(peng[, 3:6])
noteworthy <- order(DSQ, decreasing = TRUE)[1:3] |> print()
#> [1] 283  10  35

peng |>
  tibble::rownames_to_column(var = "id") |> 
  mutate(
    z_BL = c(scale(bill_length)),
    z_BD = c(scale(bill_depth)),
    z_FL = c(scale(flipper_length)),
    z_BM = c(scale(body_mass))
  ) |>
  filter(id %in% noteworthy) |>
  select(id, species, z_BL:z_BM) 
#> # A tibble: 3 × 6
#>   id    species     z_BL  z_BD   z_FL   z_BM
#>   <chr> <fct>      <dbl> <dbl>  <dbl>  <dbl>
#> 1 10    Adelie    -1.72  2.00  -0.212  0.240
#> 2 35    Adelie    -0.767 0.983 -1.21   0.550
#> 3 283   Chinstrap  2.56  0.323 -1.42  -0.630
```
:::







-->
</section></section><section id="sec-scatmat" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="sec-scatmat">
<span class="header-section-number">3.5</span> Scatterplot matrices</h2>
<p>Going beyond bivariate scatterplots, a <em>pairs</em> plot (or <em>scatterplot matrix</em>) displays all possible <span class="math inline">\(p \times p\)</span> pairs of <span class="math inline">\(p\)</span> variables in a matrix-like display where variables <span class="math inline">\((x_i, x_j)\)</span> are shown in a plot for row <span class="math inline">\(i\)</span>, column <span class="math inline">\(j\)</span>. This idea, due to <span class="citation" data-cites="Hartigan:75b">Hartigan (<a href="95-references.html#ref-Hartigan:75b" role="doc-biblioref">1975b</a>)</span>, uses small multiple plots, so that the eye can easily scan across a row or down a column to see how a given variable is related to all the others.</p>
<p>The most basic version is provided by <code><a href="https://rdrr.io/r/graphics/pairs.html">pairs()</a></code> in base R. When one variable is considered as an outcome or response, it is usually helpful to put this in the first row and column. For the <code>Prestige</code> data, in addition to income and education, we also have a measure of % women in each occupational category.</p>
<p>Plotting these together gives <a href="#fig-prestige-pairs" class="quarto-xref">Figure&nbsp;<span>3.26</span></a>. In such plots, the diagonal cells give labels for the variables, but they are also a guide to interpreting what is shown. In each row, say row 2 for <code>income</code>, income is the vertical <span class="math inline">\(y\)</span> variable in plots against other variables. In each column, say column 3 for <code>education</code>, education is the horizontal <span class="math inline">\(x\)</span> variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">prestige</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>      data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-pairs" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-pairs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-prestige-pairs-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-pairs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.26: Scatterplot matrix of the variables in the Prestige dataset produced by <code><a href="https://rdrr.io/r/graphics/pairs.html">pairs()</a></code>
</figcaption></figure>
</div>
</div>
</div>
<p>The plots in the first row show what we have seen before for the relations between prestige and income and education, adding to those the plot of prestige vs.&nbsp;% women. Plots in the first column show the same data, but with <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> interchanged.</p>
<p>But this basic <code><a href="https://rdrr.io/r/graphics/pairs.html">pairs()</a></code> plot is very limited. A more feature-rich version is provided by <code><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">car::scatterplotMatrix()</a></code> which can add the regression lines, loess smooths and data ellipses for each pair, as shown in <a href="#fig-prestige-spm1" class="quarto-xref">Figure&nbsp;<span>3.27</span></a>.</p>
<p>The diagonal panels show density curves for the distribution of each variable; for example, the distribution of <code>education</code> appears to be multi-modal and that of <code>women</code> shows that most of the occupations have a low percentage of women.</p>
<p>The combination of the regression line with the loess smoothed curve, but without their confidence envelopes, provides about the right amount of detail to take in at a glance where the relations are non-linear. We’ve already seen (<a href="#fig-Prestige-scatterplot-income1" class="quarto-xref">Figure&nbsp;<span>3.11</span></a>) the non-linear relation between prestige and income (row 1, column 2) when occupational type is ignored. But all relations with income in column 2 are non-linear, reinforcing our idea (<a href="#sec-log-scale" class="quarto-xref"><span>Section 3.2.3.1</span></a>) that effects of income should be assessed on a log scale.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">prestige</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>  data<span class="op">=</span><span class="va">Prestige</span>,</span>
<span>  regLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="va">lm</span>, lty<span class="op">=</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,</span>
<span>  smooth<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>smoother<span class="op">=</span><span class="va">loessLine</span>, spread<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>              lty.smooth<span class="op">=</span><span class="fl">1</span>, lwd.smooth<span class="op">=</span><span class="fl">3</span>, col.smooth<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>,</span>
<span>  ellipse<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels<span class="op">=</span><span class="fl">0.68</span>, fill.alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-spm1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-spm1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-prestige-spm1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-spm1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.27: Scatterplot matrix of the variables in the Prestige dataset from <code><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">car::scatterplotMatrix()</a></code>.
</figcaption></figure>
</div>
</div>
</div>
<p><code><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix()</a></code> can also label points using the <code>id =</code> argument (though this can get messy) and can stratify the observations by a grouping variable with different symbols and colors. For example, <a href="#fig-prestige-spm2" class="quarto-xref">Figure&nbsp;<span>3.28</span></a> uses the syntax <code>~ prestige + education + income + women | type</code> to provide separate regression lines, smoothed curves and data ellipses for the three types of occupations. (The default colors are somewhat garish, so I use <code><a href="https://scales.r-lib.org/reference/pal_hue.html">scales::hue_pal()</a></code> to mimic the discrete color scale used in <code>ggplot2</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">prestige</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">|</span> <span class="va">type</span>,</span>
<span>  data <span class="op">=</span> <span class="va">Prestige</span>,</span>
<span>  col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">15</span><span class="op">:</span><span class="fl">17</span>,</span>
<span>  smooth<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>smoother<span class="op">=</span><span class="va">loessLine</span>, spread<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>              lty.smooth<span class="op">=</span><span class="fl">1</span>, lwd.smooth<span class="op">=</span><span class="fl">3</span>, col.smooth<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,</span>
<span>  ellipse<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels<span class="op">=</span><span class="fl">0.68</span>, fill.alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-spm2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-spm2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-prestige-spm2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-spm2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.28: Scatterplot matrix of the variables in the Prestige dataset from <code><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">car::scatterplotMatrix()</a></code>, stratified by type of occupation.
</figcaption></figure>
</div>
</div>
</div>
<p>It is now easy to see why education is multi-modal: blue collar, white collar and professional occupations have largely non-overlapping years of education. As well, the distribution of % women is much higher in the white collar category.</p>
<p>For the <code>penguins</code> data, given what we’ve seen before in <a href="#fig-peng-ggplot1" class="quarto-xref">Figure&nbsp;<span>3.18</span></a> and <a href="#fig-peng-ggplot2" class="quarto-xref">Figure&nbsp;<span>3.19</span></a>, we may wish to suppress details of the points (<code>plot.points = FALSE</code>) and loess smooths (<code>smooth = FALSE</code>) to focus attention on the similarity of regression lines and data ellipses for the three penguin species. In <a href="#fig-peng-spm" class="quarto-xref">Figure&nbsp;<span>3.29</span></a>, I’ve chosen to show boxplots rather than density curves in the diagonal panels in order to highlight differences in the means and interquartile ranges of the species, and to show 68% and 95% data ellipses in the off-diagonal panels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">bill_length</span> <span class="op">+</span> <span class="va">bill_depth</span> <span class="op">+</span> <span class="va">flipper_length</span> <span class="op">+</span> <span class="va">body_mass</span> <span class="op">|</span> <span class="va">species</span>,</span>
<span>  data <span class="op">=</span> <span class="va">peng</span>, </span>
<span>  col <span class="op">=</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="st">"medium"</span><span class="op">)</span>, </span>
<span>  legend<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.68</span>, <span class="fl">0.95</span><span class="op">)</span>, </span>
<span>                 fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  regLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  diagonal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"boxplot"</span><span class="op">)</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot.points <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cex.labels<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-peng-spm" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-spm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-spm-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-spm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.29: Scatterplot matrix of the quantitative variables in the penguins dataset, stratified by species.
</figcaption></figure>
</div>
</div>
</div>
<!--# I added cex.labels=1 in the code above because the diag labels were on top of the boxplots, I think it looks a bit better now, but still slightly obscured-->
<p>It can be seen that the species are widely separated in most of the bivariate plots. As well, the regression lines for species have similar slopes and the data ellipses have similar size and shape in most of the plots. From the boxplots, we can also see that <span style="color: orange;">Adelie</span> penguins have shorter bill lengths than the others, while <span style="color: green;">Gentoo</span> penguins have smaller bill depth, but longer flippers and are heavier than <span style="color: purple;">Chinstrap</span> and <span style="color: orange;">Adelie</span> penguins.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Looking ahead">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Looking ahead
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#fig-peng-spm" class="quarto-xref">Figure&nbsp;<span>3.29</span></a> provides a reasonably complete visual summary of the data in relation to multivariate models that ask “do the species differ in their means on these body size measures?” This corresponds to the MANOVA model,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">peng.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bill_length</span>, <span class="va">bill_depth</span>, <span class="va">flipper_length</span>, <span class="va">body_mass</span><span class="op">)</span> <span class="op">~</span> <span class="va">species</span>, </span>
<span>               data<span class="op">=</span><span class="va">peng</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hypothesis-error (HE) plots, described in <a href="11-mlm-viz.html" class="quarto-xref"><span>Chapter 11</span></a> provide a better summary of the evidence for the MANOVA test of differences among means on all variables together. These give an <span class="math inline">\(\mathbf{H}\)</span> ellipse reflecting the differences among means, to be compared with an <span class="math inline">\(\mathbf{E}\)</span> ellipse reflecting within-group variation and a visual test of significance.</p>
<p>A related question is “how well are the penguin species distinguished by these body size measures?” Here, the relevant model is linear discriminant analysis (LDA), where <code>species</code> plays the role of the response in the model,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">peng.lda</span> <span class="op">&lt;-</span> <span class="va">MASS</span><span class="op">:</span><span class="fu">lda</span><span class="op">(</span> <span class="va">species</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bill_length</span>, <span class="va">bill_depth</span>, <span class="va">flipper_length</span>, <span class="va">body_mass</span><span class="op">)</span>, </span>
<span>               data<span class="op">=</span><span class="va">peng</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both MANOVA and LDA depend on the assumption that the variances and correlations between the variables are the same for all groups. This assumption can be tested and visualized using the methods in <a href="12-eqcov.html" class="quarto-xref"><span>Chapter 12</span></a>.</p>
</div>
</div>
<section id="visual-thinning" class="level3" data-number="3.5.1"><h3 data-number="3.5.1" class="anchored" data-anchor-id="visual-thinning">
<span class="header-section-number">3.5.1</span> Visual thinning</h3>
<p>What can you do if there are even more variables than in these examples? If what you want is a high-level, zoomed-out display summarizing the pairwise relations more strongly, you can apply the idea of visual thinning to show only the most important features.</p>
<p>This example uses data on the rate of various crimes in the 50 U.S. states from the United States Statistical Abstracts, 1970, used by <span class="citation" data-cites="Hartigan:75">Hartigan (<a href="95-references.html#ref-Hartigan:75" role="doc-biblioref">1975a</a>)</span> and <span class="citation" data-cites="Friendly:91">Friendly (<a href="95-references.html#ref-Friendly:91" role="doc-biblioref">1991</a>)</span>. These are ordered in the dataset roughly by seriousness of crime or from crimes of violence to property crimes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">crime</span>, package <span class="op">=</span> <span class="st">"ggbiplot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">crime</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':  50 obs. of  10 variables:</span></span>
<span><span class="co">#&gt;  $ state   : chr  "Alabama" "Alaska" "Arizona" "Arkansas" ...</span></span>
<span><span class="co">#&gt;  $ murder  : num  14.2 10.8 9.5 8.8 11.5 6.3 4.2 6 10.2 11.7 ...</span></span>
<span><span class="co">#&gt;  $ rape    : num  25.2 51.6 34.2 27.6 49.4 42 16.8 24.9 39.6 31.1 ...</span></span>
<span><span class="co">#&gt;  $ robbery : num  96.8 96.8 138.2 83.2 287 ...</span></span>
<span><span class="co">#&gt;  $ assault : num  278 284 312 203 358 ...</span></span>
<span><span class="co">#&gt;  $ burglary: num  1136 1332 2346 973 2139 ...</span></span>
<span><span class="co">#&gt;  $ larceny : num  1882 3370 4467 1862 3500 ...</span></span>
<span><span class="co">#&gt;  $ auto    : num  281 753 440 183 664 ...</span></span>
<span><span class="co">#&gt;  $ st      : chr  "AL" "AK" "AZ" "AR" ...</span></span>
<span><span class="co">#&gt;  $ region  : Factor w/ 4 levels "Northeast","South",..: 2 4 4 2 4 4 1 2 2 2 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- **TODO**: This dataset is actually `data(crime, package = "ggbiplot")` but this depends on my new version, not yet on CRAN. -->
<p><a href="#fig-crime-spm" class="quarto-xref">Figure&nbsp;<span>3.30</span></a> displays the scatterplot matrix for these seven variables, using only the regression line and data ellipse to show the linear relation and the loess smooth to show potential non-linearity.<!--# I believe you used non-linear, hyphenated earlier so I added the - --> To make this even more schematic, the axis tick marks and labels are also removed using the <code><a href="https://rdrr.io/r/graphics/par.html">par()</a></code> settings <code>xaxt = "n", yaxt = "n"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix</a></span><span class="op">(</span></span>
<span>    plot.points <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span>, fill<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    smooth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>spread <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                  lwd.smooth<span class="op">=</span><span class="fl">2</span>, lty.smooth <span class="op">=</span> <span class="fl">1</span>, col.smooth <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>,</span>
<span>    cex.labels <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    xaxt <span class="op">=</span> <span class="st">"n"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-spm" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-spm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-crime-spm-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-spm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.30: <strong>Visual thinning</strong>: Scatterplot matrix of the crime data, showing only high-level summaries of the linear and nonlinear relations betgween each pair of variables.
</figcaption></figure>
</div>
</div>
</div>
<p>We can see that all pairwise correlations are positive, pairs closer to the main diagonal tend to be more highly correlated and in most cases the nonparametric smooth doesn’t differ much from the linear regression line. Exceptions to this appear mainly in the columns for <code>robbery</code> and <code>auto</code> (auto theft).</p>
</section></section><section id="sec-corrgram" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="sec-corrgram">
<span class="header-section-number">3.6</span> Corrgrams</h2>
<p>What if you want to summarize the data even further simple visual thinning. For example with many variables you might want to show only the value of the correlation for each pair of variables, but do so in a way to help see patterns in the correlations that would be invisible in just a table.</p>
<p>A <strong>corrgram</strong> <span class="citation" data-cites="Friendly:02:corrgram">(<a href="95-references.html#ref-Friendly:02:corrgram" role="doc-biblioref">Friendly, 2002</a>)</span> is a visual display of a correlation matrix, where the correlation can be rendered in a variety of ways to show the direction and magnitude: circular “pac-man” (or pie) symbols, ellipses, colored vars or shaded rectangles, as shown in <a href="#fig-corrgram-renderings" class="quarto-xref">Figure&nbsp;<span>3.31</span></a>.</p>
<p>Another aspect is that of <strong>effect ordering</strong> <span class="citation" data-cites="FriendlyKwan:03:effect">(<a href="95-references.html#ref-FriendlyKwan:03:effect" role="doc-biblioref">Friendly &amp; Kwan, 2003</a>)</span>, ordering the levels of factors and variables in graphic displays to make important features most apparent. For variables, this means that we can arrange the variables in a matrix-like display in such a way as to make the pattern of relationships easiest to see. Methods to achieve this include using principal components and cluster analysis to put the most related variables together as described in <a href="04-pca-biplot.html" class="quarto-xref"><span>Chapter 4</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-corrgram-renderings" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-corrgram-renderings-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/corrgram-renderings.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-corrgram-renderings-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.31: <strong>Corrgrams</strong>: Some renderings for the value of a correlation in a corrgram display, conveying sign and magnitude in different ways.
</figcaption></figure>
</div>
</div>
</div>
<p>In R, these diagrams can be created using the <span style="color: brown;"><strong>corrgram</strong></span> <span class="citation" data-cites="R-corrgram">(<a href="95-references.html#ref-R-corrgram" role="doc-biblioref">Wright, 2021</a>)</span> and <span style="color: brown;"><strong>corrplot</strong></span> <span class="citation" data-cites="R-corrplot">(<a href="95-references.html#ref-R-corrplot" role="doc-biblioref">Wei &amp; Simko, 2024</a>)</span> packages, with different features. <code><a href="http://kwstat.github.io/corrgram/reference/corrgram.html">corrgram::corrgram()</a></code> is closest to <span class="citation" data-cites="Friendly:02:corrgram">Friendly (<a href="95-references.html#ref-Friendly:02:corrgram" role="doc-biblioref">2002</a>)</span>, in that it allows different rendering functions for the lower, upper and diagonal panels as illustrated in <a href="#fig-corrgram-renderings" class="quarto-xref">Figure&nbsp;<span>3.31</span></a>. For example, a corrgram similar to <a href="#fig-crime-spm" class="quarto-xref">Figure&nbsp;<span>3.30</span></a> can be produced as follows (not shown here):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="http://kwstat.github.io/corrgram/reference/corrgram.html">corrgram</a></span><span class="op">(</span>lower.panel <span class="op">=</span> <span class="va">panel.ellipse</span>,</span>
<span>           upper.panel <span class="op">=</span> <span class="va">panel.ellipse</span>,</span>
<span>           diag.panel <span class="op">=</span> <span class="va">panel.density</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the <span style="color: brown;"><strong>corrplot</strong></span> package, <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot()</a></code> provides the rendering methods <code>c("circle", "square", "ellipse", "number", "shade", "color", "pie")</code>, but only one can be used at a time. The function <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.mixed.html">corrplot.mixed()</a></code> allows different options to be selected for the lower and upper triangles. The iconic rendering shape is colored with a gradient in relation to the correlation value. For comparison, <a href="#fig-crime-corrplot" class="quarto-xref">Figure&nbsp;<span>3.32</span></a> uses ellipses below the diagonal and filled pie charts below the diagonal using a gradient of the fill color in both cases.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime.cor</span> <span class="op">&lt;-</span> <span class="va">crime</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.mixed.html">corrplot.mixed</a></span><span class="op">(</span><span class="va">crime.cor</span>,</span>
<span>   lower <span class="op">=</span> <span class="st">"ellipse"</span>,</span>
<span>   upper <span class="op">=</span> <span class="st">"pie"</span>,</span>
<span>   tl.col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>   tl.srt <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   tl.cex <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>   addCoef.col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>   addCoefasPercent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-corrplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-corrplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-crime-corrplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-corrplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.32: Mixed corrplot of the <code>crime</code> data, showing the correlation between each pair of variables with an ellipse (lower) and a pie chart symbol (upper), all shaded in proportion to the correlation value, also shown numerically.
</figcaption></figure>
</div>
</div>
</div>
<p>The combination of renderings shown in <a href="#fig-crime-corrplot" class="quarto-xref">Figure&nbsp;<span>3.32</span></a> is instructive. Small differences among correlation values are easier to see with the pie symbols than with the ellipses; for example, compare the values for murder with larceny and auto theft in row 1, columns 6-7 with those in column 1, rows 6-7, where the former are easier to distinguish. The shading color adds another visual cue.</p>
<p>The variables in <a href="#fig-crime-spm" class="quarto-xref">Figure&nbsp;<span>3.30</span></a> and <a href="#fig-crime-corrplot" class="quarto-xref">Figure&nbsp;<span>3.32</span></a> are arranged by their order in the dataset, which is not often the most useful. A better idea is to arrange the variables so that the most highly correlated variables are adjacent.</p>
<p>A general method described in <a href="04-pca-biplot.html#sec-var-order" class="quarto-xref"><span>Section 4.5</span></a> orders the variables according to the angles of the first two eigenvectors from a principal components analysis (PCA) around a unit circle. The function <code><a href="https://rdrr.io/pkg/corrplot/man/corrMatOrder.html">corrMatOrder()</a></code> provides several methods (<code>order = c("AOE", "FPC", "hclust", "alphabet")</code>) for doing this, and PCA ordering is <code>order = "AOE"</code>. Murder and auto theft are still first and last, but some of the intermediate crimes have been rearranged.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrMatOrder.html">corrMatOrder</a></span><span class="op">(</span><span class="va">crime.cor</span>, order <span class="op">=</span> <span class="st">"AOE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">crime.cor</span><span class="op">)</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "murder"   "assault"  "rape"     "robbery"  "burglary"</span></span>
<span><span class="co">#&gt; [6] "larceny"  "auto"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- other orders: FPC (PC1), hclust (with various clustering methods), alphabet, original -->
<!-- calculated with corrMatOrder() -->
<p>Using this ordering in <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot()</a></code> produces <a href="#fig-crime-corrplot-AOE" class="quarto-xref">Figure&nbsp;<span>3.33</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.mixed.html">corrplot.mixed</a></span><span class="op">(</span><span class="va">crime.cor</span>,</span>
<span>  order <span class="op">=</span> <span class="st">"AOE"</span>, </span>
<span>  lower <span class="op">=</span> <span class="st">"ellipse"</span>,</span>
<span>  upper <span class="op">=</span> <span class="st">"ellipse"</span>,</span>
<span>  tl.col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  tl.srt <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tl.cex <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>  addCoef.col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  addCoefasPercent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-corrplot-AOE" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-corrplot-AOE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-crime-corrplot-AOE-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-corrplot-AOE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.33: Corrplot of the <code>crime</code> data with the variables reordered according to the angles of variable eigenvectors. Correlations are rendered with ellipses shaded in proportion to their magnitude.
</figcaption></figure>
</div>
</div>
</div>
<p>In this case, where the correlations among the crime variables are all positive, the effect of variable re-ordering is subtle, but note that there is now a slightly pronounced pattern of highest correlations near the diagonal, and decreasing away from the diagonal. <a href="04-pca-biplot.html#fig-mtcars-corrplot-varorder" class="quarto-xref">Figure&nbsp;<span>4.27</span></a> and <a href="04-pca-biplot.html#fig-mtcars-corrplot-pcaorder" class="quarto-xref">Figure&nbsp;<span>4.29</span></a> in <a href="04-pca-biplot.html#sec-var-order" class="quarto-xref"><span>Section 4.5</span></a> provide a more dramatic example of variable ordering using this method.</p>
<p>Variations of corrgrams are worthy replacements for a numeric table of correlations, which are often presented in publications only for archival value. Including the numeric value (rounded here, for presentation purposes), makes this an attractive alternative to boring tables of correlations.</p>
</section><section id="sec-ggpairs" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="sec-ggpairs">
<span class="header-section-number">3.7</span> Generalized pairs plots</h2>
<p>When a dataset contains one or more discrete variables, the traditional pairs plot cannot cope, because the discrete categories would plot as many overlaid points. This cannot be represented using only color and/or point symbols in a meaningful scatterplot.</p>
<p>But the associations between categorical variables in a frequency table <em>can</em> be shown in <em>mosaic displays</em> <span class="citation" data-cites="Friendly:94a">(<a href="95-references.html#ref-Friendly:94a" role="doc-biblioref">Friendly, 1994</a>)</span>, using an array of tiles whose areas are depict the cell frequencies. For an <span class="math inline">\(n\)</span>-way frequency, an analog of the scatterplot matrix uses mosaic plots for each pair of variables. The <span style="color: brown;"><strong>vcd</strong></span> package <span class="citation" data-cites="R-vcd">(<a href="95-references.html#ref-R-vcd" role="doc-biblioref">Meyer et al., 2024</a>)</span> implements very general <code><a href="https://rdrr.io/r/graphics/pairs.html">pairs()</a></code> methods for <code>"table"</code> objects and <span style="color: brown;"><strong>vcdExtra</strong></span> <span class="citation" data-cites="R-vcdExtra">(<a href="95-references.html#ref-R-vcdExtra" role="doc-biblioref">Friendly, 2023</a>)</span> extends this to wide classes of loglinear models <span class="citation" data-cites="Friendly:99:EMD">(<a href="95-references.html#ref-Friendly:99:EMD" role="doc-biblioref">Friendly, 1999</a>)</span> See <span class="citation" data-cites="Friendly:99:EMD">Friendly (<a href="95-references.html#ref-Friendly:99:EMD" role="doc-biblioref">1999</a>)</span> and my book <em>Discrete Data Analysis with R</em> <span class="citation" data-cites="FriendlyMeyer:2016:DDAR">(<a href="95-references.html#ref-FriendlyMeyer:2016:DDAR" role="doc-biblioref">Friendly &amp; Meyer, 2016</a>)</span> for mosaic plots and mosaic matrices.</p>
<p>For example, we can tabulate the distributions of penguin species by sex and the island where they were observed using <code><a href="https://rdrr.io/r/stats/xtabs.html">xtabs()</a></code>. <code><a href="https://rdrr.io/r/stats/ftable.html">ftable()</a></code> prints this three-way table more compactly. (In this example, and what follows in the chapter, I’ve changed the labels for sex from (“f”, “m”) to (“Female”, “Male”)).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># use better labels for sex</span></span>
<span><span class="va">peng</span> <span class="op">&lt;-</span> <span class="va">peng</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">peng.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">island</span>, data <span class="op">=</span> <span class="va">peng</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/ftable.html">ftable</a></span><span class="op">(</span><span class="va">peng.table</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  island Biscoe Dream Torgersen</span></span>
<span><span class="co">#&gt; species   sex                                 </span></span>
<span><span class="co">#&gt; Adelie    Female            22    27        24</span></span>
<span><span class="co">#&gt;           Male              22    28        23</span></span>
<span><span class="co">#&gt; Chinstrap Female             0    34         0</span></span>
<span><span class="co">#&gt;           Male               0    34         0</span></span>
<span><span class="co">#&gt; Gentoo    Female            58     0         0</span></span>
<span><span class="co">#&gt;           Male              61     0         0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see immediately that the penguin species differ by island: only Adelie were observed on all three islands; Biscoe Island had no Chinstraps and Dream Island had no Gentoos.</p>
<p><code>vcd::pairs()</code> produces all pairwise mosaic plots, as shown in <a href="#fig-peng-mosaic" class="quarto-xref">Figure&nbsp;<span>3.34</span></a>. The diagonal panels show the one-way frequencies by width of the divided bars. Each off-diagonal panel shows the bivariate counts, breaking down each column variable by splitting the bars in proportion to a second variable. Consequently, the frequency of each cell is represented by its’ area. The purpose is to show the <strong>pattern of association</strong> between each pair, and so, the tiles in the mosaic are shaded according to the signed standardized residual, <span class="math inline">\(d_{ij} = (n_{ij} - \hat{n}_{ij}) / \sqrt{\hat{n}_{ij}}\)</span> in a simple <span class="math inline">\(\chi^2 = \Sigma_{ij} \; d_{ij}^2\)</span> test for association— <span style="color: blue;">blue</span> where the observed frequency <span class="math inline">\(n_{ij}\)</span> is significantly greater than expected <span class="math inline">\(\hat{n}_{ij}\)</span> under independence, and <span style="color: red;">red</span> where it is less than expected. The tiles are unshaded when <span class="math inline">\(| d_{ij} | &lt; 2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">vcd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="va">peng.table</span>, shade <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      lower_panel_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>labeling <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vcd/man/labeling_border.html">labeling_values</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      upper_panel_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>labeling <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vcd/man/labeling_border.html">labeling_values</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-peng-mosaic" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-mosaic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-mosaic-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-mosaic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.34: Mosaic pairs plot for the combinations of species, sex and island. Diagnonal plots show the marginal frequency of each variable by the width of each rectangle. Off-diagonal mosaic plots subdivide by the conditional frequency of the second variable, shown numerically in the tiles.
</figcaption></figure>
</div>
</div>
</div>
<p>The shading patterns in cells (1,3) and (3,1) of <a href="#fig-peng-mosaic" class="quarto-xref">Figure&nbsp;<span>3.34</span></a> show what we’ve seen before in the table of frequencies: The distribution of species varies across island because on each island one or more species did not occur. Row 2 and column 2 show that sex is nearly exactly proportional among species and islands, indicating independence, <span class="math inline">\(\text{sex} \perp \{\text{species}, \text{island}\}\)</span>. More importantly, mosaic pairs plots can show, at a glance, all (bivariate) associations among multivariate categorical variables.</p>
<p>The next step, by John Emerson and others <span class="citation" data-cites="Emerson-etal:2013">(<a href="95-references.html#ref-Emerson-etal:2013" role="doc-biblioref">Emerson et al., 2013</a>)</span> was to recognize that combinations of continuous and discrete, categorical variables could be plotted in different ways.</p>
<ul>
<li>Two continuous variables can be shown as a standard scatterplot of points and/or bivariate density contours, or simply by numeric summaries such as a correlation value;</li>
<li>A pair of one continuous and one categorical variable can be shown as side-by-side boxplots or violin plots, histograms or density plots;</li>
<li>Two categorical variables could be shown in a mosaic plot or by grouped bar plots.</li>
</ul>
<p>In the ggplot2 framework, these displays are implemented using the <code><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs()</a></code> function from the <span style="color: brown;"><strong>GGally</strong></span> package <span class="citation" data-cites="R-GGally">(<a href="95-references.html#ref-R-GGally" role="doc-biblioref">Schloerke et al., 2024</a>)</span>. This allows different plot types to be shown in the lower and upper triangles and in the diagonal cells of the plot matrix. As well, aesthetics such as color and shape can be used within the plots to distinguish groups directly. As illustrated below, you can define custom functions to control exactly what is plotted in any panel.</p>
<p>The basic, default plot shows scatterplots for pairs of continuous variables in the lower triangle and the values of correlations in the upper triangle. A combination of a discrete and continuous variables is plotted as histograms in the lower triangle and boxplots in the upper triangle. <a href="#fig-peng-ggpairs1" class="quarto-xref">Figure&nbsp;<span>3.35</span></a> includes <code>sex</code> to illustrate the combinations.</p>
<!-- fig.code: R/peng/peng-ggally.R -->
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb49" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span><span class="va">peng</span>, columns<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">species</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- this figure now frozen because it takes too long and caching creates git problems -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-ggpairs1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-ggpairs1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-ggpairs1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-ggpairs1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.35: Basic <code><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs()</a></code> plot of penguin size variables and sex, stratified by species.
</figcaption></figure>
</div>
</div>
</div>
<p>To my eye, printing the values of correlations in the upper triangle is often a waste of graphic space. But in this example the correlations show something peculiar and interesting if you look closely: In all pairs among the penguin size measurements, there are positive correlations within each species, as we can see in <a href="#fig-peng-spm" class="quarto-xref">Figure&nbsp;<span>3.29</span></a>. Yet, in three of these panels, the overall correlation ignoring species is negative. For example, the overall correlation between bill depth and flipper length is <span class="math inline">\(r = -0.579\)</span> in row 2, column 3; the scatterplot in the diagonally opposite cell, row 3, column 2 shows the data. These cases, of differing signs for an overall correlation, ignoring a group variable and the within group correlations are examples of <strong>Simpson’s Paradox</strong>, explored later in Chapter XX. <!--# TODO: add chapter number when known --></p>
<p>The last row and column, for <code>sex</code> in <a href="#fig-peng-ggpairs1" class="quarto-xref">Figure&nbsp;<span>3.35</span></a>, provides an initial glance at the issue of sex differences among penguin species that motivated the collection of these data. We can go further by also examining differences among species and island, but first we need to understand how to display exactly what we want for each pairwise plot.</p>
<p><code><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs()</a></code> is extremely general in that for each of the <code>lower</code>, <code>upper</code> and <code>diag</code> sections you can assign any of a large number of built-in functions (of the form <code>ggally_NAME</code>), or your own custom function for what is plotted, depending on the types of variables in each plot.</p>
<ul>
<li>
<code>continuous</code>: both X and Y are continuous variables, supply this as the <code>NAME</code> part of a <code>ggally_NAME()</code> function or the name of a custom function;</li>
<li>
<code>combo</code>: one X of and Y variable is discrete while the other is continuous, using the same convention;</li>
<li>
<code>discrete</code>: both X and Y are discrete variables.</li>
</ul>
<p>The defaults, which were used in <a href="#fig-peng-ggpairs1" class="quarto-xref">Figure&nbsp;<span>3.35</span></a>, are:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">upper</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="st">"cor"</span>,          <span class="co"># correlation values</span></span>
<span>             combo <span class="op">=</span> <span class="st">"box_no_facet"</span>,      <span class="co"># boxplots </span></span>
<span>             discrete <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span>          <span class="co"># rectangles ~ count</span></span>
<span><span class="va">lower</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="st">"points"</span>,       <span class="co"># just data points</span></span>
<span>             combo <span class="op">=</span> <span class="st">"facethist"</span>,         <span class="co"># faceted histograms</span></span>
<span>             discrete <span class="op">=</span> <span class="st">"facetbar"</span><span class="op">)</span>       <span class="co"># faceted bar plots</span></span>
<span><span class="va">diag</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="st">"densityDiag"</span>,  <span class="co"># density plots</span></span>
<span>             discrete <span class="op">=</span> <span class="st">"barDiag"</span><span class="op">)</span>        <span class="co"># bar plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Thus, <code><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs()</a></code> uses <code><a href="https://ggobi.github.io/ggally/reference/ggally_cor.html">ggally_cor()</a></code> to print the correlation values for pairs of continuous variables in the upper triangle, and uses <code><a href="https://ggobi.github.io/ggally/reference/ggally_points.html">ggally_points()</a></code> to plot scatterplots of points in the lower portion. The diagonal panels as shown as density plots (<code><a href="https://ggobi.github.io/ggally/reference/ggally_densityDiag.html">ggally_densityDiag()</a></code>) for continuous variables but as bar plots (<code><a href="https://ggobi.github.io/ggally/reference/ggally_barDiag.html">ggally_barDiag()</a></code>) for discrete factors.</p>
<p>See the vignette, <a href="https://ggobi.github.io/ggally/articles/ggally_plots.html">ggally_plots</a> for an illustrated list of available high-level plots. For our purpose here, which is to illustrate enhanced displays, note that for scatterplots of continuous variables, there are two functions which plot the points and also add a smoother, <code>_lm</code> or <code>_loess</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-reflect.html">getNamespace</a></span><span class="op">(</span><span class="st">"GGally"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span><span class="st">"^ggally_smooth_"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ggally_smooth_lm"    "ggally_smooth_loess"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A customized display for scatterplots of continuous variables can be any function that takes <code>data</code> and <code>mapping</code> arguments and returns a <code>"ggplot"</code> object. The <code>mapping</code> argument supplies the aesthetics, e.g., <code>aes(color=species, alpha=0.5)</code>, but only if you wish to override what is supplied in the <code><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs()</a></code> call.</p>
<p>Here is a function, <code>my_panel()</code> that plots the data points, regression line and loess smooth:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_panel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">mapping</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, mapping <span class="op">=</span> <span class="va">mapping</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="va">loess</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">p</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this example, I want only simple summaries of for the scatterplots, so I don’t want to plot the data points, but do want to add the regression line and a data ellipse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_panel1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">mapping</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, mapping <span class="op">=</span> <span class="va">mapping</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, level <span class="op">=</span> <span class="fl">0.68</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">p</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, to show what can be done, <a href="#fig-peng-ggpairs7" class="quarto-xref">Figure&nbsp;<span>3.36</span></a> uses <code>my_panel1()</code> for the scatterplots in the 4 x 4 block of plots in the upper left. The combination of the continuous body size measures and the discrete factors <code>species</code>, <code>island</code> and <code>sex</code> are shown in upper triangle by boxplots but by faceted histograms in the lower portion. The factors are shown as rectangles with area proportional to count (poor-man’s mosaic plots) above the diagonal and as faceted bar plots below.</p>
<!-- fig.code: R/peng/peng-ggally.R -->
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb54" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span><span class="va">peng</span>, columns<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>        mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">species</span>, fill <span class="op">=</span> <span class="va">species</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>        lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="va">my_panel1</span><span class="op">)</span>,</span>
<span>        upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="va">my_panel1</span><span class="op">)</span>,</span>
<span>        progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- this figure now frozen because it takes too long and caching creates git problems -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-ggpairs7" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-ggpairs7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-peng-ggpairs7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-ggpairs7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.36: Customized <code><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs()</a></code> plot of penguin size variables, together with species, island and sex.
</figcaption></figure>
</div>
</div>
</div>
<p>There is certainly a lot going on in <a href="#fig-peng-ggpairs7" class="quarto-xref">Figure&nbsp;<span>3.36</span></a>, but it does show a high-level overview of all the variables (except <code>year</code>) in the penguins dataset. It is probably easiest to “read” this figure by focusing on the four blocks for the combinations of 4 continuous and 3 categorical measures. In the upper left block, visual thinning of the scatterplots, showing only the data ellipses and regression lines gives a simple view as it did in <a href="#fig-peng-spm" class="quarto-xref">Figure&nbsp;<span>3.29</span></a>.</p>
</section><section id="sec-parcoord" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="sec-parcoord">
<span class="header-section-number">3.8</span> Parallel coordinate plots</h2>
<p>As we have seen above, scatterplot matrices and generalized pairs plots extend data visualization to multivariate data, but these variables share one 2D space, so resolution decreases as the number of variable increase. You need a very large screen or sheet of paper to see more than, say 5-6 variables with any clarity.</p>
<p>Parallel coordinate plots are an attractive alternative, with which we can visualize an arbitrary number of variables to get a visual summary of a potentially high-dimensional dataset, and perhaps recognize outliers and clusters in the data in a different way. In these plots, each variable is shown on a separate, parallel axis. A multivariate observation is then plotted by connecting their respective values on each axis with lines across all the axes.</p>
<p>The geometry of parallel coordinates is interesting, because what is a point in <span class="math inline">\(n\)</span>-dimensional (Euclidean) <em>data</em> space becomes a line in the <em>projective</em> parallel coordinate space with <span class="math inline">\(n\)</span> axes, and vice-versa: lines in parallel coordinate space correspond to points in data space. Thus, a collection of points in data space map to lines that intersect in a point in projective space. What this does is to map <span class="math inline">\(n\)</span>-dimensional relations into 2D patterns we can see in a parallel coordinates plot.</p>
<div class="callout callout-style-default callout-note callout-titled" title="History Corner">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
History Corner
</div>
</div>
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p>Those who don’t know history are doomed to plagarize it —The author</p>
</blockquote>
<p>The theory of projective geometry originated with the French mathematician Maurice d’Ocagne <span class="citation" data-cites="Ocagne:1885">(<a href="95-references.html#ref-Ocagne:1885" role="doc-biblioref">1885</a>)</span> who sought a way to provide graphic calculation of mathematical functions with alignment diagrams or <em>nomograms</em> using parallel axes with different scales. A three-variable equation, for example, could be solved using three parallel axes, where known values could be marked on their scales, a line drawn between them, and an unknown read on its scale at the point where the line intersects that scale.</p>
<p>Henry Gannet (1880), in work preceding the <em>Statistical Atlas of the United States</em> for the 1890 Census <span class="citation" data-cites="Gannett:1898">(<a href="95-references.html#ref-Gannett:1898" role="doc-biblioref">Gannett, 1898</a>)</span>, is widely credited with being the first to use parallel coordinates plots to show data, in his case, to show the <a href="https://www.davidrumsey.com/luna/servlet/detail/RUMSEY~8~1~32803~1152181">rank ordering of US states</a> by 10 measures including population, occupations, wealth, manufacturing, agriculture and so on.</p>
<p>However, both d’Ocagne and Gannet were far preceded in this by Andre-Michel Guerry <span class="citation" data-cites="Guerry:1833">(<a href="95-references.html#ref-Guerry:1833" role="doc-biblioref">1833</a>)</span> who used this method to show how the rank order of various crimes changed with age of the accused. See <span class="citation" data-cites="Friendly2022">Friendly (<a href="95-references.html#ref-Friendly2022" role="doc-biblioref">2022</a>)</span>, Figure 7 for his version and for an appreciation of the remarkable contributions of this amateur statistician to the history of data visualization.</p>
<!-- **TODO**: Revise the _History_ section of the Wikipedia page for [Parallel coordinates](https://en.wikipedia.org/wiki/Parallel_coordinates). -->
<p>The use of parallel coordinates for display of multidimensional data was rediscovered by Alfred Inselberg <span class="citation" data-cites="Inselberg:1985">(<a href="95-references.html#ref-Inselberg:1985" role="doc-biblioref">1985</a>)</span> and extended by Edward Wegman <span class="citation" data-cites="Wegman:1990">(<a href="95-references.html#ref-Wegman:1990" role="doc-biblioref">1990</a>)</span>, neither of whom recognized the earlier history. Somewhat earlier, David Andrews <span class="citation" data-cites="Andrews:72">(<a href="95-references.html#ref-Andrews:72" role="doc-biblioref">1972</a>)</span> proposed mapping multivariate observations to smooth Fourrier functions composed of alternating <span class="math inline">\(\sin()\)</span> and <span class="math inline">\(\cos()\)</span> terms. And in my book, <em>SAS System for Statistical Graphics</em> <span class="citation" data-cites="Friendly:91">(<a href="95-references.html#ref-Friendly:91" role="doc-biblioref">Friendly, 1991</a>)</span>, I implemented what I called <a href="https://blogs.sas.com/content/iml/2022/11/14/profile-plots-sas.html"><em>profile plots</em></a> without knowing their earlier history as parallel coordinate plots.</p>
</div>
</div>
<p>Parallel coordinate plots present a challenge for graphic developers, in that they require a different way to think about plot construction for multiple variables, which can be quantitative, as in the original idea, or categorical factors, all to be shown along parallel axes.</p>
<p>Here, I use the <span style="color: brown;"><strong>ggpcp</strong></span> package <span class="citation" data-cites="R-ggpcp">(<a href="95-references.html#ref-R-ggpcp" role="doc-biblioref">Hofmann et al., 2022</a>)</span>, best described in <span class="citation" data-cites="VanderPlas2023">VanderPlas et al. (<a href="95-references.html#ref-VanderPlas2023" role="doc-biblioref">2023</a>)</span>, who also review the modern history.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> This takes some getting used to, because they develop <code>pcp_*()</code> extensions of the <code>ggplot2</code> grammar of graphics framework to allow:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/ggpcp/man/pcp_select.html">pcp_select()</a></code>: selections of the variables to be plotted and their horizontal order on parallel axes,</li>
<li>
<code><a href="https://rdrr.io/pkg/ggpcp/man/pcp_scale.html">pcp_scale()</a></code>: methods for scaling of the variables to each axis,</li>
<li>
<code><a href="https://rdrr.io/pkg/ggpcp/man/pcp_arrange.html">pcp_arrange()</a></code>: methods for breaking ties in factor variables to space them out.</li>
</ul>
<p>Then, it provides <code>geom_pcp_*()</code> functions to control the display of axes with appropriate aesthetics, labels for categorical factors and so forth. <a href="#fig-peng-ggpcp1" class="quarto-xref">Figure&nbsp;<span>3.37</span></a> illustrates this type of display, using sex and species in addition to the quantitative variables for the penguin data.</p>
<!-- fig.code: R/peng/peng-ggpcp.R -->
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb55" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">peng</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/pcp_select.html">pcp_select</a></span><span class="op">(</span><span class="va">bill_length</span><span class="op">:</span><span class="va">body_mass</span>, <span class="va">sex</span>, <span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/pcp_scale.html">pcp_scale</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"uniminmax"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/pcp_arrange.html">pcp_arrange</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/aes_pcp.html">aes_pcp</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/geom_pcp_axes.html">geom_pcp_axes</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/geom_pcp.html">geom_pcp</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, overplot <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/geom_pcp_labels.html">geom_pcp_labels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- CHEATING HERE because ggcpc plots take so long & caching causes problems -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-ggpcp1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-ggpcp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/fig-peng-ggpcp1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-ggpcp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.37: Parallel coordinates plot of penguin size variables, together with sex and species.
</figcaption></figure>
</div>
</div>
</div>
<p>Rearranging the order of variables and the ordering of factor levels can make a difference in what we can see in such plots. For a simple example (following <span class="citation" data-cites="VanderPlas2023">VanderPlas et al. (<a href="95-references.html#ref-VanderPlas2023" role="doc-biblioref">2023</a>)</span>), we reorder the levels of species and islands to make it clearer which species occur on each island.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb56" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">peng1</span> <span class="op">&lt;-</span> <span class="va">peng</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">species</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Chinstrap"</span>, <span class="st">"Adelie"</span>, <span class="st">"Gentoo"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>island <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">island</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dream"</span>, <span class="st">"Torgersen"</span>, <span class="st">"Biscoe"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">peng1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/pcp_select.html">pcp_select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">bill_length</span><span class="op">:</span><span class="va">body_mass</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/pcp_scale.html">pcp_scale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/pcp_arrange.html">pcp_arrange</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"from-left"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/aes_pcp.html">aes_pcp</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/geom_pcp_axes.html">geom_pcp_axes</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/geom_pcp.html">geom_pcp</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>, overplot <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/geom_pcp_boxes.html">geom_pcp_boxes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggpcp/man/geom_pcp_labels.html">geom_pcp_labels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- cHEATING HERE because ggcpc plots take so long -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/fig-peng-ggpcp2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>The order of variables in this plot emphasizes the relation between penguin species and the island where they were observed and then shows the values of the quantitative body size measurements. More generally, quantitative variables can, and probably should, be ordered to place the most highly correlated variables adjacently to minimize the degree of crossing lines from one variable to the next <span class="citation" data-cites="MartiLaguna2003">(<a href="95-references.html#ref-MartiLaguna2003" role="doc-biblioref">Martí &amp; Laguna, 2003</a>)</span>. When variables are highly <em>negatively</em> correlated (such as <code>bill_depth</code> and <code>flipper_length</code> here), crossings can be reduced simply by reversing the scale of one of the variables, e.g., by plotting <code>-bill_depth</code>. </p>
</section><section id="animated-tours" class="level2" data-number="3.9"><h2 data-number="3.9" class="anchored" data-anchor-id="animated-tours">
<span class="header-section-number">3.9</span> Animated tours</h2>
<p>In the mid 17<span class="math inline">\(^{th}\)</span> to early 19<span class="math inline">\(^{th}\)</span>-century the <strong>Grand Tour</strong> became a coming-of-age custom for young Europeans (mainly British nobility and landed gentry) of sufficient rank and means to undertake a journey to the principal sites of Europe (Paris, Geneva, Rome, Athens, …) to complete their education by learning something of the cultural legacies in history, art, and music from antiquity to the Renaissance. Thereby, they could gain a wider appreciation of history and be prepared to play a role in polite society or in their chosen endeavors.</p>
<p>Travels in high-dimensional data space might be less thrilling than a journey from London through Paris and Millan to Rome. Yet, in both cases it is useful to think of the path taken, and what might be seen along the way. But there are different kinds of tours. We might simply take a meandering tour, exploring all the way, or want to plan a tour to see the most interesting sites in travel or have a tour guided by an expert. Similarly in data space, we might travel randomly to see what we can find or be guided to find interesting features such as clusters, outliers or non-linear relations in data.</p>
<p>Following the demonstration in PRIM-9 (<a href="index.html#sec-discoveries" class="quarto-xref"><span>Section 3.1</span></a>) of exploring multidimensional data space by rotation <span class="citation" data-cites="Asimov:85">Asimov (<a href="95-references.html#ref-Asimov:85" role="doc-biblioref">1985</a>)</span> developed the idea of the <em>grand tour</em>, a computer method for viewing multivariate statistical data via orthogonal projections onto an animated sequence of low-dimensional subspaces, like a movie. In contrast to a scatterplot matrix which shows a static view of a data cloud projected onto all pairwise variable axes, a statistical tour is like the view of an eye moving smoothly in high-dimensional space, capturing what it sees from a given location onto the 2-d plane of the computer screen.</p>
<p>More generally, statistical tours are a type of dynamic projections onto orthogonal axes (called a <em>basis</em>) that embed data in a <span class="math inline">\(p\)</span>−dimensional space into a <span class="math inline">\(d\)</span>−dimensional viewing subspace. Typically, <span class="math inline">\(d=2\)</span>, and the result is displayed as scatterplots, together with vectors representing the projections of the data variables in this space. But the projected data can be rendered in 1-d as densities or histograms, or in other number of dimensions as glyphs, or even as parallel coordinate plots. The essential idea is that we can define, and animate, a <em>tour path</em> as a smooth sequence of such projections over small changes to the projection basis, which gives the orientation of the data in the viewing space.</p>
<section id="projections" class="level3" data-number="3.9.1"><h3 data-number="3.9.1" class="anchored" data-anchor-id="projections">
<span class="header-section-number">3.9.1</span> Projections</h3>
<p>The idea of a projection is fundamental to touring methods and other visualizations of high-D data, so it is useful to understand what a projection is. Quite simply, you can think of a projection as the shadow of an object or cloud of points. This is nicely illustrated by the cover image (<a href="#fig-cover-GBE" class="quarto-xref">Figure&nbsp;<span>3.38</span></a>) used for Douglas Hofstadter’s <span class="citation" data-cites="Hofstadter1979">(<a href="95-references.html#ref-Hofstadter1979" role="doc-biblioref">1979</a>)</span> <em>Gödel, Bach and Escher</em> which shows 3D solid shapes illuminated by light sources so their shadows form the letters G, B and E projected onto the planes formed by pairs of the three coordinate axes. The set of three 2D views is essentially the same that we see in a scatterplot matrix, where a 3D dataset is portrayed by the set of shadows of the points on planes formed by pairs of coordinate axes.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-cover-GBE" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-cover-GBE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/Cover-GBE.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cover-GBE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.38: The cover image from <span class="citation" data-cites="Hofstadter1979">Hofstadter (<a href="95-references.html#ref-Hofstadter1979" role="doc-biblioref">1979</a>)</span> illustrates how projections are shadows of an object cast by a light from a given direction.
</figcaption></figure>
</div>
</div>
</div>
<p>In the simplest case, a data point <span class="math inline">\(\mathbf{x} = (x_1, x_2)\)</span> in two dimensions can be represented geometrically as a vector from the origin as shown in <a href="#fig-projection" class="quarto-xref">Figure&nbsp;<span>3.39</span></a>. This point can be projected on any one-dimensional axis <span class="math inline">\(\mathbf{p}\)</span> by dropping a line perpendicular to <span class="math inline">\(\mathbf{p}\)</span>, which is the idea of a shadow. Mathematically, this is calculated as the product <span class="math inline">\(\mathbf{x}^\mathsf{T} \mathbf{p} = x_1 p_1 + x_2 p_2\)</span> and suitably normalized to give the correct length. …</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-projection" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-projection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/projection.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-projection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.39: Projection of a point <strong>x</strong> onto a direction or axis <strong>p</strong>.
</figcaption></figure>
</div>
</div>
</div>
<p>More generally, a projection of an <span class="math inline">\((n \times p)\)</span> data matrix <span class="math inline">\(\mathbf{X}\)</span> representing <span class="math inline">\(n\)</span> observations in <span class="math inline">\(p\)</span> dimensions onto a <span class="math inline">\(d\)</span>-dimensional viewing space <span class="math inline">\(\mathbf{Y}_{n \times d}\)</span> is represented by a <span class="math inline">\(p \times d\)</span> projection matrix <span class="math inline">\(\mathbf{P}\)</span> as <span class="math inline">\(\mathbf{Y} = \mathbf{X} \mathbf{P}\)</span>, where the columns of <span class="math inline">\(\mathbf{P}\)</span> are orthogonal and of unit length,i.e., <span class="math inline">\(\mathbf{P}^\mathsf{T} \mathbf{P} = \mathbf{I}_{(d \times d)}\)</span>.</p>
<p>For example, to project a data matrix <span class="math inline">\(\mathbf{X}\)</span> in three dimensions onto a 2D plane, we would multiply it by a <span class="math inline">\((3 \times 2)\)</span> orthonormal matrix <span class="math inline">\(\mathbf{P}\)</span>. The matrix <span class="math inline">\(\mathbf{P}_1\)</span> below simply selects the first two columns of <span class="math inline">\(\mathbf{X}\)</span>.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p><span class="math display">\[
\mathbf{X} =
\begin{bmatrix}
    0 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 10 \\
    0 &amp; 10 &amp; 0 \\
    0 &amp; 10 &amp; 10 \\
    10 &amp; 0 &amp; 0 \\
    10 &amp; 0 &amp; 10 \\
    10 &amp; 10 &amp; 0 \\
    10 &amp; 10 &amp; 10 \\
\end{bmatrix}_{8 \times 3}
;\;
\mathbf{P_1} =
\begin{bmatrix}
    1 &amp; 0 \\
    0 &amp; 1 \\
    0 &amp; 0 \\
\end{bmatrix}_{3 \times 2}
\;\Rightarrow\quad
\mathbf{Y} = \mathbf{X} \; \mathbf{P_1} =
\begin{bmatrix}
    0 &amp; 0 \\
    0 &amp; 0 \\
    0 &amp; 10 \\
    0 &amp; 10 \\
    10 &amp; 0 \\
    10 &amp; 0 \\
    10 &amp; 10 \\
    10 &amp; 10 \\
\end{bmatrix}_{8 \times 2}
\]</span> An oblique projection using all three dimensions is given by <span class="math inline">\(\mathbf{P_2}\)</span> below. This produces a new 2D view in <span class="math inline">\(\mathbf{Y}\)</span>: <span class="math display">\[
\mathbf{P_2} =
\begin{bmatrix}
    0.71 &amp; -0.42 \\
    0.71 &amp; 0.42 \\
    0 &amp; 0.84 \\
\end{bmatrix}_{3 \times 2}
\quad\Rightarrow\quad
\mathbf{Y} = \mathbf{X} \; \mathbf{P_2} =
\begin{bmatrix}
    0 &amp; 0 \\
    0 &amp; 8.4 \\
    7.1 &amp; 4.2 \\
    7.1 &amp; 12.6 \\
    7.1 &amp; -4.2 \\
    7.1 &amp; 4.2 \\
    14.2 &amp; 0 \\
    14.2 &amp; 8.4 \\
\end{bmatrix}
\]</span></p>
<p>The columns in <span class="math inline">\(\mathbf{Y}\)</span> are simply the linear combinations of those of <span class="math inline">\(\mathbf{X}\)</span> using the weights in each column of <span class="math inline">\(\mathbf{P_2}\)</span></p>
<p><span class="math display">\[\begin{aligned}
\mathbf{y}_1 &amp; = &amp; 0.71 \mathbf{x}_1 + 0.71 \mathbf{x}_2 + 0 \mathbf{x}_3\\
\mathbf{y}_2 &amp; = &amp; -0.42 \mathbf{x}_1 + 0.42 \mathbf{x}_2 + 0.84 \mathbf{x}_3 \\
\end{aligned}\]</span></p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">vals</span>, x2<span class="op">=</span><span class="va">vals</span>, x3<span class="op">=</span><span class="va">vals</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># project on just x1, x2 plane</span></span>
<span><span class="va">P1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Y1</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">P1</span></span>
<span></span>
<span><span class="co"># oblique projection</span></span>
<span><span class="va">P2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.71</span>, <span class="fl">0.71</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.42</span>, <span class="fl">.42</span>, <span class="fl">0.84</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Y2</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">P2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this example, the matrix <span class="math inline">\(\mathbf{X}\)</span> consists of 8 points at the vertices of a cube of size 10, as shown in <a href="#fig-proj-combined" class="quarto-xref">Figure&nbsp;<span>3.40</span></a> (a). The projections <span class="math inline">\(\mathbf{Y}_1 = \mathbf{P}_1 \mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}_2 = \mathbf{P}_2 \mathbf{X}\)</span> are shown in panels (b) and (c). To make it easier to relate the points in different views, shapes and colors are assigned so that each point has a unique combination of these attributes.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb58" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"brown"</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">colors</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">pch</span>, <span class="va">col</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x1 x2 x3 pch       col</span></span>
<span><span class="co">#&gt; 1  0  0  0  15       red</span></span>
<span><span class="co">#&gt; 2 10  0  0  16       red</span></span>
<span><span class="co">#&gt; 3  0 10  0  17      blue</span></span>
<span><span class="co">#&gt; 4 10 10  0  18      blue</span></span>
<span><span class="co">#&gt; 5  0  0 10  15 darkgreen</span></span>
<span><span class="co">#&gt; 6 10  0 10  16 darkgreen</span></span>
<span><span class="co">#&gt; 7  0 10 10  17     brown</span></span>
<span><span class="co">#&gt; 8 10 10 10  18     brown</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-proj-combined" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-proj-combined-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/proj-combined.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-proj-combined-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.40: <strong>Projection example</strong>: (a) The 8 points in <strong>X</strong> form a cube of size 10; (b) the projection by <strong>P1</strong> is the view ignoring <strong>x3</strong> (two points coincide at each vertex); (c) the projection by <strong>P2</strong> is an oblique view.
</figcaption></figure>
</div>
</div>
</div>
<p>But, if we are traveling in the projection space of <span class="math inline">\(\mathbf{Y}\)</span>, we need some signposts to tell us how the new dimensions relate to those of <span class="math inline">\(\mathbf{X}\)</span>. The answer is provided simply by plotting the rows of <span class="math inline">\(\mathbf{P}\)</span> as vectors, as shown in <a href="#fig-proj-vectors" class="quarto-xref">Figure&nbsp;<span>3.41</span></a>. In these plots, each row of <span class="math inline">\(\mathbf{P}_1\)</span> and <span class="math inline">\(\mathbf{P}_2\)</span> appears as a vector from the origin. It’s direction shows the contribution each of <span class="math inline">\(\mathbf{x}_1, \mathbf{x}_2, \mathbf{x}_3\)</span> make to the new coordinates <span class="math inline">\(\mathbf{y}_1\)</span> and <span class="math inline">\(\mathbf{y}_2\)</span>.</p>
<p>In <span class="math inline">\(\mathbf{P}_1\)</span>, the projected variable <span class="math inline">\(\mathbf{y}_1\)</span> is related only to <span class="math inline">\(\mathbf{x}_1\)</span>, while <span class="math inline">\(\mathbf{y}_2\)</span> is related only to <span class="math inline">\(\mathbf{x}_2\)</span> <span class="math inline">\(\mathbf{x}_3\)</span> makes no contribution, and appears at the origin. However in the projection given by <span class="math inline">\(\mathbf{P}_2\)</span>, <span class="math inline">\(\mathbf{x}_1\)</span> and <span class="math inline">\(\mathbf{x}_2\)</span> make the same contribution to <span class="math inline">\(\mathbf{y}_1\)</span>, while <span class="math inline">\(\mathbf{x}_3\)</span> has no contribution to that horizontal axis. The vertical axis, <span class="math inline">\(\mathbf{y}_2\)</span> here is completely aligned with <span class="math inline">\(\mathbf{x}_3\)</span>; <span class="math inline">\(\mathbf{x}_1\)</span> and <span class="math inline">\(\mathbf{x}_2\)</span> have vertical components that are half of that for <span class="math inline">\(\mathbf{x}_3\)</span> in absolute value.</p>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb59" data-code-line-numbers=""><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/matlib">matlib</a></span><span class="op">)</span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.1</span>, <span class="fl">1.1</span><span class="op">)</span></span>
<span><span class="va">axes.x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">axes.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="cn">NA</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">xlim</span>, <span class="va">ylim</span>, type <span class="op">=</span> <span class="st">"n"</span>, asp<span class="op">=</span><span class="fl">1</span>,</span>
<span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     cex.lab <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/matlib/reference/circle.html">circle</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"skyblue"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">axes.x</span>, <span class="va">axes.y</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/matlib/reference/vectors.html">vectors</a></span><span class="op">(</span><span class="va">P1</span>, labels <span class="op">=</span> <span class="va">labs</span>, cex.lab <span class="op">=</span> <span class="fl">1.8</span>, lwd <span class="op">=</span> <span class="fl">3</span>, pos.lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">xlim</span>, <span class="va">ylim</span>, type <span class="op">=</span> <span class="st">"n"</span>, asp<span class="op">=</span><span class="fl">1</span>,</span>
<span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     cex.lab <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/matlib/reference/circle.html">circle</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"skyblue"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">axes.x</span>, <span class="va">axes.y</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/matlib/reference/vectors.html">vectors</a></span><span class="op">(</span><span class="va">P2</span>, labels <span class="op">=</span> <span class="va">labs</span>, cex.lab <span class="op">=</span> <span class="fl">1.8</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-layout-align="center" data-layout-ncol="2">

</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-proj-vectors" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-proj-vectors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/proj-vectors.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-proj-vectors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.41: <strong>Variable vectors</strong>: Data variables viewed as vectors in the space of their projections. The angles of the <strong>x</strong> vectors with respect to the <strong>y</strong> coordinate axes show their relative contributions to each. The lengths of the <strong>x</strong> vectors show the relative degree to which they are represented in the space of <strong>y</strong>s. Left: the <strong>P1</strong> projection; right: the <strong>P2</strong> projection.
</figcaption></figure>
</div>
</div>
</div>
<section id="vector-lengths" class="level4" data-number="3.9.1.1"><h4 data-number="3.9.1.1" class="anchored" data-anchor-id="vector-lengths">
<span class="header-section-number">3.9.1.1</span> Vector lengths</h4>
<p>In <a href="#fig-proj-vectors" class="quarto-xref">Figure&nbsp;<span>3.41</span></a>, the <strong>lengths</strong> of the <span class="math inline">\(\mathbf{x}\)</span> vectors reflect the relative degree to which each variable is represented in the space of the projection, and this is important for interpretation. For the <span class="math inline">\(\mathbf{P}_1\)</span> projection, <span class="math inline">\(\mathbf{x}_3\)</span> is of length 0, while <span class="math inline">\(\mathbf{x}_1\)</span> and <span class="math inline">\(\mathbf{x}_2\)</span> fill the unit circle. In the projection given by <span class="math inline">\(\mathbf{P}_2\)</span>, all three <span class="math inline">\(\mathbf{x}\)</span> are approximately the same length.</p>
<p>In algebra, the length of a vector <span class="math inline">\(\mathbf{x}\)</span> is <span class="math inline">\(||\mathbf{x}|| = (\mathbf{x}^\mathsf{T} \mathbf{x})^{1/2} = \sqrt{\Sigma x_i^2}\)</span>, the Euclidean distance of the tip of the vector from the origin. In R, we calculate the lengths of row vectors in a projection matrix by transposing and using <code><a href="http://friendly.github.io/matlib/reference/len.html">matlib::len()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb60" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">P1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">matlib</span><span class="fu">::</span><span class="fu"><a href="http://friendly.github.io/matlib/reference/len.html">len</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 1 0</span></span>
<span><span class="va">P2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">matlib</span><span class="fu">::</span><span class="fu"><a href="http://friendly.github.io/matlib/reference/len.html">len</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.825 0.825 0.840</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="joint-views" class="level4" data-number="3.9.1.2"><h4 data-number="3.9.1.2" class="anchored" data-anchor-id="joint-views">
<span class="header-section-number">3.9.1.2</span> Joint-views</h4>
<p>To interpret such projections, we want to see <strong>both</strong> the projected data and the signposts that tell us where we are in relation to the original variables. To do this, we can overlay the variable vectors represented by the rows of the projection matrix <span class="math inline">\(\mathbf{P}\)</span> onto plots like <a href="#fig-proj-combined" class="quarto-xref">Figure&nbsp;<span>3.40</span></a> (b) and <a href="#fig-proj-combined" class="quarto-xref">Figure&nbsp;<span>3.40</span></a> (c) to see how the axes in a projection relate to those in the data. To place these together on the same plot, we can either center the columns of <span class="math inline">\(\mathbf{Y}\)</span> at their means or shift the the columns of <span class="math inline">\(\mathbf{P}\)</span> to <code>colMeans(Y)</code>. It is only the directions of the vectors that matters, so we are free to scale their lengths by any convenient factor.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb61" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Y2s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">Y2</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>       <span class="co"># center Y2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Y2s</span>, cex <span class="op">=</span> <span class="fl">3</span>, </span>
<span>     asp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     pch <span class="op">=</span> <span class="va">pch</span>, col <span class="op">=</span> <span class="va">col</span>,</span>
<span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, cex.lab <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span><span class="va">vecs</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">r</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">P2</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/matlib/reference/vectors.html">vectors</a></span><span class="op">(</span><span class="va">vecs</span>, labels <span class="op">=</span> <span class="va">labs</span>, cex.lab <span class="op">=</span> <span class="fl">1.8</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/matlib/reference/vectors.html">vectors</a></span><span class="op">(</span><span class="op">-</span><span class="va">vecs</span>, labels <span class="op">=</span> <span class="cn">NULL</span>, lty <span class="op">=</span> <span class="fl">1</span>, angle <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The plot in <a href="#fig-proj-P2-vec" class="quarto-xref">Figure&nbsp;<span>3.42</span></a> illustrates this, centering <span class="math inline">\(\mathbf{Y}\)</span>, and multiplying the vectors in <span class="math inline">\(\mathbf{P}\)</span> by 7. To check your understanding, try to see if you can relate what is shown in this plot to the 3D plot in <a href="#fig-proj-combined" class="quarto-xref">Figure&nbsp;<span>3.40</span></a> (a).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-proj-P2-vec" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-proj-P2-vec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/proj-P2-vec.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-proj-P2-vec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.42: The <strong>P2</strong> projection of the data showing vectors for the original variables in the space of <strong>Y</strong>.
</figcaption></figure>
</div>
</div>
</div>
<p>The idea of viewing low-dimensional projections of data together with vectors representing the contributions of the original variables to the dimensions shown in a display is also the basis of <strong>biplot</strong> techniques (<a href="04-pca-biplot.html#sec-biplot" class="quarto-xref"><span>Section 4.3</span></a>) we will use in relation to principal components analysis.</p>
</section></section><section id="touring-methods" class="level3" data-number="3.9.2"><h3 data-number="3.9.2" class="anchored" data-anchor-id="touring-methods">
<span class="header-section-number">3.9.2</span> Touring methods</h3>
<p>The trick of statistical touring methods is to generate a smooth sequence of interpolated projections <span class="math inline">\(\mathbf{P}_{(t)}\)</span> indexed by time <span class="math inline">\(t\)</span>, <span class="math inline">\(\mathbf{P}_{(1)}, \mathbf{P}_{(2)}, \mathbf{P}_{(3)}, \dots, \mathbf{P}_{(T)}\)</span>. This gives a path of views <span class="math inline">\(\mathbf{Y}_{(t)} = \mathbf{X} \mathbf{P}_{(t)}\)</span>, that can be animated in successive frames, as shown schematically in <a href="#fig-peng-tourr-diagram" class="quarto-xref">Figure&nbsp;<span>3.43</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-tourr-diagram" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-tourr-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/peng-tourr-diagram.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-tourr-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.43: <strong>Interpolations</strong>: Illustration of a grand tour of interpolations of projection planes showing 2D scatterplots of the Penguin dataset. The seqeunce of views moves smoothly from an initial frame <strong>P(1)</strong> to a final frame <strong>P(T)</strong> where the penguin species are widely separated.
</figcaption></figure>
</div>
</div>
</div>
<p>Asimov’s <span class="citation" data-cites="Asimov:85">(<a href="95-references.html#ref-Asimov:85" role="doc-biblioref">1985</a>)</span> original idea of the grand tour was that of a random path, picking orthogonal projections <span class="math inline">\(\mathbf{P}_{(i)}\)</span> at random. Given enough time, the grand tour gives a space-filling path and would eventually show every possible projection of the data. But it does so smoothly, by interpolating from one projection to the next. In the travel analogy, the path by road from London to Paris might go smoothly through Kent to Dover, thence via Amiens and Beauvais before reaching Paris. By air, the tour would follow a smoother <em>geodesic</em> path, and this is what the grand tour does. The sense in watching an animation of a statistical grand tour is that of continuous motion. The grand tour algorithm is described in detail by <span class="citation" data-cites="Buja-etal-2005">Buja et al. (<a href="95-references.html#ref-Buja-etal-2005" role="doc-biblioref">2005</a>)</span> and <span class="citation" data-cites="Cook-etal-2008">Cook et al. (<a href="95-references.html#ref-Cook-etal-2008" role="doc-biblioref">2008</a>)</span>.</p>
<!-- Projection pursuit @Cook-etal-1995 -> guided tour -->
<section id="guided-tours" class="level4" data-number="3.9.2.1"><h4 data-number="3.9.2.1" class="anchored" data-anchor-id="guided-tours">
<span class="header-section-number">3.9.2.1</span> Guided tours</h4>
<p>The next big idea was that rather than traveling randomly in projection space one could take a <em>guided tour</em>, following a path that leads to “interesting projections”, such as those that reveal clusters, gaps in data space or outliers. This idea, called <em>projection pursuit</em> <span class="citation" data-cites="Cook-etal-1995">(<a href="95-references.html#ref-Cook-etal-1995" role="doc-biblioref">Cook et al., 1995</a>)</span>, works by defining a measure of interestingness of a data projection. In a guided tour, the next projection is chosen to increase that index, so over time the projection moves toward one that is maximizes that index.</p>
<p>In the time since <span class="citation" data-cites="Asimov:85">Asimov (<a href="95-references.html#ref-Asimov:85" role="doc-biblioref">1985</a>)</span>, there have been many implementations of touring visualization methods. XGobi <span class="citation" data-cites="Swayne-etal-1998">(<a href="95-references.html#ref-Swayne-etal-1998" role="doc-biblioref">Swayne et al., 1998</a>)</span> for X-Windows displays on Linux systems provided a test-bed for dynamic, interactive graphic methods; it’s successor, GGobi <span class="citation" data-cites="Swayne-etal-2003 CookSwayne:2007">(<a href="95-references.html#ref-CookSwayne:2007" role="doc-biblioref">Cook &amp; Swayne, 2007</a>; <a href="95-references.html#ref-Swayne-etal-2003" role="doc-biblioref">Swayne et al., 2003</a>)</span> extended the range of touring methods to include a wider variety of projection pursuit indices.</p>
</section><section id="tourr-package" class="level4" data-number="3.9.2.2"><h4 data-number="3.9.2.2" class="anchored" data-anchor-id="tourr-package">
<span class="header-section-number">3.9.2.2</span> <code>tourr</code> package</h4>
<p>The current state of art is best captured in the <span style="color: brown;"><strong>tourr</strong></span> package for R <span class="citation" data-cites="Wickham-etal-2011 R-tourr">(<a href="95-references.html#ref-Wickham-etal-2011" role="doc-biblioref">Wickham et al., 2011</a>; <a href="95-references.html#ref-R-tourr" role="doc-biblioref">Wickham &amp; Cook, 2024</a>)</span>. It defines a tour to consist of three components:</p>
<ul>
<li>
<strong>data</strong>: An <span class="math inline">\((n \times p)\)</span> numerical data matrix to be viewed.</li>
<li>
<strong>path</strong>: A tour path function that produces a smoothed sequence of projection matrices <span class="math inline">\(\mathbf{P}_{(p \times d)}\)</span> in <span class="math inline">\(d\)</span>. dimensions, for example <code>grand_tour(d = 2)</code> or <code>guided_tour(index = holes)</code>.</li>
<li>
<strong>display</strong>: A function that renders the projected data, for example <code><a href="https://rdrr.io/pkg/tourr/man/display_xy.html">display_xy()</a></code> for a scatterplot, <code><a href="https://rdrr.io/pkg/tourr/man/display_depth.html">display_depth()</a></code> for a 3D plot with simulated depth, or <code><a href="https://rdrr.io/pkg/tourr/man/display_pcp.html">display_pcp()</a></code> for a parallel coordinates plots</li>
</ul>
<p>This very nicely separates the aspects of a tour, and allows one to think of and define new tour path methods and display methods. The package defines two general tour functions: <code><a href="https://rdrr.io/pkg/tourr/man/animate.html">animate()</a></code> produces a real-time animation on a display device and <code><a href="https://rdrr.io/pkg/tourr/man/render.html">render()</a></code> saves image frames to disk, such as a <code>.gif</code> file.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb62" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/tourr/man/animate.html">animate</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">tour_path</span>, <span class="va">display_method</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tourr/man/render.html">render</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">tour_path</span>, <span class="va">display_method</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <span style="color: brown;"><strong>tourr</strong></span> package provides a wide range of tour path methods and display methods:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb63" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># tour path methods</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"_tour$"</span>, <span class="fu"><a href="https://rdrr.io/r/utils/ls_str.html">lsf.str</a></span><span class="op">(</span><span class="st">"package:tourr"</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "dependence_tour"     "frozen_guided_tour" </span></span>
<span><span class="co">#&gt;  [3] "frozen_tour"         "grand_tour"         </span></span>
<span><span class="co">#&gt;  [5] "guided_anomaly_tour" "guided_section_tour"</span></span>
<span><span class="co">#&gt;  [7] "guided_tour"         "little_tour"        </span></span>
<span><span class="co">#&gt;  [9] "local_tour"          "new_tour"           </span></span>
<span><span class="co">#&gt; [11] "planned_tour"        "planned2_tour"      </span></span>
<span><span class="co">#&gt; [13] "radial_tour"</span></span>
<span></span>
<span><span class="co"># display methods</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"display_"</span>, <span class="fu"><a href="https://rdrr.io/r/utils/ls_str.html">lsf.str</a></span><span class="op">(</span><span class="st">"package:tourr"</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "display_andrews"   "display_density2d" "display_depth"    </span></span>
<span><span class="co">#&gt;  [4] "display_dist"      "display_faces"     "display_groupxy"  </span></span>
<span><span class="co">#&gt;  [7] "display_idx"       "display_image"     "display_pca"      </span></span>
<span><span class="co">#&gt; [10] "display_pcp"       "display_sage"      "display_scatmat"  </span></span>
<span><span class="co">#&gt; [13] "display_slice"     "display_stars"     "display_stereo"   </span></span>
<span><span class="co">#&gt; [16] "display_trails"    "display_xy"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tour path methods take a variety of optional arguments to specify the detailed behavior of the method. For example, most allow you to specify the number of dimension (<code>d =</code>) of the projections. The <code><a href="https://rdrr.io/pkg/tourr/man/guided_tour.html">guided_tour()</a></code> is of particular interest here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb64" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html">args</a></span><span class="op">(</span><span class="va">guided_tour</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (index_f, d = 2, alpha = 0.5, cooling = 0.99, max.tries = 25, </span></span>
<span><span class="co">#&gt;     max.i = Inf, search_f = search_geodesic, n_sample = 100, </span></span>
<span><span class="co">#&gt;     ...) </span></span>
<span><span class="co">#&gt; NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this, <code>index_f</code> specifies a function that the method tries to optimize on its path and package defines four indices:</p>
<ul>
<li>Holes (<code><a href="https://rdrr.io/pkg/tourr/man/holes.html">holes()</a></code>): This is sensitive to projections with separated clusters of points, with few points near the origin</li>
<li>Central mass (<code><a href="https://rdrr.io/pkg/tourr/man/cmass.html">cmass()</a></code>): Sensitive to projections with lots of points in the center, but perhaps with some outliers</li>
<li>Linear discriminant analysis (<code><a href="https://rdrr.io/pkg/tourr/man/lda_pp.html">lda_pp()</a></code>): For data with a grouping factor, optimizes a measure of separation of the group means as in MANOVA or linear discriminant analysis.</li>
<li>PDA analysis (<code><a href="https://rdrr.io/pkg/tourr/man/pda_pp.html">pda_pp()</a></code>): A penalized version of <code><a href="https://rdrr.io/pkg/tourr/man/lda_pp.html">lda_pp()</a></code> for cases of large <span class="math inline">\(p\)</span> relative to sample size <span class="math inline">\(n\)</span> <span class="citation" data-cites="LeeCook-2009">(<a href="95-references.html#ref-LeeCook-2009" role="doc-biblioref">E.-K. Lee &amp; Cook, 2009</a>)</span>.</li>
</ul>
<p>In addition, there is now a <code><a href="https://rdrr.io/pkg/tourr/man/guided_anomaly_tour.html">guided_anomaly_tour()</a></code> that looks for the best projection of observations that are outside the data ellipsoid, finding a view showing observations with large Mahalanobis distances from the centroid.</p>
</section><section id="penguin-tours" class="level4" data-number="3.9.2.3"><h4 data-number="3.9.2.3" class="anchored" data-anchor-id="penguin-tours">
<span class="header-section-number">3.9.2.3</span> Penguin tours</h4>
<p>Penguins are a traveling species. They make yearly travels inland to breeding sites in early spring, repeating the patterns of their ancestors. Near the beginning of summer, adult penguins and their chicks return to the sea and spend the rest of the summer feeding there <span class="citation" data-cites="Black-etal-2018">(<a href="95-references.html#ref-Black-etal-2018" role="doc-biblioref">Black et al., 2018</a>)</span>. If they were also data scientists, they might wonder about the relations among among their cousins of different species and take a tour of their measurements…</p>
<!-- Cite: Black et al Time-lapse imagery of Ade´lie penguins, https://doi.org/10.1371/journal.pone.0193532 -->
<p>For example, using the Penguins dataset, the following calls produce grand tours in 2, 3, and 4 dimensions. The 2D tour is displayed as a scatterplot, the 3D tour using simulated depth as shown by variation in point size and transparency, and the 4D tour is shown using a parallel coordinate plot.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb65" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">peng</span>, package <span class="op">=</span> <span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="va">peng_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">peng</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">peng_scaled</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BL"</span>, <span class="st">"BD"</span>, <span class="st">"FL"</span>, <span class="st">"BM"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tourr/man/animate.html">animate</a></span><span class="op">(</span><span class="va">peng_scaled</span>, <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/grand_tour.html">grand_tour</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/display_xy.html">display_xy</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tourr/man/animate.html">animate</a></span><span class="op">(</span><span class="va">peng_scaled</span>, <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/grand_tour.html">grand_tour</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/display_depth.html">display_depth</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tourr/man/animate.html">animate</a></span><span class="op">(</span><span class="va">peng_scaled</span>, <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/grand_tour.html">grand_tour</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/display_pcp.html">display_pcp</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-peng-tour-demo" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-tour-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-peng-tour-demo" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-peng-tour-demo-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-peng-tour-demo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-tour-demo1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:33.0%" data-ref-parent="fig-peng-tour-demo">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-peng-tour-demo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) 2D, scatterplot
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-peng-tour-demo" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-peng-tour-demo-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-peng-tour-demo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-tour-demo2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:33.0%" data-ref-parent="fig-peng-tour-demo">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-peng-tour-demo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) 3D, simulated depth
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-peng-tour-demo" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-peng-tour-demo-3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-peng-tour-demo-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-tour-demo3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:33.0%" data-ref-parent="fig-peng-tour-demo">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-peng-tour-demo-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) 4D, parallel coordinates plot
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-tour-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.44: Grand tours of the penguin dataset in 2, 3, and 4 dimensions using different <code>display_*()</code> methods.
</figcaption></figure>
</div>
<p>To illustrate, I’ll start with a grand tour designed to explore this 4D space of penguins. I’ll abbreviate the variables to two characters, “BL” = <code>bill_length</code>, “BD” = <code>bill_depth</code>, “FL” = <code>flipper_length</code>, and “BM” = <code>body_mass</code> and identify the penguin species using point shape (<code>pch</code>) and color (<code>col</code>).</p>
<p>As you watch this pay attention to the separation of the species and any other interesting features. What do you see?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb66" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">peng</span>, package <span class="op">=</span> <span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="va">peng_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">peng</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">peng_scaled</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BL"</span>, <span class="st">"BD"</span>, <span class="st">"FL"</span>, <span class="st">"BM"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="va">peng</span><span class="op">$</span><span class="va">species</span><span class="op">]</span> </span>
<span><span class="va">cex</span> <span class="op">=</span> <span class="fl">1.2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tourr/man/animate.html">animate</a></span><span class="op">(</span><span class="va">peng_scaled</span>,</span>
<span>        tour_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/grand_tour.html">grand_tour</a></span><span class="op">(</span>d<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/display_xy.html">display_xy</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">peng</span><span class="op">$</span><span class="va">species</span>,</span>
<span>                   palette <span class="op">=</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span>,</span>
<span>                   pch <span class="op">=</span> <span class="va">pch</span>, cex <span class="op">=</span> <span class="va">cex</span>,</span>
<span>                   axis.col <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                   axis.text.col <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                   axis.lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-tour-grand" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-tour-grand-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-tourr-grand.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-tour-grand-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.45: Animation of a grand tour of the Penguin data.
</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-peng-tour-grand-frames" class="quarto-xref">Figure&nbsp;<span>3.46</span></a> shows three frames from this movie. The first (a) is the initial frame that shows the projection in the plane of bill depth and bill length. The variable vectors indicate that bill length differentiates Adelie penguins from the others. In frame (b), the three species are widely separated, with bill depth distinguishing Gentoo from the others. In frame (c) the three species are largely mixed, but two points stand out as outliers, with exceptionally long bills compared to the rest.</p>
<div id="fig-peng-tour-grand-frames" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-tour-grand-frames-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-peng-tour-grand-frames" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-peng-tour-grand-frames-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-peng-tour-grand-frames-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-grand-tour1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%" data-ref-parent="fig-peng-tour-grand-frames">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-peng-tour-grand-frames-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Initial frame
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-peng-tour-grand-frames" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-peng-tour-grand-frames-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-peng-tour-grand-frames-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-grand-tour2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%" data-ref-parent="fig-peng-tour-grand-frames">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-peng-tour-grand-frames-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Clusters
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-peng-tour-grand-frames" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-peng-tour-grand-frames-3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-peng-tour-grand-frames-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-grand-tour3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%" data-ref-parent="fig-peng-tour-grand-frames">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-peng-tour-grand-frames-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Outliers
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-tour-grand-frames-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.46: Three frames from the grand tour of the Penguin data. (a) The initial frame is the projection showing only BD and BL, where bill length conveniently separates Adelie from the other two species. (b) A frame that shows the three species more widely separated. (c) A frame that shows two outliers with very large bills.
</figcaption></figure>
</div>
<!-- ::: {#fig-peng-tour-grand-frames layout-ncol=3} -->
<!-- ![Initial frame](images/tours/peng-grand-tour1.png){#fig-peng-grand-tour1 width=140} -->
<!-- ![Clusters](images/tours/peng-grand-tour2.png){#fig-peng-grand-tour2 width=140} -->
<!-- ![Outliers](images/tours/peng-grand-tour3.png){#fig-peng-grand-tour3 width=140} -->
<!-- Three frames from the grand tour of the Penguin data. (a) The initial frame is the projection showing only -->
<!-- BD and BL, where bill length conveniently separates Adelie from the other two species. -->
<!-- (b) A frame that shows the three species more widely separated. (c) A frame that shows two outliers. -->
<!-- ::: -->
<p>Let’s take the penguins on a guided tour, trying to find views that show the greatest separations among the penguin species; that is, a guided tour, optimizing the <code><a href="https://rdrr.io/pkg/tourr/man/lda_pp.html">lda_pp()</a></code> index.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb67" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tourr/man/animate.html">animate</a></span><span class="op">(</span><span class="va">peng_scaled</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/guided_tour.html">guided_tour</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tourr/man/lda_pp.html">lda_pp</a></span><span class="op">(</span><span class="va">peng</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/display_xy.html">display_xy</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">peng</span><span class="op">$</span><span class="va">species</span>,</span>
<span>                   palette <span class="op">=</span> <span class="fu">peng.colors</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span>,</span>
<span>                   pch <span class="op">=</span> <span class="va">pch</span>,</span>
<span>                   cex <span class="op">=</span> <span class="va">cex</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-tour-lda" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-tour-lda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-tourr-lda.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-tour-lda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.47: Animation of a guided tour of the Penguin data, using a tour criterion designed to find an optimal separation among the penguin species. The animation shows three loops of the sequence of projections and stops when the LDA criterion cannot be improved.
</figcaption></figure>
</div>
</div>
</div>
<p><strong>TODO</strong>: I’m trying to balance what will/can be shown in the HTML version vs.&nbsp;the printed PDF. Needs text here specifically for the PDF version.</p>
<div id="fig-peng-tour-guided" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-tour-guided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-peng-tour-guided" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-peng-tour-guided-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-peng-tour-guided-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-tour-lda-final.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%" data-ref-parent="fig-peng-tour-guided">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-peng-tour-guided-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Optimizing <code><a href="https://rdrr.io/pkg/tourr/man/lda_pp.html">lda_pp()</a></code>
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-peng-tour-guided" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-peng-tour-guided-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-peng-tour-guided-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tours/peng-tour-anomalies-final.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%" data-ref-parent="fig-peng-tour-guided">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-peng-tour-guided-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Optimizing <code><a href="https://rdrr.io/pkg/tourr/man/anomaly_index.html">anomaly_index()</a></code>
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-tour-guided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.48: <strong>Guided tours</strong>: These figures show the final frame in the animations of guided tours designed to find the projection that optimize an index. (a) The <code><a href="https://rdrr.io/pkg/tourr/man/lda_pp.html">lda_pp()</a></code> criterion optimizes the separation of the means for species relative to within-group variation. (b) The <code>anomalies_index()</code> optimizes the average Mahalanobis distance of points from the centroid
</figcaption></figure>
</div>
<p>These examples are intended to highlight what is possible with dynamic graphics for exploring high-dimensional data visually. <span class="citation" data-cites="CookLaa-mulgar">Cook &amp; Laa (<a href="95-references.html#ref-CookLaa-mulgar" role="doc-biblioref">2024</a>)</span> extend the discussion of these methods from <span class="citation" data-cites="CookSwayne:2007">Cook &amp; Swayne (<a href="95-references.html#ref-CookSwayne:2007" role="doc-biblioref">2007</a>)</span> (which used Ggobi) to the <span style="color: brown;"><strong>tourr</strong></span> package. They illustrate dimension reduction, various cluster analysis methods, trees and random forests and some machine-learning techniques.</p>
<!-- **TODO**: Clean up these package references. I'm linking to the pkgdown sites, b/c I don't have them installed and can't easily get a `citation()`.  -->
<p>Ideally, we should be able interact with a tour,</p>
<ul>
<li>pausing when we see something interesting and saving the view for later analysis;</li>
<li>selecting or highlighting unusual points,</li>
<li>changing tour methods or variables displayed on the fly, and so forth.</li>
</ul>
<p>Some packages that provide these capabilities are: <a href="https://casperhart.github.io/detourr/index.html"><strong>detourr</strong></a> <span class="citation" data-cites="R-detourr">(<a href="95-references.html#ref-R-detourr" role="doc-biblioref">Hart &amp; Wang, 2022</a>)</span> <a href="https://sa-lee.github.io/liminal/"><strong>liminal</strong></a> <span class="citation" data-cites="R-liminal">(<a href="95-references.html#ref-R-liminal" role="doc-biblioref">S. Lee, 2021</a>)</span> and <a href="https://logarithmic.net/langevitour/index.html"><strong>langevitour</strong></a> <span class="citation" data-cites="R-langevitour Harrison2023">(<a href="95-references.html#ref-Harrison2023" role="doc-biblioref">Harrison, 2023</a>, <a href="95-references.html#ref-R-langevitour" role="doc-biblioref">2024</a>)</span> The <span style="color: brown;"><strong>loon</strong></span> package <span class="citation" data-cites="R-loon">(<a href="95-references.html#ref-R-loon" role="doc-biblioref">Waddell &amp; Oldford, 2023</a>)</span> is a general toolkit that enables highly interactive data visualization. It provides a <strong>loon.tour</strong> package <span class="citation" data-cites="R-loon-tour">(<a href="95-references.html#ref-R-loon-tour" role="doc-biblioref">Xu &amp; Oldford, 2021</a>)</span> for using touring methods within the <code>loon</code> environment.</p>
</section></section></section><section id="sec-network" class="level2" data-number="3.10"><h2 data-number="3.10" class="anchored" data-anchor-id="sec-network">
<span class="header-section-number">3.10</span> Network diagrams</h2>
<p>A major theme throughout this chapter has been to understand how to extend data visualization from simple bivariate scatterplots to increasingly more complex situations with larger datasets. With a moderate number of variables, techniques such as smoothing, summarizing with data ellipses and fitted curves, and visual thinning can be used to tame “big <span class="math inline">\(N\)</span>” datasets with thousands of cases.</p>
<p>However “big <span class="math inline">\(p\)</span>” datasets, with more than a moderate number (<span class="math inline">\(p\)</span>) of variables still remain a challenge. It is hard to see how the more advanced methods (corrgrams, parallel coordinate) described earlier could cope with <span class="math inline">\(p = 20, 50, 100, 500, \dots\)</span> variables. At some point, each of these begins to break down for the purpose of visualizing associations among many variables. We are forced to thin the information presented in graphs more and more as the number of variables increases.</p>
<p>It turns out that there is a way to increase the number of variables displayed dramatically, if we are mainly interested in the pairwise correlations for reasonably normally distributed data. A graphical <strong>network diagram</strong> portrays variables by <em>nodes</em> (vertices), connected by (weighted) <em>edges</em> whose properties reflect the strength of connections between pairs, such as a correlation. Such diagrams can reveal properties not readily seen by other means.</p>
<p>As an example consider <a href="#fig-big5-qgraph-rodrigues" class="quarto-xref">Figure&nbsp;<span>3.49</span></a>, which portrays the correlations among 25 self-report items reflecting 5 factors (the “Big Five”) considered in personality psychology to represent the dominant aspects of all of personality. These factors are easily remembered by the acronum <strong>OCEAN</strong>: <strong>O</strong>penness, <strong>C</strong>onscientiousness, <strong>E</strong>xtraversion, <strong>A</strong>greeableness and <strong>N</strong>euroticism. The dataset, <code><a href="https://rdrr.io/pkg/psych/man/bfi.html">psych::bfi</a></code>, contains data from an online sample of <span class="math inline">\(n=2800\)</span> with 5 items for each scale.</p>
<p>In this figure (taken from <a href="https://bit.ly/3A6kvq5">Rodrigues (2021)</a>), the item nodes are labeled according to the OCEAN factor they are assumed to measure. For 25 items, there are <span class="math inline">\(25 \times 24 / 2 = 300\)</span> correlations, way too much to see. A clearer picture arises when we reduce the number of edges shown according to some criterion. Here, edges are drawn <em>only</em> between nodes where the correlation is considered important by a method (“glasso” = graphical LASSO) designed to make the graph optimally sparse.</p>
<!-- Actually, the psych::bfi data is:
25 personality self report items taken from the International Personality Item Pool (ipip.ori.org) were included as part of the Synthetic Aperture Personality Assessment (SAPA) web based personality assessment project. The data from 2800 subjects are included here as a demonstration set for scale construction, factor analysis, and Item Response Theory analysis. Three additional demographic variables (sex, education, and age) are also included.
-->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-big5-qgraph-rodrigues" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-big5-qgraph-rodrigues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/big5-qgraph-rodrigues.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-big5-qgraph-rodrigues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.49: Network diagram of the correlations among 25 items from a Big-Five personality scale, 5 items for each scale. The magnitude of a correlation is shown by the thickness and transparency of the edge between two item nodes. The sign of a correlation is shown by edge color and style: solid blue for positive and dashed red for negative. <em>Source</em>: <a href="https://bit.ly/3A6kvq5">Rodrigues (2021)</a>
</figcaption></figure>
</div>
</div>
</div>
<p>The edges shown in <a href="#fig-big5-qgraph-rodrigues" class="quarto-xref">Figure&nbsp;<span>3.49</span></a> reflect the Pearson correlation between a given pair of items by the visual attributes of color and line style: magnitude is shown by both the thickness and transparency of the edge; the sign of the correlation is shown by color and line type: solid <span style="color: blue;">blue</span> for positive correlations and dashed <span style="color: red;">red</span> for negative ones.</p>
<p>According to some theories, the five personality factors should be largely non-overlapping, so there should not be many edges connecting items of one factor with those of another. Yet, there are quite a few cross-factor connections in <a href="#fig-big5-qgraph-rodrigues" class="quarto-xref">Figure&nbsp;<span>3.49</span></a>, so perhaps the theory is wrong, or, more likely, the 25 items are not good representatives of these underlying dimensions. The network diagram shown here is a visual tool for thought and refinement. See <span class="citation" data-cites="Costantini2015">Costantini et al. (<a href="95-references.html#ref-Costantini2015" role="doc-biblioref">2015</a>)</span> for a tutorial on network analysis of personality data in R.</p>
<p>Network diagrams stem from mathematical graph theory <span class="citation" data-cites="BondyMurty2008 West2001">(<a href="95-references.html#ref-BondyMurty2008" role="doc-biblioref">Bondy &amp; Murty, 2008</a>; <a href="95-references.html#ref-West2001" role="doc-biblioref">West, 2001</a>)</span> of the abstract properties of nodes and edges used to represent pairwise relationships. These can be used to model many types of relations and processes in physical, biological, social and other sciences, where such properties as connectedness, centrality, cliques of connected nodes and so forth provide a vocabulary used to understand and explain complex systems.</p>
<p>For one example, <span class="citation" data-cites="Grandjean2016">Grandjean (<a href="95-references.html#ref-Grandjean2016" role="doc-biblioref">2016</a>)</span> used network analysis to study the connections among 2500 Twitter users (nodes) who identified as belonging to a “digital humanities” community from the relations (edges) of who follows whom. Grandjean also used these methods to study the relationships among <a href="http://www.martingrandjean.ch/network-visualization-shakespeare/">characters in Shakespeare’s tragedies</a> in terms of the characters (nodes) and edges representing how often they appeared in the same scene.</p>
<p>The wide applicability of these ideas has led to what is now called <em>network science</em> <span class="citation" data-cites="Barabasi2016network">(<a href="95-references.html#ref-Barabasi2016network" role="doc-biblioref">Barab’asi, 2016</a>)</span> encompassing computer networks, biological networks, cognitive and semantic networks, and social networks. Recent developments in psychology led to a framework of <em>network psychometrics</em> <span class="citation" data-cites="IsvoranuEpskamp2022">(<a href="95-references.html#ref-IsvoranuEpskamp2022" role="doc-biblioref">Isvoranu et al., 2022</a>)</span>, where, for example, symptoms of psychopathology (phobias, anxiety, substance abuse) can be conceptualized as an interconnected network of clusters and studied for possible causal relations <span class="citation" data-cites="Robinaugh2019">(<a href="95-references.html#ref-Robinaugh2019" role="doc-biblioref">Robinaugh et al., 2019</a>)</span>.</p>
<p>Because a network diagram can potentially reflect hundreds of variables, various <a href="https://en.wikipedia.org/wiki/Graph_drawing">graph layout algorithms</a> have been developed to automatically position the nodes so as to generate aesthetically pleasing network visualizations that emphasize important structural properties, like clusters and central nodes, while minimizing visual clutter (many crossing lines) to promote understandability and usability.</p>
<p>There are quite a few R packages for constructing network diagrams, both static and dynamic / interactive, and these differ considerably in how the information required for a graph is structured as R objects, and the flexibility to produce attractive graphs. Among these, <span style="color: brown;"><strong>igraph</strong></span> <span class="citation" data-cites="R-igraph">(<a href="95-references.html#ref-R-igraph" role="doc-biblioref">Csárdi et al., 2024</a>)</span> structures the data as a dataset of vertices and edges with properties</p>
<p>-&gt; packages: qgraph, …</p>
<section id="crime-data" class="level3" data-number="3.10.1"><h3 data-number="3.10.1" class="anchored" data-anchor-id="crime-data">
<span class="header-section-number">3.10.1</span> Crime data</h3>
<p>For the present purposes, let’s see what network diagrams can tell us about the crime data analyzed earlier. Here, I first reorder the variables as in <a href="#fig-crime-corrplot-AOE" class="quarto-xref">Figure&nbsp;<span>3.33</span></a>. In the call to <code><a href="https://rdrr.io/pkg/qgraph/man/qgraph.html">qgraph()</a></code>, the argument <code>minimum = "sig"</code> says to show only the edges for significant correlations (at <span class="math inline">\(\alpha = 0.01\)</span> here). In <a href="#fig-crime-cor" class="quarto-xref">Figure&nbsp;<span>3.50</span></a>, the variable nodes are positioned around a circle (<code>layout = "circle"</code>), which is the default.</p>
<!-- fig.code: R/crime/crime-network.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">qgraph</span><span class="op">)</span></span>
<span><span class="va">ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrMatOrder.html">corrMatOrder</a></span><span class="op">(</span><span class="va">crime.cor</span>, order <span class="op">=</span> <span class="st">"AOE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">crime.cor</span><span class="op">)</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "murder"   "assault"  "rape"     "robbery"  "burglary"</span></span>
<span><span class="co">#&gt; [6] "larceny"  "auto"</span></span>
<span><span class="va">crime.cor</span> <span class="op">&lt;-</span> <span class="va">crime.cor</span><span class="op">[</span><span class="va">ord</span>, <span class="va">ord</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># "association graph": network of correlations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/qgraph/man/qgraph.html">qgraph</a></span><span class="op">(</span><span class="va">crime.cor</span>, </span>
<span>  title <span class="op">=</span> <span class="st">"Crime data:\ncorrelations"</span>, title.cex <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  graph <span class="op">=</span> <span class="st">"cor"</span>,</span>
<span>  layout <span class="op">=</span> <span class="st">"circle"</span>,</span>
<span>  minimum <span class="op">=</span> <span class="st">"sig"</span>, sampleSize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">crime</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span><span class="op">(</span><span class="fl">.9</span><span class="op">)</span>, vsize <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">crime.cor</span><span class="op">)</span>,</span>
<span>  posCol <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-cor" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-cor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-crime-cor-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-cor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.50: Network diagram depicting the correlations among the crime variables. Only edges for correlations that are significant at the <span class="math inline">\(\alpha = 0.01\)</span> level are displayed.
</figcaption></figure>
</div>
</div>
</div>
<!--
::: {.cell layout-align="center"}

```{.r .cell-code}
knitr::include_graphics("images/crime-cor.png")
```

::: {.cell-output-display}
![Network diagram depicting the correlations among the crime variables.](images/crime-cor.png){#fig-crime-cor-image fig-align='center' width=80%}
:::
:::
-->
<p>In this figure, you can see the group of property crimes (auto theft, larceny, burglary) at the left separated from the violent crimes against persons at the right.</p>
</section><section id="sec-partial-cor" class="level3" data-number="3.10.2"><h3 data-number="3.10.2" class="anchored" data-anchor-id="sec-partial-cor">
<span class="header-section-number">3.10.2</span> Partial correlations</h3>
<p>Among the more important statistical applications of network graph theory is the idea that you can also use them to study the the <em>partial</em> (conditional) associations among variables with the contributions of all other variables removed in what are called Graphical Gaussian Models (GGMs) <span class="citation" data-cites="Lauritzen1996 Hojsgaard2012graphical">(<a href="95-references.html#ref-Hojsgaard2012graphical" role="doc-biblioref">Højsgaard et al., 2012</a>; <a href="95-references.html#ref-Lauritzen1996" role="doc-biblioref">Lauritzen, 1996</a>)</span>. In a network diagram of these partial associations,</p>
<ul>
<li><p>The edges between nodes represent the <em>partial correlations</em> between those variables.</p></li>
<li><p>The absence of an edge between two nodes indicates their variables are <em>conditionally independent</em>, given the other variables.</p></li>
</ul>
<p>So, whereas a network diagram of correlations shows <em>marginal associations</em> ignoring other variables, one of partial correlations allows you to visualize the <em>direct</em> relationship between each pair of variables, removing the indirect effects that might be mediated through all other variables.</p>
<p>For a set of variables <span class="math inline">\(X = \{x_1, x_2, \dots, x_p \}\)</span>, the partial correlation between <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_i\)</span>, controlling for all other variables <span class="math inline">\(Z = X \setminus \{x_i, x_j\} = x_\text{others}\)</span> is equivalent to the correlation between the <em>residuals</em> of the linear regressions of <span class="math inline">\(x_i\)</span> on all other <span class="math inline">\(\mathbf{Z}\)</span> and <span class="math inline">\(x_j\)</span> on <span class="math inline">\(\mathbf{Z}\)</span>. (The notation <span class="math inline">\(X \setminus \{x_i, x_j\}\)</span> is read as “<span class="math inline">\(X\)</span> without the set <span class="math inline">\(\{x_i, x_j\}\)</span>”).</p>
<p>Mathematically, let <span class="math inline">\(\hat{x}_i\)</span> and <span class="math inline">\(\hat{x}_j\)</span> be the predicted values from the linear regressions of <span class="math inline">\(x_i\)</span> on <span class="math inline">\(\mathbf{Z}\)</span> and of <span class="math inline">\(x_j\)</span> on <span class="math inline">\(\mathbf{Z}\)</span>, respectively. The partial correlation <span class="math inline">\(p_{ij}\)</span> between <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_j\)</span> controlling for <span class="math inline">\(\mathbf{Z}\)</span> is given by: <span id="eq-parcor"><span class="math display">\[
p_{x_i,x_j|\mathbf{Z}} = r( x_i, x_j \mid \text{others}) = \text{cor}[ (x_i - \hat{x}_i),\; (x_j - \hat{x}_j)]
\tag{3.3}\]</span></span></p>
<p>But, rather than running all these linear regressions, they can all be computed from the inverse of the correlation matrix <span class="citation" data-cites="Whittaker1990">(<a href="95-references.html#ref-Whittaker1990" role="doc-biblioref">Whittaker, 1990</a>, Ch. 5)</span>, a relation first noted by <span class="citation" data-cites="Dempster1972">Dempster (<a href="95-references.html#ref-Dempster1972" role="doc-biblioref">1972</a>)</span>. Let <span class="math inline">\(\mathbf{R}\)</span> be the correlation matrix of the variables. Then, the matrix <span class="math inline">\(\mathbf{P}\)</span> of partial correlations can be obtained from the negative inverse, <span class="math inline">\(-\mathbf{R}^{-1}\)</span>, standardized to a correlation matrix by dividing by the square root of product of its diagonal elements, <span class="math display">\[
P_{ij} = - \frac{R^{-1}_{ij}}{\sqrt{(R^{-1}_{ii} \cdot R^{-1}_{jj})}} \:\: .
\]</span></p>
<!-- Detrius from earlier descriptions ...
$$
\mathbf{P} = -\mathbf{R}^{-1} \comma
$$
where $\mathbf{R}^{-1}$ is the inverse of the correlation matrix $\mathbf{R}$.

Let $\mathbf{S}$ be the covariance matrix of the variable, and $\mathbf{R}$ be the corresponding
correlation matrix.
Then the matrix of partial variances and covariances, $\mathbf{T}$ is

$$
\mathbf{T} = -\mathbf{S}^{-1} \period
$$
The diagonal elements 
$R_{ij} = \frac{S_{ij}}{\sqrt{S_{ii} S_{jj}}}$
-->
<p>The practical implications of this are:</p>
<ul>
<li><p>If a partial correlation is close to zero, it suggests the relationship between two variables is primarily mediated through other variables.</p></li>
<li><p>Non-zero partial correlations indicate a direct relationship that persists after controlling for other variables.</p></li>
</ul>
<p><a href="#fig-crime-partial-spring" class="quarto-xref">Figure&nbsp;<span>3.51</span></a> shows the partial correlation network for the crime data, using the <code><a href="https://rdrr.io/pkg/qgraph/man/qgraph.html">qgraph()</a></code> argument <code>graph = "pcor"</code> To provide a more interpretable result, the argument <code>layout = "spring"</code> positions the nodes using a force-embedded algorithm where edges act like springs, pulling connected nodes together and unconnected nodes repel each other, pushing them apart.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb69" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/qgraph/man/qgraph.html">qgraph</a></span><span class="op">(</span><span class="va">crime.cor</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Crime data:\npartial correlations"</span>, title.cex <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>       graph <span class="op">=</span> <span class="st">"pcor"</span>,</span>
<span>       layout <span class="op">=</span> <span class="st">"spring"</span>, repulsion <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>       minimum <span class="op">=</span> <span class="st">"sig"</span>, sampleSize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">crime</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>       color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span><span class="op">(</span><span class="fl">.9</span><span class="op">)</span>, vsize <span class="op">=</span> <span class="fl">14</span>,</span>
<span>       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">crime.cor</span><span class="op">)</span>,</span>
<span>       edge.labels <span class="op">=</span> <span class="cn">TRUE</span>, edge.label.cex <span class="op">=</span> <span class="fl">1.7</span>,</span>
<span>       posCol <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-partial-spring" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-partial-spring-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch03/fig-crime-partial-spring-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-partial-spring-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.51: Network diagram of partial correlations among the crime variables, controlling for all others. Variable nodes have been positioned by a “spring” layout method …
</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-crime-partial-spring" class="quarto-xref">Figure&nbsp;<span>3.51</span></a> shows that, once all other crime variables are controlled for each pair, there remain only a few partial correlations at the <span class="math inline">\(\alpha = 0.05\)</span> level. Of these, only the largest three in absolute value are significant at <span class="math inline">\(\alpha = 0.01\)</span>.</p>
<p>Thus, once all other variables are taken into account, what remains is mainly a strong positive association between burglary and larceny and a moderate one between auto theft and robbery. There also remains a moderate negative correlation between murder and larceny. The spring layout makes it clear that, with suppression of weak edges, auto theft and robbery form a cluster separated from the other variables.</p>
</section><section id="sec-pvPlot" class="level3" data-number="3.10.3"><h3 data-number="3.10.3" class="anchored" data-anchor-id="sec-pvPlot">
<span class="header-section-number">3.10.3</span> Visualizing partial correlations</h3>
<p>Just as you can visualize <em>marginal</em> association between variables in a scatterplot, you can also visualize <em>conditional</em> association. A <strong>partial variables plot</strong> is simply a scatterplot of the partial residuals <span class="math inline">\(e_i = (x_i - \hat{x}_i)\)</span> from a regression of <span class="math inline">\(x_i\)</span> on the other variables <span class="math inline">\(Z\)</span> against those <span class="math inline">\(e_j = (x_j - \hat{x}_j)\)</span> for another variable <span class="math inline">\(x_j\)</span>.</p>
<p>In this, you can use all the bells and whistles of standard scatterplots (regression lines, smooths, data ellipses, …) to listen more attentively to the story partial association has to tell. The function <code>pvPlot()</code> calculates the partial residuals and then calls <code><a href="https://rdrr.io/pkg/car/man/Ellipses.html">car::dataEllipse()</a></code> for display. The five most “unusual” observations by Mahalanobis <span class="math inline">\(D^2\)</span> are identified with their abbreviated state labels. <a href="#fig-crime-pvPlots" class="quarto-xref">Figure&nbsp;<span>3.52</span></a> shows these plots for the variable pairs with the two largest partial correlations.</p>
<!-- **TODO**: I'd like to put these two figures side-by-side and integrate the code chunks, but `car::scatterplot` doesn't seem to allow this. -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb70" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/pvPlot.R"</span><span class="op">)</span></span>
<span><span class="co"># select numeric, make `st` into rownames</span></span>
<span><span class="va">crime.num</span> <span class="op">&lt;-</span> <span class="va">crime</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"st"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pvPlot</span><span class="op">(</span><span class="va">crime.num</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"burglary"</span>, <span class="st">"larceny"</span><span class="op">)</span>, </span>
<span>       id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>       cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu">pvPlot</span><span class="op">(</span><span class="va">crime.num</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"robbery"</span>, <span class="st">"auto"</span><span class="op">)</span>,</span>
<span>       id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>       cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-crime-pvPlots" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-pvPlots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/crime-pvPlot-1-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-pvPlots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.52: Partial variables plots for burglary and larceny (left) and for robbery and auto theft (right) in the network diagram for partial correlations of the crime variables.
</figcaption></figure>
</div>
</div>
</div>
<p>In the pvPlot for burglary and larceny, you can see that the high partial correlation is largely driven by the extreme points at the left and and right sides. Once all other variables are taken into account, Arizona (AZ) and Hawaii (HI) have larger incidence of both crimes, while Arkansas (AK) are smaller on both.</p>
<p>In the pvPlot for robbery and auto theft, New York stands out as an influential, high-leverage point (see <a href="06-linear_models-plots.html#sec-leverage" class="quarto-xref"><span>Section 6.6</span></a>); Massachusetts (MA) is noteworthy because auto theft in that state is considerably higher than what would be predicted from all other variables.</p>
</section></section><section id="multivariate-thinking-and-visualization" class="level2" data-number="3.11"><h2 data-number="3.11" class="anchored" data-anchor-id="multivariate-thinking-and-visualization">
<span class="header-section-number">3.11</span> Multivariate thinking and visualization</h2>
<p><strong>TODO</strong>: These are just initial notes on a chapter summary, and pointing the way to dimension reduction methods in <a href="04-pca-biplot.html" class="quarto-xref"><span>Chapter 4</span></a>.</p>
<p>This chapter has covered a lot of ground. We started with simple scatterplots and how to enhance them with graphical summaries and annotations …</p>
<p><strong>The two curses</strong></p>
<p>Multivariate data is often said to suffer from the <strong>curse of dimensionality</strong> (ref: Bellman1957), meaning that that as the dimensionality of data increases, the volume of the space increases so fast that the available data become sparse, so that the amount of data needed often grows exponentially with the dimensionality.</p>
<p>But, there is another curse here, the <strong>curse of two-dimensionality</strong>, meaning that as the dimensionality of data increases, what we can display and understand from a 2D image decreases rapidly with the number of dimensions of data. …</p>
<p><strong>Package summary</strong></p>
<p>For development, keep track of the packages used in each chapter.</p>
<div class="cell" data-layout-align="center">
<p>18 packages used here: broom, car, carData, corrgram, corrplot, dplyr, GGally, ggdensity, ggpcp, ggplot2, grid, heplots, knitr, patchwork, qgraph, tidyr, tourr, vcd</p>
</div>
<!-- ## References {.unnumbered} -->


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Andrews:72" class="csl-entry" role="listitem">
Andrews, D. F. (1972). Plots of high dimensional data. <em>Biometrics</em>, <em>28</em>, 123–136.
</div>
<div id="ref-Asimov:85" class="csl-entry" role="listitem">
Asimov, D. (1985). Grand tour. <em>SIAM Journal of Scientific and Statistical Computing</em>, <em>6</em>(1), 128–143.
</div>
<div id="ref-Barabasi2016network" class="csl-entry" role="listitem">
Barab’asi, A.-L. (2016). <em>Network science</em>. Cambridge University Press.
</div>
<div id="ref-Becker:1996:VDC" class="csl-entry" role="listitem">
Becker, R. A., Cleveland, W. S., &amp; Shyu, M.-J. (1996). The visual design and control of trellis display. <em>Journal of Computational and Graphical Statistics</em>, <em>5</em>(2), 123–155.
</div>
<div id="ref-Black-etal-2018" class="csl-entry" role="listitem">
Black, C., Southwell, C., Emmerson, L., Lunn, D., &amp; Hart, T. (2018). Time-lapse imagery of adélie penguins reveals differential winter strategies and breeding site occupation. <em>PLOS ONE</em>, <em>13</em>(3), e0193532. <a href="https://doi.org/10.1371/journal.pone.0193532">https://doi.org/10.1371/journal.pone.0193532</a>
</div>
<div id="ref-Blishen-etal-1987" class="csl-entry" role="listitem">
Blishen, B., Carroll, W., &amp; Moore, C. (1987). The 1981 socioeconomic index for occupations in canada. <em>Canadian Review of Sociology/Revue Canadienne de Sociologie</em>, <em>24</em>(4), 465–488. <a href="https://doi.org/10.1111/j.1755-618x.1987.tb00639.x">https://doi.org/10.1111/j.1755-618x.1987.tb00639.x</a>
</div>
<div id="ref-BondyMurty2008" class="csl-entry" role="listitem">
Bondy, J. A., &amp; Murty, U. S. R. (2008). <em>Graph theory</em>. Springer.
</div>
<div id="ref-Buja-etal-2005" class="csl-entry" role="listitem">
Buja, A., Cook, D., Asimov, D., &amp; Hurley, C. (2005). Computational methods for high-dimensional rotations in data visualization. In J. S. CR Rao EJ Wegman (Ed.), <em>Handbook of statistics</em> (pp. 391–413). Elsevier. <a href="https://doi.org/10.1016/s0169-7161(04)24014-7">https://doi.org/10.1016/s0169-7161(04)24014-7</a>
</div>
<div id="ref-Ocagne:1885" class="csl-entry" role="listitem">
cagne, M. (1885). <em>Coordonn<span>é</span>es parall<span>è</span>les et axiales: M<span>é</span>thode de transformation g<span>é</span>om<span>é</span>trique et proc<span>é</span>d<span>é</span> nouveau de calcul graphique d<span>é</span>duits de la consid<span>é</span>ration des coordonn<span>é</span>es parall<span>è</span>lles</em>. Gauthier-Villars. <a href="http://historical.library.cornell.edu/cgi-bin/cul.math/docviewer?did=00620001&amp;seq=3">http://historical.library.cornell.edu/cgi-bin/cul.math/docviewer?did=00620001&amp;seq=3</a>
</div>
<div id="ref-Chambers-etal:83" class="csl-entry" role="listitem">
Chambers, J. M., Cleveland, W. S., Kleiner, B., &amp; Tukey, P. A. (1983). <em>Graphical methods for data analysis</em>. Wadsworth.
</div>
<div id="ref-ChambersHastie1991" class="csl-entry" role="listitem">
Chambers, J. M., &amp; Hastie, T. J. (1991). <em>Statistical models in s</em> (p. 624). Chapman &amp; Hall/CRC.
</div>
<div id="ref-Cleveland:79" class="csl-entry" role="listitem">
Cleveland, W. S. (1979). Robust locally weighted regression and smoothing scatterplots. <em>Journal of the American Statistical Association</em>, <em>74</em>, 829–836.
</div>
<div id="ref-Cleveland:85" class="csl-entry" role="listitem">
Cleveland, W. S. (1985). <em>The elements of graphing data</em>. Wadsworth Advanced Books.
</div>
<div id="ref-ClevelandDevlin:88" class="csl-entry" role="listitem">
Cleveland, W. S., &amp; Devlin, S. J. (1988). Locally weighted regression: An approach to regression analysis by local fitting. <em>Journal of the American Statistical Association</em>, <em>83</em>, 596–610.
</div>
<div id="ref-ClevelandMcGill:84b" class="csl-entry" role="listitem">
Cleveland, W. S., &amp; McGill, R. (1984). Graphical perception: Theory, experimentation and application to the development of graphical methods. <em>Journal of the American Statistical Association</em>, <em>79</em>, 531–554.
</div>
<div id="ref-ClevelandMcGill:85" class="csl-entry" role="listitem">
Cleveland, W. S., &amp; McGill, R. (1985). Graphical perception and graphical methods for analyzing scientific data. <em>Science</em>, <em>229</em>, 828–833.
</div>
<div id="ref-Cook-etal-1995" class="csl-entry" role="listitem">
Cook, D., Buja, A., Cabrera, J., &amp; Hurley, C. (1995). Grand tour and projection pursuit. <em>Journal of Computational and Graphical Statistics</em>, <em>4</em>(3), 155. <a href="https://doi.org/10.2307/1390844">https://doi.org/10.2307/1390844</a>
</div>
<div id="ref-Cook-etal-2008" class="csl-entry" role="listitem">
Cook, D., Buja, A., Lee, E.-K., &amp; Wickham, H. (2008). Grand tours, projection pursuit guided tours, and manual controls. In <em>Handbook of data visualization</em> (pp. 295–314). Springer Berlin Heidelberg. <a href="https://doi.org/10.1007/978-3-540-33037-0_13">https://doi.org/10.1007/978-3-540-33037-0_13</a>
</div>
<div id="ref-CookLaa-mulgar" class="csl-entry" role="listitem">
Cook, D., &amp; Laa, U. (2024). <em>Interactively exploring high-dimensional data and models in <span>R</span></em>. Online. <a href="https://dicook.github.io/mulgar_book/">https://dicook.github.io/mulgar_book/</a>
</div>
<div id="ref-CookSwayne:2007" class="csl-entry" role="listitem">
Cook, D., &amp; Swayne, D. F. (2007). <em>Interactive and dynamic graphics for data analysis : With <span>R</span> and <span>GGobi</span></em>. Springer. <a href="http://www.ggobi.org/book/">http://www.ggobi.org/book/</a>
</div>
<div id="ref-Costantini2015" class="csl-entry" role="listitem">
Costantini, G., Epskamp, S., Borsboom, D., Perugini, M., Mõttus, R., Waldorp, L. J., &amp; Cramer, A. O. J. (2015). State of the <span class="nocase">aRt</span> personality research: A tutorial on network analysis of personality data in <span>R</span>. <em>Journal of Research in Personality</em>, <em>54</em>, 13–29. <a href="https://doi.org/10.1016/j.jrp.2014.07.003">https://doi.org/10.1016/j.jrp.2014.07.003</a>
</div>
<div id="ref-R-igraph" class="csl-entry" role="listitem">
Csárdi, G., Nepusz, T., Traag, V., Horvát, S., Zanini, F., Noom, D., &amp; Müller, K. (2024). <em><span class="nocase">igraph</span>: Network analysis and visualization in r</em>. <a href="https://doi.org/10.5281/zenodo.7682609">https://doi.org/10.5281/zenodo.7682609</a>
</div>
<div id="ref-Dempster:69" class="csl-entry" role="listitem">
Dempster, A. P. (1969). <em>Elements of continuous multivariate analysis</em>. Addison-Wesley.
</div>
<div id="ref-Dempster1972" class="csl-entry" role="listitem">
Dempster, A. P. (1972). Covariance selection. <em>Biometrics</em>, <em>28</em>(1), 157–175.
</div>
<div id="ref-Emerson-etal:2013" class="csl-entry" role="listitem">
Emerson, J. W., Green, W. A., Schloerke, B., Crowley, J., Cook, D., Hofmann, H., &amp; Wickham, H. (2013). The generalized pairs plot. <em>Journal of Computational and Graphical Statistics</em>, <em>22</em>(1), 79–91. <a href="http://www.tandfonline.com/doi/ref/10.1080/10618600.2012.694762">http://www.tandfonline.com/doi/ref/10.1080/10618600.2012.694762</a>
</div>
<div id="ref-Fox:2016:ARA" class="csl-entry" role="listitem">
Fox, J. (2016). <em>Applied regression analysis and generalized linear models</em> (Third edition.). SAGE.
</div>
<div id="ref-R-car" class="csl-entry" role="listitem">
Fox, J., Weisberg, S., &amp; Price, B. (2023). <em>Car: Companion to applied regression</em>. <a href="https://CRAN.R-project.org/package=car">https://CRAN.R-project.org/package=car</a>
</div>
<div id="ref-Friendly:91" class="csl-entry" role="listitem">
Friendly, M. (1991). <em><span>SAS System</span> for statistical graphics</em> (1st ed.). SAS Institute. <a href="http://www.sas.%20com/service/doc/pubcat/uspubcat/ind_files/56143.html">http://www.sas. com/service/doc/pubcat/uspubcat/ind_files/56143.html</a>
</div>
<div id="ref-Friendly:94a" class="csl-entry" role="listitem">
Friendly, M. (1994). Mosaic displays for multi-way contingency tables. <em>Journal of the American Statistical Association</em>, <em>89</em>, 190–200. <a href="http://www.jstor.org/stable/2291215">http://www.jstor.org/stable/2291215</a>
</div>
<div id="ref-Friendly:99:EMD" class="csl-entry" role="listitem">
Friendly, M. (1999). Extending mosaic displays: Marginal, conditional, and partial views of categorical data. <em>Journal of Computational and Graphical Statistics</em>, <em>8</em>(3), 373–395. <a href="http://datavis.ca/papers/drew/drew.pdf">http://datavis.ca/papers/drew/drew.pdf</a>
</div>
<div id="ref-Friendly:02:corrgram" class="csl-entry" role="listitem">
Friendly, M. (2002). Corrgrams: Exploratory displays for correlation matrices. <em>The American Statistician</em>, <em>56</em>(4), 316–324. <a href="https://doi.org/10.1198/000313002533">https://doi.org/10.1198/000313002533</a>
</div>
<div id="ref-Friendly2022" class="csl-entry" role="listitem">
Friendly, M. (2022). The life and works of andr<span>é</span>-michel guerry, revisited. <em>Sociological Spectrum</em>, <em>42</em>(4-6), 233–259. <a href="https://doi.org/10.1080/02732173.2022.2078450">https://doi.org/10.1080/02732173.2022.2078450</a>
</div>
<div id="ref-R-vcdExtra" class="csl-entry" role="listitem">
Friendly, M. (2023). <em>vcdExtra: Vcd extensions and additions</em>. <a href="https://friendly.github.io/vcdExtra/">https://friendly.github.io/vcdExtra/</a>
</div>
<div id="ref-FriendlyKwan:03:effect" class="csl-entry" role="listitem">
Friendly, M., &amp; Kwan, E. (2003). Effect ordering for data displays. <em>Computational Statistics and Data Analysis</em>, <em>43</em>(4), 509–539. <a href="https://doi.org/10.1016/S0167-9473(02)00290-6">https://doi.org/10.1016/S0167-9473(02)00290-6</a>
</div>
<div id="ref-FriendlyMeyer:2016:DDAR" class="csl-entry" role="listitem">
Friendly, M., &amp; Meyer, D. (2016). <em>Discrete data analysis with <span>R</span>: Visualization and modeling techniques for categorical and count data</em>. Chapman &amp; Hall/CRC.
</div>
<div id="ref-Friendly-etal:ellipses:2013" class="csl-entry" role="listitem">
Friendly, M., Monette, G., &amp; Fox, J. (2013). Elliptical insights: Understanding statistical methods through elliptical geometry. <em>Statistical Science</em>, <em>28</em>(1), 1–39. <a href="https://doi.org/10.1214/12-STS402">https://doi.org/10.1214/12-STS402</a>
</div>
<div id="ref-Galton:1886" class="csl-entry" role="listitem">
Galton, F. (1886). Regression towards mediocrity in hereditary stature. <em>Journal of the Anthropological Institute</em>, <em>15</em>, 246–263. <a href="http://www.jstor.org/cgi-bin/jstor/viewitem/09595295/dm995266/99p0374f/0">http://www.jstor.org/cgi-bin/jstor/viewitem/09595295/dm995266/99p0374f/0</a>
</div>
<div id="ref-Gannett:1898" class="csl-entry" role="listitem">
Gannett, H. (1898). <em>Statistical atlas of the united states, eleventh (1890) census</em>. U.S. Government Printing Office.
</div>
<div id="ref-Gorman2014" class="csl-entry" role="listitem">
Gorman, K. B., Williams, T. D., &amp; Fraser, W. R. (2014). Ecological sexual dimorphism and environmental variability within a community of antarctic penguins (genus pygoscelis). <em><span>PLoS</span> <span>ONE</span></em>, <em>9</em>(3), e90081. <a href="https://doi.org/10.1371/journal.pone.0090081">https://doi.org/10.1371/journal.pone.0090081</a>
</div>
<div id="ref-Grandjean2016" class="csl-entry" role="listitem">
Grandjean, M. (2016). A social network analysis of <span>T</span>witter: <span>M</span>apping the digital humanities community. <em>Cogent Arts &amp;Amp; Humanities</em>, <em>3</em>(1), 1171458. <a href="https://doi.org/10.1080/23311983.2016.1171458">https://doi.org/10.1080/23311983.2016.1171458</a>
</div>
<div id="ref-Guerry:1833" class="csl-entry" role="listitem">
Guerry, A.-M. (1833). <em>Essai sur la statistique morale de la <span>France</span></em>. Crochard.
</div>
<div id="ref-Harrison2023" class="csl-entry" role="listitem">
Harrison, P. (2023). Langevitour: Smooth interactive touring of high dimensions, demonstrated with scRNA-seq data. <em>The R Journal</em>, <em>15</em>(2), 206–219. <a href="https://doi.org/10.32614/RJ-2023-046">https://doi.org/10.32614/RJ-2023-046</a>
</div>
<div id="ref-R-langevitour" class="csl-entry" role="listitem">
Harrison, P. (2024). <em>Langevin tour</em>. <a href="https://CRAN.R-project.org/package=langevitour">https://CRAN.R-project.org/package=langevitour</a>
</div>
<div id="ref-R-detourr" class="csl-entry" role="listitem">
Hart, C., &amp; Wang, E. (2022). <em>Detourr: Portable and performant tour animations</em>. <a href="https://CRAN.R-project.org/package=detourr">https://CRAN.R-project.org/package=detourr</a>
</div>
<div id="ref-Hartigan:75" class="csl-entry" role="listitem">
Hartigan, J. A. (1975a). <em>Clustering algorithms</em>. John Wiley; Sons.
</div>
<div id="ref-Hartigan:75b" class="csl-entry" role="listitem">
Hartigan, J. A. (1975b). Printer graphics for clustering. <em>Journal of Statistical Computing and Simulation</em>, <em>4</em>, 187–213.
</div>
<div id="ref-R-ggpcp" class="csl-entry" role="listitem">
Hofmann, H., VanderPlas, S., &amp; Ge, Y. (2022). <em>Ggpcp: Parallel coordinate plots in the ggplot2 framework</em>. <a href="https://github.com/heike/ggpcp">https://github.com/heike/ggpcp</a>
</div>
<div id="ref-Hofstadter1979" class="csl-entry" role="listitem">
Hofstadter, D. R. (1979). <em>Gödel, escher, bach: An eternal golden braid</em>. Basic Books.
</div>
<div id="ref-Hojsgaard2012graphical" class="csl-entry" role="listitem">
Højsgaard, S., Edwards, D., &amp; Lauritzen, S. (2012). <em>Graphical models with <span>R</span></em>. Springer Science &amp; Business Media.
</div>
<div id="ref-R-palmerpenguins" class="csl-entry" role="listitem">
Horst, A., Hill, A., &amp; Gorman, K. (2022). <em>Palmerpenguins: Palmer archipelago (antarctica) penguin data</em>. <a href="https://allisonhorst.github.io/palmerpenguins/">https://allisonhorst.github.io/palmerpenguins/</a>
</div>
<div id="ref-Inselberg:1985" class="csl-entry" role="listitem">
Inselberg, A. (1985). The plane with parallel coordinates. <em>The Visual Computer</em>, <em>1</em>, 69–91.
</div>
<div id="ref-IsvoranuEpskamp2022" class="csl-entry" role="listitem">
Isvoranu, A.-M., Epskamp, S., Waldorp, L. J., &amp; Borsboom, D. (2022). <em>Network psychometrics with r: A guide for behavioral and social scientists</em>. Routledge. <a href="https://doi.org/10.4324/9781003111238">https://doi.org/10.4324/9781003111238</a>
</div>
<div id="ref-Lauritzen1996" class="csl-entry" role="listitem">
Lauritzen, S. L. (1996). <em>Graphical models</em>. Oxford University Press.
</div>
<div id="ref-LeeCook-2009" class="csl-entry" role="listitem">
Lee, E.-K., &amp; Cook, D. (2009). A projection pursuit index for large p small n data. <em>Statistics and Computing</em>, <em>20</em>(3), 381–392. <a href="https://doi.org/10.1007/s11222-009-9131-1">https://doi.org/10.1007/s11222-009-9131-1</a>
</div>
<div id="ref-R-liminal" class="csl-entry" role="listitem">
Lee, S. (2021). <em>Liminal: Multivariate data visualization with tours and embeddings</em>. <a href="https://CRAN.R-project.org/package=liminal">https://CRAN.R-project.org/package=liminal</a>
</div>
<div id="ref-MartiLaguna2003" class="csl-entry" role="listitem">
Martí, R., &amp; Laguna, M. (2003). Heuristics and meta-heuristics for 2-layer straight line crossing minimization. <em>Discrete Applied Mathematics</em>, <em>127</em>(3), 665–678.
</div>
<div id="ref-R-vcd" class="csl-entry" role="listitem">
Meyer, D., Zeileis, A., Hornik, K., &amp; Friendly, M. (2024). <em>Vcd: Visualizing categorical data</em>. <a href="https://CRAN.R-project.org/package=vcd">https://CRAN.R-project.org/package=vcd</a>
</div>
<div id="ref-Monette:90" class="csl-entry" role="listitem">
Monette, G. (1990). Geometry of multiple regression and interactive 3-<span>D</span> graphics. In J. Fox &amp; S. Long (Eds.), <em>Modern methods of data analysis</em> (pp. 209–256). SAGE Publications.
</div>
<div id="ref-R-ggdensity" class="csl-entry" role="listitem">
Otto, J., &amp; Kahle, D. (2023). <em>Ggdensity: Interpretable bivariate density visualization with ggplot2</em>. <a href="https://jamesotto852.github.io/ggdensity/">https://jamesotto852.github.io/ggdensity/</a>
</div>
<div id="ref-Pearson:1901" class="csl-entry" role="listitem">
Pearson, K. (1901). On lines and planes of closest fit to systems of points in space. <em>Philosophical Magazine</em>, <em>6</em>(2), 559–572.
</div>
<div id="ref-PineoPorter2008" class="csl-entry" role="listitem">
Pineo, P. O., &amp; Porter, J. (2008). Occupational prestige in canada. <em>Canadian Review of Sociology</em>, <em>4</em>(1), 24–40. <a href="https://doi.org/10.1111/j.1755-618x.1967.tb00472.x">https://doi.org/10.1111/j.1755-618x.1967.tb00472.x</a>
</div>
<div id="ref-Robinaugh2019" class="csl-entry" role="listitem">
Robinaugh, D. J., Hoekstra, R. H. A., Toner, E. R., &amp; Borsboom, D. (2019). The network approach to psychopathology: A review of the literature 2008–2018 and an agenda for future research. <em>Psychological Medicine</em>, <em>50</em>(3), 353–366. <a href="https://doi.org/10.1017/s0033291719003404">https://doi.org/10.1017/s0033291719003404</a>
</div>
<div id="ref-R-lattice" class="csl-entry" role="listitem">
Sarkar, D. (2024). <em>Lattice: Trellis graphics for r</em>. <a href="https://lattice.r-forge.r-project.org/">https://lattice.r-forge.r-project.org/</a>
</div>
<div id="ref-R-GGally" class="csl-entry" role="listitem">
Schloerke, B., Cook, D., Larmarange, J., Briatte, F., Marbach, M., Thoen, E., Elberg, A., &amp; Crowley, J. (2024). <em>GGally: Extension to ggplot2</em>. <a href="https://ggobi.github.io/ggally/">https://ggobi.github.io/ggally/</a>
</div>
<div id="ref-Scott1992" class="csl-entry" role="listitem">
Scott, D. W. (1992). <em>Multivariate density estimation: Theory, practice, and visualization</em>. Wiley.
</div>
<div id="ref-Silverman:86" class="csl-entry" role="listitem">
Silverman, B. W. (1986). <em>Density estimation for statistics and data analysis</em>. Chapman &amp; Hall.
</div>
<div id="ref-Simpson:51" class="csl-entry" role="listitem">
Simpson, E. H. (1951). The interpretation of interaction in contingency tables. <em>Journal of the Royal Statistical Society, Series B</em>, <em>30</em>, 238–241.
</div>
<div id="ref-Swayne-etal-1998" class="csl-entry" role="listitem">
Swayne, D. F., Cook, D., &amp; Buja, A. (1998). XGobi: Interactive dynamic data visualization in the x window system. <em>Journal of Computational and Graphical Statistics</em>, <em>7</em>(1), 113–130. <a href="https://doi.org/10.1080/10618600.1998.10474764">https://doi.org/10.1080/10618600.1998.10474764</a>
</div>
<div id="ref-Swayne-etal-2003" class="csl-entry" role="listitem">
Swayne, D. F., Lang, D. T., Buja, A., &amp; Cook, D. (2003). <span>GGobi</span>: Evolving from <span>XGobi</span> into an extensible framework for interactive data visualization. <em>Computational Statistics &amp;Amp; Data Analysis</em>, <em>43</em>(4), 423–444. <a href="https://doi.org/10.1016/s0167-9473(02)00286-4">https://doi.org/10.1016/s0167-9473(02)00286-4</a>
</div>
<div id="ref-VanderPlas2023" class="csl-entry" role="listitem">
VanderPlas, S., Ge, Y., Unwin, A., &amp; Hofmann, H. (2023). Penguins go parallel: A grammar of graphics framework for generalized parallel coordinate plots. <em>Journal of Computational and Graphical Statistics</em>, 1–16. <a href="https://doi.org/10.1080/10618600.2023.2195462">https://doi.org/10.1080/10618600.2023.2195462</a>
</div>
<div id="ref-R-loon" class="csl-entry" role="listitem">
Waddell, A., &amp; Oldford, R. W. (2023). <em>Loon: Interactive statistical data visualization</em>. <a href="https://CRAN.R-project.org/package=loon">https://CRAN.R-project.org/package=loon</a>
</div>
<div id="ref-Wegman:1990" class="csl-entry" role="listitem">
Wegman, E. J. (1990). Hyperdimensional data analysis using parallel coordinates. <em>Journal of the American Statistical Association</em>, <em>85</em>(411), 664–675.
</div>
<div id="ref-R-corrplot" class="csl-entry" role="listitem">
Wei, T., &amp; Simko, V. (2024). <em>Corrplot: Visualization of a correlation matrix</em>. <a href="https://github.com/taiyun/corrplot">https://github.com/taiyun/corrplot</a>
</div>
<div id="ref-West2001" class="csl-entry" role="listitem">
West, D. B. (2001). <em>Introduction to graph theory</em>. Prentice hall.
</div>
<div id="ref-Whittaker1990" class="csl-entry" role="listitem">
Whittaker, J. (1990). <em>Graphical models in applied multivariate statistics</em>. John Wiley; Sons.
</div>
<div id="ref-R-tourr" class="csl-entry" role="listitem">
Wickham, H., &amp; Cook, D. (2024). <em>Tourr: Tour methods for multivariate data visualisation</em>. <a href="https://github.com/ggobi/tourr">https://github.com/ggobi/tourr</a>
</div>
<div id="ref-Wickham-etal-2011" class="csl-entry" role="listitem">
Wickham, H., Cook, D., Hofmann, H., &amp; Buja, A. (2011). Tourr: An <span>R</span> package for exploring multivariate data with projections. <em>Journal of Statistical Software</em>, <em>40</em>(2). <a href="https://doi.org/10.18637/jss.v040.i02">https://doi.org/10.18637/jss.v040.i02</a>
</div>
<div id="ref-Wood:2006" class="csl-entry" role="listitem">
Wood, S. N. (2006). <em>Generalized additive models: An introduction with r</em>. Chapman; Hall/CRC Press.
</div>
<div id="ref-R-corrgram" class="csl-entry" role="listitem">
Wright, K. (2021). <em>Corrgram: Plot a correlogram</em>. <a href="https://kwstat.github.io/corrgram/">https://kwstat.github.io/corrgram/</a>
</div>
<div id="ref-R-loon-tour" class="csl-entry" role="listitem">
Xu, Z., &amp; Oldford, R. W. (2021). <em>Loon.tour: Tour in ’loon’</em>. <a href="https://cran.r-project.org/package=loon.tourr">https://cran.r-project.org/package=loon.tourr</a>
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Confidence bands allow us to visualize the uncertainty around a fitted regression curve, which can be of two types: <em>pointwise intervals</em> or <em>simultaneous intervals</em>. The default setting in `<code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">ggplot2::geom_smooth()</a></code> calculates pointwise intervals (using <code>stats::predict.lm(..., interval="confidence")</code> at a confidence level <span class="math inline">\(1-\alpha\)</span> for the predicted response at <em>each value</em> <span class="math inline">\(x_i\)</span> of a predictor, and have the frequentist interpretation that over repeated sampling only <span class="math inline">\(100\;\alpha\)</span> of the predictions at <span class="math inline">\(x_i\)</span> will be outside that interval. In contrast, simultaneous intervals are calculated so that <span class="math inline">\(1 - \alpha\)</span> is the probability that <em>all of them</em> cover their corresponding true values simultaneously. These are necessarily wider than pointwise intervals. Commonly used methods for constructing simultaneous confidence bands in regression are the Bonferroni and Scheffé methods, which control the family-wise error rate over all values of <span class="math inline">\(x_i\)</span>. See <a href="https://en.wikipedia.org/wiki/Confidence_and_prediction_bands"></a> for precise definitions of these terms. These are different from a <em>prediction band</em>, which is used to represent the uncertainty about the value of a <strong>new</strong> data-point on the curve, but subject to the additional variance reflected in one observation.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The classic study by <span class="citation" data-cites="ClevelandMcGill:84b">Cleveland &amp; McGill (<a href="95-references.html#ref-ClevelandMcGill:84b" role="doc-biblioref">1984</a>)</span>;<span class="citation" data-cites="ClevelandMcGill:85">Cleveland &amp; McGill (<a href="95-references.html#ref-ClevelandMcGill:85" role="doc-biblioref">1985</a>)</span> shows that judgements of magnitude along a common scale are more accurate than those along separate, aligned scales.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The dataset was collected by Bernard Blishen, William Carroll and Catherine Moore, but apparently unpublished. A version updated to the 1981 census is described in <span class="citation" data-cites="Blishen-etal-1987">Blishen et al. (<a href="95-references.html#ref-Blishen-etal-1987" role="doc-biblioref">1987</a>)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The <span class="math inline">\(p^{th}\)</span>-quantile of a random variable <span class="math inline">\(Y\)</span> is a value, denoted by <span class="math inline">\(Q_Y(p)\)</span>, such that <span class="math inline">\(X \leq Q_Y(p)\)</span> with probability <span class="math inline">\(p\)</span>, i.e., <span class="math inline">\(\Pr (Y \leq Q_Y(p)) = p\)</span>. For continuous variables, the quantile is the inverse of the cumulative distribution function.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Other implementations of parallel coordinate plots in R include: <code><a href="https://rdrr.io/pkg/MASS/man/parcoord.html">MASS::parcoord()</a></code>, <code>GGally::ggparcoord() and</code>PairViz::pcp()`. The <strong>ggpcp</strong> version used here is the most general.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>This example was modified from one used by <span class="citation" data-cites="Cook-etal-2008">Cook et al. (<a href="95-references.html#ref-Cook-etal-2008" role="doc-biblioref">2008</a>)</span>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Plot shapes given by <code>pch = 15:18</code> correspond to: filled square (15), filled circle (16), filled triangle point-up (17), filled diamond (18).<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-getting_started.html" class="pagination-link" aria-label="Getting Started">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-pca-biplot.html" class="pagination-link" aria-label="Dimension Reduction">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>