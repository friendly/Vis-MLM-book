<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>9&nbsp; Hotelling’s T^2 – Visualizing Multivariate Data and Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-mlm-review.html" rel="next">
<link href="./08-collinearity-ridge.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-17e746a5a36f38a88c5f5cc681d9ba3d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-hotelling.html">Multivariate Linear Models</a></li><li class="breadcrumb-item"><a href="./09-hotelling.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-hotelling.html">Multivariate Linear Models</a></li><li class="breadcrumb-item"><a href="./09-hotelling.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></a></li></ol></nav>
      <h1 class="title"><span id="sec-Hotelling" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-Author.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Author</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-Prelude.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Warm-up Exercises</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./I-OrientingIdeas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orienting Ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Exploratory Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Univariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for Univariate Response Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Multivariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-hotelling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-infl-robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiviate Influence and Robust Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Case Studies</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">End Matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./95-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-T2" id="toc-sec-T2" class="nav-link active" data-scroll-target="#sec-T2"><span class="header-section-number">9.1</span> <span class="math inline">\(T^2\)</span> as a generalized <span class="math inline">\(t\)</span>-test</a></li>
  <li>
<a href="#sec-t2-properties" id="toc-sec-t2-properties" class="nav-link" data-scroll-target="#sec-t2-properties"><span class="header-section-number">9.2</span> <span class="math inline">\(T^2\)</span> properties</a>
  <ul class="collapse">
<li><a href="#sec-mathscore-example" id="toc-sec-mathscore-example" class="nav-link" data-scroll-target="#sec-mathscore-example"><span class="header-section-number">9.2.1</span> Example: Mathscore data</a></li>
  </ul>
</li>
  <li>
<a href="#sec-t2-heplot" id="toc-sec-t2-heplot" class="nav-link" data-scroll-target="#sec-t2-heplot"><span class="header-section-number">9.3</span> HE plot and discriminant axis</a>
  <ul class="collapse">
<li><a href="#the-heplot-function" id="toc-the-heplot-function" class="nav-link" data-scroll-target="#the-heplot-function"><span class="header-section-number">9.3.1</span> The <code>heplot()</code> function</a></li>
  <li><a href="#he-plot-data-ellipses-and-discriminant-axis" id="toc-he-plot-data-ellipses-and-discriminant-axis" class="nav-link" data-scroll-target="#he-plot-data-ellipses-and-discriminant-axis"><span class="header-section-number">9.3.2</span> HE plot, data ellipses and discriminant axis</a></li>
  </ul>
</li>
  <li><a href="#sec-t2-discrim" id="toc-sec-t2-discrim" class="nav-link" data-scroll-target="#sec-t2-discrim"><span class="header-section-number">9.4</span> Discriminant analysis</a></li>
  <li>
<a href="#sec-t2-more-variables" id="toc-sec-t2-more-variables" class="nav-link" data-scroll-target="#sec-t2-more-variables"><span class="header-section-number">9.5</span> More variables</a>
  <ul class="collapse">
<li><a href="#sec-t2-biplot" id="toc-sec-t2-biplot" class="nav-link" data-scroll-target="#sec-t2-biplot"><span class="header-section-number">9.5.1</span> Biplots</a></li>
  <li><a href="#testing-mean-differences" id="toc-testing-mean-differences" class="nav-link" data-scroll-target="#testing-mean-differences"><span class="header-section-number">9.5.2</span> Testing mean differences</a></li>
  </ul>
</li>
  <li><a href="#variance-accounted-for-eta2" id="toc-variance-accounted-for-eta2" class="nav-link" data-scroll-target="#variance-accounted-for-eta2"><span class="header-section-number">9.6</span> Variance accounted for: <span class="math inline">\(\eta^2\)</span></a></li>
  <li><a href="#the-grand-scheme" id="toc-the-grand-scheme" class="nav-link" data-scroll-target="#the-grand-scheme"><span class="header-section-number">9.7</span> The Grand Scheme</a></li>
  <li><a href="#what-have-we-learned" id="toc-what-have-we-learned" class="nav-link" data-scroll-target="#what-have-we-learned"><span class="header-section-number">9.8</span> What have we learned?</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">9.9</span> Exercises</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- \require{newcommand} --><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \providecommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- \newcommand*{\E}{\mathcal{E}} --><!-- Index generation --><!-- % R packages:  indexed under both package name and packages! --><!-- % data sets:  --><!-- % R stuff --><p>Just as the one- and two- sample univariate <span class="math inline">\(t\)</span>-test is the gateway drug for understanding analysis of variance, so too Hotelling’s <span class="math inline">\(T^2\)</span> test provides an entry point to multivariate analysis of variance. This simple case provides a simple springboard to understanding the collection of methods I call the <strong>HE plot framework</strong> for visualizing effects in multivariate linear models, which are a main focus of this book.</p>
<p>The essential idea (<a href="#sec-T2" class="quarto-xref"><span class="quarto-unresolved-ref">sec-T2</span></a>) is that Hotelling’s <span class="math inline">\(T^2\)</span> provides a test of the difference in means between two groups on a <em>collection</em> of variables, <span class="math inline">\(\mathbf{x} = x_1, x_2, \dots x_p\)</span> <em>simultaneously</em>, rather than one by one. This has the advantages that it:</p>
<ul>
<li>does not require <span class="math inline">\(p\)</span>-value corrections for multiple tests (e.g., Bonferroni);</li>
<li>combines the evidence from the multiple response variables, and <em>pools strength</em>, accumulating support across measures;</li>
<li>clarifies how the multiple response are <em>jointly</em> related to the group effect along a single dimension, the <em>discriminant axis</em>;</li>
<li>In so doing, it reduces the problem of testing differences for two or more response variables to testing the difference on a <em>single variable</em> that best captures the multivariable relations.</li>
</ul>
<p>After describing it’s features, I use an example of a two-group <span class="math inline">\(T^2\)</span> test to illustrate the basic ideas behind multivariate tests and hypothesis error plots in <a href="#sec-t2-heplot" class="quarto-xref"><span class="quarto-unresolved-ref">sec-t2-heplot</span></a>. Then, we’ll dip our toes into the visual ideas behind discriminant analysis (<a href="#sec-t2-discrim" class="quarto-xref"><span class="quarto-unresolved-ref">sec-t2-discrim</span></a>) and how this compares with biplots based on PCA (<a href="#sec-t2-biplot" class="quarto-xref"><span class="quarto-unresolved-ref">sec-t2-biplot</span></a>).</p>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://friendly.github.io/heplots/">heplots</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jmcurran/Hotelling">Hotelling</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/ggbiplot">ggbiplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-T2" class="level2" data-number="9.1"><h2 data-number="9.1" class="anchored" data-anchor-id="sec-T2">
<span class="header-section-number">9.1</span> <span class="math inline">\(T^2\)</span> as a generalized <span class="math inline">\(t\)</span>-test</h2>
<p>Hotelling’s <span class="math inline">\(T^2\)</span> <span class="citation" data-cites="Hotelling:1931">(<a href="#ref-Hotelling:1931" role="doc-biblioref">Hotelling, 1931</a>)</span> is an analog of the square of a univariate <span class="math inline">\(t\)</span> statistic, extended to the case of two or more response variables tested together.</p>
<p>Consider the basic one-sample <span class="math inline">\(t\)</span>-test, where we wish to test the hypothesis that the mean <span class="math inline">\(\bar{x}\)</span> of a set of <span class="math inline">\(N\)</span> measures on a test of basic math, with standard deviation <span class="math inline">\(s\)</span> does not differ from an assumed mean <span class="math inline">\(\mu_0 = 150\)</span> for a population. The <span class="math inline">\(t\)</span> statistic for testing <span class="math inline">\(\mathcal{H}_0 : \mu = \mu_0\)</span> against the two-sided alternative, <span class="math inline">\(\mathcal{H}_0 : \mu \ne \mu_0\)</span> is</p>
<p><span class="math display">\[
t = \frac{(\bar{x} - \mu_0)}{s / \sqrt{N}} = \frac{(\bar{x} - \mu_0)\sqrt{N}}{s} \; .
\]</span></p>
<p>Squaring this gives:</p>
<p><span id="eq-t2"><span class="math display">\[
t^2 = \frac{N (\bar{x} - \mu_0)^2}{s^2} = N (\bar{x} - \mu_0)(s^2)^{-1} (\bar{x} - \mu_0)
\tag{9.1}\]</span></span></p>
<p>Now consider we also have measures on a test of solving word problems for the same sample. Then, a hypothesis test for the means on basic math (BM) and word problems (WP) is the test of the means of these two variables jointly equal some specified values, say, <span class="math inline">\((\mu_{0,BM}=150,\; \mu_{0,WP} =100)\)</span>:</p>
<p><span class="math display">\[
\mathcal{H}_0 : \mathbf{\mu} = \mathbf{\mu_0} =
  \begin{pmatrix}
    \mu_{0, \text{BM}} \\ \mu_{0,\text{WP}}
  \end{pmatrix}
  =
  \begin{pmatrix}
    150 \\ 100
  \end{pmatrix}
\]</span></p>
<p>Hotelling’s <span class="math inline">\(T^2\)</span> is then the analog of <span class="math inline">\(t^2\)</span>, with the variance-covariance matrix <span class="math inline">\(\mathbf{S}\)</span> of the scores on (BM, WP) replacing the variance of a single score.</p>
<p><span id="eq-T2"><span class="math display">\[\begin{aligned}
T^2 &amp;= N (\bar{\mathbf{x}} - \mathbf{\mu}_0)^\mathsf{T} \; \mathbf{S}^{-1} \; (\bar{\mathbf{x}} - \mathbf{\mu}_0) \\
    &amp;= N D^2_M (\bar{\mathbf{x}}, \mathbf{\mu}_0)
\end{aligned} \tag{9.2}\]</span></span></p>
<p>This is nothing more than the squared Mahalanobis <span class="math inline">\(D^2_M\)</span> distance between the sample mean vector <span class="math inline">\((\bar{x}_\text{BM}, \bar{x}_\text{WP})^\mathsf{T}\)</span> and the hypothesized means <span class="math inline">\(\mathbf{\mu}_0\)</span>, in the metric of <span class="math inline">\(\mathbf{S}\)</span>, as shown in <a href="#fig-T2-diagram" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-T2-diagram</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-T2-diagram" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-T2-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/T2-diagram.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-T2-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.1: Hotelling’s T^2 statistic as the squared distance between the sample means and hypothesized means relative to the variance-covariance matrix. <em>Source</em>: Author
</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-t2-properties" class="level2" data-number="9.2"><h2 data-number="9.2" class="anchored" data-anchor-id="sec-t2-properties">
<span class="header-section-number">9.2</span> <span class="math inline">\(T^2\)</span> properties</h2>
<p>Aside from it’s elegant geometric interpretation, Hotelling’s <span class="math inline">\(T^2\)</span> has simple properties that aid in understanding the extension to more complex multivariate tests.</p>
<ul>
<li>
<strong>Maximum <span class="math inline">\(t^2\)</span></strong> : Consider constructing a new variable <span class="math inline">\(w\)</span> as a linear combination of the scores in a matrix <span class="math inline">\(\mathbf{X} = [ \mathbf{x_1}, \mathbf{x_2}, \dots, \mathbf{x_p}]\)</span> with weights <span class="math inline">\(\mathbf{a}\)</span>,</li>
</ul>
<p><span class="math display">\[
w = a_1 \mathbf{x_1} + a_2 \mathbf{x_2} + \dots + a_p \mathbf{x_p} = \mathbf{X} \mathbf{a}
\]</span></p>
<p>Hotelling’s <span class="math inline">\(T^2\)</span> is then the maximum value of a univariate <span class="math inline">\(t^2 (\mathbf{a})\)</span> over all possible choices of the weights in <span class="math inline">\(\mathbf{a}\)</span>. In this way, Hotellings test reduces a multivariate problem to a univariate one. The weights in <span class="math inline">\(\mathbf{a}\)</span> show how the variables contribute to significance: larger absolute values <span class="math inline">\(\vert a_j \vert\)</span> variables have greater impact.</p>
<ul>
<li>
<strong>Eigenvalue</strong> : Hotelling showed that <span class="math inline">\(T^2\)</span> is the one non-zero eigenvalue (latent root) <span class="math inline">\(\lambda\)</span> of the matrix <span class="math inline">\(\mathbf{Q}_H = N (\bar{\mathbf{x}} - \mathbf{\mu}_0)^\mathsf{T}  (\bar{\mathbf{x}} - \mathbf{\mu}_0)\)</span> relative to <span class="math inline">\(\mathbf{Q}_E = \mathbf{S}\)</span>. The “relative to” means that the eigenvalue problem is expressed as finding <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\mathbf{a}\)</span> that solve the equation,</li>
</ul>
<p><span id="eq-eigen"><span class="math display">\[
(\mathbf{Q}_H - \lambda \mathbf{Q}_E) \; \mathbf{a} \; = \; 0 \:\: .
\tag{9.3}\]</span></span></p>
<p>In more complex MANOVA problems, there are more than one non-zero latent roots, <span class="math inline">\(\lambda_1, \lambda_2, \dots \lambda_s\)</span>, and test statistics (Wilks’ <span class="math inline">\(\Lambda\)</span>, Pillai and Hotelling-Lawley trace criteria, Roy’s maximum root test) are functions of these as shown in <a href="#sec-multivar-tests" class="quarto-xref"><span class="quarto-unresolved-ref">sec-multivar-tests</span></a>.</p>
<ul>
<li><p><strong>Eigenvector</strong> : The corresponding eigenvector is <span class="math inline">\(\mathbf{a} = \mathbf{S}^{-1} (\bar{\mathbf{x}} - \mathbf{\mu}_0)\)</span>. These are the (raw) <em>discriminant coefficients</em>, giving the relative contribution of each variable to <span class="math inline">\(T^2\)</span>.</p></li>
<li><p><strong>Critical values</strong> : For a single response, the square of a <span class="math inline">\(t\)</span> statistic with <span class="math inline">\(N-1\)</span> degrees of freedom is an <span class="math inline">\(F (1, N-1)\)</span> statistic. But we chose <span class="math inline">\(\mathbf{a}\)</span> to give the <em>maximum</em> <span class="math inline">\(t^2 (\mathbf{a})\)</span>; this can be taken into account with a transformation of <span class="math inline">\(T^2\)</span> to give an <strong>exact</strong> <span class="math inline">\(F\)</span> test with the correct sampling distribution:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p></li>
</ul>
<p><span id="eq-Fstat"><span class="math display">\[
F^* = \frac{N - p}{p (N-1)} T^2 \; \sim \; F (p, N - p) \:\: .
\tag{9.4}\]</span></span></p>
<ul>
<li>
<strong>Invariance under linear transformation</strong> : Just as a univariate <span class="math inline">\(t\)</span>-test is unchanged if we apply a linear transformation to the variable, <span class="math inline">\(x \rightarrow a x + b\)</span>, so too <span class="math inline">\(T^2\)</span> is invariant under all linear (<em>affine</em>) transformations, multiplying <span class="math inline">\(\mathbf{x}\)</span> by a matrix <span class="math inline">\(\mathbf{A}\)</span> and adding a vector <span class="math inline">\(\mathbf{b}\)</span>,</li>
</ul>
<p><span class="math display">\[
\mathbf{x}_{p \times 1} \rightarrow \mathbf{A}_{p \times p} \; \mathbf{x} + \mathbf{b}_{p \times 1} \:\: .
\]</span></p>
<p>So, with the Penguins data, you would get the same results if you convert flipper lengths, bill length and depth, from millimeters to centimeters or inches. The same is true for all MANOVA tests.</p>
<ul>
<li>
<strong>Two-sample tests</strong> : With minor variations in notation, everything above applies to the more usual test of equality of multivariate means in a two sample test of <span class="math inline">\(\mathcal{H}_0 : \mathbf{\mu}_1 = \mathbf{\mu}_2\)</span>.</li>
</ul>
<p><span id="eq-T2-two-sample"><span class="math display">\[
T^2 = N (\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2)^\mathsf{T} \; \mathbf{S}_p^{-1} \; (\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2) \; ,
\tag{9.5}\]</span></span></p>
<p>where <span class="math inline">\(\mathbf{S}_p\)</span> is the pooled within-sample variance covariance matrix.</p>
<section id="sec-mathscore-example" class="level3" data-number="9.2.1"><h3 data-number="9.2.1" class="anchored" data-anchor-id="sec-mathscore-example">
<span class="header-section-number">9.2.1</span> Example: Mathscore data</h3>
<p>As a running example, I’ll use the data set <code><a href="https://friendly.github.io/heplots/reference/mathscore.html">heplots::mathscore</a></code>, which gives (fictitious) scores on a test of basic math skills (BM) and solving word problems (WP) for two groups of <span class="math inline">\(N=6\)</span> students in an algebra course. Each group was taught by a different instructors, and the questions are: (a) Do the groups differ on both variables, considered jointly? (b) If so, how do they differ?</p>
<p>The null hypothesis is that the means are equal for both variables, <span class="math inline">\(\mathcal{H}_0: \mu_{\text{BM}} = \mu_{\text{WP}}\)</span>, or, equivalently, that the difference between means (a contrast!) is zero: <span class="math inline">\(\mathcal{H}_0: \mu_{\text{BM}} - \mu_{\text{WP}} = \mathbf{0}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">mathscore</span>, package <span class="op">=</span> <span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">)</span></span>
<span><span class="co"># 'data.frame': 12 obs. of  3 variables:</span></span>
<span><span class="co">#  $ group: Factor w/ 2 levels "1","2": 1 1 1 1 1 1 2 2 2 2 ...</span></span>
<span><span class="co">#  $ BM   : int  190 170 180 200 150 180 160 190 150 160 ...</span></span>
<span><span class="co">#  $ WP   : int  90 80 80 120 60 70 120 150 90 130 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can carry out the test that the means for both variables are jointly equal across groups using either <code><a href="https://rdrr.io/pkg/Hotelling/man/hotelling.test.html">Hotelling::hotelling.test()</a></code> <span class="citation" data-cites="R-Hotelling">(<a href="#ref-R-Hotelling" role="doc-biblioref">Curran &amp; Hersh, 2021</a>)</span> or <code><a href="https://rdrr.io/pkg/car/man/Anova.html">car::Anova()</a></code>, but the latter is more generally useful because it applies to <em>any</em> multivariate linear model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Hotelling/man/hotelling.test.html">hotelling.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">BM</span>, <span class="va">WP</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">mathscore</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Test stat:  64.174 </span></span>
<span><span class="co"># Numerator df:  2 </span></span>
<span><span class="co"># Denominator df:  9 </span></span>
<span><span class="co"># P-value:  0.0001213</span></span>
<span></span>
<span><span class="va">math.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">BM</span>, <span class="va">WP</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">mathscore</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">math.mod</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#       Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co"># group  1     0.865     28.9      2      9 0.00012 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What’s wrong with just doing the two <span class="math inline">\(t\)</span>-tests (or equivalent <span class="math inline">\(F\)</span>-test with <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>)? Let’s see.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">BM</span> <span class="op">~</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">mathscore</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Anova Table (Type II tests)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Response: BM</span></span>
<span><span class="co">#           Sum Sq Df F value Pr(&gt;F)  </span></span>
<span><span class="co"># group       1302  1    4.24  0.066 .</span></span>
<span><span class="co"># Residuals   3071 10                 </span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">WP</span> <span class="op">~</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">mathscore</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Anova Table (Type II tests)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Response: WP</span></span>
<span><span class="co">#           Sum Sq Df F value Pr(&gt;F)   </span></span>
<span><span class="co"># group       4408  1    10.4  0.009 **</span></span>
<span><span class="co"># Residuals   4217 10                  </span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From this, we might conclude that the two groups do <em>not</em> differ significantly on Basic Math but strongly differ on Word problems. But this interpretation would be wrong! The two univariate tests do not take the correlation among the mean differences into account. In this case, the means are negatively related across the groups, which heightens the significance test, as we will shortly see (<a href="#fig-mathscore-HE" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-mathscore-HE</span></a>).</p>
<p>If you want to just extract the <span class="math inline">\(t\)</span>-tests, here’s a handy trick using <code><a href="https://broom.tidymodels.org/reference/tidy.mlm.html">broom::tidy.mlm()</a></code>, which summarizes the test statistics for each response and each term in a MLM. The mean difference shown below is that for group 2 - group 1.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">math.mod</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">term</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Mean_diff <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>         t <span class="op">=</span> <span class="va">statistic</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>signif <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span><span class="op">(</span><span class="fu">gtools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gtools/man/stars.pval.html">stars.pval</a></span><span class="op">(</span><span class="va">p.value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 2 × 6</span></span>
<span><span class="co">#   response Mean_diff std.error     t p.value signif   </span></span>
<span><span class="co">#   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;noquote&gt;</span></span>
<span><span class="co"># 1 BM           -20.8      10.1 -2.06 0.0665  .        </span></span>
<span><span class="co"># 2 WP            38.3      11.9  3.23 0.00897 **</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To see the differences between the groups on both variables together, we draw their data (68%) ellipses, using <code><a href="https://friendly.github.io/heplots/reference/covEllipses.html">heplots::covEllipses()</a></code>. (Setting <code>pooled=FALSE</code> here omits drawing the the ellipse for the pooled covariance matrix <span class="math inline">\(\mathbf{S}_p\)</span>.)</p>
<!-- figure-code: R/mathscore/mathscore-figs.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://friendly.github.io/heplots/reference/covEllipses.html">covEllipses</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BM"</span>, <span class="st">"WP"</span><span class="op">)</span><span class="op">]</span>, <span class="va">mathscore</span><span class="op">$</span><span class="va">group</span>,</span>
<span>            pooled <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            col <span class="op">=</span> <span class="va">colors</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            fill.alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            cex <span class="op">=</span> <span class="fl">2</span>, cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>            asp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            xlab<span class="op">=</span><span class="st">"Basic math"</span>, ylab<span class="op">=</span><span class="st">"Word problems"</span><span class="op">)</span></span>
<span><span class="co"># plot points</span></span>
<span><span class="va">pch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="fl">1</span>, <span class="fl">15</span>, <span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="fl">1</span>, <span class="va">colors</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">colors</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch<span class="op">=</span><span class="va">pch</span>, col<span class="op">=</span><span class="va">col</span>, cex<span class="op">=</span><span class="fl">1.25</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mathscore-cov1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mathscore-cov1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch09/fig-mathscore-cov1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mathscore-cov1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.2: Data ellipses for the <code>mathscore</code> data, enclosing approximately 68% of the observations in each group.
</figcaption></figure>
</div>
</div>
</div>
<p>In <a href="#fig-mathscore-cov1" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-mathscore-cov1</span></a> you can see that:</p>
<ul>
<li>Group 1 &gt; Group 2 on Basic Math, but worse on Word Problems</li>
<li>Group 2 &gt; Group 1 on Word Problems, but worse on Basic Math</li>
<li>Within each group, those who do better on Basic Math also do better on Word Problems</li>
</ul>
<p>We can also see why the univariate test, at least for Basic math is non-significant: the scores for the two groups overlap considerably on the horizontal axis. They are slightly better separated along the vertical axis for word problems. The plot also reveals why Hotelling’s <span class="math inline">\(T^2\)</span> reveals such a strongly significant result: the two groups are very widely separated along an approximately 45<span class="math inline">\(^o\)</span> line between them.</p>
<p>A relatively simple interpretation is that the groups don’t really differ in overall math ability, but perhaps the instructor in Group 1 put more focus on basic math skills, while the instructor for Group 2 placed greater emphasis on solving word problems.</p>
<p>In Hotelling’s <span class="math inline">\(T^2\)</span>, the “size” of the difference between the means (labeled “1” and “2”) is assessed relative to the pooled within-group covariance matrix <span class="math inline">\(\mathbf{S}_p\)</span>, which is just a size-weighted average of the two within-sample matrices, <span class="math inline">\(\mathbf{S}_1\)</span> and <span class="math inline">\(\mathbf{S}_2\)</span>,</p>
<p><span class="math display">\[
\mathbf{S}_p = [ (n_1 - 1) \mathbf{S}_1 + (n_2 - 1) \mathbf{S}_2 ] / (n_1 + n_2 - 2) \:\: .
\]</span></p>
<p>Visually, imagine sliding the the separate data ellipses to the grand mean, <span class="math inline">\((\bar{x}_{\text{BM}}, \bar{x}_{\text{WP}})\)</span> and finding their combined data ellipse. This is just the data ellipse of the sample of deviations of the scores from their group means, or that of the residuals from the model <code>lm(cbind(BM, WP) ~ group, data=mathscore)</code></p>
<p>To see this, we plot <span class="math inline">\(\mathbf{S}_1\)</span>, <span class="math inline">\(\mathbf{S}_2\)</span> and <span class="math inline">\(\mathbf{S}_p\)</span> together,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/covEllipses.html">covEllipses</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BM"</span>, <span class="st">"WP"</span><span class="op">)</span><span class="op">]</span>, <span class="va">mathscore</span><span class="op">$</span><span class="va">group</span>,</span>
<span>            col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">colors</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>            fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>            fill.alpha <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>            cex <span class="op">=</span> <span class="fl">2</span>, cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>            asp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            xlab<span class="op">=</span><span class="st">"Basic math"</span>, ylab<span class="op">=</span><span class="st">"Word problems"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mathscore-cov2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mathscore-cov2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch09/fig-mathscore-cov2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mathscore-cov2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.3: Data ellipses and the pooled covariance matrix <code>mathscore</code> data.
</figcaption></figure>
</div>
</div>
</div>
<p>One of the assumptions of the <span class="math inline">\(T^2\)</span> test (and of MANOVA) is that the within-group variance covariance matrices, <span class="math inline">\(\mathbf{S}_1\)</span> and <span class="math inline">\(\mathbf{S}_2\)</span>, are the same. In <a href="#fig-mathscore-cov2" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-mathscore-cov2</span></a>, you can see how the shapes of <span class="math inline">\(\mathbf{S}_1\)</span> and <span class="math inline">\(\mathbf{S}_2\)</span> are very similar, differing in that the variance of word Problems is slightly greater for group 2. In Chapter XX we take of the topic of visualizing tests of this assumption, based on Box’s <span class="math inline">\(M\)</span>-test.</p>
</section></section><section id="sec-t2-heplot" class="level2" data-number="9.3"><h2 data-number="9.3" class="anchored" data-anchor-id="sec-t2-heplot">
<span class="header-section-number">9.3</span> HE plot and discriminant axis</h2>
<p>As we describe in detail in <a href="#sec-vis-mlm" class="quarto-xref"><span class="quarto-unresolved-ref">sec-vis-mlm</span></a>, all the information relevant to the <span class="math inline">\(T^2\)</span> test and MANOVA can be captured in the remarkably simple <em>Hypothesis Error</em> plot, which shows the relative size of two data ellipses,</p>
<ul>
<li>
<span class="math inline">\(\mathbf{H}\)</span>: the data ellipse of the <em>fitted</em> values, which are just the group means on the two variables, <span class="math inline">\(\bar{\mathbf{x}}\)</span>, corresponding to <span class="math inline">\(\mathbf{Q}_H\)</span> in <a href="#eq-eigen" class="quarto-xref">Equation&nbsp;<span class="quarto-unresolved-ref">eq-eigen</span></a>. In case of <span class="math inline">\(T^2\)</span>, the <span class="math inline">\(\mathbf{H}\)</span> matrix is of rank 1, so the “ellipse” plots as a line.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># calculate H directly</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">math.mod</span><span class="op">)</span></span>
<span><span class="va">xbar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">N</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">xbar</span>, <span class="va">xbar</span><span class="op">)</span></span>
<span><span class="co">#       BM    WP</span></span>
<span><span class="co"># BM  1302 -2396</span></span>
<span><span class="co"># WP -2396  4408</span></span>
<span></span>
<span><span class="co"># same as: SSP for group effect from Anova</span></span>
<span><span class="va">math.aov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">math.mod</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">H</span> <span class="op">&lt;-</span> <span class="va">math.aov</span><span class="op">$</span><span class="va">SSP</span><span class="op">)</span></span>
<span><span class="co"># $group</span></span>
<span><span class="co">#       BM    WP</span></span>
<span><span class="co"># BM  1302 -2396</span></span>
<span><span class="co"># WP -2396  4408</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<span class="math inline">\(\mathbf{E}\)</span>: the data ellipse of the <em>residuals</em>, the deviations of the scores from the group means, <span class="math inline">\(\mathbf{x} - \bar{\mathbf{x}}\)</span>, corresponding to <span class="math inline">\(\mathbf{Q}_E\)</span>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># calculate E directly</span></span>
<span><span class="va">resids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">math.mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span><span class="op">(</span><span class="va">resids</span><span class="op">)</span></span>
<span><span class="co">#      BM   WP</span></span>
<span><span class="co"># BM 3071 2808</span></span>
<span><span class="co"># WP 2808 4217</span></span>
<span></span>
<span><span class="co"># same as: SSPE from Anova</span></span>
<span><span class="op">(</span><span class="va">E</span> <span class="op">&lt;-</span> <span class="va">math.aov</span><span class="op">$</span><span class="va">SSPE</span><span class="op">)</span></span>
<span><span class="co">#      BM   WP</span></span>
<span><span class="co"># BM 3071 2808</span></span>
<span><span class="co"># WP 2808 4217</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-heplot-function" class="level3" data-number="9.3.1"><h3 data-number="9.3.1" class="anchored" data-anchor-id="the-heplot-function">
<span class="header-section-number">9.3.1</span> The <code>heplot()</code> function</h3>
<p>The function <code><a href="https://friendly.github.io/heplots/reference/heplot.html">heplots::heplot()</a></code> takes the model object, extracts the <span class="math inline">\(\mathbf{H}\)</span> and <span class="math inline">\(\mathbf{E}\)</span> matrices (from <code>summary(Anova(math.mod))</code>) and plots them as their data ellipses. There are many options to control the details. See <code><a href="https://friendly.github.io/heplots/reference/heplot.html">help(heplot)</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/heplot.html">heplot</a></span><span class="op">(</span><span class="va">math.mod</span>, </span>
<span>       fill<span class="op">=</span><span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3</span>,</span>
<span>       asp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       cex<span class="op">=</span><span class="fl">2</span>, cex.lab<span class="op">=</span><span class="fl">1.8</span>,</span>
<span>       xlab<span class="op">=</span><span class="st">"Basic math"</span>, ylab<span class="op">=</span><span class="st">"Word problems"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mathscore-HE" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mathscore-HE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch09/fig-mathscore-HE-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mathscore-HE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.4: Hypothesis error plot of the <code>mathscore</code> data. The line through the group means is the H ellipse, which plots as a line here. The <span style="color: red;">red</span> ellipse labeled ‘Error’ represents the pooled within-group covariance matrix.
</figcaption></figure>
</div>
</div>
</div>
<p>But the HE plot offers more:</p>
<ul>
<li><p>A visual test of significance: the <span class="math inline">\(\mathbf{H}\)</span> ellipse is scaled so that it projects <em>anywhere</em> outside the <span class="math inline">\(\mathbf{E}\)</span> ellipse, if and only if the test is significant at a given <span class="math inline">\(\alpha\)</span> level (<span class="math inline">\(\alpha = 0.05\)</span> by default)</p></li>
<li><p>The <span class="math inline">\(\mathbf{H}\)</span> ellipse, which appears as a line, goes through the means of the two groups. This is also the <em>discriminant axis</em>, the direction in the space of the variables which maximally discriminates between the groups. That is, if we project the data points onto this line, we get the linear combination <span class="math inline">\(w\)</span> which has the maximum possible univariate <span class="math inline">\(t^2\)</span>.</p></li>
</ul></section><section id="he-plot-data-ellipses-and-discriminant-axis" class="level3" data-number="9.3.2"><h3 data-number="9.3.2" class="anchored" data-anchor-id="he-plot-data-ellipses-and-discriminant-axis">
<span class="header-section-number">9.3.2</span> HE plot, data ellipses and discriminant axis</h3>
<p>You can see how the HE plot relates to the plots of the separate data ellipses by overlaying them in a single figure. In <a href="#fig-mathscore-HE-overlay" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-mathscore-HE-overlay</span></a> below I also plot the scores on the discriminant axis, by using this small function <code>project_on()</code> to find the orthogonal projection of a point <span class="math inline">\(\mathbf{a}\)</span> on the line joining two points, <span class="math inline">\(\mathbf{p}_1\)</span> and <span class="math inline">\(\mathbf{p}_2\)</span>, which in math is <span class="math inline">\(\mathbf{p}_1 + \frac{\mathbf{d}^\mathsf{T} (\mathbf{a} - \mathbf{p}_1)} {\mathbf{d}^\mathsf{T} \mathbf{d}}\)</span>, letting <span class="math inline">\(\mathbf{d} = \mathbf{p}_1 - \mathbf{p}_2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="va">y</span><span class="op">)</span>       <span class="co"># dot product of two vectors</span></span>
<span><span class="va">project_on</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span>  <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span>  <span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span>
<span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu">dot</span><span class="op">(</span><span class="va">p2</span><span class="op">-</span><span class="va">p1</span>, <span class="va">a</span><span class="op">-</span><span class="va">p1</span><span class="op">)</span> <span class="op">/</span> <span class="fu">dot</span><span class="op">(</span><span class="va">p2</span><span class="op">-</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">-</span><span class="va">p1</span><span class="op">)</span></span>
<span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">t</span><span class="op">*</span><span class="op">(</span><span class="va">p2</span><span class="op">-</span><span class="va">p1</span><span class="op">)</span></span>
<span>  <span class="va">C</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, I run the same code as before (for <a href="#fig-mathscore-cov2" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-mathscore-cov2</span></a>) to plot the data ellipses, and follow this with a call to <code><a href="https://friendly.github.io/heplots/reference/heplot.html">heplot()</a></code> using the option <code>add=TRUE</code> which adds to an existing plot. Following this, I find the group means and draw lines projecting the points on the line between them.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/covEllipses.html">covEllipses</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BM"</span>, <span class="st">"WP"</span><span class="op">)</span><span class="op">]</span>, <span class="va">mathscore</span><span class="op">$</span><span class="va">group</span>,</span>
<span>            pooled<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>            col <span class="op">=</span> <span class="va">colors</span>,</span>
<span>            cex<span class="op">=</span><span class="fl">2</span>, cex.lab<span class="op">=</span><span class="fl">1.5</span>,</span>
<span>            asp<span class="op">=</span><span class="fl">1</span>, </span>
<span>            xlab<span class="op">=</span><span class="st">"Basic math"</span>, ylab<span class="op">=</span><span class="st">"Word problems"</span></span>
<span>            <span class="op">)</span></span>
<span><span class="va">pch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="fl">1</span>, <span class="fl">15</span>, <span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="fl">1</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch<span class="op">=</span><span class="va">pch</span>, col<span class="op">=</span><span class="va">col</span>, cex<span class="op">=</span><span class="fl">1.25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># overlay with HEplot (add = TRUE)</span></span>
<span><span class="fu"><a href="https://friendly.github.io/heplots/reference/heplot.html">heplot</a></span><span class="op">(</span><span class="va">math.mod</span>, </span>
<span>       fill<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>       cex<span class="op">=</span><span class="fl">2</span>, cex.lab<span class="op">=</span><span class="fl">1.8</span>, </span>
<span>       fill.alpha<span class="op">=</span><span class="fl">0.2</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>       add <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>       error.ellipse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find group means</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="va">mathscore</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>BM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">BM</span><span class="op">)</span>, WP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">WP</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gp</span> <span class="op">&lt;-</span> <span class="va">mathscore</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">pt</span> <span class="op">&lt;-</span> <span class="fu">project_on</span><span class="op">(</span> <span class="va">mathscore</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">means</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">means</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">[</span><span class="va">i</span>, <span class="st">"BM"</span><span class="op">]</span>, <span class="va">mathscore</span><span class="op">[</span><span class="va">i</span>, <span class="st">"WP"</span><span class="op">]</span>, <span class="va">pt</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">pt</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mathscore-HE-overlay" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mathscore-HE-overlay-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch09/fig-mathscore-HE-overlay-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mathscore-HE-overlay-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.5: HE plot overlaid on top of the within-group data ellipses, with lines showing the projection of each point on the line joining the means, which is the discriminant axis.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-t2-discrim" class="level2" data-number="9.4"><h2 data-number="9.4" class="anchored" data-anchor-id="sec-t2-discrim">
<span class="header-section-number">9.4</span> Discriminant analysis</h2>
<p>Discriminant analysis for two-group designs or for one-way MANOVA essentially turns the problem around: Instead of asking whether the mean vectors for two or more groups are equal, discriminant analysis tries to find the linear combination <span class="math inline">\(w\)</span> of the response variables that has the greatest separation among the groups, allowing cases to be best classified.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<!--
It was developed by @Fisher:1936 as a solution to the biological taxonomy problem
of developing a rule to classify instances of flowers---in his famous case, Iris flowers---into known species (_I. setosa_, _I. versicolor_, _I. virginica_) on the basis of multiple measurements
(length and width of their sepals and petals).
-->
<p>For the <code>mathscore</code> data, you can perform the discriminant analysis as follows, using the <span style="color: brown;"><strong>MASS</strong></span> function <code>lda()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">math.lda</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html">lda</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">.</span>, data<span class="op">=</span><span class="va">mathscore</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># lda(group ~ ., data = mathscore)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Prior probabilities of groups:</span></span>
<span><span class="co">#   1   2 </span></span>
<span><span class="co"># 0.5 0.5 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Group means:</span></span>
<span><span class="co">#    BM    WP</span></span>
<span><span class="co"># 1 178  83.3</span></span>
<span><span class="co"># 2 158 121.7</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Coefficients of linear discriminants:</span></span>
<span><span class="co">#        LD1</span></span>
<span><span class="co"># BM -0.0835</span></span>
<span><span class="co"># WP  0.0753</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The coefficients give <span class="math inline">\(w = -0.084 \;\text{BM} + 0.075 \;\text{WP}\)</span>. This is exactly the direction given by the line for the <span class="math inline">\(\mathbf{H}\)</span> ellipse in <a href="#fig-mathscore-HE-overlay" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-mathscore-HE-overlay</span></a>.</p>
<p>To round this out, we can calculate the discriminant scores by multiplying the matrix <span class="math inline">\(\mathbf{X}\)</span> by the vector <span class="math inline">\(\mathbf{a} = \mathbf{S}^{-1} (\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2)\)</span> of the discriminant weights, given by the <code>scaling</code> component of the result of <code>lda()</code>. These were shown in <a href="#fig-mathscore-HE-overlay" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-mathscore-HE-overlay</span></a> as the projections of the data points on the line joining the group means,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">math.lda</span><span class="op">$</span><span class="va">scaling</span></span>
<span><span class="co">#        LD1</span></span>
<span><span class="co"># BM -0.0835</span></span>
<span><span class="co"># WP  0.0753</span></span>
<span></span>
<span><span class="va">LD1_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">mathscore</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">math.lda</span><span class="op">$</span><span class="va">scaling</span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">mathscore</span><span class="op">$</span><span class="va">group</span>,</span>
<span>                LD1 <span class="op">=</span> <span class="va">LD1_scores</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">scores</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 6 × 2</span></span>
<span><span class="co"># # Groups:   group [2]</span></span>
<span><span class="co">#   group   LD1</span></span>
<span><span class="co">#   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co"># 1     1 -9.09</span></span>
<span><span class="co"># 2     1 -8.17</span></span>
<span><span class="co"># 3     1 -9.01</span></span>
<span><span class="co"># 4     2 -4.33</span></span>
<span><span class="co"># 5     2 -4.58</span></span>
<span><span class="co"># 6     2 -5.75</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then a <span class="math inline">\(t\)</span>-test on these scores gives the same value as Hotelling’s <span class="math inline">\(T\)</span>; it is accessed via the <code>statistic</code> component of <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">LD1</span> <span class="op">~</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">scores</span><span class="op">)</span><span class="op">$</span><span class="va">statistic</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">t</span>, T2 <span class="op">=</span><span class="va">t</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#     t  T2.t </span></span>
<span><span class="co"># -8.01 64.17</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, it is instructive to compare violin plots for the three measures, <code>BM</code>, <code>WP</code> and <code>LD1</code>. To do this with <code>ggplot2</code> requires reshaping the data from wide to long format so the plots can be faceted.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="va">mathscore</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span>LD1 <span class="op">=</span> <span class="va">scores</span><span class="op">[</span>, <span class="st">"LD1"</span><span class="op">]</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">scores</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"measure"</span>, value <span class="op">=</span><span class="st">"Score"</span>, <span class="va">BM</span><span class="op">:</span><span class="va">LD1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">measure</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BM"</span>, <span class="st">"WP"</span>, <span class="st">"LD1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">Score</span>, color <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.2</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">measure</span>, scales <span class="op">=</span> <span class="st">"free"</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mathscore-violins" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mathscore-violins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch09/fig-mathscore-violins-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mathscore-violins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.6: Violin plots comparing group 1 and 2 for the two observed measures and the linear discriminant score.
</figcaption></figure>
</div>
</div>
</div>
<p>You can readily see how well the groups are separated on the discriminant axes, relative to the two individual variables—the groups are much further apart in on the discriminant axis.</p>
</section><section id="sec-t2-more-variables" class="level2" data-number="9.5"><h2 data-number="9.5" class="anchored" data-anchor-id="sec-t2-more-variables">
<span class="header-section-number">9.5</span> More variables</h2>
<p>The <code>mathscore</code> data gave a simple example with two outcomes to explain the essential ideas behind Hotelling’s <span class="math inline">\(T^2\)</span> and multivariate tests. Multivariate methods become increasingly useful as the number of response variables increases because it is harder to show them all together and see how they relate to differences between groups.</p>
<div id="exm-banknote" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.1</strong></span> <strong>Real and fake banknotes</strong></p>
<p>A classic example is the dataset <code><a href="https://mclust-org.github.io/mclust/reference/banknote.html">mclust::banknote</a></code>, containing six size measures made on 100 genuine and 100 counterfeit old-Swiss 1000-franc bank notes <span class="citation" data-cites="FluryReidwyl-1988">(<a href="#ref-FluryReidwyl-1988" role="doc-biblioref">Flury &amp; Riedwyl, 1988</a>)</span>. The goal is to see how well the real and fake banknotes can be distinguished. The measures are the <code>Length</code> and <code>Diagonal</code> lengths of a banknote and the <code>Left</code>, <code>Right</code>, <code>Top</code> and <code>Bottom</code> edge margins in mm.</p>
<p>Before considering hypothesis tests, let’s look at some exploratory graphics. <a href="#fig-banknote-violin" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-banknote-violin</span></a> shows univariate violin and boxplots of each of the measures. To make this plot, faceted by measure, I first reshape the data from wide to long and make <code>measure</code> a factor with levels in the order of the variables in the data set.</p>
<!-- figure-code: R/banknote.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">banknote</span>, package<span class="op">=</span> <span class="st">"mclust"</span><span class="op">)</span></span>
<span><span class="va">banknote</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"measure"</span>, </span>
<span>                value <span class="op">=</span> <span class="st">"Size"</span>, </span>
<span>                <span class="va">Length</span><span class="op">:</span><span class="va">Diagonal</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">measure</span>, </span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Status</span>, y <span class="op">=</span> <span class="va">Size</span>, color <span class="op">=</span> <span class="va">Status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Status</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>           <span class="co"># (1)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.2</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span>                    <span class="co"># (2)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.25</span>,                               <span class="co"># (3)</span></span>
<span>               linewidth <span class="op">=</span> <span class="fl">1.1</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>               alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Size (mm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">measure</span>, scales <span class="op">=</span> <span class="st">"free"</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-banknote-violin" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-banknote-violin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch09/fig-banknote-violin-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-banknote-violin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.7: Overlaid violin and boxplots of the banknote variables. The violin plots give a sense of the shapes of the distributions, while the boxplots highlight the center and spread.
</figcaption></figure>
</div>
</div>
</div>
<p>A quick glance at <a href="#fig-banknote-violin" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-banknote-violin</span></a> shows that the counterfeit and genuine bills differ in their means on most of the measures, with the counterfeit ones slightly larger on Left, Right, Bottom and Top margins. But univariate plots don’t give an overall sense of how these variables are related to one another.</p>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="**Graph craft**: Layers and transparency">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Graph craft</strong>: Layers and transparency
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#fig-banknote-violin" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-banknote-violin</span></a> is somewhat complex, so it is useful to understand the steps needed to make this figure show what I wanted. The plot in each panel contains three layers noted by comments in the code:</p>
<ol type="1">
<li>the violin plot based on a density estimate, showing the shape of each distribution;</li>
<li>the data points, but they are jittered horizontally using <code>geom_jiter()</code> because otherwise they would all overlap on the X axis;</li>
<li>the boxplot, showing the center (median) and spread (IQR) of each distribution.</li>
</ol>
<p>In composing graphs with layers, plotting <em>order matters</em>, and also does the <code>alpha</code> transparency, because each layer adds data ink on top of earlier ones. I plotted these in the order shown because I wanted the violin plot to provide the background, and the boxplot to show a simple univariate summary, not obscured by the other layers. The <code>alpha</code> values allow the data ink to be blended for each layer, and in this case, <code>alpha = 0.5</code> for the boxplot let the earlier layers show through.</p>
</div>
</div>
<section id="sec-t2-biplot" class="level3" data-number="9.5.1"><h3 data-number="9.5.1" class="anchored" data-anchor-id="sec-t2-biplot">
<span class="header-section-number">9.5.1</span> Biplots</h3>
<p>Multivariate relations among these six variables could be explored in data space using scatterplots or other methods, but I turn to my trusty multivariate juicer, a PCA and biplot, to give a 2D summary. This differs from the analysis above in that it does not take the <code>Status</code> grouping into account.</p>
<p>Two dimensions account for 70% of the total variance of all the banknotes, while three would give 85%.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">banknote.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">banknote.pca</span><span class="op">)</span></span>
<span><span class="co"># Importance of components:</span></span>
<span><span class="co">#                          PC1   PC2   PC3   PC4    PC5    PC6</span></span>
<span><span class="co"># Standard deviation     1.716 1.131 0.932 0.671 0.5183 0.4346</span></span>
<span><span class="co"># Proportion of Variance 0.491 0.213 0.145 0.075 0.0448 0.0315</span></span>
<span><span class="co"># Cumulative Proportion  0.491 0.704 0.849 0.924 0.9685 1.0000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The biplot in <a href="#fig-banknote-biplot" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-banknote-biplot</span></a> gives a nicely coherent overview, at least in two dimensions. The first component shows the positive correlations among the measures of the margins, where the counterfeit bills are larger than the real ones and a negative correlation of the Diagonal with the other measures. The length of bills only distinguishes the types of banknotes on the second dimension.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">banknote.pca</span> <span class="op">&lt;-</span> <span class="fu">ggbiplot</span><span class="fu">::</span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/reflect.html">reflect</a></span><span class="op">(</span><span class="va">banknote.pca</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggbiplot.html">ggbiplot</a></span><span class="op">(</span><span class="va">banknote.pca</span>,</span>
<span>   obs.scale <span class="op">=</span> <span class="fl">1</span>, var.scale <span class="op">=</span> <span class="fl">1</span>,</span>
<span>   groups <span class="op">=</span> <span class="va">banknote</span><span class="op">$</span><span class="va">Status</span>,</span>
<span>   ellipse <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>   ellipse.level <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>   ellipse.alpha <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>   ellipse.linewidth <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   varname.size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>   varname.color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Status"</span>, </span>
<span>       color <span class="op">=</span> <span class="st">"Status"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-banknote-biplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-banknote-biplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch09/fig-banknote-biplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-banknote-biplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.8: Biplot of the banknote variables, showing how the size measurements are related to each other. The points and data ellipses for the component scores are colored by Status, showing how the counterfeit and genuine bills are distinguished by these measures.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="testing-mean-differences" class="level3" data-number="9.5.2"><h3 data-number="9.5.2" class="anchored" data-anchor-id="testing-mean-differences">
<span class="header-section-number">9.5.2</span> Testing mean differences</h3>
<p>As noted above, Hotelling’s <span class="math inline">\(T^2\)</span> is equivalent to a one-way MANOVA, fitting the size measures to the <code>Status</code> of the banknotes. <code><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova()</a></code> reports only the <span class="math inline">\(F\)</span>-statistic based on Pillai’s trace criterion.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">banknote.mlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Length</span>, <span class="va">Left</span>, <span class="va">Right</span>, <span class="va">Bottom</span>, <span class="va">Top</span>, <span class="va">Diagonal</span><span class="op">)</span> <span class="op">~</span> <span class="va">Status</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">banknote</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">banknote.mlm</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#        Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co"># Status  1     0.924      392      6    193 &lt;2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can see <em>all</em> the multivariate test statistics with the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method for <code>"Anova.mlm"</code> objects. With two groups, and hence a 1 df test, these all translate into identical <span class="math inline">\(F\)</span>-statistics.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">banknote.mlm</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Type II MANOVA Tests:</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ------------------------------------------</span></span>
<span><span class="co">#  </span></span>
<span><span class="co"># Term: Status </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Multivariate Tests: Status</span></span>
<span><span class="co">#                  Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co"># Pillai            1      0.92      392      6    193 &lt;2e-16 ***</span></span>
<span><span class="co"># Wilks             1      0.08      392      6    193 &lt;2e-16 ***</span></span>
<span><span class="co"># Hotelling-Lawley  1     12.18      392      6    193 &lt;2e-16 ***</span></span>
<span><span class="co"># Roy               1     12.18      392      6    193 &lt;2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you wish, you can extract the univariate <span class="math inline">\(t\)</span>-tests or equivalent <span class="math inline">\(F = t^2\)</span> statistics from the <code>"mlm"</code> object using <code><a href="https://broom.tidymodels.org/reference/tidy.mlm.html">broom::tidy.mlm()</a></code>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> What is given as the <code>estimate</code> is the difference in the mean for the genuine banknotes relative to the counterfeit ones.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">banknote.mlm</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">term</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">statistic</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>F <span class="op">=</span> <span class="va">t</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="cn">F</span>, .after <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 6 × 6</span></span>
<span><span class="co">#   response estimate std.error      t      F  p.value</span></span>
<span><span class="co">#   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co"># 1 Length      0.146    0.0524   2.79   7.77 5.82e- 3</span></span>
<span><span class="co"># 2 Left       -0.357    0.0445  -8.03  64.5  8.50e-14</span></span>
<span><span class="co"># 3 Right      -0.473    0.0464 -10.2  104.   6.84e-20</span></span>
<span><span class="co"># 4 Bottom     -2.22     0.130  -17.1  292.   7.78e-41</span></span>
<span><span class="co"># 5 Top        -0.965    0.0909 -10.6  113.   3.85e-21</span></span>
<span><span class="co"># 6 Diagonal    2.07     0.0715  28.9  836.   5.35e-73</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The individual <span class="math inline">\(F_{(1, 198)}\)</span> statistics can be compared to the <span class="math inline">\(F_{(6, 193)} = 392\)</span> value for the overall multivariate test. While all of the individual tests are highly significant, the average of the univariate <span class="math inline">\(F\)</span>s is only 236. The multivariate test gains power by taking the correlations of the size measures into account.</p>
</section></section><section id="variance-accounted-for-eta2" class="level2" data-number="9.6"><h2 data-number="9.6" class="anchored" data-anchor-id="variance-accounted-for-eta2">
<span class="header-section-number">9.6</span> Variance accounted for: <span class="math inline">\(\eta^2\)</span>
</h2>
<p>In a univariate multiple regression model, the <em>coefficient of determination</em> <span class="math inline">\(R^2 = \text{SS}_H / \text{SS}_\text{Total}\)</span> gives the proportion of variance accounted for by hypothesized terms in <span class="math inline">\(H\)</span> relative to the total variance. An analog for ANOVA-type models with categorical, group factors as predictors is <span class="math inline">\(\eta^2\)</span> <span class="citation" data-cites="Pearson-1903">(<a href="#ref-Pearson-1903" role="doc-biblioref">Pearson, 1903</a>)</span>, defined as:</p>
<p><span class="math display">\[
\eta^2 = \frac{\text{SS}_\text{Between groups}}{\text{SS}_\text{Total}} \:\: .
\]</span></p>
<p>For multivariate response models, the generalization of <span class="math inline">\(\eta^2\)</span> uses multivariate analogs of these sums of squares, <span class="math inline">\(\mathbf{Q}_H\)</span> and <span class="math inline">\(\mathbf{Q}_T = \mathbf{Q}_H + \mathbf{Q}_E\)</span>. In larger designs, there are different calculations for a single measure corresponding to the various test statistics (Wilks’ <span class="math inline">\(\Lambda\)</span>, etc.), as described in <a href="#sec-mlm-review" class="quarto-xref"><span class="quarto-unresolved-ref">sec-mlm-review</span></a>.</p>
<p>Let’s calculate the <span class="math inline">\(\eta^2\)</span> for the multivariate model <code>banknote.mlm</code> with <code>Status</code> as the only predictor. The function <code><a href="https://friendly.github.io/heplots/reference/etasq.html">heplots::etasq()</a></code> gives <span class="math inline">\(\eta^2 = 0.92\)</span>, or 92% of the total variance.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">heplots</span><span class="fu">::</span><span class="fu"><a href="https://friendly.github.io/heplots/reference/etasq.html">etasq</a></span><span class="op">(</span><span class="va">banknote.mlm</span><span class="op">)</span></span>
<span><span class="co">#        eta^2</span></span>
<span><span class="co"># Status 0.924</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This can be compared to the principal components analysis and the biplot in <a href="#fig-banknote-biplot" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-banknote-biplot</span></a>, where two components (less favorably) accounted for 70% of total variance and it took four PCA dimensions to account for over 90%.</p>
<p>The goals of PCA and MANOVA are different, of course, but they are both concerned with accounting for variance of multivariate data. We will meet another multivariate juicer, <strong>canonical discriminant analysis</strong> in <a href="#sec-vis-mlm" class="quarto-xref"><span class="quarto-unresolved-ref">sec-vis-mlm</span></a>.</p>
<!-- ## Canonical analysis -->
</section><section id="the-grand-scheme" class="level2" data-number="9.7"><h2 data-number="9.7" class="anchored" data-anchor-id="the-grand-scheme">
<span class="header-section-number">9.7</span> The Grand Scheme</h2>
<!-- **TODO**: ~~Combine with `summary/Ch09-summary.qmd ~~ -->
<!--
This chapter was designed to illustrate the main ideas for visualizing differences between
means on multiple response variables in a two-group design.
Hotelling's $T^2$ is the generalization of a simple univariate $t$-test and
works by combining the responses into a weighted sum that has the maximum possible
univariate $t$ for all choices of weights.
-->
<p><a href="#fig-HE-framework" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-HE-framework</span></a> summarizes what was shown in <a href="#sec-t2-heplot" class="quarto-xref"><span class="quarto-unresolved-ref">sec-t2-heplot</span></a> and <a href="#sec-t2-discrim" class="quarto-xref"><span class="quarto-unresolved-ref">sec-t2-discrim</span></a>. The data ellipses for the two groups in the <code>mathscore</code> data summarize the information about means and within-group variances. In the HE plot, the difference between the means is itself summarized by the line through them, which represents the <span class="math inline">\(\mathbf{H} =\mathbf{Q}_H\)</span> matrix and within-group variation is represented by the “Error” ellipse which is the <span class="math inline">\(\mathbf{E} = \mathbf{S}_p = \mathbf{Q}_E\)</span> matrix.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-HE-framework" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-HE-framework-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/HE-framework.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-HE-framework-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.9: The Hypothesis Error plot framework for a two-group design. Above: Data ellipses can be summarized in an HE plot showing the pooled within-group error (<span class="math inline">\(\mathbf{E}\)</span>) ellipse and the <span class="math inline">\(\mathbf{H}\)</span> ‘ellipse’ for the group means. Below: Observations projected on the line joining the means give discriminant scores which correpond to a one-dimensional canonical space, represented by a boxplot of their scores and arrows reflecting the variable weights.
</figcaption></figure>
</div>
</div>
</div>
<p>As we will see later (<a href="#sec-vis-mlm" class="quarto-xref"><span class="quarto-unresolved-ref">sec-vis-mlm</span></a>), the <span class="math inline">\(\mathbf{H}\)</span> ellipse is scaled so that it provides a visual test of significance: it projects somewhere outside the <span class="math inline">\(\mathbf{E}\)</span> ellipse if and only if the means differ significantly.</p>
<p>The direction of the line between the means is also the <em>discriminant axis</em>. Scores on this axis are shown in <a href="#fig-HE-framework" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-HE-framework</span></a> as the projection of the points on the line joining the group means. These are the weighted sum of the responses that have the greatest possible mean difference. A plot of these scores using boxplots, together with vectors for the variable weights is shown in the bottom right in <a href="#fig-HE-framework" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-HE-framework</span></a>. I call this “Canonical space”, described more generally in <a href="#sec-candisc" class="quarto-xref"><span class="quarto-unresolved-ref">sec-candisc</span></a>.</p>
</section><section id="what-have-we-learned" class="level2" data-number="9.8"><h2 data-number="9.8" class="anchored" data-anchor-id="what-have-we-learned">
<span class="header-section-number">9.8</span> What have we learned?</h2>
<p>This chapter introduced Hotelling’s <span class="math inline">\(T^2\)</span> as the gateway to understanding multivariate analysis of variance and the HE plot framework for visualizing multivariate tests. Here are the essential takeaways:</p>
<ul>
<li><p><strong>Hotelling’s <span class="math inline">\(T^2\)</span> transforms multivariate complexity into univariate clarity</strong>. Rather than running separate <span class="math inline">\(t\)</span>-tests on each variable (with multiple comparison problems), <span class="math inline">\(T^2\)</span> finds the single linear combination of variables that maximally separates the groups. This elegant approach reduces a <span class="math inline">\(p\)</span>-dimensional problem to testing differences on one optimally-weighted composite variable.</p></li>
<li><p><strong>The geometric interpretation reveals the statistical essence</strong>. <span class="math inline">\(T^2\)</span> is simply the squared Mahalanobis distance between group means, scaled by sample size. This geometric view helps us understand why <span class="math inline">\(T^2\)</span> can detect significant differences even when individual variables show weak or non-significant effects —the groups may be well-separated along some direction in the <span class="math inline">\(p\)</span>-dimensional multivariate space.</p></li>
<li><p><strong>HE plots provide visual hypothesis testing</strong>. The key insight is that all information needed for multivariate tests can be captured in two data ellipses: the <span class="math inline">\(\mathbf{H}\)</span> ellipse (representing group differences) and the <span class="math inline">\(\mathbf{E}\)</span> ellipse (representing within-group variation). When the <span class="math inline">\(\mathbf{H}\)</span> ellipse projects outside the <span class="math inline">\(\mathbf{E}\)</span> ellipse, the test is significant—making statistical significance immediately visible.</p></li>
<li><p><strong>The discriminant axis is the line of maximum separation</strong>. The direction connecting group means in an HE plot is the axis that achieves the maximum possible univariate <span class="math inline">\(t^2\)</span>. This direction shows exactly how the variables combine to best distinguish between groups, providing both statistical power and interpretive insight.</p></li>
<li><p><strong>Multivariate tests gain power through correlation structure</strong>. While individual variables might show modest effects, the multivariate test leverages the correlations among variables to accumulate evidence. As we saw with the banknote data, the average univariate F was 236, but the multivariate F reached 392 by exploiting the relationships among the six size measures.</p></li>
<li><p><strong>This framework scales directly to more complex designs</strong>. Though we focused on two-group comparisons, the HE plot approach extends naturally to full MANOVA and regression designs with multiple factors and interactions. The visual principles remain the same: hypothesis effects as ellipses, error as ellipses, and significance determined by their relative sizes and positions.</p></li>
</ul></section><section id="exercises" class="level2" data-number="9.9"><h2 data-number="9.9" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">9.9</span> Exercises</h2>
<div id="exr-hotel1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 9.1</strong></span> The value of Hotelling’s <span class="math inline">\(T^2\)</span> found by <code><a href="https://rdrr.io/pkg/Hotelling/man/hotelling.test.html">hotelling.test()</a></code> is 64.17. The value of the equivalent <span class="math inline">\(F\)</span> statistic found by <code><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova()</a></code> is 28.9. Verify that <a href="#eq-Fstat" class="quarto-xref">Equation&nbsp;<span class="quarto-unresolved-ref">eq-Fstat</span></a> gives this result.</p>
</div>
<!-- ## References {.unnumbered} -->


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-R-Hotelling" class="csl-entry" role="listitem">
Curran, J., &amp; Hersh, T. (2021). <em>Hotelling: Hotelling’s t^2 test and variants</em>. <a href="https://doi.org/10.32614/CRAN.package.Hotelling">https://doi.org/10.32614/CRAN.package.Hotelling</a>
</div>
<div id="ref-FluryReidwyl-1988" class="csl-entry" role="listitem">
Flury, B., &amp; Riedwyl, H. (1988). <em>Multivariate statistics: A practical approach</em>. Chapman &amp; Hall.
</div>
<div id="ref-Hotelling:1931" class="csl-entry" role="listitem">
Hotelling, H. (1931). The generalization of <span class="nocase">Student’s</span> ratio. <em>The Annals of Mathematical Statistics</em>, <em>2</em>(3), 360–378. <a href="https://doi.org/10.1214/aoms/1177732979">https://doi.org/10.1214/aoms/1177732979</a>
</div>
<div id="ref-Pearson-1903" class="csl-entry" role="listitem">
Pearson, K. (1903). I. Mathematical contributions to the theory of evolution. —XI. On the influence of natural selection on the variability and correlation of organs. <em>Philosophical Transactions of the Royal Society of London</em>, <em>200</em>(321–330), 1–66. <a href="https://doi.org/10.1098/rsta.1903.0001">https://doi.org/10.1098/rsta.1903.0001</a>
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>An <strong>exact test</strong> in statistics is a hypothesis test a gives a true, accurate significance level (<span class="math inline">\(p\)</span>-value) without relying on approximations or large-sample assumptions. For example, the complete sampling distribution of the statistic <span class="math inline">\(t = (\bar{x}_1 - \bar{x}_2) / s_p\)</span> for a two-sample <span class="math inline">\(t\)</span> test can be generated in a <em>permutation test</em> that generates all possible random assignments of <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> observations to the two groups. This trades computation for the use of any assumptions.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>One important difference between MANOVA and linear discriminant analysis (LDA) is the role of <em>prior probabilities</em> of the groups in the latter. LDA treats this as a decision problem, so prior weights for the groups effectively shift the decision boundary or classification threshold. If one group is more common, its prior probability will be higher, making it “easier” for a new observation to be classified into that group.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The function <code><a href="https://friendly.github.io/heplots/reference/uniStats.html">heplots::uniStats()</a></code> does this more compactly and displays the <span class="math inline">\(R^2\)</span> and <span class="math inline">\(F\)</span> statistics for each response variable.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p><code><a href="https://friendly.github.io/heplots/reference/etasq.html">heplots::etasq</a></code> calculates overall <span class="math inline">\(\eta^2\)</span>, across all response variables, for each term in a MLM. You can obtain these values for each of the response variables separately using <code><a href="https://easystats.github.io/effectsize/reference/eta_squared.html">effectsize::eta_squared()</a></code>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/friendly\.github\.io\/Vis-MLM-book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./08-collinearity-ridge.html" class="pagination-link" aria-label="Collinearity &amp; Ridge Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-mlm-review.html" class="pagination-link" aria-label="Multivariate Linear Models">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>