<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Visualizing Multivariate Data and Models in R - 7&nbsp; Topics in Linear Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-collinearity-ridge.html" rel="next">
<link href="./06-linear_models-plots.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-linear_models.html">Univariate Linear Models</a></li><li class="breadcrumb-item"><a href="./07-lin-mod-topics.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-linear_models.html">Univariate Linear Models</a></li><li class="breadcrumb-item"><a href="./07-lin-mod-topics.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></a></li></ol></nav><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span>
</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Orienting Ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Exploratory Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Univariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Multivariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">End matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./95-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-betaspace" id="toc-sec-betaspace" class="nav-link active" data-scroll-target="#sec-betaspace"><span class="header-section-number">7.1</span> Ellipsoids in data space and <span class="math inline">\(\mathbf{\beta}\)</span> space</a>
  <ul class="collapse">
<li><a href="#sec-coffee-stress" id="toc-sec-coffee-stress" class="nav-link" data-scroll-target="#sec-coffee-stress"><span class="header-section-number">7.1.1</span> Coffee, stress and heart disease</a></li>
  </ul>
</li>
  <li>
<a href="#measurement-error" id="toc-measurement-error" class="nav-link" data-scroll-target="#measurement-error"><span class="header-section-number">7.2</span> Measurement error</a>
  <ul class="collapse">
<li><a href="#ols-is-blue" id="toc-ols-is-blue" class="nav-link" data-scroll-target="#ols-is-blue"><span class="header-section-number">7.2.1</span> OLS is BLUE</a></li>
  <li><a href="#errors-in-predictors" id="toc-errors-in-predictors" class="nav-link" data-scroll-target="#errors-in-predictors"><span class="header-section-number">7.2.2</span> Errors in predictors</a></li>
  <li><a href="#coffee-data-beta-space" id="toc-coffee-data-beta-space" class="nav-link" data-scroll-target="#coffee-data-beta-space"><span class="header-section-number">7.2.3</span> Coffee data: <span class="math inline">\(\beta\)</span> space</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- \require{newcommand} --><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \newcommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- \newcommand*{\E}{\mathcal{E}} --><!-- Index generation --><!-- % R packages:  indexed under both package name and packages! --><!-- % data sets:  --><!-- % R stuff --><p>The geometric and graphical approach of earlier chapters has already introduced some new ideas for thinking about multivariate data, models for explaining them, and graphical methods for understanding their results. These can be applied to better understand common problems that arise in data analysis.</p>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/matlib">matlib</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-betaspace" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-betaspace">
<span class="header-section-number">7.1</span> Ellipsoids in data space and <span class="math inline">\(\mathbf{\beta}\)</span> space</h2>
<p>It is most common to look at data and fitted models in “data space,” where axes correspond to variables, points represent observations, and fitted models are plotted as lines (or planes) in this space. As we’ve suggested, data ellipsoids provide informative summaries of relationships in data space. For linear models, particularly regression models with quantitative predictors, there is another space—“<span class="math inline">\(\mathbf{\beta}\)</span> space”—that provides deeper views of models and the relationships among them. This discussion extends <span class="citation" data-cites="Friendly-etal:ellipses:2013">Friendly et al. (<a href="95-references.html#ref-Friendly-etal:ellipses:2013" role="doc-biblioref">2013</a>)</span>, Sec. 4.6.</p>
<p>In <span class="math inline">\(\mathbf{\beta}\)</span> space, the axes pertain to coefficients, for example <span class="math inline">\((\beta_0, \beta_1)\)</span> in a simple linear regression. Points in this space are models (true, hypothesized, fitted) whose coordinates represent values of these parameters. For example, one point <span class="math inline">\(\widehat{\mathbf{\beta}}_{\text{OLS}} = (\hat{\beta}_0, \hat{\beta}_1)\)</span> represents the least squares estimate; other points, <span class="math inline">\(\widehat{\mathbf{\beta}}_{\text{WLS}}\)</span> and <span class="math inline">\(\widehat{\mathbf{\beta}}_{\text{ML}}\)</span> would give weighted least squares and maximum likelihood estimates, and the line <span class="math inline">\(\beta_1 = 0\)</span> represents the null hypothesis that the slope is zero.</p>
<p>In the sense described below, data space and <span class="math inline">\(\boldsymbol{\beta}\)</span> space are each <em>dual</em> to the other. In simple linear regression, for example:</p>
<ul>
<li>each line, like <span class="math inline">\(\mathbf{y} = \beta_0 + \beta_1 \mathbf{x}\)</span> with intercept <span class="math inline">\(\beta_0\)</span> and slope <span class="math inline">\(\beta_1\)</span> in data space corresponds to a point <span class="math inline">\((\beta_0,\beta_1)\)</span> in <span class="math inline">\(\mathbf{\beta}\)</span> space, and conversely;</li>
<li>the set of points on any line <span class="math inline">\(\beta_1 = x + y \beta_0\)</span> in <span class="math inline">\(\mathbf{\beta}\)</span> space corresponds to a set of lines through a given point <span class="math inline">\((x, y)\)</span> in data space, and conversely;</li>
<li>the geometric proposition that every pair of points defines a line in one space corresponds to the proposition that every two lines intersect in a point in the other space.</li>
</ul>
<!-- fig.code: R/dual-points-lines.R --><div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-dual-points-lines" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dual-points-lines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/dual-points-lines.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dual-points-lines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: Duality of <span class="math inline">\((x, y)\)</span> lines in data space (left) and points in <span class="math inline">\(\beta\)</span>-space (right). Each line in data space corresponds to a point, whose intercept and slope are shown in <span class="math inline">\(\beta\)</span>-space.
</figcaption></figure>
</div>
</div>
</div>
<p>This is illustrated in <a href="#fig-dual-points-lines" class="quarto-xref">Figure&nbsp;<span>7.1</span></a>. The left panel shows three lines in data space, which can be expressed as linear equations in <span class="math inline">\(\mathbf{z} = (x, y)\)</span> of the form <span class="math inline">\(\mathbf{A} \mathbf{z} = \mathbf{d}\)</span>. <code>matlib::showEqn(A, d)</code> prints these as equations in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>,</span>
<span>              <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span> </span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/matlib/reference/showEqn.html">showEqn</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">d</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x - 1*y  =    2 </span></span>
<span><span class="co">#&gt;   x   + y  =  0.5 </span></span>
<span><span class="co">#&gt; 0*x   + y  =    1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first equation, <span class="math inline">\(x - y = 2\)</span> can be expressed as the line <span class="math inline">\(y = x - 2\)</span> and corresponds to the point <span class="math inline">\((\beta_0, \beta_1) = (-2, 1)\)</span> in <span class="math inline">\(\beta\)</span> space, and similarly for the other two equations. The second equation, <span class="math inline">\(x + y = \frac{1}{2}\)</span>, or <span class="math inline">\(y = 0.5 - x\)</span> intersects the first at the point <span class="math inline">\((x, y) = (1.25, 0.75)\)</span>; this corresponds to the line connecting <span class="math inline">\((-2, 1)\)</span> and <span class="math inline">\((0.5, -1)\)</span> in <span class="math inline">\(\beta\)</span> space.</p>
<p>This lovely duality is an example of an <a href="https://en.wikipedia.org/wiki/Duality_(mathematics)">important principle</a> in modern mathematics which translates concepts and structures from one perspective to another and back again. We get two views of the same thing, whose dual nature provides greater insight.</p>
<p>We have seen (<a href="03-multivariate_plots.html#sec-data-ellipse" class="quarto-xref"><span>Section 3.2</span></a>) how ellipsoids in data space summarize variance (lack of precision) and correlation of our data. For the purpose of understanding linear models, ellipsoids in <span class="math inline">\(\beta\)</span> space do the same thing for the estimates of parameters. These ellipsoids are dual and inversely related to each other, a point first made clear by Dempster <span class="citation" data-cites="Dempster:69">(<a href="95-references.html#ref-Dempster:69" role="doc-biblioref">1969</a>, Ch. 6)</span>:</p>
<ul>
<li><p>In data space, joint confidence intervals for the mean vector or joint prediction regions for the data are given by the ellipsoids <span class="math inline">\((\bar{x}_1, \bar{x}_2)^\mathsf{T} \oplus c \sqrt{\mathbf{S}_{\mathbf{X}}}\)</span>, where the covariance matrix <span class="math inline">\(\mathbf{S}_{\mathbf{X}}\)</span> depends on <span class="math inline">\(\mathbf{X}^\mathsf{T}\mathbf{X}\)</span> (<span class="math inline">\(\oplus\)</span> here shifts the ellipsoid to one centered at <span class="math inline">\((\bar{x}_1, \bar{x}_2)\)</span> here, as in <a href="03-multivariate_plots.html#eq-ellE" class="quarto-xref">Equation&nbsp;<span>3.2</span></a>).</p></li>
<li><p>In the dual <span class="math inline">\(\mathbf{\beta}\)</span> space, joint confidence regions for the coefficients of a response variable <span class="math inline">\(y\)</span> on <span class="math inline">\((x_1, x_2)\)</span> are given by ellipsoids of the form <span class="math inline">\(\widehat{\mathbf{\beta}} \oplus c \sqrt{\mathbf{S}_{\mathbf{X}}^{-1}}\)</span>, and depend on <span class="math inline">\(\mathbf{(\mathbf{X}^\mathsf{T}\mathbf{X})}^{-1}\)</span>.</p></li>
</ul>
<p>It is useful to understand the underlying geometry here connecting the ellipses for a matrix and its inverse. This can be seen in <a href="#fig-inverse" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>, which shows an ellipse for a covariance matrix <span class="math inline">\(\mathbf{S}\)</span>, whose axes, as we saw in <a href="04-pca-biplot.html" class="quarto-xref"><span>Chapter 4</span></a> are the eigenvectors <span class="math inline">\(\mathbf{v}_i\)</span> of <span class="math inline">\(\mathbf{S}\)</span> and whose radii are the square roots <span class="math inline">\(\sqrt{\lambda_i}\)</span> of the corresponding eigenvalues. The comparable ellipse for <span class="math inline">\(2 \mathbf{S}\)</span> has radii multiplied by <span class="math inline">\(\sqrt{2}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-inverse" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-inverse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/inverse.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inverse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: Geometric properties of an ellipse <span class="math inline">\(\mathbf{S}\)</span> and its inverse, <span class="math inline">\(\mathbf{S}^{-1}\)</span>. The principal axes (dotted lines) are given by the eigenvectors, which are the same for <span class="math inline">\(\mathbf{S}\)</span> and <span class="math inline">\(\mathbf{S}^{-1}\)</span>. Multiplying <span class="math inline">\(\mathbf{S}\)</span> by 2 makes it’s ellipse larger by <span class="math inline">\(\sqrt{2}\)</span>, while the same factor makes the ellipse for <span class="math inline">\((2 \mathbf{S})^{-1}\)</span> smaller by the same factor.
</figcaption></figure>
</div>
</div>
</div>
<p>As long as <span class="math inline">\(\mathbf{S}\)</span> is of full rank, the eigenvectors of <span class="math inline">\(\mathbf{S}^{-1}\)</span> are identical, while the eigenvalues are <span class="math inline">\(1 / \lambda_i\)</span>, so the radii are the reciprocals <span class="math inline">\(1 / \sqrt{\lambda_i}\)</span>. The analogous ellipse for <span class="math inline">\((2 \mathbf{S}^{-1})\)</span> is smaller by a factor of <span class="math inline">\(\sqrt{2}\)</span>.</p>
<p>Thus, in two dimensions, the ellipse for <span class="math inline">\(\mathbf{S}^{-1}\)</span> is a <span class="math inline">\(90^o\)</span> rotation of that for <span class="math inline">\(\mathbf{S}\)</span>. It is small in directions where the ellipse for <span class="math inline">\(\mathbf{S}\)</span> is large, and vice-versa. In our statistical applications, this translates as: parameter estimates in <span class="math inline">\(\beta\)</span> space are more precise (have less variance) in the directions where the data are more widely dispersed, having more information about the relationship.</p>
<p>We illustrate these ideas in the example below.</p>
<section id="sec-coffee-stress" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="sec-coffee-stress">
<span class="header-section-number">7.1.1</span> Coffee, stress and heart disease</h3>
<p>Consider the dataset <code>coffee</code>, giving measures of <code>Heart</code> (<span class="math inline">\(y\)</span>), an index of cardiac damage, <code>Coffee</code> (<span class="math inline">\(x_1\)</span>), a measure of daily coffee consumption, and <code>Stress</code> (<span class="math inline">\(x_2\)</span>), a measure of occupational stress, in a contrived sample of <span class="math inline">\(n=20\)</span> university people.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> For the sake of the example we assume that the main goal is to determine whether or not coffee is good or bad for your heart, and stress represents one potential confounding variable among others (age, smoking, etc.) that might be useful to control statistically.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">coffee</span>, package<span class="op">=</span><span class="st">"matlib"</span><span class="op">)</span></span>
<span><span class="va">coffee</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Group Coffee Stress Heart</span></span>
<span><span class="co">#&gt; 1 Grad_Student    104    117    92</span></span>
<span><span class="co">#&gt; 2      Student     52     86    63</span></span>
<span><span class="co">#&gt; 3 Grad_Student     76     92    58</span></span>
<span><span class="co">#&gt; 4      Student    100    123    92</span></span>
<span><span class="co">#&gt; 5      Student     64     74    63</span></span>
<span><span class="co">#&gt; 6    Professor    141    175   145</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-coffee-scatmat" class="quarto-xref">Figure&nbsp;<span>7.3</span></a> shows the scatterplot matrix, giving the marginal relations between all pairs of variables. The marginal message seems to be that coffee is bad for your heart, stress is bad for your heart and coffee consumption is also related to occupational stress.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show the code</summary><div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Heart</span> <span class="op">+</span> <span class="va">Coffee</span> <span class="op">+</span> <span class="va">Stress</span>, data<span class="op">=</span><span class="va">coffee</span>,</span>
<span>    smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"brown"</span>,</span>
<span>    cex.axis <span class="op">=</span> <span class="fl">1.3</span>, cex.labels <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-coffee-scatmat" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-coffee-scatmat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch07/fig-coffee-scatmat-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-scatmat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Scatterplot matrix for the <code>coffee</code> data showing the pairwise relationships among Heart damage (<span class="math inline">\(y\)</span>), Coffee consumption (<span class="math inline">\(x_1\)</span>), and Stress (<span class="math inline">\(x_2\)</span>), with linear regression lines and 68% data ellipses.
</figcaption></figure>
</div>
</div>
</div>
<p>Yet, when we fit both variables together, we obtain the following results, suggesting that coffee is good for you—the coefficient for coffee is now negative, though non-significant. How can this be?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coffee.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Heart</span> <span class="op">~</span> <span class="va">Coffee</span> <span class="op">+</span> <span class="va">Stress</span>, data<span class="op">=</span><span class="va">coffee</span><span class="op">)</span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">coffee.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic   p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 (Intercept)   -7.79      5.79      -1.35 0.196    </span></span>
<span><span class="co">#&gt; 2 Coffee        -0.409     0.292     -1.40 0.179    </span></span>
<span><span class="co">#&gt; 3 Stress         1.20      0.224      5.34 0.0000536</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The answer is that the marginal plots of <code>Heart</code> vs.&nbsp;<code>Coffee</code> and <code>Stress</code> in the first row of <a href="#fig-coffee-scatmat" class="quarto-xref">Figure&nbsp;<span>7.3</span></a> each ignore the the other predictor. In contrast, the coefficients for coffee and stress in the multiple regression model <code>coffee.mod</code> are <em>partial</em> coefficients, giving the estimated change in heart damage for a unit change in each predictor, but <strong>adjusting for</strong> (controlling for, or holding constant) the other predictor.</p>
<p>We can see these effects directly in <strong>added variable plots</strong> (<a href="06-linear_models-plots.html#sec-avplots" class="quarto-xref"><span>Section 6.4</span></a>), but here I consider the relationship of coffee and stress in data space and beta space and how their ellipses relate to each other and to hypothesis tests.</p>
<p>The left panel in <a href="#fig-coffee-data-beta-both" class="quarto-xref">Figure&nbsp;<span>7.4</span></a> is the same as that in the (3,2) cell of <a href="#fig-coffee-scatmat" class="quarto-xref">Figure&nbsp;<span>7.3</span></a> for the relation <code>Stress ~ Coffee</code> but with data ellipses of 40% and 60% coverage. The shadows of the 40% ellipse on any axis give univariate intervals of the mean <span class="math inline">\(\bar{x} \pm 1 s_x\)</span> (standard deviation) shown by the thick red lines; the shadow of the 68% ellipse corresponds to an interval <span class="math inline">\(\bar{x} \pm 1.5 s_x\)</span>.</p>
<p>The right panel shows the joint 95% confidence region for the coefficients <span class="math inline">\((\beta_{\text{Coffee}}, \beta_{\text{Stress}})\)</span> and individual confidence intervals in <span class="math inline">\(\mathbf{\beta}\)</span> space. These are determined as</p>
<p><span class="math display">\[
\widehat{\mathbf{\beta}} \oplus \sqrt{d F^{.95}_{d, \nu}} \times s_e \times \mathbf{S}_X^{-1/2} \:\: .
\]</span> where <span class="math inline">\(d\)</span> is the number of dimensions for which we want coverage, <span class="math inline">\(\nu\)</span> is the residual degrees of freedom for <span class="math inline">\(s_e\)</span>, and <span class="math inline">\(\mathbf{S}_X\)</span> is the covariance matrix of the predictors.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-coffee-data-beta-both" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-coffee-data-beta-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/coffee-data-beta-both.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-data-beta-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.4: Data space and <span class="math inline">\(\mathbf{\beta}\)</span> space representations of Coffee and Stress. Left: 40% and 68% data ellipses. Right: Joint 95% confidence ellipse (blue) for (<span class="math inline">\(\beta_{\text{Coffee}}, \beta_{\text{Stress}}\)</span>), confidence interval generating ellipse (red) with 95% univariate shadows. <span class="math inline">\(H_0\)</span> marks the joint hypothesis that both coefficients equal zero.
</figcaption></figure>
</div>
</div>
</div>
<p>Thus, the <span style="color: blue;">blue</span> ellipse in <a href="#fig-coffee-data-beta-both" class="quarto-xref">Figure&nbsp;<span>7.4</span></a> (right) is the ellipse of <strong>joint</strong> 95% coverage, using the factor <span class="math inline">\(\sqrt{2 F^{.95}_{2, \nu}}\)</span>, which covers the true values of (<span class="math inline">\(\beta_{\mathrm{Stress}}, \beta_{\mathrm{Coffee}}\)</span>) in 95% of samples. Moreover:</p>
<ul>
<li>Any <em>joint</em> hypothesis (e.g., <span class="math inline">\(\mathcal{H}_0:\beta_{\mathrm{Stress}}=0, \beta_{\mathrm{Coffee}}=0\)</span>) can be tested visually, simply by observing whether the hypothesized point, <span class="math inline">\((0, 0)\)</span> here, lies inside or outside the joint confidence ellipse. That hypothesis is rejected</li>
<li>The shadows of this ellipse on the horizontal and vertical axes give Scheff'e joint 95% confidence intervals for the parameters, with protection for simultaneous inference (“fishing”) in a 2-dimensional space.</li>
<li>Similarly, using the factor <span class="math inline">\(\sqrt{F^{1-\alpha/d}_{1, \nu}} = t^{1-\alpha/2d}_\nu\)</span> would give an ellipse whose 1D shadows are <span class="math inline">\(1-\alpha\)</span> Bonferroni confidence intervals for <span class="math inline">\(d\)</span> posterior hypotheses.</li>
</ul>
<p>Visual hypothesis tests and <span class="math inline">\(d=1\)</span> confidence intervals for the parameters <em>separately</em> are obtained from the <span style="color: red;">red</span> ellipse in <a href="#fig-coffee-data-beta-both" class="quarto-xref">Figure&nbsp;<span>7.4</span></a>, which is scaled by <span class="math inline">\(\sqrt{F^{.95}_{1, \nu}} = t^{.975}_\nu\)</span>. We call this the _confidence-interval generating ellipse” (or, more compactly, the “confidence-interval ellipse”). The shadows of the confidence-interval ellipse on the axes (thick red lines) give the corresponding individual 95% confidence intervals, which are equivalent to the (partial, Type III) <span class="math inline">\(t\)</span>-tests for each coefficient given in the standard multiple regression output shown above.</p>
<p>Thus, controlling for Stress, the confidence interval for the slope for Coffee includes 0, so we cannot reject the hypothesis that <span class="math inline">\(\beta_{\mathrm{Coffee}}=0\)</span> in the multiple regression model, as we saw above in the numerical output. On the other hand, the interval for the slope for Stress excludes the origin, so we reject the null hypothesis that <span class="math inline">\(\beta_{\mathrm{Stress}}=0\)</span>, controlling for Coffee consumption.</p>
<p>Finally, consider the relationship between the data ellipse and the confidence ellipse. These have exactly the same shape, but (with equal coordinate scaling of the axes), the confidence ellipse is exactly a <span class="math inline">\(90^o\)</span> rotation and rescaling of the data ellipse. In directions in data space where the slice of the data ellipse is wide—where we have more information about the relationship between Coffee and Stress—the projection of the confidence ellipse is narrow, reflecting greater precision of the estimates of coefficients. Conversely, where slice of the the data ellipse is narrow (less information), the projection of the confidence ellipse is wide (less precision).</p>
<p>Confidence ellipses are drawn using <code><a href="https://rdrr.io/pkg/car/man/Ellipses.html">car::confidenceEllipse()</a></code>. Click the button to show the code.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code for confidence ellipses</summary><div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">confidenceEllipse</a></span><span class="op">(</span><span class="va">coffee.mod</span>, </span>
<span>    grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">2.5</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Coffee coefficient,  "</span>, <span class="va">beta</span><span class="op">[</span><span class="st">"Coffee"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Stress coefficient,  "</span>, <span class="va">beta</span><span class="op">[</span><span class="st">"Stress"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">confidenceEllipse</a></span><span class="op">(</span><span class="va">coffee.mod</span>, add<span class="op">=</span><span class="cn">TRUE</span>, draw <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    dfn <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, v <span class="op">=</span> <span class="fl">0</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># confidence intervals</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span> <span class="va">coffee.mod</span> <span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">coffee.mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span> y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">CI</span><span class="op">[</span><span class="st">"Coffee"</span>,<span class="op">]</span> , lwd <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span> x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">CI</span><span class="op">[</span><span class="st">"Stress"</span>,<span class="op">]</span> , lwd <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span> <span class="va">beta</span> <span class="op">)</span>, col <span class="op">=</span> <span class="st">'black'</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">CI</span><span class="op">[</span><span class="st">"Coffee"</span>,<span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">CI</span><span class="op">[</span><span class="st">"Stress"</span>,<span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.1</span>, <span class="fl">2.35</span>, <span class="st">"Beta space"</span>, cex<span class="op">=</span><span class="fl">2</span>, pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span>, angle<span class="op">=</span><span class="fl">8</span>, len<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">0</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, angle<span class="op">=</span><span class="fl">8</span>, len<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.85</span>, <span class="st">"df = 2"</span>, col <span class="op">=</span> <span class="st">'blue'</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span> <span class="fl">0.2</span>, <span class="fl">.85</span>, <span class="st">"df = 1"</span>, col <span class="op">=</span> <span class="st">'red'</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">heplots</span><span class="fu">::</span><span class="fu"><a href="https://friendly.github.io/heplots/reference/mark.H0.html">mark.H0</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"darkgreen"</span>, pch <span class="op">=</span> <span class="st">"+"</span>, lty <span class="op">=</span> <span class="fl">0</span>, pos <span class="op">=</span> <span class="fl">4</span>, cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="measurement-error" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="measurement-error">
<span class="header-section-number">7.2</span> Measurement error</h2>
<section id="ols-is-blue" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="ols-is-blue">
<span class="header-section-number">7.2.1</span> OLS is BLUE</h3>
<p>In classical linear models, the predictors are often considered to be fixed variables, or, if random, to be measured without error and independent of the regression errors. Either condition, along with the assumption of linearity, guarantees that the standard OLS estimators are <em>unbiased</em>. That is, in a simple linear regression, <span class="math inline">\(y = \beta_0 + \beta_1 x + \epsilon\)</span>, the estimated slope <span class="math inline">\(\hat{\beta}_1\)</span> wiil have an average, expected value <span class="math inline">\(\mathcal{E} (\hat{\beta}_1)\)</span> equal to the true population value <span class="math inline">\(\beta_1\)</span> over repeated samples.</p>
<p>Not only this, but the Gauss-Markov theorem guarantees that the OLS estimator is also the most <em>efficient</em> because it has the least variance among all linear and unbiased estimators. The classical OLS estimator is said to be BLUE: <strong>B</strong>est (lowest variance), <strong>L</strong>inear (among linear estimators), <strong>U</strong>nbiased, <strong>E</strong>stimator.</p>
</section><section id="errors-in-predictors" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="errors-in-predictors">
<span class="header-section-number">7.2.2</span> Errors in predictors</h3>
<p>Errors in the response <span class="math inline">\(y\)</span> are accounted for in the model and measured by the mean squared error, <span class="math inline">\(\text{MSE} = \hat{\sigma}_\epsilon^2\)</span>. But in practice, of course, predictor variables are often also observed indicators, subject to their own error. Indeed, in the behavioral sciences it is rare that predictors are perfectly reliable and measured exactly. This fact that is recognized in errors-in-variables regression models <span class="citation" data-cites="Fuller2006">(<a href="95-references.html#ref-Fuller2006" role="doc-biblioref">Fuller, 2006</a>)</span> and in more general structural equation models, but often ignored otherwise. Ellipsoids in data space and <span class="math inline">\(\beta\)</span> space are well suited to showing the effect of measurement error in predictors on OLS estimates.</p>
<p>The statistical facts are well known, though perhaps counter-intuitive in certain details: measurement error in a predictor biases regression coefficients (towards 0), while error in the measurement in <span class="math inline">\(y\)</span> increases the MSE and thus standard errors of the regression coefficients but does not introduce bias in the coefficients.</p>
<section id="example" class="level4" data-number="7.2.2.1"><h4 data-number="7.2.2.1" class="anchored" data-anchor-id="example">
<span class="header-section-number">7.2.2.1</span> Example</h4>
<p>An illuminating example can be constructed by starting with the simple linear regression <span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \epsilon_i \; ,
\]</span> where <span class="math inline">\(x_i\)</span> is the <em>true</em>, fully reliable predictor and <span class="math inline">\(y\)</span> is the response, with error variance <span class="math inline">\(\sigma_\epsilon^2\)</span>. Now consider that we don’t measure <span class="math inline">\(x_i\)</span> exactly, but instead observe <span class="math inline">\(x^\star_i\)</span>. <span class="math display">\[
x^\star_i = x_i + \eta_i \; ,
\]</span> where the measurement error <span class="math inline">\(\eta_i\)</span> is independent of the true <span class="math inline">\(x_i\)</span> with variance <span class="math inline">\(\sigma^2_\eta\)</span>. We can extend this example to also consider the effect of adding additional, independent error variance to <span class="math inline">\(y\)</span>, so that instead of <span class="math inline">\(y_i\)</span> we observe</p>
<p><span class="math display">\[
y^\star_i = y_i + \nu_i
\]</span> with variance <span class="math inline">\(\sigma^2_\nu\)</span>.</p>
<p>Let’s simulate an example where the true relation is <span class="math inline">\(y = 0.2 + 0.3 x\)</span> with error standard deviation <span class="math inline">\(\sigma = 0.5\)</span>. I’ll take <span class="math inline">\(x\)</span> to be uniformly distributed in [0, 10] and calculate <span class="math inline">\(y\)</span> as normally distributed around that linear relation.</p>
<!-- fig.code: R/measerr-demo.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>    <span class="co"># true intercept</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">0.3</span>    <span class="co"># true slope</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># baseline error standard deviation</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">a</span> <span class="op">+</span> <span class="va">b</span><span class="op">*</span><span class="va">x</span>, <span class="va">sigma</span><span class="op">)</span></span>
<span><span class="va">demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, generate alternative values <span class="math inline">\(x^\star\)</span> and <span class="math inline">\(y^\star\)</span> with additional error standard deviations around <span class="math inline">\(x\)</span> given by <span class="math inline">\(\sigma_\eta = 4\)</span> and around <span class="math inline">\(y\)</span> given by <span class="math inline">\(\sigma_\nu = 1\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">err_y</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># additional error stdev for y</span></span>
<span><span class="va">err_x</span> <span class="op">&lt;-</span> <span class="fl">4</span>   <span class="co"># additional error stdev for x</span></span>
<span><span class="va">demo</span>  <span class="op">&lt;-</span> <span class="va">demo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">y</span>, <span class="va">err_y</span><span class="op">)</span>,</span>
<span>         x_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">x</span>, <span class="va">err_x</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are four possible models we could fit and compare, using the combinations of <span class="math inline">\((x, x^\star)\)</span> and <span class="math inline">\((y, y^\star)\)</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,           data <span class="op">=</span> <span class="va">demo</span><span class="op">)</span>   <span class="co"># no additional error</span></span>
<span><span class="va">fit_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y_star</span> <span class="op">~</span> <span class="va">x</span>,      data <span class="op">=</span> <span class="va">demo</span><span class="op">)</span>   <span class="co"># error in y</span></span>
<span><span class="va">fit_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x_star</span>,      data <span class="op">=</span> <span class="va">demo</span><span class="op">)</span>   <span class="co"># error in x</span></span>
<span><span class="va">fit_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y_star</span> <span class="op">~</span> <span class="va">x_star</span>, data <span class="op">=</span> <span class="va">demo</span><span class="op">)</span>   <span class="co"># error in x and y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, to show the differences visually, we can simply plot the data for each pair and show the regression lines (with confidence bands) and the data ellipses. To do this efficiently with <code>ggplot2</code>, it is necessary to transform the <code>demo</code> data to long format with columns <code>x</code> and <code>y</code>, distinguished by <code>name</code> for the four combinations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># make the demo dataset long, with names for the four conditions</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">x</span>,      y<span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">y</span>,      name<span class="op">=</span><span class="st">"No measurement error"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">x</span>,      y<span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">y_star</span>, name<span class="op">=</span><span class="st">"Measurement error on y"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">x_star</span>, y<span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">y</span>,      name<span class="op">=</span><span class="st">"Measurement error on x"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">x_star</span>, y<span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">y_star</span>, name<span class="op">=</span><span class="st">"Measurement error on x and y"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we can plot the data in <code>df</code> with points, regression lines and a data ellipse, faceting by <code>name</code> to give the <strong>measurement error quartet</strong>.</p>
<!-- fig.code: R/measerr-demo.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"blue"</span>,fill<span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>               alpha<span class="op">=</span><span class="fl">0.05</span>, linewidth <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, fullrange<span class="op">=</span><span class="cn">TRUE</span>, level<span class="op">=</span><span class="fl">0.995</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-measerr-demo" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-measerr-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch07/fig-measerr-demo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-measerr-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.5: <strong>The measurement error quartet</strong>: Each plot shows the linear regression of <em>y</em> on <em>x</em>, but where additional error variance has been added to <em>y</em> or <em>x</em> or both. The widths of the confidence bands and the vertical extent of the data ellipses show the effect on precision.
</figcaption></figure>
</div>
</div>
</div>
<p>Comparing the plots in the first row, you can see that when additional error is added to <span class="math inline">\(y\)</span>, the regression slope remains essentially unchanged, illustrating that the estimate is unbiased. However, the confidence bounds on the regression line become wider, and the data ellipse becomes fatter in the <span class="math inline">\(y\)</span> direction, illustrating the loss of precision.</p>
<p>The effect of error in <span class="math inline">\(x\)</span> is less kind. Comparing the first row of plots with the second row, you can see that the estimated slope decreases when errors are added to <span class="math inline">\(x\)</span>. This is called <em>attenuation bias</em>, and it can be shown that <span class="math display">\[
\widehat{\beta}_{x^\star} \longrightarrow \frac{\beta}{1+\sigma^2_\eta /\sigma^2_x} \; ,
\]</span> where <span class="math inline">\(\beta\)</span> here refers to the regression slope and <span class="math inline">\(\longrightarrow\)</span> means “converges to”, as the sample size gets large. Thus, as <span class="math inline">\(\sigma^2_\eta\)</span> increases, <span class="math inline">\(\widehat{\beta}_{x^\star}\)</span> becomes less than <span class="math inline">\(\beta\)</span>.</p>
<p>Beyond plots like <a href="#fig-measerr-demo" class="quarto-xref">Figure&nbsp;<span>7.5</span></a>, we can see the effects of error in <span class="math inline">\(x\)</span> or <span class="math inline">\(y\)</span> on the model summary statistics such as the correlation <span class="math inline">\(r_{xy}\)</span> or MSE by extracting these from the fitted models. This is easily done using <code>dplyr::nest_by(name)</code> and fitting the regression model to each subset, from which we can obtain the model statistics using <code><a href="https://rdrr.io/r/stats/sigma.html">sigma()</a></code>, <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> and so forth. A bit of <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code> magic is used to construct indicators <code>errX</code> and <code>errY</code> giving whether or not error was added to <span class="math inline">\(x\)</span> and/or <span class="math inline">\(y\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_stats</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nest_by.html">nest_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>,</span>
<span>         intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>         slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>         r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>errX <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">" x"</span><span class="op">)</span>,</span>
<span>         errY <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">" y"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>errX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">errX</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         errY <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">errY</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">errX</span>, <span class="va">errY</span>, <span class="va">r</span>, .after <span class="op">=</span> <span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 8</span></span>
<span><span class="co">#&gt; # Rowwise:  name</span></span>
<span><span class="co">#&gt;   name                errX  errY      r model sigma intercept  slope</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;               &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;lis&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 No measurement err… FALSE FALSE 0.858 &lt;lm&gt;  0.495    0.244  0.294 </span></span>
<span><span class="co">#&gt; 2 Measurement error … FALSE TRUE  0.648 &lt;lm&gt;  1.09     0.0838 0.329 </span></span>
<span><span class="co">#&gt; 3 Measurement error … TRUE  FALSE 0.481 &lt;lm&gt;  0.844    1.22   0.0946</span></span>
<span><span class="co">#&gt; 4 Measurement error … TRUE  TRUE  0.401 &lt;lm&gt;  1.31     1.12   0.117</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We plot the model <span class="math inline">\(R = r_{xy}\)</span> and the estimated residual standard error in <a href="#fig-measerr-stats" class="quarto-xref">Figure&nbsp;<span>7.6</span></a> below. The lines connecting the points are approximately parallel, indicating that errors of measurement in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> have nearly additive effects on model summaries.</p>
<!-- fig.code: R/measerr-demo.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">model_stats</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">errX</span>, y <span class="op">=</span> <span class="va">r</span>, </span>
<span>                 group <span class="op">=</span> <span class="va">errY</span>, color <span class="op">=</span> <span class="va">errY</span>, </span>
<span>                 shape <span class="op">=</span> <span class="va">errY</span>, linetype <span class="op">=</span> <span class="va">errY</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Error on X?"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Model R "</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Error on Y?"</span>,</span>
<span>       shape <span class="op">=</span> <span class="st">"Error on Y?"</span>,</span>
<span>       linetype <span class="op">=</span> <span class="st">"Error on Y?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">legend_inside</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">model_stats</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">errX</span>, y <span class="op">=</span> <span class="va">sigma</span>, </span>
<span>                 group <span class="op">=</span> <span class="va">errY</span>, color <span class="op">=</span> <span class="va">errY</span>, </span>
<span>                 shape <span class="op">=</span> <span class="va">errY</span>, linetype <span class="op">=</span> <span class="va">errY</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Error on X?"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Model residual standard error"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Error on Y?"</span>,</span>
<span>       shape <span class="op">=</span> <span class="st">"Error on Y?"</span>,</span>
<span>       linetype <span class="op">=</span> <span class="st">"Error on Y?"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-measerr-stats" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-measerr-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch07/fig-measerr-stats-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-measerr-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.6: Model statistics for the combinations of additional error variance in x or y or both. Left: model R; right: Residual standard error.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="coffee-data-beta-space" class="level3" data-number="7.2.3"><h3 data-number="7.2.3" class="anchored" data-anchor-id="coffee-data-beta-space">
<span class="header-section-number">7.2.3</span> Coffee data: <span class="math inline">\(\beta\)</span> space</h3>
<p>In multiple regression the effects of measurement error in a predictor become more complex, because error variance in one predictor, <span class="math inline">\(x_1\)</span>, say, can affect the coefficients of other terms in the model.</p>
<p>Consider the marginal relation between Heart disease and Stress in the <code>coffee</code> data. <a href="#fig-coffee-measerr-data-beta" class="quarto-xref">Figure&nbsp;<span>7.7</span></a> shows this with data ellipses in data space and the corresponding confidence ellipses in <span class="math inline">\(\beta\)</span> space. Each panel starts with the observed data (the darkest ellipse, marked <span class="math inline">\(0\)</span>), then adds random normal error, <span class="math inline">\(\mathcal{N}(0, \delta \times \mathrm{SD}_{Stress})\)</span>, with <span class="math inline">\(\delta = \{0.75, 1.0, 1.5\}\)</span>, to the value of Stress, while keeping the mean of Stress the same. All of the data ellipses have the same vertical shadows (<span class="math inline">\(\text{SD}_{\textrm{Heart}}\)</span>), while the horizontal shadows increase with <span class="math inline">\(\delta\)</span>, driving the slope for Stress toward 0.</p>
<p>In <span class="math inline">\(\beta\)</span> space, it can be seen that the estimated coefficients, <span class="math inline">\((\beta_0, \beta_{\textrm{Stress}})\)</span> vary along a line and approach <span class="math inline">\(\beta_{\textrm{Stress}}=0\)</span> as <span class="math inline">\(\delta\)</span> gets sufficiently large. The shadows of ellipses for <span class="math inline">\((\beta_0, \beta_{\textrm{Stress}})\)</span> along the <span class="math inline">\(\beta_{\textrm{Stress}}\)</span> axis also demonstrate the effects of measurement error on the standard error of <span class="math inline">\(\beta_{\textrm{Stress}}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-coffee-measerr-data-beta" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-coffee-measerr-data-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/coffee-measerr-data-beta.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-measerr-data-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.7: Effects of measurement error in Stress on the marginal relationship between Heart disease and Stress. Each panel starts with the observed data (<span class="math inline">\(\delta = 0\)</span>), then adds random normal error, <span class="math inline">\(\mathcal{N}(0, \delta \times \text{SD}_\text{Stress})\)</span> with standard deviations multiplied by <span class="math inline">\(\delta\)</span> = 0.75, 1.0, 1.5, to the value of Stress. Increasing measurement error biases the slope for Stress toward 0. Left: 50% data ellipses; right: 50% confidence ellipses.
</figcaption></figure>
</div>
</div>
</div>
<p>Perhaps less well-known, but both more surprising and interesting, is the effect that measurement error in one variable, <span class="math inline">\(x_1\)</span>, has on the estimate of the coefficient for an <em>other</em> variable, <span class="math inline">\(x_2\)</span>, in a multiple regression model. <a href="#fig-coffee-measerr" class="quarto-xref">Figure&nbsp;<span>7.8</span></a> shows the confidence ellipses for <span class="math inline">\((\beta_{\textrm{Coffee}}, \beta_{\textrm{Stress}})\)</span> in the multiple regression predicting Heart disease, adding random normal error <span class="math inline">\(\mathcal{N}(0, \delta \times \mathrm{SD}_{Stress})\)</span>, with <span class="math inline">\(\delta = \{0, 0.2, 0.4, 0.8\}\)</span>, to the value of Stress alone.<br>
As can be plainly seen, while this measurement error in Stress attenuates its coefficient, it also has the effect of biasing the coefficient for Coffee toward that in the <em>marginal</em> regression of Heart disease on Coffee alone.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-coffee-measerr" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-coffee-measerr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/coffee-measerr.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-measerr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.8: Biasing effect of measurement error in one variable (Stress) on on the coefficient of another variable (Coffee) in a multiple regression. The coefficient for Coffee is driven towards its value in the marginal model using Coffee alone, as measurement error in Stress makes it less informative in the joint model.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<p><strong>Packages used here</strong>:</p>
<p>10 packages used here: car, carData, dplyr, forcats, gganimate, ggplot2, knitr, matlib, patchwork, tidyr</p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Dempster:69" class="csl-entry" role="listitem">
Dempster, A. P. (1969). <em>Elements of continuous multivariate analysis</em>. Addison-Wesley.
</div>
<div id="ref-Friendly-etal:ellipses:2013" class="csl-entry" role="listitem">
Friendly, M., Monette, G., &amp; Fox, J. (2013). Elliptical insights: Understanding statistical methods through elliptical geometry. <em>Statistical Science</em>, <em>28</em>(1), 1–39. <a href="https://doi.org/10.1214/12-STS402">https://doi.org/10.1214/12-STS402</a>
</div>
<div id="ref-Fuller2006" class="csl-entry" role="listitem">
Fuller, W. (2006). <em>Measurement error models</em> (2nd ed.). John Wiley &amp; Sons.
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>This example was developed by Georges Monette.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./06-linear_models-plots.html" class="pagination-link" aria-label="Plots for univariate response models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-collinearity-ridge.html" class="pagination-link" aria-label="Collinearity &amp; Ridge Regression">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>