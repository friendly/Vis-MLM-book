<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>5&nbsp; Overview of Linear models – Visualizing Multivariate Data and Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-linear_models-plots.html" rel="next">
<link href="./04-pca-biplot.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-17e746a5a36f38a88c5f5cc681d9ba3d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-linear_models.html">Univariate Linear Models</a></li><li class="breadcrumb-item"><a href="./05-linear_models.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-linear_models.html">Univariate Linear Models</a></li><li class="breadcrumb-item"><a href="./05-linear_models.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></a></li></ol></nav>
      <h1 class="title"><span id="sec-linear-models" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-Author.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Author</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-Prelude.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Warm-up Exercises</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Orienting Ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Exploratory Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Univariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for Univariate Response Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Multivariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-infl-robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiviate Influence and Robust Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Case Studies</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">End Matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./95-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-GLM" id="toc-sec-GLM" class="nav-link active" data-scroll-target="#sec-GLM"><span class="header-section-number">5.1</span> The General Linear Model</a>
  <ul class="collapse">
<li><a href="#sec-model-formulas" id="toc-sec-model-formulas" class="nav-link" data-scroll-target="#sec-model-formulas"><span class="header-section-number">5.1.1</span> Model formulas</a></li>
  <li><a href="#model-matrices" id="toc-model-matrices" class="nav-link" data-scroll-target="#model-matrices"><span class="header-section-number">5.1.2</span> Model matrices</a></li>
  <li><a href="#sec-contrasts" id="toc-sec-contrasts" class="nav-link" data-scroll-target="#sec-contrasts"><span class="header-section-number">5.1.3</span> Coding factors and contrasts</a></li>
  </ul>
</li>
  <li><a href="#what-have-we-learned" id="toc-what-have-we-learned" class="nav-link" data-scroll-target="#what-have-we-learned"><span class="header-section-number">5.2</span> What have we learned?</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- \require{newcommand} --><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \providecommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- \newcommand*{\E}{\mathcal{E}} --><!-- Index generation --><!-- % R packages:  indexed under both package name and packages! --><!-- % data sets:  --><!-- % R stuff --><p>Although this book is primarily about multivariate models, it is useful to have an overview of the range of available techniques for univariate response models to see their uses and to appreciate how easily univariate models generalize to multivariate ones. Hence, this chapter reviews the characteristics of the standard univariate methods for explaining or predicting a single outcome variable from a set of predictors.</p>
<p>The key ideas are:</p>
<ul>
<li><p>For a single quantitative outcome variable <span class="math inline">\(\mathbf{y}\)</span>, methods of linear regression and analysis of variance (ANOVA) are comprised within a single framework of the <strong>general linear model</strong> (GLM). Regression and ANOVA differ only in that the predictors in the former are quantitative, while those in the latter are discrete factors. They can all be fit using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>.</p></li>
<li><p>These models extend directly to the multivariate case of <span class="math inline">\(q &gt; 1\)</span> outcomes, <span class="math inline">\(\mathbf{Y} = (\mathbf{y}_1, \mathbf{y}_2, \dots \mathbf{y}_q)\)</span>, and are also fit using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>.</p></li>
<li><p>A binary outcome <span class="math inline">\(y = (0, 1)\)</span> and categorical outcomes like marital status (“never married”, “married”, “separated”, “divorced”) can be handled within a different extension, the <strong>generalized</strong> linear model as logistic regression or multinomial regression, fit using <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>.</p></li>
<li><p>All of these models involve linear combinations of predictors (weighted sums) fit to optimize some criterion, for example minimizing some function of the residuals or maximizing some measure of fit.</p></li>
<li><p>Models and data can be more easily understood with graphics, and many statistical ideas have a visual representation in geometry.</p></li>
</ul>
<p><a href="#fig-techniques" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-techniques</span></a> summarizes a variety of methods for linear models, classified by number of predictors and number of response variables, and whether these are quantitative vs.&nbsp;discrete. For the present purposes, the key columns are the first two, for the case of one or more quantitative outcome variables.</p>
<!-- **TODO**: This should be a table, but that's not working -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-techniques" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-techniques-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/techniques-table.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-techniques-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: Techniques for linear models classified by number of predictors and number of response variables, and whether these are quantitative vs.&nbsp;discrete
</figcaption></figure>
</div>
</div>
</div>
<p>When the <em>predictors</em> are also quantitative, simple regression (<span class="math inline">\(p=1\)</span>) generalizes to multivariate regression with two or more outcomes (<span class="math inline">\(q &gt; 1\)</span>). For example we might want to predict weight and body mass index <em>jointly</em> from a person’s height.</p>
<p>The situation is more interesting when there are <span class="math inline">\(p&gt;1\)</span> predictors. The most common multivariate generalization is <em>multivariate multiple regression</em> (MMRA), where each outcome is regressed on the predictors, as if done separately for each outcome, but using multivariate tests that take correlations among the response variables into account. Other methods for this case include canonical correlation analysis, which tries to explain all relations between <span class="math inline">\(\mathbf{Y}\)</span> and a set of <span class="math inline">\(\mathbf{x}\)</span>s through maximally correlated linear combinations of each.</p>
<p>When the predictor variables are all discrete or categorical, such as gender or level of education, methods like the simple <span class="math inline">\(t\)</span>-test, one-way ANOVA and factorial ANOVA with <span class="math inline">\(q=1\)</span> outcome measures all have simple extensions to the case of <span class="math inline">\(q&gt;1\)</span> outcomes.</p>
<div class="callout callout-style-default callout-note callout-titled" title="History Corner: Twins Reared Apart">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
History Corner: Twins Reared Apart
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why are there so many different names for regression vs.&nbsp;ANOVA concepts, statistics and techniques? In regression, we use notation like <span class="math inline">\(x_1, x_2, ...\)</span> to refer to <em>predictors</em> in a model, while in ANOVA, factors <span class="math inline">\(A, B, ...\)</span> are called <em>main effects</em>. In regression applications, we often test <em>linear hypotheses</em>, are interested in <em>coefficients</em> and evaluate a model with an <span class="math inline">\(R^2\)</span> statistic, while in ANOVA we may test <em>contrasts</em> among factor levels, and use <span class="math inline">\(F\)</span>-tests to evaluate models.</p>
<p>Well, like twins separated at birth, they grew up in homes in different places and with different parents, who were each free to choose their own names, not recognizing their shared DNA.</p>
<p>Methods of regression began in evolutionary biology with Francis Galton’s <span class="citation" data-cites="Galton:1886 Galton:1889">(<a href="#ref-Galton:1886" role="doc-biblioref">1886</a>, <a href="#ref-Galton:1889" role="doc-biblioref">1889</a>)</span> studies of heritability of traits, trying to understand how strongly the physical characteristics of one generation of living things resembled those in the next generation. From a study of the diameters of sweet peas in parent plants and their size in the next generation, and another on the relationship between heights of human parents and their offspring, he developed the fundamental ideas of regression. Karl Pearson <span class="citation" data-cites="Pearson:1896">(<a href="#ref-Pearson:1896" role="doc-biblioref">1896</a>)</span> formalized the mathematical technique of regression and laid the foundation for the extension to multiple regression.</p>
<p>In contrast, analysis of variance methods were raised on farms, notably the Rothamsted Experimental Station, where R. A. Fisher analyzed vast amounts of data on crop experiments designed to determine the conditions (soil condition, fertilizer treatments) that gave the greatest yields, while controlling for extraneous determiners (plots of planting). With multiple factors determining the outcome, Fisher <span class="citation" data-cites="Fisher1923">(<a href="#ref-Fisher1923" role="doc-biblioref">1923</a>)</span>, in an experiment on yields of different varieties of potatoes given various manure treatments, devised the method of breaking down the total variance into portions attributable to each factor and presented the first ANOVA table. The method became well-known after Fisher’s <span class="citation" data-cites="Fisher:25">(<a href="#ref-Fisher:25" role="doc-biblioref">1925</a>)</span> <em>Statistical Methods for Research Workers</em>.</p>
<p>The great synthesis of regression and ANOVA did not take place until the 1960s. At that time, methods for computing were beginning to move from programmable desk calculators to mainframe computers, largely using a collection of separate FORTRAN programs, designed for regression, one-way ANOVA, two-way ANOVA, models with interactions, and so forth. To complete an analysis, as a graduate student I often had to use three or more different programs.</p>
<p>Then, something remarkable happened on two fronts: theory and computation. First, in quick succession textbooks by <span class="citation" data-cites="Scheffe1960">Scheffé (<a href="#ref-Scheffe1960" role="doc-biblioref">1960</a>)</span>, <span class="citation" data-cites="Graybill1961">Graybill (<a href="#ref-Graybill1961" role="doc-biblioref">1961</a>)</span>, <span class="citation" data-cites="Winer1962">Winer (<a href="#ref-Winer1962" role="doc-biblioref">1962</a>)</span> and others began to layout a general theory of linear models that encompassed all of these separate models, giving the “<strong>General Linear Model</strong>” its well-deserved name. Second, two symposiums, one at IBM Yorkdown Heights (<span class="citation" data-cites="IBM1965">IBM (<a href="#ref-IBM1965" role="doc-biblioref">1965</a>)</span>) and the other at the University of Georgia (<span class="citation" data-cites="BradshawFindley1967">Bashaw &amp; Findley (<a href="#ref-BradshawFindley1967" role="doc-biblioref">1967</a>)</span>) resulted in the first general programs to handle <em>all these cases</em> in an understandable way.</p>
<p>A bit of matrix algebra thrown into the mix showed that most of the ideas for univariate models could be extended to multiple response variables, and so the “**Multivariate Linear Model” was born. R. Darrell Bock <span class="citation" data-cites="Bock1963 Bock1964">(<a href="#ref-Bock1963" role="doc-biblioref">Bock, 1963</a>, <a href="#ref-Bock1964" role="doc-biblioref">1964</a>)</span> sketched a flowchart of the computational steps, which was implemented at the University of Chicago by Jeremy Finn <span class="citation" data-cites="Finn1967">(<a href="#ref-Finn1967" role="doc-biblioref">1967</a>)</span> in the MULTIVARIANCE program. A group at the University of North Carolina headed by Elliot Cramer developed their MANOVA program <span class="citation" data-cites="Clyde-etal-1966">(<a href="#ref-Clyde-etal-1966" role="doc-biblioref">Clyde et al., 1966</a>)</span> and Willard Dixon <span class="citation" data-cites="Dixon1965">(<a href="#ref-Dixon1965" role="doc-biblioref">1965</a>)</span> at UCLA developed the BMD programs incorporating these ideas. The ANOVA and regression twins had finally become part of a larger family.</p>
<!--
...
Graybill, Winer, Bock  ... -> Symposium 1967

Birth of the general linear models : https://files.eric.ed.gov/fulltext/ED026737.pdf

Bock1966: flowchart -> Jeremy Finn (1967) MULTIVARIANCE
Elliot Cramer (UNC) -> Clyde, Cramer & Shering (1966) MANOVA
Dixon, UCLA (1965): BMD
-->
</div>
</div>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/nestedLogit">nestedLogit</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
   **TODO**: Removed the stuff on linear combinations

## Linear combinations

All methods of multivariate statistics involve a simple idea: Finding weighted sums---_linear combinations_--- of
observed variables to optimize some criterion---maximizing a measure of goodness-of-fit, like $R^2$ or minimizing
a measure of badness-of-fit like sums of squares of residuals. Methods differ according to whether:

* All variables belong to **one set** (say, $\mathbf{X}$), not distinguished as to whether they are responses or predictors, as in PCA and factor analysis, 
vs. **two sets** where one set  is considered outcome, dependent variables, to be explained by predictors, 
independent variables ($\mathbf{X}$),
as in multiple regression, multivariate analysis of variance, discriminant analysis and canonical correlation analysis.

* The variables in $\mathbf{X}$ and $\mathbf{Y}$ are discrete, **categorical factors** like sex and level of education or **quantitative** variables like salary and number of years of experience.

#### PCA {.unnumbered}
For example, @fig-lin-comb-pca illustrates PCA (as we saw in @sec-pca-biplot) as finding weights to maximize the variance of linear combinations, $v_1, v_2, ...$,
\begin{eqnarray*}
\mathbf{v}_1 & = & a_1 \mathbf{x}_1 + a_2 \mathbf{x}_2 + a_3 \mathbf{x}_3 + a_4 \mathbf{x}_4 \\
\mathbf{v}_2 & = & b_1 \mathbf{x}_1 + b_2 \mathbf{x}_2 + b_3 \mathbf{x}_3 + b_4 \mathbf{x}_4 \\
\vdots & = & \vdots \; , \\
\end{eqnarray*}

subject to all $\mathbf{v}_i, \mathbf{v}_j$ being uncorrelated, $\mathbf{v}_i \;\perp\; \mathbf{v}_j$.


::: {.cell layout-align="center"}
::: {.cell-output-display}
![Principal components analysis as linear combinations to maximize variance accounted for. Left: diagram of PCA showing two uncorrelated linear combinations, v1 and v2. Right: Geometry of PCA.](images/lin-comb-pca.png){#fig-lin-comb-pca fig-align='center' width=100%}
:::
:::


#### Multiple regression {.unnumbered}

An analogous diagram for multiple regression is shown in @fig-lin-comb-mra. Here, we find the weights $b_1, b_2, \dots$
to maximize the $R^2$ of $\mathbf{y}$ with the predicted values $\widehat{\mathbf{y}}$,

$$
\widehat{\mathbf{y}} = b_1 \mathbf{x}_1 + b_2 \mathbf{x}_2 + b_3 \mathbf{x}_3 \period
$$
In the vector diagram at the right, saying that the fitted vector $\widehat{\mathbf{y}}$ is a linear combination of
$\mathbf{x}_1$ and $\mathbf{x}_2$ means that it lies in the plane that they define. 
The fitted vector is the orthogonal projection of $\mathbf{y}$ on this plane, and
the least squares weights $b_1$ and $b_2$ give the maximum possible correlation $r^2 (\mathbf{y}, \widehat{\mathbf{y}})$.


::: {.cell layout-align="center"}
::: {.cell-output-display}
![Multiple regression as a linear combination to maximize the squared correlation with the predicted values $\hat{\mathbf{y}}$. Right: vector geometry of multiple regression for two predictors.](images/lin-comb-mra.png){#fig-lin-comb-mra fig-align='center' width=100%}
:::
:::


The vector of residuals,
$\mathbf{e} = \mathbf{y} -\widehat{\mathbf{y}}$ is orthogonal to that plane ($\mathbf{y}$ and
$\mathbf{e}$ are uncorrelated), and the least squares solution also minimizes length 
$\parallel \mathbf{e} \parallel = \sqrt(\Sigma e_i^2)$.


#### Multivariate regression {.unnumbered}

Multivariate multiple regression does the same thing for each response variable, $\mathbf{y}_1$ and $\mathbf{y}_2$,
as shown in @fig-lin-comb3. It finds the weights to maximize the correlation between _each_ $\mathbf{y}_j$
and the corresponding predicted value $\widehat{\mathbf{y}}_j$.

\begin{eqnarray*}
\widehat{\mathbf{y}}_1 & = & a_1 \mathbf{x}_1 + a_2 \mathbf{x}_2 + a_3 \mathbf{x}_3 \\
\widehat{\mathbf{y}}_2 & = & b_1 \mathbf{x}_1 + b_2 \mathbf{x}_2 + b_3 \mathbf{x}_3 \\
\end{eqnarray*}



::: {.cell layout-align="center"}
::: {.cell-output-display}
![Multivariate multiple regression as linear combinations to maximize the R squared for each response variable separately.](images/lin-comb3.png){#fig-lin-comb3 fig-align='center' width=40%}
:::
:::


The weights $a_1, a_2, a_3$ and $b_1, b_2, b_3$ are the same as would be found in separate multiple regressions
for the response variables. 
However, the multivariate tests used here take the correlations among the $\mathbf{y}$s, and can be more powerful
than fitting separate univariate response models.

#### Canonical correlation analysis {.unnumbered}

Finally, canonical correlation analysis uses a different approach to fitting relations between a set of
responses, $\mathbf{y}_1, \mathbf{y}_2, \dots$ and a set of predictors, $\mathbf{x}_1, \mathbf{x}_2, \dots$. ...


::: {.cell layout-align="center"}
::: {.cell-output-display}
![Canonical correlation analyis finds uncorrelated linear combinations of the responses which maximize the R squared with linear combinations of the predictors.](images/lin-comb4.png){#fig-lin-comb4 fig-align='center' width=40%}
:::
:::

-->
<section id="sec-GLM" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="sec-GLM">
<span class="header-section-number">5.1</span> The General Linear Model</h2>
<p>To establish notation and terminology, it is worthwhile to state the general linear model formally. For convenience, I use vector and matrix notation. This expresses a response variable, <span class="math inline">\(\mathbf{y} = (y_1, y_2, \dots , y_n)^\mathsf{T}\)</span> for <span class="math inline">\(n\)</span> observations, as a sum of terms involving <span class="math inline">\(p\)</span> <em>regressors</em>, <span class="math inline">\(\mathbf{x}_1, \mathbf{x}_2, \dots , \mathbf{x}_p\)</span>, each of length <span class="math inline">\(n\)</span>.</p>
<!-- $$ -->
<!-- \begin{align*} -->
<!-- \mathbf{y} & = \beta_0 + \beta_1 \mathbf{x}_1 + \beta_2 \mathbf{x}_2 + \cdots + \beta_p \mathbf{x}_p + \mathbf{\epsilon} \\ -->
<!--            & = \left[ \mathbf{1},\; \mathbf{x}_1,\; \mathbf{x}_2,\; \dots ,\; \mathbf{x}_p \right] \; \boldsymbol{\beta} + \boldsymbol{\epsilon} \\ -->
<!--            & = \mathbf{X}_{n \times (p+1)}\; \boldsymbol{\beta}_{(p+1) \times 1} + \boldsymbol{\epsilon} -->
<!-- \end{align*} -->
<!-- $$ -->
<p><span id="eq-glm"><span class="math display">\[\begin{aligned}
\mathbf{y} &amp; = \beta_0 + \beta_1 \mathbf{x}_1 + \beta_2 \mathbf{x}_2 + \cdots + \beta_p \mathbf{x}_p + \mathbf{\epsilon} \\
           &amp; = \left[ \mathbf{1},\; \mathbf{x}_1,\; \mathbf{x}_2,\; \dots ,\; \mathbf{x}_p \right] \; \boldsymbol{\beta} + \boldsymbol{\epsilon} \\
\end{aligned} \tag{5.1}\]</span></span></p>
<!-- & = \LARGE{\sizedmat{X}{n \times (p+1)}\; \sizedmat{\boldsymbol{\beta}}{(p+1) \times 1} + \boldsymbol{\epsilon}} -->
<p>or, expressed in matrices,</p>
<p><span class="math display">\[
\large{\mathord{\mathop{\mathbf{y}}\limits_{n \times 1}} = \mathord{\mathop{\mathbf{X}}\limits_{n \times (p+1)}}\; \mathord{\mathop{\mathbf{\boldsymbol{\beta}}}\limits_{(p+1) \times 1}} + \boldsymbol{\epsilon}}
\]</span></p>
<p>The matrix <span class="math inline">\(\mathbf{X}\)</span> is called the <em>model matrix</em> and contains the numerical representations of the predictor variables called <em>regressors</em>. The essential thing about a linear model is that it is linear in the <strong>parameters</strong> <span class="math inline">\(\beta_i\)</span>. That is, the predicted value of <span class="math inline">\(\mathbf{y}\)</span> is a linear combination of some <span class="math inline">\(\mathbf{x}_i\)</span> with weights <span class="math inline">\(\beta_i\)</span>. An example of a nonlinear model is the exponential growth model, <span class="math inline">\(y = \beta_0 + e^{\beta_1 x}\)</span>, where the parameter <span class="math inline">\(\beta_1\)</span> appears as an exponent.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<ul>
<li><p>These can be quantitative variables like <code>age</code>, <code>salary</code> or <code>years</code> of education. But they can also be transformed versions, like <code>sqrt(age)</code> or <code>log(salary)</code>.</p></li>
<li><p>A quantitative variable can be represented by more than one model regressor, for example if it is expressed as a polynomial like <code>poly(age, degree=2)</code> or a natural spline like <code>ns(salary, df=5)</code>. The model matrix portion for such terms contains one column for each degree of freedom (<code>df</code>) and there are <code>df</code> coefficients in the corresponding portion of <span class="math inline">\(\boldsymbol{\beta}\)</span>.</p></li>
<li><p>A categorical or discrete predictor– a factor variable in R– with <span class="math inline">\(d\)</span> levels is expressed as <span class="math inline">\(d - 1\)</span> columns in <span class="math inline">\(\mathbf{X}\)</span>. Typically these are contrasts or comparisons between a baseline or reference level and each of the remaining ones, but any set of <span class="math inline">\(d - 1\)</span> linearly independent contrasts can be used by assigning to <code>contrasts(factor)</code>. For example, <code>contrasts(factor) &lt;- contr.treatment(4)</code> for a 4-level factor assigns 3 contrasts representing comparisons with a baseline level, typically the first (in alphabetic order). For an <em>ordered</em> factor, such as one for political knowledge with levels “low”, “medium”, “high”, <code>contrasts.poly()</code> returns the coefficients of orthogonal polynomial contrasts representing linear and quadratic trends.</p></li>
<li><p>Interactions between predictors are represented as the direct products of the corresponding columns of <span class="math inline">\(\mathbf{X}\)</span>. This allows the effect of one predictor on the response to depend on values of other predictors. For example, the interaction of two quantitative variables, <span class="math inline">\(\mathbf{x}_1, \mathbf{x}_2\)</span> is represented by the product <span class="math inline">\(\mathbf{x}_1 \times \mathbf{x}_2\)</span>. More generally, for variables or factors <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> with degrees of freedom <span class="math inline">\(\text{df}_A\)</span> and <span class="math inline">\(\text{df}_B\)</span> the regressors in <span class="math inline">\(\mathbf{X}\)</span> are the <span class="math inline">\(\text{df}_A \times \text{df}_B\)</span> products of each column for <span class="math inline">\(A\)</span> with each column for <span class="math inline">\(B\)</span>.</p></li>
</ul>
<section id="sec-model-formulas" class="level3" data-number="5.1.1"><h3 data-number="5.1.1" class="anchored" data-anchor-id="sec-model-formulas">
<span class="header-section-number">5.1.1</span> Model formulas</h3>
<p>Statistical models in R, such as those fit by <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> and many other modelling function in R are expressed in a simple notation that was developed by <span class="citation" data-cites="WilkinsonRogers1973">Wilkinson &amp; Rogers (<a href="#ref-WilkinsonRogers1973" role="doc-biblioref">1973</a>)</span> for the GENSTAT software system at the Rothamsted Research Station. It solves the problem of having a compact way to specify any model consisting of any combinations of quantitative and discrete factor variables, interactions of these and arbitrary transformations of these.</p>
<p>In this, a <strong>model formula</strong> take the forms</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">response</span> <span class="op">~</span> <span class="va">terms</span></span>
<span><span class="va">response</span> <span class="op">~</span> <span class="va">term1</span> <span class="op">+</span> <span class="va">term2</span> <span class="op">+</span> <span class="va">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where the left-hand side, <code>response</code> specifies the response variable in the model and the right-hand side specifies the <code>terms</code> in the model specifying the columns in the <span class="math inline">\(\mathbf{X}\)</span> matrix of <a href="#eq-glm" class="quarto-xref">Equation&nbsp;<span class="quarto-unresolved-ref">eq-glm</span></a>; the coefficients <span class="math inline">\(\beta\)</span> are implied and not represented explicitly in the formula.</p>
<p>The notation <code>y ~ x</code> is read as “<code>y</code> <em>is modeled by</em> <code>x</code>”. The left-hand side is usually a variable name (such as <code>height</code>), but it could be an expression that evaluates to the the response, such as <code>log(salary)</code> or <code>weight/height^2</code> which represents the body mass index.</p>
<p>On the right-hand side (RHS), the usual arithmetic operator, <code>+, -, *, /, ^</code> have special meanings as described below. The most fundamental is that <code>y ~ a + b</code> is interpreted as “<code>y</code> is modeled by <code>a</code> <em>and</em> <code>b</code>”; that is, the sum of linear terms for <code>a</code> and <code>b</code>.</p>
<p>Some examples for regression-like models using only quantitative variables, <code>x, x1, x2, x3, ...</code> are shown below:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>                      <span class="co"># simple linear regression</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">1</span>                  <span class="co"># no intercept: regression through the origin </span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>             <span class="co"># quadratic model</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span>             <span class="co"># cubic model</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">*</span> <span class="va">x2</span>                <span class="co"># crossing: x1 + x2  +  x1 : x2</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span>           <span class="co"># multiple regression</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="op">(</span><span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>       <span class="co"># response surface: all quadratics &amp; two-way interactions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span>   <span class="co"># arbitrary transformation of response</span></span>
<span><span class="va">y1</span> <span class="op">+</span> <span class="va">y2</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span>     <span class="co"># response is sum of y1 and y2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The intercept <span class="math inline">\(\beta_0\)</span> is automatically included in the model without need to specify it explicitly. The minus sign, <code>-</code> on the right-hand side removes terms from the model, so a model with no intercept <span class="math inline">\(\beta_0 = 0\)</span> can be specifies as <code>y ~ X -1</code> (or perhaps more naturally, <code>y ~ 0 + X</code>).</p>
<p>Function calls on the RHS, such as <code>poly(x, 3)</code> are evaluated directly, but to use a special model operator, like <code>^</code> must be “protected” by wrapping the term in <code><a href="https://rdrr.io/r/base/AsIs.html">I()</a></code>, meaning “identity” or “inhibit”. Thus, the model <code>y ~ x + I(x^2)</code> means the quadratic model <span class="math inline">\(y = \beta_0 + \beta_1 x + \beta_2 x^2\)</span>. This differs from the model <code>y ~ poly(x, 2)</code> in that the former uses the raw <code>x, x^2</code> values (which are necessarily positively correlated) while <code><a href="https://rdrr.io/r/stats/poly.html">poly()</a></code> converts these to orthogonal polynomial scores, which are uncorrelated (and therefore free from problems of collinearity).</p>
<div id="exm-workers1" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.1</strong></span> <strong>Workers data: Regression models</strong></p>
<p>For the <code>workers</code> data (<a href="#exm-workers-pca" class="quarto-xref">Example&nbsp;<span class="quarto-unresolved-ref">exm-workers-pca</span></a>) you can fit simple regression models predicting income from years of experience using a linear and quadratic model as follows.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">workers</span>, package <span class="op">=</span> <span class="st">"matlib"</span><span class="op">)</span></span>
<span><span class="va">workers.mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Income</span> <span class="op">~</span> <span class="va">Experience</span>, data<span class="op">=</span><span class="va">workers</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">workers.mod1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#              [,1]</span></span>
<span><span class="co"># (Intercept) 29.16</span></span>
<span><span class="co"># Experience   1.12</span></span>
<span></span>
<span><span class="va">workers.mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Income</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">Experience</span>, <span class="fl">2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">workers</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">workers.mod2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#                       [,1]</span></span>
<span><span class="co"># (Intercept)           46.5</span></span>
<span><span class="co"># poly(Experience, 2)1  39.1</span></span>
<span><span class="co"># poly(Experience, 2)2 -11.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(In this code, <code>coef(workers.mod2) |&gt; t() |&gt; t()</code> is used to print the coefficients as a one-column matrix.)</p>
<p>It is simplest to understand these models by plotting the data overlaid with the fitted regressions. Ths uses <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> and specifies the smoothing model as <code>method = "lm"</code> with a <code>formula</code>, which is <code>y ~ x</code> for the linear model and <code>y ~ poly(x, 2)</code> for the quadratic.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">workers</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Experience</span>, y <span class="op">=</span> <span class="va">Income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>              se <span class="op">=</span> <span class="cn">FALSE</span>, linewidth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>              se <span class="op">=</span> <span class="cn">FALSE</span>, linewidth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-workers-fits" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-workers-fits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-workers-fits-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-workers-fits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.2: Workers data with fitted linear and quadratic models for years of experience.
</figcaption></figure>
</div>
</div>
</div>
<p>The coefficients of the linear model are also easy to interpret:</p>
<div class="cell" data-layout-align="center">
<p><span class="math display">\[
\operatorname{\widehat{Income}} = 29.162 + 1.119(\operatorname{Experience})
\]</span></p>
</div>
<p>So a worker with zero years of experience can expect an income of $29162 and this should increase by $1119 for each additional year. However, it is not so simple to interpret the coefficients when a <code><a href="https://rdrr.io/r/stats/poly.html">poly()</a></code> term is used. Naively plugging in the coefficients for <code>workers.mod2</code> gives</p>
<div class="cell" data-layout-align="center">
<p><span class="math display">\[
\operatorname{\widehat{Income}} = 46.5 + 39.111(\operatorname{Experience}) - 11.16(\operatorname{Experience^2})
\]</span></p>
</div>
<p>The problem is that <span class="math inline">\(x\)</span> = <code>Experience</code> in model <code>workers.mod</code> is represented not by the raw values, but rather by values of <span class="math inline">\(x\)</span> and <span class="math inline">\(x^2\)</span> that have been made to be uncorrelated. If you really want to interpret the coefficient values in terms of years of experience, use the option <code>raw = TRUE</code> in <code><a href="https://rdrr.io/r/stats/poly.html">poly()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">workers.mod2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Income</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">Experience</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                    data<span class="op">=</span><span class="va">workers</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># lm(formula = Income ~ poly(Experience, 2, raw = TRUE), data = workers)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Coefficients:</span></span>
<span><span class="co">#                      (Intercept)  poly(Experience, 2, raw = TRUE)1  </span></span>
<span><span class="co">#                          23.0680                            2.2952  </span></span>
<span><span class="co"># poly(Experience, 2, raw = TRUE)2  </span></span>
<span><span class="co">#                          -0.0335</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
\operatorname{\widehat{Income}} = 23.07 + 2.3(\operatorname{Experience}) - 0.03(\operatorname{Experience}^2)
\]</span> This says that income is predicted to be $23,068 with no experience, increase initially by $2295, but that yearly increase decreases by $330. Some further details of orthogonal polynomials are explained below.</p>
</div>
<section id="factors" class="level4" data-number="5.1.1.1"><h4 data-number="5.1.1.1" class="anchored" data-anchor-id="factors">
<span class="header-section-number">5.1.1.1</span> Factors</h4>
<p>Factor variables are treated specially in linear models, but have simple notations in R formulas. The following examples use <code>A, B, C</code> to represent discrete factors with two or more levels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">~</span> <span class="va">A</span>                 <span class="co"># one-way ANOVA</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span>             <span class="co"># two-way, main effects only</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">*</span> <span class="va">B</span>             <span class="co"># full two-way, with interaction</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span> <span class="op">+</span> <span class="va">A</span><span class="op">:</span><span class="va">B</span>       <span class="co"># same, in long-hand</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">A</span>             <span class="co"># one-way ANCOVA</span></span>
<span><span class="va">y</span> <span class="op">~</span> <span class="op">(</span><span class="va">A</span> <span class="op">+</span> <span class="va">B</span> <span class="op">+</span> <span class="va">C</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>     <span class="co"># three-way ANOVA, incl. all two-way interactions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="crossing" class="level4 unnnumbered" data-number="5.1.1.2"><h4 class="unnnumbered anchored" data-number="5.1.1.2" data-anchor-id="crossing">
<span class="header-section-number">5.1.1.2</span> Crossing</h4>
<p>The <code>*</code> operator has special meaning used to specify the crossing of variables and factors and <code>:</code> specifies interactions (products of variables). So, the model <code>y ~ x1 * x2</code> is expanded to give <code>y ~ x1 + x2 + x1:x2</code> and the interaction term <code>x1:x2</code> is calculated as <span class="math inline">\(x_1 \times x_2\)</span>. In algebraic notation (omitting the error term) this works out to the model,</p>
<p><span class="math display">\[\begin{aligned}
y &amp; = &amp; \beta_0 + \beta_1 x_1 +  \beta_2 x_2 +  \beta_1 x_1 *  \beta_2 x_2 \\
  &amp; = &amp; \beta_0 + (\beta_1 + \beta_2 x_2) x_1 + \beta_2 x_2 \:\: ,\\
\end{aligned}\]</span></p>
<p>which means that the coefficient for <span class="math inline">\(x_1\)</span> in the model is not constant for all values of <span class="math inline">\(x_2\)</span>, but rather changes with the value of <span class="math inline">\(x_2\)</span>. If <span class="math inline">\(\beta_2 &gt; 0\)</span>, the slope for <span class="math inline">\(x_1\)</span> increases with <span class="math inline">\(x_2\)</span> and vice-versa.</p>
<p><code>y ~ A * B</code> for factors is similar, expanding to <code>y ~ A + B + A:B</code>, but the columns in the model matrix represent contrasts among the factor levels as described in detail below (<a href="#sec-contrasts" class="quarto-xref"><span class="quarto-unresolved-ref">sec-contrasts</span></a>). The main effects, <code>A</code> and <code>B</code> come from contrasts among the means of their factor levels and the interaction term <code>A:B</code> reflects <em>differences</em> among means of <code>A</code> across the levels of <code>B</code> (and vice-versa).</p>
<p>The model formula <code>y ~ x + A</code> specifies an ANCOVA model with different intercepts for the levels of <code>A</code>, but with a common slope for <code>x</code>. Adding an interaction of <code>x:A</code> in the model <code>y ~ x * A</code> allow separate slopes and intercepts for the groups.</p>
</section><section id="powers" class="level4 unnnumbered" data-number="5.1.1.3"><h4 class="unnnumbered anchored" data-number="5.1.1.3" data-anchor-id="powers">
<span class="header-section-number">5.1.1.3</span> Powers</h4>
<p>The <code>^</code> exponent operator indicates <em>powers of a term expression</em> to a specified degree. Thus the term <code>(A + B)^2</code> is identical to <code>(A + B) * (A + B)</code> which expands to the main effects of <code>A</code>, <code>B</code> and their interaction, also identical to <code>A * B</code>. In general, the product of parenthesized terms expands as in ordinary algebra,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">~</span> <span class="op">(</span><span class="va">A</span> <span class="op">+</span> <span class="va">B</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">C</span> <span class="op">+</span> <span class="va">D</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span> <span class="op">+</span> <span class="va">C</span> <span class="op">+</span> <span class="va">D</span> <span class="op">+</span> <span class="va">A</span><span class="op">:</span><span class="va">C</span> <span class="op">+</span> <span class="va">A</span><span class="op">:</span><span class="va">D</span> <span class="op">+</span> <span class="va">B</span><span class="op">:</span><span class="va">C</span> <span class="op">+</span> <span class="va">B</span><span class="op">:</span><span class="va">D</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Powers get more interesting with more terms, so <code>(A + B + C)^2</code> is the same as <code>(A + B + C) * (A + B + C)</code>, which includes main effects of <code>A</code>, <code>B</code> and <code>C</code> as well as all two-way interactions, <code>A:B, A:C</code> and <code>B:C</code>. The model formula <code>(A + B + C)^3</code> expands to include all two-way interactions and the three-way interaction <code>A:B:C</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">A</span> <span class="op">+</span> <span class="va">B</span> <span class="op">+</span> <span class="va">C</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span> <span class="op">-&gt;</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span> <span class="op">+</span> <span class="va">C</span> <span class="op">+</span> <span class="va">A</span><span class="op">:</span><span class="va">B</span> <span class="op">+</span> <span class="va">A</span><span class="op">:</span><span class="va">C</span> <span class="op">+</span> <span class="va">B</span><span class="op">:</span><span class="va">C</span> <span class="op">+</span> <span class="va">A</span><span class="op">:</span><span class="va">B</span><span class="op">:</span><span class="va">C</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this context <code>-</code> can be use to remove terms, as shown in the following examples</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(A <span class="sc">+</span> B <span class="sc">+</span> C)<span class="sc">^</span><span class="dv">2</span> <span class="ot">&lt;-</span><span class="er">&gt;</span> (A <span class="sc">+</span> B <span class="sc">+</span> C)<span class="sc">^</span><span class="dv">3</span> <span class="sc">-</span> A<span class="sc">:</span>B<span class="sc">:</span>C</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>(A <span class="sc">+</span> B <span class="sc">+</span> C)<span class="sc">^</span><span class="dv">3</span> <span class="sc">-</span> B<span class="sc">:</span>C <span class="sc">-</span> A<span class="sc">:</span>B<span class="sc">:</span>C  <span class="ot">&lt;-</span><span class="er">&gt;</span> A <span class="sc">+</span> B <span class="sc">+</span> C <span class="sc">+</span> A<span class="sc">:</span>B <span class="sc">+</span> A<span class="sc">:</span>C </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, the symbol <code>.</code> on the right-hand side specifies <em>all terms</em> in the current dataset other than the response. Thus if you have a data.frame containing <code>y, x1, x2, ..., x6</code>, you can specify a model with all variables except <code>x6</code> as predictors as</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">x6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To test what we’ve covered above,</p>
<ul>
<li><p>What do you think the model formula <code>y ~ .^2</code> means in a data set containing variables <code>x1, x2, x3,</code> and <code>x4</code>?</p></li>
<li><p>What about the formula with <code>y ~ .^2 - A:B:C:D</code> with factors <code>A, B, C, D</code>?</p></li>
</ul>
<p>You can work out questions like these or explore model formulae using <code><a href="https://rdrr.io/r/stats/terms.html">terms()</a></code> for a <code>"formula"</code> object. The labels of these terms can then be concatenated to a string and turned back into a formula using <code><a href="https://rdrr.io/r/stats/formula.html">as.formula()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="op">(</span><span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">terms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/terms.html">terms</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, <span class="st">"term.labels"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">terms</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span></span>
<span><span class="co"># [1] "x1 + x2 + x3 + x4 + x1:x2 + x1:x3 + x1:x4 + x2:x3 + x2:x4 + x3:x4"</span></span>
<span><span class="co"># convert back to a formula</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"y ~ %s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">terms</span>, collapse<span class="op">=</span><span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># y ~ x1 + x2 + x3 + x4 + x1:x2 + x1:x3 + x1:x4 + x2:x3 + x2:x4 + </span></span>
<span><span class="co">#     x3:x4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="model-matrices" class="level3" data-number="5.1.2"><h3 data-number="5.1.2" class="anchored" data-anchor-id="model-matrices">
<span class="header-section-number">5.1.2</span> Model matrices</h3>
<p>As noted above, a model formula is used to generate the <span class="math inline">\(n \times (p+1)\)</span> model matrix, <span class="math inline">\(\mathbf{X}\)</span>, typically containing the column of 1s for the intercept <span class="math inline">\(\beta_0\)</span> in the model, followed by <span class="math inline">\(p\)</span> columns representing the regressors <span class="math inline">\(\mathbf{x}_1, \mathbf{x}_2, \dots , \mathbf{x}_p\)</span>. Internally, <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> uses <code><a href="https://rdrr.io/r/stats/model.matrix.html">stats::model.matrix()</a></code> and you can use this to explore how factors, interactions and other model terms are represented in a model object.</p>
<p>For a small example, here are a few observations representing income (<code>inc</code>) and <code>type</code> of occupation, taking on values <code>bc</code> (blue colar), <code>wc</code> (white colar) and <code>prof</code> (professional). <code><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix()</a></code> takes a <em>one-sided</em> formula with the terms on the right-hand side. The main effect model looks like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">inc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">9</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bc"</span>, <span class="st">"wc"</span>, <span class="st">"prof"</span><span class="op">)</span>, each <span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">inc</span> <span class="op">+</span> <span class="va">type</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">mm</span><span class="op">)</span></span>
<span><span class="co">#   type X.Intercept. inc typeprof typewc</span></span>
<span><span class="co"># 1   bc            1  38        0      0</span></span>
<span><span class="co"># 2   bc            1  39        0      0</span></span>
<span><span class="co"># 3   bc            1  26        0      0</span></span>
<span><span class="co"># 4   wc            1  37        0      1</span></span>
<span><span class="co"># 5   wc            1  33        0      1</span></span>
<span><span class="co"># 6   wc            1  30        0      1</span></span>
<span><span class="co"># 7 prof            1  35        1      0</span></span>
<span><span class="co"># 8 prof            1  23        1      0</span></span>
<span><span class="co"># 9 prof            1  33        1      0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see, <code>type</code>, with 2 degrees of freedom is represented by two <strong>dummy</strong> (0/1) variables, labeled <code>typeprof</code> and <code>typewc</code> here. Together, these represent <em>treatment contrasts</em> (comparisons) between the <em>baseline</em> group <code>type=="bc"</code>, which is coded (0, 0) and each of the others: <code>type=="prof"</code>, coded (1, 0) and <code>type=="wc"</code>, codes (0, 1). Different coding schemes are described in the following section.</p>
<p>In a model with the interaction <code>inc * type</code>, additional columns are constructed as the <strong>product</strong> of <code>inc</code> with each of the columns for <code>type</code>. We will see below how this generalizes to an arbitrary number of predictor terms and their possible interactions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">inc</span> <span class="op">*</span> <span class="va">type</span><span class="op">)</span></span>
<span><span class="co">#   (Intercept) inc typeprof typewc inc:typeprof inc:typewc</span></span>
<span><span class="co"># 1           1  38        0      0            0          0</span></span>
<span><span class="co"># 2           1  39        0      0            0          0</span></span>
<span><span class="co"># 3           1  26        0      0            0          0</span></span>
<span><span class="co"># 4           1  37        0      1            0         37</span></span>
<span><span class="co"># 5           1  33        0      1            0         33</span></span>
<span><span class="co"># 6           1  30        0      1            0         30</span></span>
<span><span class="co"># 7           1  35        1      0           35          0</span></span>
<span><span class="co"># 8           1  23        1      0           23          0</span></span>
<span><span class="co"># 9           1  33        1      0           33          0</span></span>
<span><span class="co"># attr(,"assign")</span></span>
<span><span class="co"># [1] 0 1 2 2 3 3</span></span>
<span><span class="co"># attr(,"contrasts")</span></span>
<span><span class="co"># attr(,"contrasts")$type</span></span>
<span><span class="co"># [1] "contr.treatment"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-contrasts" class="level3" data-number="5.1.3"><h3 data-number="5.1.3" class="anchored" data-anchor-id="sec-contrasts">
<span class="header-section-number">5.1.3</span> Coding factors and contrasts</h3>
<p>Discrete explanatory variables, such as race, type of occupation or level of education require special attention in linear models because, unlike continuous variables, they cannot by entered into the model equation just as they are. Instead, we need some way to code those variables numerically.</p>
<p>A key insight is that your choice of a coding scheme changes the meaning of the model parameters, and allows you to perform different comparisons (test different statistical hypotheses) about the means of the category levels according to meaningful questions in your research design. For a more general discussion of coding schemes, see <span class="citation" data-cites="FoxWeisberg:2018">Fox &amp; Weisberg (<a href="#ref-FoxWeisberg:2018" role="doc-biblioref">2018</a>)</span>, sec.&nbsp;4.7 and the vignette <a href="https://cran.r-project.org/web/packages/codingMatrices/vignettes/codingMatrices.pdf">Coding Matrices, Contrast Matrices and Linear Models</a> for the <span style="color: brown;"><strong>codingMatrices</strong></span> package.</p>
<p>Each coding scheme for a factor represents the <strong>same</strong> model in terms of fitted values and overall significance for that term, but they differ in how the coefficients are parameterized and interpreted. This is crucial to understand, because tests of the coefficients can directly answer different research questions depending on the coding scheme used.</p>
<p>In R, categorical variables are called <strong>factors</strong> usually created by <code>g &lt;- factor(g)</code> or <code>g &lt;- as.factor(g)</code> for a discrete variable <code>g</code>. If levels of the variable <code>g</code> are ordered, such as <code>type</code> of occupation with levels <code>"bc"</code> &lt; <code>"wc"</code> &lt; <code>"prof"</code> or dose of a drug, <code>"low"</code> &lt; <code>"medium"</code> &lt; <code>"high"</code>, you can use <code>g &lt;- ordered(g)</code> to reflect this.</p>
<p>In any case, a factor with <span class="math inline">\(k\)</span> levels is reflected in an overall test with <span class="math inline">\(k-1\)</span> degrees of freedom corresponding to the null hypothesis <span class="math inline">\(\mathcal{H}_0 : \mu_1 = \mu_2 = \cdots = \mu_k\)</span>. This can be represented as <span class="math inline">\(k-1\)</span> comparisons among the factor level means, or <span class="math inline">\(k-1\)</span> separate questions asking how the means differ.</p>
<p>Base R provides several coding schemes via assignment to the <code><a href="https://rdrr.io/r/stats/contrasts.html">contrasts()</a></code> function for a factor, as in <code>contrasts(df$Drug) &lt;- ...</code> one of:</p>
<ul>
<li><p><code><a href="https://rdrr.io/r/stats/contrast.html">contr.treatment()</a></code>: Compares each level to a <em>reference</em> level using <span class="math inline">\(k-1\)</span> dummy (0, 1) variables. This is the default, and the reference level is taken as the first (in alphabetic or numerical order). You can change the reference level using <code><a href="https://rdrr.io/r/stats/relevel.html">relevel()</a></code> or <code><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder()</a></code> for the factor, or simply using <code>factor(A, levels = ...)</code>.</p></li>
<li><p><code><a href="https://rdrr.io/r/stats/contrast.html">contr.sum()</a></code>: Compares each level to the grand mean.</p></li>
<li><p><code><a href="https://rdrr.io/r/stats/contrast.html">contr.helmert()</a></code>: Compares each level to the mean of the <em>previous</em> levels, which is useful for ordered categories such as <code>type</code> of occupation with levels <code>"bc"</code> &lt; <code>"wc"</code> &lt; <code>"prof"</code> or dose of a drug, <code>"low"</code> &lt; <code>"medium"</code> &lt; <code>"high"</code>.</p></li>
<li><p><code><a href="https://rdrr.io/r/stats/contrast.html">contr.poly()</a></code>: For ordered factors with <em>numeric</em> levels, this creates orthogonal polynomial contrasts, representing the linear, quadratic, cubic … trends in the factor means, as if these appeared as <span class="math inline">\(x, x^2, x^3, ...\)</span> terms in a model with <span class="math inline">\(x\)</span> as a numeric variable.</p></li>
</ul>
<p><strong>TODO</strong>: Move some stuff from 10.3.1 on contrasts here</p>
<p>I take up some of the details of these coding schemes below. But first, it is useful to define exactly what I mean by a <strong>contrast</strong>. For a factor with <span class="math inline">\(k\)</span> groups, a contrast is simply a comparison of the mean of one subset of groups against the mean of another subset. This is specified as a weighted sum, <span class="math inline">\(L\)</span> of the means <span class="math inline">\(\mathbf{\mu}\)</span> with weights <span class="math inline">\(\mathbf{c}\)</span> that sum to zero,</p>
<p><span class="math display">\[
L = \mathbf{c}^\mathsf{T} \boldsymbol{\mu} = \sum_i^k c_i \mu_i \quad\text{such that}\quad \Sigma c_i = 0 \; .
\]</span></p>
<p>Two contrasts, <span class="math inline">\(\mathbf{c}_1\)</span> and <span class="math inline">\(\mathbf{c}_2\)</span> are <em>orthogonal</em> if the sum of products of their weights is zero, i.e., <span class="math inline">\(\mathbf{c}_1^\top \mathbf{c}_2 = \Sigma c_{1i} \times c_{2i} = 0\)</span>. When contrasts are placed as columns of a matrix <span class="math inline">\(\mathbf{C}\)</span>, they are all <em>mutually orthogonal</em> if each pair is orthogonal, which means <span class="math inline">\(\mathbf{C}^\top \mathbf{C}\)</span> is a diagonal matrix. If the columns of <span class="math inline">\(\mathbf{C}\)</span> are normalized to have sums of squares = 1, then <span class="math inline">\(\mathbf{C}^\top \mathbf{C} = \mathbf{I}\)</span>.</p>
<p>Orthogonal contrasts correspond to statistically independent tests. This is nice because they reflect separate, non-overlapping research questions. Another consequence is that the sums of squares for the overall hypothesis of differences among the groups is <em>exactly decomposed</em> as the sum of the sum of squares accounted for by the <span class="math inline">\(k-1\)</span> contrasts <span class="math inline">\(L_i\)</span>:</p>
<p><span class="math display">\[
\text{SS}_{\text{group}} = \sum_i^{k-1} \text{SS} (L_i) \; .
\]</span></p>
<section id="treatment-coding" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="treatment-coding">Treatment coding</h4>
<p>Let’s examine R’s default coding scheme, <code>contr.treatment</code> (also called dummy coding), for a factor with 4 levels: ‘a’, ‘b’, ‘c’, and ‘d’, with a view to understanding the relationship between the true population means, <span class="math inline">\(\mu_a\)</span>, <span class="math inline">\(\mu_b\)</span>, <span class="math inline">\(\mu_c\)</span>, and <span class="math inline">\(\mu_d\)</span> and the parameters <span class="math inline">\(\boldsymbol{\beta}\)</span> estimated in a linear model. We get the following:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/contrast.html">contr.treatment</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#   b c d</span></span>
<span><span class="co"># a 0 0 0</span></span>
<span><span class="co"># b 1 0 0</span></span>
<span><span class="co"># c 0 1 0</span></span>
<span><span class="co"># d 0 0 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the columns of <code>C</code> correspond to three dummy variables for the levels b, c, d compared to the reference level a. If we denote these columns as <span class="math inline">\(x_b\)</span>, <span class="math inline">\(x_c\)</span>, and <span class="math inline">\(x_d\)</span>, then:</p>
<!-- \begin{equation*} -->
<p><span class="math display">\[
x_b =
\begin{cases}
1 &amp; \! \text{if factor=b} \\
0 &amp; \! \text{otherwise}
\end{cases}
;\quad
X_c =
\begin{cases}
1 &amp; \! \text{if factor=c} \\
0 &amp; \! \text{otherwise}
\end{cases}
;\quad
X_d =
\begin{cases}
1 &amp; \! \text{if factor=d} \\
0 &amp; \! \text{otherwise}
\end{cases}
\]</span> <!-- \end{equation*} --></p>
<p>The design matrix <span class="math inline">\(\mathbf{X}_{(4 \times 4)} = [\mathbf{1}, \mathbf{C}] = [\mathbf{1}, \mathbf{x}_b, \mathbf{x}_c, \mathbf{x}_c]\)</span> includes the constant column <span class="math inline">\(\mathbf{1}\)</span> representing the intercept, which averages over the factor levels when there are other terms in the model.</p>
<p><span class="math display">\[
\mathbf{X} =
\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\]</span></p>
<p>With this coding, the parameters <span class="math inline">\(\boldsymbol{\beta}\)</span> in the model are related to the means <span class="math inline">\(\boldsymbol{\mu}\)</span> as,</p>
<p><span class="math display">\[
\begin{pmatrix}
\mu_a \\
\mu_b \\
\mu_c \\
\mu_d \\
\end{pmatrix}
= \mathbf{X} \boldsymbol{\beta} =
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix}
\begin{pmatrix}
\beta_0 \\
\beta_b \\
\beta_c \\
\beta_d \\
\end{pmatrix}
=
\begin{pmatrix}  
\beta_0           \\
\beta_0 + \beta_b \\
\beta_0 + \beta_c \\
\beta_0 + \beta_d \\
\end{pmatrix}
\]</span></p>
<p>Thus we have,</p>
<p><span class="math display">\[
\begin{pmatrix}
\mu_a \\
\mu_b \\
\mu_c \\
\mu_d \\
\end{pmatrix}
=
\begin{pmatrix}  
\beta_0           \\
\beta_0 + \beta_b \\
\beta_0 + \beta_c \\
\beta_0 + \beta_d \\
\end{pmatrix}
\]</span></p>
<p>Note that <span class="math inline">\(\mathbf{X}\)</span> is non-singular as long as the comparisons in <span class="math inline">\(\mathbf{C}\)</span> are linearly independent. It’s inverse, <span class="math inline">\(\mathbf{X}^{-1}\)</span> determines how the transformed parameters relate to the original class means, that is, it determines the <em>interpretation</em> of the parameters in terms of the means.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">C</span><span class="op">)</span></span>
<span><span class="va">Xinv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#    a b c d</span></span>
<span><span class="co">#    1 0 0 0</span></span>
<span><span class="co"># b -1 1 0 0</span></span>
<span><span class="co"># c -1 0 1 0</span></span>
<span><span class="co"># d -1 0 0 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Thus, you can solve for the parameters in terms of the means symbolically as follows</p>
<p><span class="math display">\[
\begin{pmatrix}
\beta_0 \\
\beta_b \\
\beta_c \\
\beta_d \\
\end{pmatrix}
= \mathbf{X}^{-1} \boldsymbol{\mu} = \begin{bmatrix}
1 &amp;  0 &amp;  0 &amp;  0 \\
-1 &amp;  1 &amp;  0 &amp;  0 \\
-1 &amp;  0 &amp;  1 &amp;  0 \\
-1 &amp;  0 &amp;  0 &amp;  1 \\
\end{bmatrix}
\begin{pmatrix}
\mu_a \\
\mu_b \\
\mu_c \\
\mu_d \\
\end{pmatrix}
= \begin{pmatrix}  
\mu_a           \\
\mu_b - \mu_a   \\
\mu_c - \mu_a   \\
\mu_d - \mu_a    \\
\end{pmatrix}
\]</span></p>
<!--
From this you can see how the coefficients are interpreted:

- $\beta_0$: The intercept, which here is the mean response for the reference level 'a' (i.e., $\mu_a = \beta_0$)
- $\beta_b$: The difference in mean response between level 'b' and reference level 'a' (i.e., $\mu_b = \beta_0 + \beta_b$ or $\beta_b = \mu_b - \mu_a$)
- $\beta_c$: The difference in mean response between level 'c' and reference level 'a' (i.e., $\mu_c = \beta_0 + \beta_c$ or $\beta_c = \mu_c - \mu_a$)
- $\beta_d$: The difference in mean response between level 'd' and reference level 'a' (i.e., $\mu_d = \beta_0 + \beta_d$ or $\beta_d = \mu_d - \mu_a$)
-->
</section><section id="deviation-coding" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="deviation-coding">Deviation coding</h4>
<p>Another common coding scheme, useful for unordered factors, is <em>deviation coding</em> given by <code>contrast.sum()</code>. This has the property that the parameters are constrained to sum to zero, <span class="math inline">\(\Sigma \beta_i = 0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/contrast.html">contr.sum</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#   [,1] [,2] [,3]</span></span>
<span><span class="co"># a    1    0    0</span></span>
<span><span class="co"># b    0    1    0</span></span>
<span><span class="co"># c    0    0    1</span></span>
<span><span class="co"># d   -1   -1   -1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The parameters estimated with this coding are: With this coding, the intercept is <span class="math inline">\(\beta_0 = \bar{\mu}\)</span>, the grand mean across all levels and the parameters are the deviations from that,</p>
<ul>
<li><span class="math inline">\(\beta_1 = \mu_a - \bar{\mu}\)</span></li>
<li><span class="math inline">\(\beta_2 = \mu_b - \bar{\mu}\)</span></li>
<li><span class="math inline">\(\beta_3 = \mu_c - \bar{\mu}\)</span></li>
</ul>
<p>A (redundant) coefficient for the last group is omitted, because with this coding a coefficient for that group would be equal to the negative of the sum of the others, <span class="math inline">\(\beta_d = \mu_d - \bar{\mu} = -(\beta_1 + \beta_2 + \beta_3)\)</span>.</p>
</section><section id="helmert-contrasts" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="helmert-contrasts">Helmert contrasts</h4>
<p>For <strong>ordered factors</strong>, it is sensible to take the ordering into account in interpreting the results. <em>Helmert contrasts</em> are designed for this purpose. The intercept is again the grand mean across all levels. Each contrast compares the mean of a given level to the <em>average of all previous</em> ones in the order; they contrast the second level with the first, the third with the average of the first two, and so on.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/contrast.html">contr.helmert</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#   [,1] [,2] [,3]</span></span>
<span><span class="co"># a   -1   -1   -1</span></span>
<span><span class="co"># b    1   -1   -1</span></span>
<span><span class="co"># c    0    2   -1</span></span>
<span><span class="co"># d    0    0    3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is easier to understand these if the columns are normalized so that the largest value in each column is 1.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">C</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/fractions.html">fractions</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#   [,1] [,2] [,3]</span></span>
<span><span class="co"># a   -1 -1/2 -1/3</span></span>
<span><span class="co"># b    1 -1/2 -1/3</span></span>
<span><span class="co"># c    0    1 -1/3</span></span>
<span><span class="co"># d    0    0    1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we would have the coefficients as:</p>
<ul>
<li><span class="math inline">\(\beta_0 = \bar{\mu}\)</span></li>
<li><span class="math inline">\(\beta_1 = \mu_b - \mu_a\)</span></li>
<li><span class="math inline">\(\beta_2 = \mu_c - \frac{\mu_a + \mu_b}{2}\)</span></li>
<li><span class="math inline">\(\beta_3 = \mu_d - \frac{\mu_a + \mu_b + \mu_c}{3}\)</span></li>
</ul>
<p>Note that you can easily reverse the ordering of the comparisons to contrast each of the first <span class="math inline">\(k-1\)</span> means with the average of all those <em>higher</em> in the order.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">C.rev</span> <span class="op">&lt;-</span> <span class="va">C</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">C.rev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">C.rev</span></span>
<span><span class="co">#   [,1] [,2] [,3]</span></span>
<span><span class="co"># a    3    0    0</span></span>
<span><span class="co"># b   -1    2    0</span></span>
<span><span class="co"># c   -1   -1    1</span></span>
<span><span class="co"># d   -1   -1   -1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="polynomial-contrasts" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="polynomial-contrasts">Polynomial contrasts</h4>
<p>For ordered factors that are also numeric, like <code>Age = c(8, 9, 10, 11)</code> or those that can be considered equally spaced along some continuum, polynomial contrasts, given by <code><a href="https://rdrr.io/r/stats/contrast.html">contr.poly()</a></code>, provide <em>orthogonal</em> (uncorrelated) contrasts that assess the degree to which the factor means vary linearly, quadratically, and so on with the factor levels.</p>
<p><code><a href="https://rdrr.io/r/stats/contrast.html">contr.poly()</a></code> scales each column so that it’s sum of squares is 1. Each pair of columns is orthogonal, <span class="math inline">\(\mathbf{c}_i^\top \mathbf{c}_j = 0\)</span>, so that <span class="math inline">\(\mathbf{C}^\top \mathbf{C} = \mathbf{I}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/contrast.html">contr.poly</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#          .L   .Q     .C</span></span>
<span><span class="co"># [1,] -0.671  0.5 -0.224</span></span>
<span><span class="co"># [2,] -0.224 -0.5  0.671</span></span>
<span><span class="co"># [3,]  0.224 -0.5 -0.671</span></span>
<span><span class="co"># [4,]  0.671  0.5  0.224</span></span>
<span></span>
<span><span class="co"># show they are orthonormal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">C</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/zapsmall.html">zapsmall</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#    .L .Q .C</span></span>
<span><span class="co"># .L  1  0  0</span></span>
<span><span class="co"># .Q  0  1  0</span></span>
<span><span class="co"># .C  0  0  1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can get a better sense of orthogonal polynomial contrasts by taking a numeric vector <span class="math inline">\(x\)</span>, and raising it to successive powers, 1, 2, 3. Here <span class="math inline">\(x^0 = 1\)</span> is the constant term or intercept.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, <span class="va">`^`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"lin"</span>, <span class="st">"quad"</span>, <span class="st">"cubic"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">M</span></span>
<span><span class="co">#    int lin quad cubic</span></span>
<span><span class="co"># x1   1   1    1     1</span></span>
<span><span class="co"># x2   1   2    4     8</span></span>
<span><span class="co"># x3   1   3    9    27</span></span>
<span><span class="co"># x4   1   4   16    64</span></span>
<span><span class="co"># x5   1   5   25   125</span></span>
<span><span class="co"># x6   1   6   36   216</span></span>
<span><span class="co"># x7   1   7   49   343</span></span>
<span><span class="co"># x8   1   8   64   512</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can make the columns of <code>M</code> orthogonal using the Gram-Schmidt method, where each successive column after the first is made orthogonal to all previous columns by subtracting their projections on that column. Plotting these, as in <a href="#fig-poly" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-poly</span></a> shows that the coefficients for a linear term plot as a line, those for <span class="math inline">\(x^2\)</span> follow a quadratic, and so forth.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu">matlib</span><span class="fu">::</span><span class="fu">GramSchmidt</span><span class="op">(</span><span class="va">M</span>, normalize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="va">M1</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"X"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Coefficient"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-poly" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-poly-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-poly-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-poly-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.3: The coefficients for orthogonal polynomial contrasts for linear (1), quadratic (2) and cubic (3) terms for a numeric variable <span class="math inline">\(X\)</span>. The intercept or constant term is represented as 0. Orthogonality means that each pair of values is uncorrelated.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="custom-contrasts" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="custom-contrasts">Custom contrasts</h4>
<p>You don’t have to be constrained by the kinds of comparisons available in <code>contr.*</code> functions. For a factor with <span class="math inline">\(k\)</span> levels you are free to make up <em>any</em> <span class="math inline">\(k-1\)</span> contrasts that correspond to <span class="math inline">\(k-1\)</span> different questions or tests of hypotheses about the factor level means. Even better, if your contrasts are orthogonal, their tests are statistically independent.</p>
<p>One useful idea for defining orthogonal comparisons of substantive interest is the idea of <strong>nested dichotomies</strong>. Here you would start with contrasting one meaningful subset of the groups against all the others. Then, successive contrasts are defined by making dichotomies among the groups within each subset.</p>
<p><strong>TODO</strong>: Make a figure for the two examples</p>
<p>As one example, suppose we are looking at support on some issue among four political parties: A, B, C and D, where A and B are left-of-center and C and D are to the right of the political spectrum. The following comparisons might of interest:</p>
<div class="cell" data-layout-align="center">
<pre data-code-line-numbers=""><code>AB.CD: {A, B} vs. {C, D}
A.B: {A} vs. {B}
C.D: {C} vs. {D}</code></pre>
</div>
<p>You could set up these comparisons as the following contrasts:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># contrasts</span></span>
<span><span class="va">AB.CD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,  <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">A.B</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>,  <span class="fl">0</span>,  <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">C.D</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,  <span class="fl">0</span>,  <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put them in a matrix</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">AB.CD</span>, <span class="va">A.B</span>, <span class="va">C.D</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">C</span></span>
<span><span class="co">#   AB.CD A.B C.D</span></span>
<span><span class="co"># A     1   1   0</span></span>
<span><span class="co"># B     1  -1   0</span></span>
<span><span class="co"># C    -1   0   1</span></span>
<span><span class="co"># D    -1   0  -1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With a data frame like <code>df</code> with the factor <code>party</code>, you would then use these contrasts in a model by assigning <code>C</code> to <code>contrasts(df$party)</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">47</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  party <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  support <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">25</span>, <span class="fl">25</span>, <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html">contrasts</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">party</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">C</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, in a linear model, the coefficients estimate the mean difference between the averages of the subset of parties in each comparison. For example, parties A and B on average are 2.11 higher in support than parties C and D; support for party A is 2.37 greater than party B and so forth.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">party.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">support</span> <span class="op">~</span> <span class="va">party</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">party.mod</span><span class="op">)</span></span>
<span><span class="co"># (Intercept)  partyAB.CD    partyA.B    partyC.D </span></span>
<span><span class="co">#       24.83        2.11        2.37        1.85</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For another example, say we are examining differences among three psychiatric diagnostic patient groups, “bipolar”, “manic”, “depressed” and also have a matched normal group. One set of meaningful comparisons would be as follows:</p>
<div class="cell" data-layout-align="center">
<pre data-code-line-numbers=""><code>D1: {Normal} vs. {Bipolar, Depressed, Manic}
D2: {Bipolar} vs. {Depressed, Manic}
D3: {Depressed} vs. {Manic}</code></pre>
</div>
<p>Weights for these contrasts are assigned by making them positive values for the groups in one subset and negative for the other, and giving numbers that sum to zero for each one:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">D1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">D2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,  <span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">D3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,  <span class="fl">0</span>,  <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">D1</span>, <span class="va">D2</span>, <span class="va">D3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Normal"</span>, <span class="st">"Bipolar"</span>, <span class="st">"Depressed"</span>, <span class="st">"Manic"</span><span class="op">)</span></span>
<span><span class="va">C</span></span>
<span><span class="co">#           D1 D2 D3</span></span>
<span><span class="co"># Normal     3  0  0</span></span>
<span><span class="co"># Bipolar   -1  2  0</span></span>
<span><span class="co"># Depressed -1 -1  1</span></span>
<span><span class="co"># Manic     -1 -1 -1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These have the same form as the reversed Helmert contrasts considered earlier.</p>
<!--
**TODO**: Do I need to go through the details of univariate regression, ANOVA, ... here?
## Regression

## ANOVA

## ANCOVA

Not shown in @fig-techniques are rows for cases where predictor variables include 
a mixture quantitative and discrete factors. These have two "flavors", depending on our emphasis.

* **Analysis of covariance** (ANCOVA) is the
term for models where the main emphasis on on comparing means of different groups,
but where there are one or more quantitative predictors (for example a pre-test score
on the outcome variable) that need to be taken into account, so we can assess the differences
among groups _controlling_ or _adjusting_ for those predictors, which are called
_covariates_. (Strictly speaking, ANCOVA models typically assume that the regression
slopes are the same for all groups.)

* **Homogeneity of regression** treats the same type of data, 
but the main interest is on the regression relation between $\mathbf{y}$ and a set of
quantitative $\mathbf{x}$s, but there is also one or more grouping factors.
In this case, we want to determine if the _same regression_ relation applies in all groups
or whether the groups differ in their intercepts and/or slopes. 
Another term for this class of questions is **moderator** effects, which refers to
interactions between the quantitative predictors and group factors.

**TODO** Move the initial discussion of ANCOVA from @sec-ANCOVA-MANCOVA here with the generic example.

## Regression trees
-->
<!-- ## References {.unnumbered} -->
</section></section></section><section id="what-have-we-learned" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="what-have-we-learned">
<span class="header-section-number">5.2</span> What have we learned?</h2>
<p>This chapter introduced the fundamental building blocks of linear modeling in R, focusing on the versatile <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function as our primary tool for fitting and understanding linear relationships in data. The goal for the chapter is to help you understand the mechanics of translating between the algebraic formulation of a linear model and your research questions using the tools in the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> family.</p>
<p>Here are the essential takeaways:</p>
<ul>
<li>
<strong>The <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function is your Swiss Army knife for linear modeling</strong> – Whether you’re fitting simple regression, multiple regression, ANOVA, or ANCOVA models, <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> provides a unified interface through R’s elegant formula syntax. The beauty lies in how a model foprmula like <code>y ~ x1 + x2 + x1:x2</code> captures complex relationships with intuitive notation.</li>
</ul>
<!-- Jack-of-all-trades? polymath? --><ul>
<li><p><strong>Model objects contain a wealth of information</strong> – An <code>"lm"</code> object isn’t just coefficients; it’s a comprehensive container holding fitted values, residuals, the design matrix, and diagnostic information. Learning to extract and manipulate these components with functions like <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code>, <code><a href="https://rdrr.io/r/stats/fitted.values.html">fitted()</a></code>, <code><a href="https://rdrr.io/r/stats/residuals.html">residuals()</a></code>, and <code><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix()</a></code> unlocks the full power of linear modeling.</p></li>
<li><p><strong>Model matrices reveal the algebraic heart of your analysis</strong> – Understanding how R transforms your formula into a design matrix via <code><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix()</a></code> is fundamental to grasping what linear models actually compute. The journey from a formula like <code>y ~ treatment + block</code> to a matrix of 0s and 1s illuminates how categorical predictors are used in mathematical operations to calculate fitted values.</p></li>
<li><p><strong>Contrasts control how factors speak to your research questions</strong> – The choice between treatment, sum, or Helmert contrasts isn’t just technical housekeeping – it determines which comparisons your model coefficients represent. Using <code><a href="https://rdrr.io/r/stats/contrasts.html">contrasts()</a></code> and <code><a href="https://rdrr.io/r/stats/zC.html">C()</a></code> strategically means your model output directly answers your scientific questions rather than leaving you to decode cryptic parameter estimates.</p></li>
</ul>
<!--
* **Factor coding schemes have profound interpretational consequences** -- Whether you use treatment contrasts 
(comparing to a reference level) or sum contrasts (comparing to overall mean) fundamentally changes what your 
intercept and slopes mean. Understanding these choices helps you avoid the common trap of misinterpreting coefficients in factorial designs.

* **The design matrix bridges statistical theory and computational reality** -- Examining the model matrix with `model.matrix()` 
demystifies how R handles missing cells, interaction terms, and nested factors. What seems like magic in the output 
becomes transparent when you see the actual numbers being multiplied and summed in the linear algebra.
--><p>However fitting a model is just the first step. While <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> and <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> provide essential numerical summaries, diagnostic plots created with <code>plot(lm_object)</code> expose patterns in residuals. Other plots help toidentify influential observations, and validate model assumptions. The interplay between numerical and graphical summaries is where true understanding emerges. This is the topic of <a href="#sec-linear-models-plots" class="quarto-xref"><span class="quarto-unresolved-ref">sec-linear-models-plots</span></a>.</p>
<!--
**Package summary**
-->
<div class="cell" data-layout-align="center">
<p><strong>Packages used here</strong>:</p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-BradshawFindley1967" class="csl-entry" role="listitem">
Bashaw, W. L., &amp; Findley, W. G. (Eds.). (1967). <em>Symposium on general linear model approach to the analysis of experimental data in educational research, final report</em>. <a href="https://files.eric.ed.gov/fulltext/ED026737.pdf">https://files.eric.ed.gov/fulltext/ED026737.pdf</a>
</div>
<div id="ref-Bock1963" class="csl-entry" role="listitem">
Bock, R. D. (1963). Programming univariate and multivariate analysis of variance. <em>Technometrics</em>, <em>5</em>(1), 95–117. <a href="https://doi.org/10.1080/00401706.1963.10490061">https://doi.org/10.1080/00401706.1963.10490061</a>
</div>
<div id="ref-Bock1964" class="csl-entry" role="listitem">
Bock, R. D. (1964). A computer program forunivariate and multivariate analysis of variance. <em>Proceedings of Scientific Symposium on Statistics</em>.
</div>
<div id="ref-Clyde-etal-1966" class="csl-entry" role="listitem">
Clyde, D. J., Cramer, E. M., &amp; Sherin, R. J. (1966). <em>Multivariate statistical programs</em>. Biometric Laboratory,University of Miami.
</div>
<div id="ref-Dixon1965" class="csl-entry" role="listitem">
Dixon, W. J. (1965). <em>BMD biomedical computer programs</em>. Health Sciences Computing Facility, School of Medicine, University of California; Health Sciences Computing Faculty.
</div>
<div id="ref-Finn1967" class="csl-entry" role="listitem">
Finn, J. D. (1967). <em><span>MULTIVARIANCE</span>: Fortran program for univariate and multivariate analysis of variance and covariance</em>. School of Education, State University of New York at Buffalo.
</div>
<div id="ref-Fisher1923" class="csl-entry" role="listitem">
Fisher, R. A. (1923). Studies in crop variation. II. The manurial response of different potato varieties. <em>The Journal of Agricultural Science</em>, <em>13</em>(2), 311–320. <a href="https://hdl.handle.net/2440/15179">https://hdl.handle.net/2440/15179</a>
</div>
<div id="ref-Fisher:25" class="csl-entry" role="listitem">
Fisher, R. A. (1925). <em>Statistical methods for research workers</em>. Oliver &amp; Boyd.
</div>
<div id="ref-FoxWeisberg:2018" class="csl-entry" role="listitem">
Fox, J., &amp; Weisberg, S. (2018). <em>An <span>R</span> companion to applied regression</em> (Third). SAGE Publications. <a href="https://books.google.ca/books?id=uPNrDwAAQBAJ">https://books.google.ca/books?id=uPNrDwAAQBAJ</a>
</div>
<div id="ref-Galton:1886" class="csl-entry" role="listitem">
Galton, F. (1886). Regression towards mediocrity in hereditary stature. <em>Journal of the Anthropological Institute</em>, <em>15</em>, 246–263. <a href="http://www.jstor.org/cgi-bin/jstor/viewitem/09595295/dm995266/99p0374f/0">http://www.jstor.org/cgi-bin/jstor/viewitem/09595295/dm995266/99p0374f/0</a>
</div>
<div id="ref-Galton:1889" class="csl-entry" role="listitem">
Galton, F. (1889). <em>Natural inheritance</em>. Macmillan. <a href="http://galton.org/books/natural-inheritance/pdf/galton-nat-inh-1up-clean.pdf">http://galton.org/books/natural-inheritance/pdf/galton-nat-inh-1up-clean.pdf</a>
</div>
<div id="ref-Graybill1961" class="csl-entry" role="listitem">
Graybill, F. A. (1961). <em>An introduction to linear statistical models</em>. McGraw-Hill.
</div>
<div id="ref-IBM1965" class="csl-entry" role="listitem">
IBM. (1965). <em>Proceedings of the IBM scientific computing symposium on statistics: Oct 21-23, 1963</em> (L. Robinson, Ed.). IBM. <a href="https://www.amazon.com/Proceedings-Scientific-Computing-Symposium-Statistics/dp/B000GL5RLU">https://www.amazon.com/Proceedings-Scientific-Computing-Symposium-Statistics/dp/B000GL5RLU</a>
</div>
<div id="ref-Pearson:1896" class="csl-entry" role="listitem">
Pearson, K. (1896). Contributions to the mathematical theory of evolution—<span>III</span>, regression, heredity and panmixia. <em>Philosophical Transactions of the Royal Society of London</em>, <em>187</em>, 253–318.
</div>
<div id="ref-Scheffe1960" class="csl-entry" role="listitem">
Scheffé, H. A. (1960). <em>The analysis of variance</em>. Wiley.
</div>
<div id="ref-WilkinsonRogers1973" class="csl-entry" role="listitem">
Wilkinson, G. N., &amp; Rogers, C. E. (1973). Symbolic description of factorial models for analysis of variance. <em>Applied Statistics</em>, <em>22</em>(3), 392. <a href="https://doi.org/10.2307/2346786">https://doi.org/10.2307/2346786</a>
</div>
<div id="ref-Winer1962" class="csl-entry" role="listitem">
Winer, B. J. (1962). <em>Statistical principles in experimental design</em>. McGraw-Hill.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Taking logarithms of both sides would yield the linear model, <span class="math inline">\(log(y) = c + \beta_1 x\)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/friendly\.github\.io\/Vis-MLM-book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./04-pca-biplot.html" class="pagination-link" aria-label="Dimension Reduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-linear_models-plots.html" class="pagination-link" aria-label="Plots for Univariate Response Models">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for Univariate Response Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>