<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Visualizing Multivariate Data and Models in R - 6&nbsp; Plots for univariate response models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-collinearity-ridge.html" rel="next">
<link href="./05-linear_models.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-linear_models-plots.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title"><span id="sec-linear-models-plots" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">PCA and Biplots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Brief review of the multivariate linear model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Tests for Equality of Covariance Matrices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./90-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#the-regression-quartet" id="toc-the-regression-quartet" class="nav-link active" data-scroll-target="#the-regression-quartet"><span class="header-section-number">6.1</span> The “regression quartet”</a></li>
  <li>
<a href="#other-diagnostic-plots" id="toc-other-diagnostic-plots" class="nav-link" data-scroll-target="#other-diagnostic-plots"><span class="header-section-number">6.2</span> Other Diagnostic plots</a>
  <ul class="collapse">
<li><a href="#spread-level-plot" id="toc-spread-level-plot" class="nav-link" data-scroll-target="#spread-level-plot"><span class="header-section-number">6.2.1</span> Spread-level plot</a></li>
  </ul>
</li>
  <li><a href="#coefficient-plots" id="toc-coefficient-plots" class="nav-link" data-scroll-target="#coefficient-plots"><span class="header-section-number">6.3</span> Coefficient plots</a></li>
  <li><a href="#added-variable-plots" id="toc-added-variable-plots" class="nav-link" data-scroll-target="#added-variable-plots"><span class="header-section-number">6.4</span> Added-variable plots</a></li>
  <li><a href="#marginal-plots" id="toc-marginal-plots" class="nav-link" data-scroll-target="#marginal-plots"><span class="header-section-number">6.5</span> Marginal plots</a></li>
  <li>
<a href="#sec-leverage" id="toc-sec-leverage" class="nav-link" data-scroll-target="#sec-leverage"><span class="header-section-number">6.6</span> Outliers, leverage and influence</a>
  <ul class="collapse">
<li><a href="#the-leverage-influence-quartet" id="toc-the-leverage-influence-quartet" class="nav-link" data-scroll-target="#the-leverage-influence-quartet"><span class="header-section-number">6.6.1</span> The leverage-influence quartet</a></li>
  <li><a href="#measuring-leverage" id="toc-measuring-leverage" class="nav-link" data-scroll-target="#measuring-leverage"><span class="header-section-number">6.6.2</span> Measuring leverage</a></li>
  <li><a href="#outliers-measuring-residuals" id="toc-outliers-measuring-residuals" class="nav-link" data-scroll-target="#outliers-measuring-residuals"><span class="header-section-number">6.6.3</span> Outliers: Measuring residuals</a></li>
  <li><a href="#measuring-influence" id="toc-measuring-influence" class="nav-link" data-scroll-target="#measuring-influence"><span class="header-section-number">6.6.4</span> Measuring influence</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p>For a univariate linear model fit using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> and similar functions, the standard <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method gives basic versions of <em>diagnostic</em> plots of residuals and other calculated quantities for assessing possible violations of the model assumptions. Some of these can be considerably enhanced using other packages.</p>
<p>Beyond this,</p>
<ul>
<li><p>tables of model coefficients, standard errors and test statistics can often be usefully supplemented or even replaced by suitable plots providing essentially the same information.</p></li>
<li><p>when there are two or more predictors, you can more easily understand their separate impact on the response by plotting the <em>marginal</em> effects of one or more focal variables, averaging over other variables not shown in a given plot.</p></li>
<li><p>when there are highly correlated predictors, some specialized plots are useful to understand the nature of <em>multicolinearity</em>.</p></li>
</ul>
<p>The classic reference on regression diagnostics is <span class="citation" data-cites="Belsley-etal:80">Belsley et al. (<a href="90-references.html#ref-Belsley-etal:80" role="doc-biblioref">1980</a>)</span>. My favorite modern texts are the brief <span class="citation" data-cites="Fox2020">Fox (<a href="90-references.html#ref-Fox2020" role="doc-biblioref">2020</a>)</span> and the more complete <span class="citation" data-cites="FoxWeisberg:2018">Fox &amp; Weisberg (<a href="90-references.html#ref-FoxWeisberg:2018" role="doc-biblioref">2018</a>)</span>, both of which are supported by the <strong>car</strong> package <span class="citation" data-cites="R-car">(<a href="90-references.html#ref-R-car" role="doc-biblioref">Fox et al., 2023</a>)</span>.</p>
<section id="the-regression-quartet" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="the-regression-quartet">
<span class="header-section-number">6.1</span> The “regression quartet”</h2>
<p>For a fitted model, plotting the model object with <code>plot(model)</code> provides for any of six basic plots, of which four are produced by default, giving rise to the term <em>regression quartet</em> for this collection. These are:</p>
<ul>
<li><p><strong>Residuals vs.&nbsp;Fitted</strong>: For well-behaved data, the points should hover around a horizontal line at residual = 0, with no obvious pattern or trend.</p></li>
<li><p><strong>Normal Q-Q plot</strong>: A plot of sorted standardized residuals <span class="math inline">\(e_i\)</span> (obtained from<code>rstudent(model)</code>) against the theoretical values those values would have in a standard normal <span class="math inline">\(\mathcal{N}(0, 1)\)</span> distribution.</p></li>
<li><p><strong>Scale-Location</strong>: Plots the square-root of the absolute values of the standardized residuals <span class="math inline">\(\sqrt{| e_i |}\)</span> as a measure of “scale” against the fitted values <span class="math inline">\(\hat{y}_i\)</span> as a measure of “location”. This provides an assessment of homogeneity of variance, which appears as a tendency for scale to vary with location.</p></li>
<li><p><strong>Residuals vs.&nbsp;Leverage</strong>: Plots standardized residuals against leverage to help identify possibly influential observations. Leverage, or “hat” values (given by <code>hat(model)</code>) are proportional to the squared Mahalanobis distances of the predictor values <span class="math inline">\(\mathbf{x}_i\)</span> from the means, and measure the potential of an observation to change the fitted coefficients if that observation was deleted. Actual influence is measured by Cooks’s distance (<code>cooks.distance(model)</code>) and is proportional to the product of residual times leverage. Contours of constant Cook’s <span class="math inline">\(D\)</span> are added to the plot.</p></li>
</ul>
<p>One key feature of these plots is providing <strong>reference</strong> lines or smoothed curves for ease of judging the extent to which a plot conforms to the expected pattern; another is the <strong>labeling</strong> of observations which deviate from an assumption.</p>
<p>The base-R <code>plot(model)</code> plots are done much better in a variety of packages. I illustrate some versions from the <strong>car</strong> <span class="citation" data-cites="R-car">(<a href="90-references.html#ref-R-car" role="doc-biblioref">Fox et al., 2023</a>)</span> and <strong>performance</strong> <span class="citation" data-cites="Ludecke-etal-performance">(<a href="90-references.html#ref-Ludecke-etal-performance" role="doc-biblioref">Lüdecke et al., 2021</a>)</span> packages, part of the <strong>easystats</strong> <span class="citation" data-cites="R-easystats">(<a href="90-references.html#ref-R-easystats" role="doc-biblioref">Lüdecke et al., 2022</a>)</span> suite of packages.</p>
<p><strong>Packages</strong>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/easystats/">easystats</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="example-duncans-occupational-prestige" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="example-duncans-occupational-prestige">Example: Duncan’s occupational prestige</h4>
<p>In a classic study in sociology, <span class="citation" data-cites="Duncan:61">Duncan (<a href="90-references.html#ref-Duncan:61" role="doc-biblioref">1961</a>)</span> used data from the U.S. Census in 1950 to study how one could predict the prestige of occupational categories — which is hard to measure — from available information in the census for those occupations. His data is available in <code>carData:Duncan</code>, and contains</p>
<ul>
<li>
<code>type</code>: the category of occupation, one of <code>prof</code> (professional), <code>wc</code> (white collar) or <code>bc</code> (blue collar);</li>
<li>
<code>income</code>: the percentage of occupational incumbents with a reported income &gt; $3500 (about $40,000 in current dollars);</li>
<li>
<code>education</code>: the percentage of occupational incumbents who were high school graduates;</li>
<li>
<code>prestige</code>: the percentage of respondents in a social survey who rated the occupation as “good” or better in prestige.</li>
</ul>
<p>These variables are a bit quirky in they are measured in percents, 0-100, rather dollars for <code>income</code> and years for <code>education</code>, but this common scale permitted Duncan to ask an interesting sociological question: Assuming that both income and education predict prestige, are they equally important, as might be assessed by testing the hypothesis <span class="math inline">\(H_0: \beta_{\text{income}} = \beta_{\text{education}}\)</span>.</p>
<p>A quick look at the data shows the variables and a selection of the occupational categories, which are the <code><a href="https://rdrr.io/r/base/row.names.html">row.names()</a></code> of the dataset.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Duncan</span>, package <span class="op">=</span> <span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/some.html">some</a></span><span class="op">(</span><span class="va">Duncan</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  type income education prestige</span></span>
<span><span class="co">#&gt; accountant       prof     62        86       82</span></span>
<span><span class="co">#&gt; professor        prof     64        93       93</span></span>
<span><span class="co">#&gt; engineer         prof     72        86       88</span></span>
<span><span class="co">#&gt; factory.owner    prof     60        56       81</span></span>
<span><span class="co">#&gt; store.clerk        wc     29        50       16</span></span>
<span><span class="co">#&gt; carpenter          bc     21        23       33</span></span>
<span><span class="co">#&gt; machine.operator   bc     21        20       24</span></span>
<span><span class="co">#&gt; barber             bc     16        26       20</span></span>
<span><span class="co">#&gt; soda.clerk         bc     12        30        6</span></span>
<span><span class="co">#&gt; janitor            bc      7        20        8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s start by fitting a simple model using just income and education as predictors. The results look very good! Both <code>income</code> and <code>education</code> are highly significant and the <span class="math inline">\(R^2 = 0.828\)</span> for the model indicates that <code>prestige</code> is very well predicted by just these variables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">duncan.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span>, data<span class="op">=</span><span class="va">Duncan</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">duncan.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = prestige ~ income + education, data = Duncan)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -29.54  -6.42   0.65   6.61  34.64 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  -6.0647     4.2719   -1.42     0.16    </span></span>
<span><span class="co">#&gt; income        0.5987     0.1197    5.00  1.1e-05 ***</span></span>
<span><span class="co">#&gt; education     0.5458     0.0983    5.56  1.7e-06 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 13.4 on 42 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.828,  Adjusted R-squared:  0.82 </span></span>
<span><span class="co">#&gt; F-statistic:  101 on 2 and 42 DF,  p-value: &lt;2e-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Beyond this, Duncan was interested in the coefficients and whether income and education could be said to have equal impacts on predicting occupational prestige. A nice display of model coefficients with confidence intervals is provided by <code><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters::model_parameters()</a></code> and we can test Duncan’s hypothesis with <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">car::linearHypothesis()</a></code>. The latter is constructed as a test of a restricted model in which the two coefficients are forced to be equal against the unrestricted model. Duncan was very happy with this result.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">duncan.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(42) |      p</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       -6.06 | 4.27 | [-14.69, 2.56] | -1.42 | 0.163 </span></span>
<span><span class="co">#&gt; income      |        0.60 | 0.12 | [  0.36, 0.84] |  5.00 | &lt; .001</span></span>
<span><span class="co">#&gt; education   |        0.55 | 0.10 | [  0.35, 0.74] |  5.56 | &lt; .001</span></span>
<span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">duncan.mod</span>, <span class="st">"income = education"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear hypothesis test:</span></span>
<span><span class="co">#&gt; income - education = 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: restricted model</span></span>
<span><span class="co">#&gt; Model 2: prestige ~ income + education</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; 1     43 7519                         </span></span>
<span><span class="co">#&gt; 2     42 7507  1      12.2 0.07    0.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But, should Duncan be <strong>so</strong> happy? It is unlikely that he ran any model diagnostics or plotted his model; we do so now. Here is the regression quartet for this model. Each plot shows some trend lines, and importantly, labels some observations that stand out and might deserve attention.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>          mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">duncan.mod</span>, lwd<span class="op">=</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-duncan-plot-model" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/fig-duncan-plot-model-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.1: Regression quartet of diagnostic plots for the <code>Duncan</code> data. Several possibly unusual observations are labeled.</figcaption></figure>
</div>
</div>
</div>
</section><section id="example-occupational-prestige" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="example-occupational-prestige">Example: Occupational prestige</h4>
<p><strong>CUT THIS EXAMPLE</strong></p>
<p>These examples use the data on the prestige of 102 occupational categories and other measures from the 1971 Canadian Census, recorded in <code><a href="https://rdrr.io/pkg/carData/man/Prestige.html">carData::Prestige</a></code>. Our interest is in understanding how <code>prestige</code> (the Pineo-Ported prestige score, from a social survey) is related to census measures of the average education, income, percent women of incumbents in those occupations. Occupation type is a factor with levels <code>"bc"</code> (blue collar), <code>"wc"</code> (white collar) and <code>"prof"</code> (professional). <strong>TODO</strong>: These data should be introduced earlier with descriptive plots, scatterplots, …</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Prestige</span>, package<span class="op">=</span><span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="co"># `type` is really an ordered factor. Make it so.</span></span>
<span><span class="va">Prestige</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">$</span><span class="va">type</span>,</span>
<span>                         levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bc"</span>, <span class="st">"wc"</span>, <span class="st">"prof"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    102 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ education: num  13.1 12.3 12.8 11.4 14.6 ...</span></span>
<span><span class="co">#&gt;  $ income   : int  12351 25879 9271 8865 8403 11030 8258 14163 11377 11023 ...</span></span>
<span><span class="co">#&gt;  $ women    : num  11.16 4.02 15.7 9.11 11.68 ...</span></span>
<span><span class="co">#&gt;  $ prestige : num  68.8 69.1 63.4 56.8 73.5 77.6 72.6 78.1 73.1 68.8 ...</span></span>
<span><span class="co">#&gt;  $ census   : int  1113 1130 1171 1175 2111 2113 2133 2141 2143 2153 ...</span></span>
<span><span class="co">#&gt;  $ type     : Ord.factor w/ 3 levels "bc"&lt;"wc"&lt;"prof": 3 3 3 3 3 3 3 3 3 3 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit a main-effects model using all predictors (ignoring <code>census</code>, the Canadian Census occupational code):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prestige.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">type</span>,</span>
<span>                   data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>plot(model)</code> produces four separate plots. For a quick look, I like to arrange them in a single 2x2 figure.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>          mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">prestige.mod</span>, lwd<span class="op">=</span><span class="fl">2</span>, cex.lab<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-plot-prestige-mod" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/fig-plot-prestige-mod-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.2: Regression quartet of diagnostic plots for the <code>Prestige</code> data. Several possibly unusual observations are labeled.</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="other-diagnostic-plots" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="other-diagnostic-plots">
<span class="header-section-number">6.2</span> Other Diagnostic plots</h2>
<section id="spread-level-plot" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="spread-level-plot">
<span class="header-section-number">6.2.1</span> Spread-level plot</h3>
</section></section><section id="coefficient-plots" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="coefficient-plots">
<span class="header-section-number">6.3</span> Coefficient plots</h2>
</section><section id="added-variable-plots" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="added-variable-plots">
<span class="header-section-number">6.4</span> Added-variable plots</h2>
</section><section id="marginal-plots" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="marginal-plots">
<span class="header-section-number">6.5</span> Marginal plots</h2>
</section><section id="sec-leverage" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="sec-leverage">
<span class="header-section-number">6.6</span> Outliers, leverage and influence</h2>
<p>In small to moderate samples, “unusual” observations can have dramatic effects on a fitted regression model, as we saw in the analysis of Davis’s data on reported and measured weight (<a href="02-getting_started.html#sec-davis"><span>Section&nbsp;2.1.2</span></a>) where one erroneous observations hugely altered the fitted line.</p>
<p>An observation can be unusual in three archetypal ways, with different consequences:</p>
<ul>
<li><p>Unusual in the response <span class="math inline">\(y\)</span>, but typical in the predictor(s), <span class="math inline">\(\mathbf{x}\)</span> — a badly fitted case with a large absolute residual, but with <span class="math inline">\(x\)</span> not far from the mean, as in <a href="02-getting_started.html#fig-ch02-davis-reg2">Figure&nbsp;<span>2.4</span></a>. This case does not do much harm to the fitted model.</p></li>
<li><p>Unusual in the predictor(s) <span class="math inline">\(\mathbf{x}\)</span>, but typical in <span class="math inline">\(y\)</span> — an otherwise well-fitted point. This case also does litle harm, and in fact can be considered to improve precision, a “good leverage” point.</p></li>
<li><p>Unusual in <strong>both</strong> <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(y\)</span> — This is the case, a “bad leverage” point, revealed in the analysis of Davis’s data, <a href="02-getting_started.html#fig-ch02-davis-reg1">Figure&nbsp;<span>2.3</span></a>, where the one erroneous point for women was highly influential, pulling the regression line towards it and affecting the estimated coefficient as well as all the fitted values.</p></li>
</ul>
<p>Influential cases are the ones that matter most. As suggested above, to be influential an observation must be unusual in <strong>both</strong> <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(y\)</span>, and affects the estimated coefficients, thereby also altering the predicted values for all observations. A heuristic formula capturing the relations among leverage, “outlyingness” on <span class="math inline">\(y\)</span> and influence is</p>
<p><span class="math display">\[
\text{Influence}_{\text{coefficients}} \;=\; X_\text{leverage} \;\times\; Y_\text{residual}
\]</span> As described below, leverage is proportional to the squared distance <span class="math inline">\((x_i - \bar{x})^2\)</span> of an observation <span class="math inline">\(x_i\)</span> from its mean in simple regression and to the squared Mahalanobis distance in the general case. The <span class="math inline">\(Y_\text{residual}\)</span> is best measured by a <em>studentized</em> residual, obtained by omitting each case <span class="math inline">\(i\)</span> in turn and calculating its residual from the coefficients obtained from the remaining cases.</p>
<section id="the-leverage-influence-quartet" class="level3" data-number="6.6.1"><h3 data-number="6.6.1" class="anchored" data-anchor-id="the-leverage-influence-quartet">
<span class="header-section-number">6.6.1</span> The leverage-influence quartet</h3>
<p>These ideas can be illustrated in the “leverage-influence quartet” by considering a standard simple linear regression for a sample and then adding one additional point reflecting the three situations described above. Below, I generate a sample of <span class="math inline">\(N = 15\)</span> points with <span class="math inline">\(x\)</span> uniformly distributed between (40, 60) and <span class="math inline">\(y \sim 10 + 0.75 x + \mathcal{N}(0, 1.25^2)\)</span>, duplicated four times.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">case_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OK"</span>, <span class="st">"Outlier"</span>, <span class="st">"Leverage"</span>, <span class="st">"Influence"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">levdemo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">case_labels</span>, </span>
<span>               each <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">40</span> <span class="op">+</span> <span class="fl">20</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">.75</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">1.25</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="st">" "</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">levdemo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)           x </span></span>
<span><span class="co">#&gt;      13.332       0.697</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The additional points, one for each situation are set to the values below.</p>
<ul>
<li>
<code>Outlier</code>: (52, 60) a low leverage point, but an outlier (<code>O</code>) with a large residual</li>
<li>
<code>Leverage</code>: (75, 65) a “good” high leverage point (<code>L</code>) that fits well with the regression line</li>
<li>
<code>Influence</code>: (70, 40) a “bad” high leverage point (<code>OL</code>) with a large residual.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  case <span class="op">=</span> <span class="va">case_labels</span>,</span>
<span>  x  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">52</span>, <span class="fl">75</span>, <span class="fl">70</span><span class="op">)</span>,</span>
<span>  y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">65</span>, <span class="fl">65</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"  "</span>, <span class="st">"O"</span>, <span class="st">"L"</span>, <span class="st">"OL"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Join these to the data</span></span>
<span><span class="va">both</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">levdemo</span>, <span class="va">extra</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">case</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plot these four situations with <code>ggplot2</code> in panels faceted by <code>case</code> as shown below. The standard version of this plot shows the regression line for the <span style="color: blue;">original data</span> and that for the <span style="color: red;">ammended data</span> with the additional point. Note that we use the <code>levdemo</code> dataset in <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> for the regression line with the original data, but specify <code>data = both</code> for that with the additional point.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">levdemo</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">both</span>, </span>
<span>              method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1.3</span>, linetype <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"longdash"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">both</span>, level <span class="op">=</span> <span class="fl">0.5</span>, color<span class="op">=</span><span class="st">"blue"</span>, type<span class="op">=</span><span class="st">"norm"</span>, linewidth <span class="op">=</span> <span class="fl">1.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">extra</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">extra</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">case</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-levdemo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/fig-levdemo-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.3: Leverage influence quartet with data 50% ellipses. Case (1) original data; (2) adding one low-leverage outlier, “O”; (3) adding one “good” leverage point, “L”; (4) adding one “bad” leverage point, “OL”. The dashed line is the fitted line for the original data, while the solid line reflects the additional point. The data ellipses show the effect of the additional point on precision.</figcaption></figure>
</div>
</div>
</div>
<p>The standard version of this graph shows only the fitted regression lines in each panel. As can be seen, the fitted line doesn’t change very much in panels (2) and (3); only the bad leverage point, “OL” in panel (4) is harmful. Adding data ellipses to each panel immediately makes it clear that there is another part to this story— the effect of the unusual point on <em>precision</em> (standard errors) of our estimates of the coefficients.</p>
<p>Now, we see <em>directly</em> that there is a big difference in impact between the low-leverage outlier [panel (2)] and the high-leverage, small-residual case [panel (3)], even though their effect on coefficient estimates is negligible. In panel (2), the single outlier inflates the estimate of residual variance (the size of the vertical slice of the data ellipse at <span class="math inline">\(\bar{x}\)</span>), while in panel (3) this is decreased.</p>
<p>To allow direct comparison and make the added value of the data ellipse more apparent, we overlay the data ellipses from <a href="#fig-levdemo">Figure&nbsp;<span>6.3</span></a> in a single graph, shown in <a href="#fig-levdemo2">Figure&nbsp;<span>6.4</span></a>.<br>
Here, we can also see why the high-leverage point “L” <a href="#fig-levdemo">added in panel (c) of&nbsp;<span>6.3</span></a> is called a “good leverage” point. By increasing the standard deviation of <span class="math inline">\(x\)</span>, it makes the data ellipse somewhat more elongated, giving increased precision of our estimates of <span class="math inline">\(\vec{\beta}\)</span>.</p>
<div class="cell" data-layout-align="center">
<details><summary>Code</summary><div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">both</span>,</span>
<span>     <span class="op">{</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">case</span>, </span>
<span>          levels <span class="op">=</span> <span class="fl">0.68</span>,</span>
<span>          plot.points <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          center.pch <span class="op">=</span> <span class="st">"+"</span>,</span>
<span>          col <span class="op">=</span> <span class="va">colors</span>,</span>
<span>          fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>     <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">case1</span> <span class="op">&lt;-</span> <span class="va">both</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">case</span> <span class="op">==</span> <span class="st">"1 OK"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">case1</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, cex<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">extra</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>       col <span class="op">=</span> <span class="va">colors</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">extra</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>     labels <span class="op">=</span> <span class="va">extra</span><span class="op">$</span><span class="va">id</span>,</span>
<span>     col <span class="op">=</span> <span class="va">colors</span>, pos <span class="op">=</span> <span class="fl">2</span>, offset <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-levdemo2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/fig-levdemo2-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.4: Data ellipses in the Leverage-influence quartet. This graph overlays the data ellipses and additional points from the four panels of <a href="#fig-levdemo2">Figure&nbsp;<span>6.4</span></a>. It can be seen that only the OL point affects the slope, while the O and L points affect precision of the estimates in opposite directions.</figcaption></figure>
</div>
</div>
</div>
</section><section id="measuring-leverage" class="level3" data-number="6.6.2"><h3 data-number="6.6.2" class="anchored" data-anchor-id="measuring-leverage">
<span class="header-section-number">6.6.2</span> Measuring leverage</h3>
<p>Leverage is thus an index of the <em>potential</em> impact of an observation on the model due to its’ atypical value in the X space of the predictor(s). It is commonly measured by the “hat” value, <span class="math inline">\(h_i\)</span>, so called because it puts the hat <span class="math inline">\(\hat{(\bullet)}\)</span> on <span class="math inline">\(\mathbf{y}\)</span>, i.e., the vector of fitted values can be expressed as</p>
<p><span class="math display">\[\begin{eqnarray*}
\hat{\mathbf{y}} &amp; = &amp; \mathbf{H} \mathbf{y} \\
                 &amp; = &amp; [\mathbf{X} (\mathbf{X}^\textsf{T} \mathbf{X})^{-1} \mathbf{X}^\textsf{T}] \; \mathbf{y} \; ,
\end{eqnarray*}\]</span></p>
<p>where <span class="math inline">\(h_i \equiv h_{ii}\)</span> are the diagonal elements of the Hat matrix <span class="math inline">\(\mathbf{H}\)</span>. In simple regression, hat values are proportional to the squared distance of the observation <span class="math inline">\(x_i\)</span> from the mean, <span class="math inline">\(h_i \propto (x_i - \bar{x})^2\)</span>, <span class="math display">\[
h_i = \frac{1}{n} + \frac{(x_i - \bar{x})^2}{\Sigma_i (x_i - \bar{x})^2} \; ,
\]</span> and range from <span class="math inline">\(1/n\)</span> to 1, with an average value <span class="math inline">\(\bar{h} = 2/n\)</span>. Consequently, observations with <span class="math inline">\(h_i\)</span> greater than <span class="math inline">\(2 \bar{h}\)</span> or <span class="math inline">\(3 \bar{h}\)</span> are commonly considered to be of high leverage.</p>
<p>With <span class="math inline">\(p \ge 2\)</span> predictors, it is demonstrated below that <span class="math inline">\(h_i \propto D^2 (\mathbf{x} - \bar{\mathbf{x}})\)</span>, the squared distance of <span class="math inline">\(\mathbf{x}\)</span> from the centroid <span class="math inline">\(\bar{\mathbf{x}}\)</span>[^1]. [^1]: See <a href="https://bit.ly/45x2T0Q">this Stats StackExchange discussion</a> for a proof. The analogous formula is</p>
<p><span class="math display">\[
h_i = \frac{1}{n} + \frac{1}{n-1} D^2 (\mathbf{x} - \bar{\mathbf{x}}) \; ,
\]</span></p>
<p>where <span class="math inline">\(D^2 (\mathbf{x} - \bar{\mathbf{x}}) = (\mathbf{x} - \bar{\mathbf{x}})^\textsf{T} \mathbf{S}_X^{-1} (\mathbf{x} - \bar{\mathbf{x}})\)</span>. From <a href="03-multivariate_plots.html#sec-data-ellipse"><span>Section&nbsp;3.1.4</span></a>, it follows that contours of constant leverage correspond to data ellipses or ellipsoids of the predictors in <span class="math inline">\(\mathbf{x}\)</span>, whose boundaries, assuming normality, correspond to quantiles of the <span class="math inline">\(\chi^2_p\)</span> distribution</p>
<p><strong>Example</strong>:</p>
<p>To illustrate, I generate <span class="math inline">\(N = 100\)</span> points from a bivariate normal distribution with means <span class="math inline">\(\mu = (30, 30)\)</span>, variances = 10, and a correlation <span class="math inline">\(\rho = 0.7\)</span> and add two noteworthy points that show an apparently paradoxical result.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">421</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,   <span class="fl">10</span><span class="op">*</span><span class="va">r</span>,</span>
<span>                <span class="fl">10</span><span class="op">*</span><span class="va">r</span>, <span class="fl">10</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">mu</span>, <span class="va">cov</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add 2 points</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">X</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">38</span><span class="op">)</span>,</span>
<span>                      x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Mahalanobis squared distances of these points can be calculated using <code><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">heplots::Mahalanobis()</a></code>, and their corresponding hatvalues found using <code><a href="https://rdrr.io/r/stats/influence.measures.html">hatvalues()</a></code> for any linear model using both <code>x1</code> and <code>x2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Dsq <span class="op">=</span> <span class="fu">heplots</span><span class="fu">::</span><span class="fu"><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">Mahalanobis</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">x2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hatvalues</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting <code>x1</code> and <code>x2</code> with data ellipses shows the relation of leverage to squared distance from the mean. The <span style="color: blue;">blue</span> point looks to be farther from the <span style="color: green;">mean</span>, but the <span style="color: red;">red</span> point is actually very much further by Mahalanobis squared distance, which takes the correlation into account; it thus has much greater leverage.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x1</span>, <span class="va">X</span><span class="op">$</span><span class="va">x2</span>, </span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.40</span>, <span class="fl">0.68</span>, <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>            xlab <span class="op">=</span> <span class="st">"X1"</span>, ylab <span class="op">=</span> <span class="st">"X2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">N</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">16</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span>      <span class="co"># last two rows</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hatvalues-demo1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/fig-hatvalues-demo1-1.png" class="img-fluid figure-img" width="2100"></p>
<figcaption class="figure-caption">Figure&nbsp;6.5: Data ellipses for a bivariate normal sample with correlation 0.7, and two additional noteworthy points. The blue point looks to be farther from the mean, but the red point is actually more than 5 times further by Mahalanobis squared distance, and thus has much greater leverage.</figcaption></figure>
</div>
</div>
</div>
<p>The fact that hatvalues are proportional to leverage can be seen by plotting one against the other. I highlight the two noteworthy points in their colors from <a href="#fig-hatvalues-demo1">Figure&nbsp;<span>6.5</span></a> to illustrate how much greater leverage the <span style="color: red;">red</span> point has compared to the <span style="color: blue;">blue</span> point.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hat</span> <span class="op">~</span> <span class="va">Dsq</span>, data <span class="op">=</span> <span class="va">X</span>,</span>
<span>     cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="va">N</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Hatvalue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Mahalanobis Dsq"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hatvalues-demo2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/fig-hatvalues-demo2-1.png" class="img-fluid figure-img" width="2100"></p>
<figcaption class="figure-caption">Figure&nbsp;6.6: Hat values are proportional to squared Mahalanobis distances from the mean.</figcaption></figure>
</div>
</div>
</div>
<p>Look back at these two points in <a href="#fig-hatvalues-demo1">Figure&nbsp;<span>6.5</span></a>. Can you guess how much further the <span style="color: red;">red</span> point is from the mean than the <span style="color: blue;">blue</span> point? You might be surprised that its’ <span class="math inline">\(D^2\)</span> and leverage are about five times as great!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x1 x2   Dsq   y    hat</span></span>
<span><span class="co">#&gt; 1 28 42 25.65 179 0.2638</span></span>
<span><span class="co">#&gt; 2 38 35  4.95 175 0.0588</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="outliers-measuring-residuals" class="level3" data-number="6.6.3"><h3 data-number="6.6.3" class="anchored" data-anchor-id="outliers-measuring-residuals">
<span class="header-section-number">6.6.3</span> Outliers: Measuring residuals</h3>
<p>From the discussion in <a href="#sec-leverage"><span>Section&nbsp;6.6</span></a>, outliers for the response <span class="math inline">\(y\)</span> are those observations for which the residual <span class="math inline">\(e_i = y_i - \hat{y}_i\)</span> are unusually large in magnitude. However, as demonstrated in <a href="#fig-levdemo">Figure&nbsp;<span>6.3</span></a>, a high-leverage point will pull the fitted line towards it, reducing its’ residual and thus making them look less unusual.</p>
<p>The standard approach <span class="citation" data-cites="CookWeisberg:82 HoaglinWelsch1978">(<a href="90-references.html#ref-CookWeisberg:82" role="doc-biblioref">Cook &amp; Weisberg, 1982</a>; <a href="90-references.html#ref-HoaglinWelsch1978" role="doc-biblioref">Hoaglin &amp; Welsch, 1978</a>)</span> is to consider a <em>deleted residual</em> <span class="math inline">\(e_{(-i)}\)</span>, conceptually as that obtained by re-fitting the model with observation <span class="math inline">\(i\)</span> omitted and obtaining the fitted value <span class="math inline">\(\hat{y}_{(-i)}\)</span> from the remaining <span class="math inline">\(n-1\)</span> observations, <span class="math display">\[
e_{(-i)} = y_i - \hat{y}_{(-i)} \; .
\]</span> The (externally) <em>studentized residual</em> is then obtained by dividing <span class="math inline">\(e_{(-i)}\)</span> by it’s estimated standard error, giving <span class="math display">\[
e^\star_{(-i)} = \frac{e_{(-i)}}{\text{sd}(e_{(-i)})} = \frac{e_i}{\sqrt{\text{MSE}_{(-i)}\; (1 - h_i)}} \; .
\]</span></p>
<p>This is just the ordinary residual <span class="math inline">\(e_i\)</span> divided by a factor that increases with the residual variance but decreases with leverage. It can be shown that these studentized residuals follow a <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(n - p -2\)</span> degrees of freedom, so a value <span class="math inline">\(|e^\star_{(-i)}| &gt; 2\)</span> can be considered large enough to pay attention to.<br>
In practice for classical linear models, it is unnecessary to actually re-fit the model <span class="math inline">\(n\)</span> times …</p>
</section><section id="measuring-influence" class="level3" data-number="6.6.4"><h3 data-number="6.6.4" class="anchored" data-anchor-id="measuring-influence">
<span class="header-section-number">6.6.4</span> Measuring influence</h3>
<p>As described at the start of this section, the actual influence of a given case depends multiplicatively on its’ leverage and residual. But how can we measure it?</p>
<p>The essential idea introduced above, is to delete the observations one at a time, each time refitting the regression model on the remaining <span class="math inline">\(n–1\)</span> observations. Then, for observation <span class="math inline">\(i\)</span> compare the results using all <span class="math inline">\(n\)</span> observations to those with the <span class="math inline">\(i^{th}\)</span> observation deleted to see how much influence the observation has on the analysis.</p>
<p>The simplest such measure, called DFFITS, compares the predicted value for case <span class="math inline">\(i\)</span> with what would be obtained when that observation is excluded.</p>
<p><span class="math display">\[\begin{eqnarray*}
\text{DFFITS}_i &amp; = &amp; \frac{\hat{y}_i - \hat{y}_{(-i)}}{\sqrt{\text{MSE}_{(-i)}\; h_i}} \\
   &amp; = &amp; e^\star_{(-i)} \times \sqrt{\frac{h_i}{1-h_i}} \;\; .
\end{eqnarray*}\]</span></p>
<p>The first equation gives the signed difference in fitted values in units of the standard deviation of that difference weighted by leverage; the second version <span class="citation" data-cites="Belsley-etal:80">(<a href="90-references.html#ref-Belsley-etal:80" role="doc-biblioref">Belsley et al., 1980</a>)</span> represents that as a product of residual and leverage. A rule of thumb is that an observation is deemed to be influential if <span class="math inline">\(| \text{DFFITS}_i | &gt; 2 \sqrt{(p+1) / n}\)</span>.</p>
<div class="cell" data-layout-align="center">
<pre data-code-line-numbers=""><code>#&gt; Writing packages to  C:/R/Projects/Vis-MLM-book/bib/pkgs.txt
#&gt; 24  packages used here:
#&gt;  bayestestR, car, carData, correlation, datawizard, dplyr, easystats, effectsize, forcats, ggplot2, insight, knitr, lubridate, modelbased, parameters, performance, purrr, readr, report, see, stringr, tibble, tidyr, tidyverse</code></pre>
</div>
<!-- ## References {.unnumbered} -->


<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Belsley-etal:80" class="csl-entry" role="listitem">
Belsley, D. A., Kuh, E., &amp; Welsch, R. E. (1980). <em>Regression diagnostics: Identifying influential data and sources of collinearity</em>. John Wiley; Sons.
</div>
<div id="ref-CookWeisberg:82" class="csl-entry" role="listitem">
Cook, R. D., &amp; Weisberg, S. (1982). <em>Residuals and influence in regression</em>. Chapman; Hall.
</div>
<div id="ref-Duncan:61" class="csl-entry" role="listitem">
Duncan, O. D. (1961). A socioeconomic index for all occupations. In Jr. A. J. Reiss, P. K. H. O. D. Duncan, &amp; C. C. North (Eds.), <em>Occupations and social status</em>. The Free Press.
</div>
<div id="ref-Fox2020" class="csl-entry" role="listitem">
Fox, J. (2020). <em>Regression diagnostics</em> (2nd ed.). <span>SAGE</span> Publications, Inc. <a href="https://doi.org/10.4135/9781071878651">https://doi.org/10.4135/9781071878651</a>
</div>
<div id="ref-FoxWeisberg:2018" class="csl-entry" role="listitem">
Fox, J., &amp; Weisberg, S. (2018). <em>An r companion to applied regression</em> (Third). SAGE Publications. <a href="https://books.google.ca/books?id=uPNrDwAAQBAJ">https://books.google.ca/books?id=uPNrDwAAQBAJ</a>
</div>
<div id="ref-R-car" class="csl-entry" role="listitem">
Fox, J., Weisberg, S., &amp; Price, B. (2023). <em>Car: Companion to applied regression</em>. <a href="https://CRAN.R-project.org/package=car">https://CRAN.R-project.org/package=car</a>
</div>
<div id="ref-HoaglinWelsch1978" class="csl-entry" role="listitem">
Hoaglin, D. C., &amp; Welsch, R. E. (1978). The hat matrix in regression and <span>ANOVA</span>. <em>The American Statistician</em>, <em>32</em>(1), 17–22. <a href="https://doi.org/10.1080/00031305.1978.10479237">https://doi.org/10.1080/00031305.1978.10479237</a>
</div>
<div id="ref-Ludecke-etal-performance" class="csl-entry" role="listitem">
Lüdecke, D., Ben-Shachar, M. S., Patil, I., Waggoner, P., &amp; Makowski, D. (2021). <span class="nocase">performance</span>: An <span>R</span> package for assessment, comparison and testing of statistical models. <em>Journal of Open Source Software</em>, <em>6</em>(60), 3139. <a href="https://doi.org/10.21105/joss.03139">https://doi.org/10.21105/joss.03139</a>
</div>
<div id="ref-R-easystats" class="csl-entry" role="listitem">
Lüdecke, D., Ben-Shachar, M. S., Patil, I., Wiernik, B. M., &amp; Makowski, D. (2022). Easystats: Framework for easy statistical modeling, visualization, and reporting. In <em>CRAN</em>. <a href="https://easystats.github.io/easystats/">https://easystats.github.io/easystats/</a>
</div>
</div>
</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./05-linear_models.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-collinearity-ridge.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>