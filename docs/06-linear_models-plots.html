<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>6&nbsp; Plots for univariate response models – Visualizing Multivariate Data and Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-lin-mod-topics.html" rel="next">
<link href="./05-linear_models.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-linear_models.html">Univariate Linear Models</a></li><li class="breadcrumb-item"><a href="./06-linear_models-plots.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-linear_models.html">Univariate Linear Models</a></li><li class="breadcrumb-item"><a href="./06-linear_models-plots.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></a></li></ol></nav>
      <h1 class="title"><span id="sec-linear-models-plots" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Orienting Ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Exploratory Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Univariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Multivariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">End matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./95-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#the-regression-quartet" id="toc-the-regression-quartet" class="nav-link active" data-scroll-target="#the-regression-quartet"><span class="header-section-number">6.1</span> The “regression quartet”</a>
  <ul class="collapse">
<li><a href="#sec-example-duncan" id="toc-sec-example-duncan" class="nav-link" data-scroll-target="#sec-example-duncan"><span class="header-section-number">6.1.1</span> Example: Duncan’s occupational prestige</a></li>
  <li><a href="#sec-example-prestige" id="toc-sec-example-prestige" class="nav-link" data-scroll-target="#sec-example-prestige"><span class="header-section-number">6.1.2</span> Example: Canadian occupational prestige</a></li>
  </ul>
</li>
  <li><a href="#other-model-plots" id="toc-other-model-plots" class="nav-link" data-scroll-target="#other-model-plots"><span class="header-section-number">6.2</span> Other Model plots</a></li>
  <li>
<a href="#coefficient-displays" id="toc-coefficient-displays" class="nav-link" data-scroll-target="#coefficient-displays"><span class="header-section-number">6.3</span> Coefficient displays</a>
  <ul class="collapse">
<li><a href="#displaying-coefficients" id="toc-displaying-coefficients" class="nav-link" data-scroll-target="#displaying-coefficients"><span class="header-section-number">6.3.1</span> Displaying coefficients</a></li>
  <li><a href="#visualizing-coefficients" id="toc-visualizing-coefficients" class="nav-link" data-scroll-target="#visualizing-coefficients"><span class="header-section-number">6.3.2</span> Visualizing coefficients</a></li>
  <li><a href="#more-useful-coefficient-plots" id="toc-more-useful-coefficient-plots" class="nav-link" data-scroll-target="#more-useful-coefficient-plots"><span class="header-section-number">6.3.3</span> More useful coefficient plots</a></li>
  </ul>
</li>
  <li>
<a href="#sec-avplots" id="toc-sec-avplots" class="nav-link" data-scroll-target="#sec-avplots"><span class="header-section-number">6.4</span> Added-variable and related plots</a>
  <ul class="collapse">
<li><a href="#properties-of-av-plots" id="toc-properties-of-av-plots" class="nav-link" data-scroll-target="#properties-of-av-plots"><span class="header-section-number">6.4.1</span> Properties of AV plots</a></li>
  <li><a href="#marginal---conditional-plots" id="toc-marginal---conditional-plots" class="nav-link" data-scroll-target="#marginal---conditional-plots"><span class="header-section-number">6.4.2</span> Marginal - conditional plots</a></li>
  <li><a href="#prestige-data" id="toc-prestige-data" class="nav-link" data-scroll-target="#prestige-data"><span class="header-section-number">6.4.3</span> Prestige data</a></li>
  <li><a href="#component-residual-plots" id="toc-component-residual-plots" class="nav-link" data-scroll-target="#component-residual-plots"><span class="header-section-number">6.4.4</span> Component + Residual plots</a></li>
  </ul>
</li>
  <li>
<a href="#effect-displays" id="toc-effect-displays" class="nav-link" data-scroll-target="#effect-displays"><span class="header-section-number">6.5</span> Effect displays</a>
  <ul class="collapse">
<li><a href="#prestige-data-1" id="toc-prestige-data-1" class="nav-link" data-scroll-target="#prestige-data-1"><span class="header-section-number">6.5.1</span> Prestige data</a></li>
  </ul>
</li>
  <li>
<a href="#sec-leverage" id="toc-sec-leverage" class="nav-link" data-scroll-target="#sec-leverage"><span class="header-section-number">6.6</span> Outliers, leverage and influence</a>
  <ul class="collapse">
<li><a href="#sec-lev-inf-quartet" id="toc-sec-lev-inf-quartet" class="nav-link" data-scroll-target="#sec-lev-inf-quartet"><span class="header-section-number">6.6.1</span> The leverage-influence quartet</a></li>
  <li><a href="#influence-plots" id="toc-influence-plots" class="nav-link" data-scroll-target="#influence-plots"><span class="header-section-number">6.6.2</span> Influence plots</a></li>
  <li><a href="#sec-duncan-influence" id="toc-sec-duncan-influence" class="nav-link" data-scroll-target="#sec-duncan-influence"><span class="header-section-number">6.6.3</span> Duncan data</a></li>
  <li><a href="#influence-in-added-variable-plots" id="toc-influence-in-added-variable-plots" class="nav-link" data-scroll-target="#influence-in-added-variable-plots"><span class="header-section-number">6.6.4</span> Influence in added-variable plots</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- \require{newcommand} --><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \newcommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- \newcommand*{\E}{\mathcal{E}} --><!-- Index generation --><!-- % R packages:  indexed under both package name and packages! --><!-- % data sets:  --><!-- % R stuff --><p>For a univariate linear model fit using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> and similar functions, the standard <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method gives basic versions of <em>diagnostic</em> plots of residuals and other calculated quantities for assessing possible violations of the model assumptions. Some of these can be considerably enhanced using other packages.</p>
<p>Beyond this,</p>
<ul>
<li><p>tables of model coefficients, standard errors and test statistics can often be usefully supplemented or even replaced by suitable <em>coeficient plots</em> providing essentially the same information.</p></li>
<li><p>when there are two or more predictors, standard plots of <span class="math inline">\(y\)</span> vs.&nbsp;each <span class="math inline">\(x\)</span> can be misleading because they ignore the other predictors in the model. <em>Added-variable plots</em> (also called <em>partial regression plots</em>) allow you to visualize <em>partial</em> relations between the response and a predictor by adjusting (controlling for) all other predictors. <em>Component + residual</em> plots help to diagnose nonlinearity.</p></li>
<li><p>in this same situation, you can more easily understand their separate impact on the response by plotting the marginal <em>predicted effects</em> of one or more focal variables, averaging over other variables not shown in a given plot.</p></li>
<li><p>when there are highly correlated predictors, some specialized plots are useful to understand the nature of <em>multicolinearity</em>.</p></li>
</ul>
<p>The classic reference on regression diagnostics is <span class="citation" data-cites="Belsley-etal:80">Belsley et al. (<a href="95-references.html#ref-Belsley-etal:80" role="doc-biblioref">1980</a>)</span>. My favorite modern texts are the brief <span class="citation" data-cites="Fox2020">Fox (<a href="95-references.html#ref-Fox2020" role="doc-biblioref">2020</a>)</span> and the more complete <span class="citation" data-cites="FoxWeisberg:2018">Fox &amp; Weisberg (<a href="95-references.html#ref-FoxWeisberg:2018" role="doc-biblioref">2018a</a>)</span>, both of which are supported by the <span style="color: brown;"><strong>car</strong></span> package <span class="citation" data-cites="R-car">(<a href="95-references.html#ref-R-car" role="doc-biblioref">Fox et al., 2023</a>)</span>. Some of the examples in this chapter are inspired by <span class="citation" data-cites="FoxWeisberg:2018">Fox &amp; Weisberg (<a href="95-references.html#ref-FoxWeisberg:2018" role="doc-biblioref">2018a</a>)</span>.</p>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/easystats/">easystats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.r-project.org">effects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/">ggeffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://larmarange.github.io/ggstats/">ggstats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/">marginaleffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://modelsummary.com">modelsummary</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/performance/">performance</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-regression-quartet" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="the-regression-quartet">
<span class="header-section-number">6.1</span> The “regression quartet”</h2>
<p>For a fitted model, plotting the model object with <code>plot(model)</code> provides for any of six basic plots, of which four are produced by default, giving rise to the term <em>regression quartet</em> for this collection. These are:</p>
<ul>
<li><p><strong>Residuals vs.&nbsp;Fitted</strong>: For well-behaved data, the points should hover around a horizontal line at residual = 0, with no obvious pattern or trend.</p></li>
<li><p><strong>Normal Q-Q plot</strong>: A plot of sorted standardized residuals <span class="math inline">\(e_i\)</span> (obtained from<code>rstudent(model)</code>) against the theoretical values those values would have in a standard normal <span class="math inline">\(\mathcal{N}(0, 1)\)</span> distribution.</p></li>
<li><p><strong>Scale-Location</strong>: Plots the square-root of the absolute values of the standardized residuals <span class="math inline">\(\sqrt{| e_i |}\)</span> as a measure of “scale” against the fitted values <span class="math inline">\(\hat{y}_i\)</span> as a measure of “location”. This provides an assessment of homogeneity of variance. Violations appear as a tendency for scale (variability) to vary with location.</p></li>
<li><p><strong>Residuals vs.&nbsp;Leverage</strong>: Plots standardized residuals against leverage to help identify possibly influential observations. Leverage, or “hat” values (given by <code>hat(model)</code>) are proportional to the squared Mahalanobis distances of the predictor values <span class="math inline">\(\mathbf{x}_i\)</span> from the means, and measure the potential of an observation to change the fitted coefficients if that observation was deleted. Actual influence is measured by Cooks’s distance (<code>cooks.distance(model)</code>) and is proportional to the product of residual times leverage. Contours of constant Cook’s <span class="math inline">\(D\)</span> are added to the plot.</p></li>
</ul>
<p>One key feature of these plots is providing <strong>reference</strong> lines or smoothed curves for ease of judging the extent to which a plot conforms to the expected pattern; another is the <strong>labeling</strong> of observations which deviate from an assumption.</p>
<p>The base-R <code>plot(model)</code> plots are done much better in a variety of packages. I illustrate some versions from the <strong>car</strong> <span class="citation" data-cites="R-car">(<a href="95-references.html#ref-R-car" role="doc-biblioref">Fox et al., 2023</a>)</span> and <strong>performance</strong> <span class="citation" data-cites="Ludecke-etal-performance">(<a href="95-references.html#ref-Ludecke-etal-performance" role="doc-biblioref">Lüdecke et al., 2021</a>)</span> packages, part of the <strong>easystats</strong> <span class="citation" data-cites="R-easystats">(<a href="95-references.html#ref-R-easystats" role="doc-biblioref">Lüdecke et al., 2022</a>)</span> suite of packages.</p>
<section id="sec-example-duncan" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="sec-example-duncan">
<span class="header-section-number">6.1.1</span> Example: Duncan’s occupational prestige</h3>
<p>In a classic study in sociology, <span class="citation" data-cites="Duncan:61">Duncan (<a href="95-references.html#ref-Duncan:61" role="doc-biblioref">1961</a>)</span> used data from the U.S. Census in 1950 to study how one could predict the prestige of occupational categories — which is hard to measure — from available information in the census for those occupations. His data is available in <code>carData:Duncan</code>, and contains</p>
<ul>
<li>
<code>type</code>: the category of occupation, one of <code>prof</code> (professional), <code>wc</code> (white collar) or <code>bc</code> (blue collar);</li>
<li>
<code>income</code>: the percentage of occupational incumbents with a reported income &gt; 3500 (about 40,000 in current dollars);</li>
<li>
<code>education</code>: the percentage of occupational incumbents who were high school graduates;</li>
<li>
<code>prestige</code>: the percentage of respondents in a social survey who rated the occupation as “good” or better in prestige.</li>
</ul>
<p>These variables are a bit quirky in they are measured in percents, 0-100, rather dollars for <code>income</code> and years for <code>education</code>, but this common scale permitted Duncan to ask an interesting sociological question: Assuming that both income and education predict prestige, are they equally important, as might be assessed by testing the hypothesis <span class="math inline">\(\mathcal{H}_0: \beta_{\text{income}} = \beta_{\text{education}}\)</span>. If so, this would provide a very simple theory for occupational prestige.</p>
<p>A quick look at the data shows the variables and a selection of the occupational categories, which are the <code><a href="https://rdrr.io/r/base/row.names.html">row.names()</a></code> of the dataset.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Duncan</span>, package <span class="op">=</span> <span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/some.html">some</a></span><span class="op">(</span><span class="va">Duncan</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  type income education prestige</span></span>
<span><span class="co">#&gt; accountant       prof     62        86       82</span></span>
<span><span class="co">#&gt; professor        prof     64        93       93</span></span>
<span><span class="co">#&gt; engineer         prof     72        86       88</span></span>
<span><span class="co">#&gt; factory.owner    prof     60        56       81</span></span>
<span><span class="co">#&gt; store.clerk        wc     29        50       16</span></span>
<span><span class="co">#&gt; carpenter          bc     21        23       33</span></span>
<span><span class="co">#&gt; machine.operator   bc     21        20       24</span></span>
<span><span class="co">#&gt; barber             bc     16        26       20</span></span>
<span><span class="co">#&gt; soda.clerk         bc     12        30        6</span></span>
<span><span class="co">#&gt; janitor            bc      7        20        8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s start by fitting a simple model using just income and education as predictors. The results look very good! Both <code>income</code> and <code>education</code> are highly significant and the <span class="math inline">\(R^2 = 0.828\)</span> for the model indicates that <code>prestige</code> is very well predicted by just these variables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">duncan.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span>, data<span class="op">=</span><span class="va">Duncan</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">duncan.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = prestige ~ income + education, data = Duncan)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -29.54  -6.42   0.65   6.61  34.64 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  -6.0647     4.2719   -1.42     0.16    </span></span>
<span><span class="co">#&gt; income        0.5987     0.1197    5.00  1.1e-05 ***</span></span>
<span><span class="co">#&gt; education     0.5458     0.0983    5.56  1.7e-06 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 13.4 on 42 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.828,  Adjusted R-squared:  0.82 </span></span>
<span><span class="co">#&gt; F-statistic:  101 on 2 and 42 DF,  p-value: &lt;2e-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Beyond this, Duncan was interested in the coefficients and whether income and education could be said to have equal impacts on predicting occupational prestige. A nice display of model coefficients with confidence intervals is provided by <code><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters::model_parameters()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">duncan.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(42) |      p</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       -6.06 | 4.27 | [-14.69, 2.56] | -1.42 | 0.163 </span></span>
<span><span class="co">#&gt; income      |        0.60 | 0.12 | [  0.36, 0.84] |  5.00 | &lt; .001</span></span>
<span><span class="co">#&gt; education   |        0.55 | 0.10 | [  0.35, 0.74] |  5.56 | &lt; .001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also test Duncan’s hypothesis that income and education have equal effects on prestige with <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">car::linearHypothesis()</a></code>. This is constructed as a test of a restricted model in which the two coefficients are forced to be equal against the unrestricted model. Duncan was very happy with this result.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">duncan.mod</span>, <span class="st">"income = education"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear hypothesis test:</span></span>
<span><span class="co">#&gt; income - education = 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: restricted model</span></span>
<span><span class="co">#&gt; Model 2: prestige ~ income + education</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; 1     43 7519                         </span></span>
<span><span class="co">#&gt; 2     42 7507  1      12.2 0.07    0.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equivalently, the linear hypothesis that <span class="math inline">\(\beta_{\text{Inc}} = \beta_{\text{Educ}}\)</span> can be tested with a Wald test for difference between these coefficients, expressed as <span class="math inline">\(\mathcal{H}_0 : \mathbf{C} \mathbf{\beta} = 0\)</span>, using <span class="math inline">\(\mathbf{C} = (0, -1, 1)\)</span>. The estimated value, -0.053 has a confidence interval [-0.462, 0.356], consistent with Duncan’s hypothesis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wtest</span> <span class="op">&lt;-</span> <span class="fu">spida2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spida2/man/wald.html">wald</a></span><span class="op">(</span><span class="va">duncan.mod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">wtest</span><span class="op">$</span><span class="va">estimate</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt;        Estimate Std.Error DF t-value p-value Lower 0.95 Upper 0.95</span></span>
<span><span class="co">#&gt;   Larg  -0.0529     0.203 42  -0.261   0.795     -0.462      0.356</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can visualize this test and confidence intervals using a joint confidence ellipse for the coefficients for income and education in the model <code>duncan.mod</code>. In <a href="#fig-duncan-beta-diff" class="quarto-xref">Figure&nbsp;<span>6.1</span></a> the size of the ellipse is set to <span class="math inline">\(\sqrt{F^{0.95}_{1,\nu}} = t^{0.95}_{\nu}\)</span>, so that its shadows on the horizontal and vertical axes correspond to 1D 95% confidence intervals. In this plot, the line through the origin with slope <span class="math inline">\(= 1\)</span> corresponds to equal coefficients for income and education and the line with slope <span class="math inline">\(= -1\)</span> corresponds to their difference, <span class="math inline">\(\beta_{\text{Educ}} - \beta_{\text{Inc}}\)</span>. The orthogonal projection of the coefficient vector <span class="math inline">\((\widehat{\beta}_{\text{Inc}}, \widehat{\beta}_{\text{Educ}})\)</span> (the center of the ellipse) is the point estimate of <span class="math inline">\(\widehat{\beta}_{\text{Educ}} - \widehat{\beta}_{\text{Inc}}\)</span> and the shadow of the ellipse along this axis is the 95% confidence interval for the difference in slopes.</p>
<!-- figure-code: R/Duncan/dunc-conf-ellipse.R -->
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>See the code</summary><div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">confidenceEllipse</a></span><span class="op">(</span><span class="va">duncan.mod</span>, col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  levels <span class="op">=</span> <span class="fl">0.95</span>, dfn <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.4</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.4</span>, <span class="fl">1</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.3</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Income coefficient, "</span>, <span class="va">beta</span><span class="op">[</span><span class="va">Inc</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Education coefficient, "</span>, <span class="va">beta</span><span class="op">[</span><span class="va">Educ</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, v<span class="op">=</span><span class="fl">0</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># confidence intervals for each coefficient</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span> <span class="va">duncan.mod</span> <span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">duncan.mod</span><span class="op">)</span>       <span class="co"># confidence intervals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span> y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">CI</span><span class="op">[</span><span class="st">"income"</span>,<span class="op">]</span> , lwd <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span> x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">CI</span><span class="op">[</span><span class="st">"education"</span>,<span class="op">]</span> , lwd <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'black'</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> , col <span class="op">=</span> <span class="st">'black'</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span>, angle<span class="op">=</span><span class="fl">8</span>, len<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">0</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, angle<span class="op">=</span><span class="fl">8</span>, len<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add line for equal slopes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="va">Educ</span><span class="op">]</span> <span class="op">==</span> <span class="va">beta</span><span class="op">[</span><span class="va">Inc</span><span class="op">]</span><span class="op">)</span>, </span>
<span>     srt<span class="op">=</span><span class="fl">45</span>, pos<span class="op">=</span><span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add line for difference in slopes</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="st">"darkred"</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="op">-</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.15</span>, <span class="op">-</span><span class="fl">.15</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="op">~</span><span class="va">beta</span><span class="op">[</span><span class="st">"Educ"</span><span class="op">]</span> <span class="op">-</span> <span class="op">~</span><span class="va">beta</span><span class="op">[</span><span class="st">"Inc"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>     col<span class="op">=</span><span class="va">col</span>, cex<span class="op">=</span><span class="fl">1.5</span>, srt<span class="op">=</span><span class="op">-</span><span class="fl">45</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># confidence interval for b1 - b2</span></span>
<span><span class="va">wtest</span> <span class="op">&lt;-</span> <span class="fu">spida2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spida2/man/wald.html">wald</a></span><span class="op">(</span><span class="va">duncan.mod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">wtest</span><span class="op">$</span><span class="va">estimate</span><span class="op">$</span><span class="va">Lower</span> <span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">wtest</span><span class="op">$</span><span class="va">estimate</span><span class="op">$</span><span class="va">Upper</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lower</span>, <span class="va">upper</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lower</span>,<span class="va">upper</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">6</span>, col<span class="op">=</span><span class="va">col</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># projection of (b1, b2) on b1-b2 axis</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span> <span class="va">duncan.mod</span> <span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">bdiff</span> <span class="op">&lt;-</span> <span class="va">beta</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">bdiff</span>, <span class="op">-</span><span class="va">bdiff</span>, pch<span class="op">=</span><span class="fl">16</span>, cex<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bdiff</span>, <span class="op">-</span><span class="va">bdiff</span>, </span>
<span>       angle<span class="op">=</span><span class="fl">8</span>, len<span class="op">=</span><span class="fl">0.2</span>, col<span class="op">=</span><span class="va">col</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calibrate the diff axis</span></span>
<span><span class="va">ticks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>, by<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">ticklen</span> <span class="op">&lt;-</span> <span class="fl">0.02</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="va">ticks</span>, <span class="op">-</span><span class="va">ticks</span>, <span class="va">ticks</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">ticklen</span>, <span class="op">-</span><span class="va">ticks</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">ticklen</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">ticks</span><span class="op">-</span><span class="fl">2.4</span><span class="op">*</span><span class="va">ticklen</span>, <span class="op">-</span><span class="va">ticks</span><span class="op">-</span><span class="fl">2.4</span><span class="op">*</span><span class="va">ticklen</span>, <span class="va">ticks</span>, srt<span class="op">=</span><span class="op">-</span><span class="fl">45</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-duncan-beta-diff" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-duncan-beta-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-duncan-beta-diff-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-duncan-beta-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.1: Joint 95% confidence ellipse for <span class="math inline">\((\beta_{\text{Inc}}, \beta_{\text{Educ}})\)</span>, together with their 1D shadows, which give 95% confidence intervals for the separate coefficients and the linear hypothesis that the coefficients are equal. Projecting the confidence ellipse along the line with unit slope gives a confidence interval for the difference between coefficients, shown by the dark red line.
</figcaption></figure>
</div>
</div>
</div>
<!-- ```{r} -->
<!-- #| label: fig-duncan-beta-diff-include -->
<!-- #| echo: false -->
<!-- #| out-width: "80%" -->
<!-- #| fig-cap: "Joint 95% confidence ellipse for $(\beta_{\text{Inc}}, \beta_{\text{Educ}}), together with their 1D shadows, which give 95% confidence intervals for the separate coefficients and the linear hypothesis that the coefficients are equal." -->
<!-- knitr::include_graphics("images/Duncan-beta-diff.png") -->
<!-- ``` -->
<section id="diagnostic-plots" class="level4" data-number="6.1.1.1"><h4 data-number="6.1.1.1" class="anchored" data-anchor-id="diagnostic-plots">
<span class="header-section-number">6.1.1.1</span> Diagnostic plots</h4>
<p>But, should Duncan be <strong>so</strong> happy? It is unlikely that he ran any model diagnostics or plotted his model; we do so now. Here is the regression quartet (<a href="#fig-duncan-plot-model" class="quarto-xref">Figure&nbsp;<span>6.2</span></a>) for this model. Each plot shows some trend lines, and importantly, labels some observations that stand out and might deserve attention.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>          mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">duncan.mod</span>, lwd<span class="op">=</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-duncan-plot-model" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-duncan-plot-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-duncan-plot-model-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-duncan-plot-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.2: Regression quartet of diagnostic plots for the <code>Duncan</code> data. Several possibly unusual observations are labeled.
</figcaption></figure>
</div>
</div>
</div>
<p>Some points to note:</p>
<ul>
<li>A few observations (minister, reporter, conductor, contractor) are flagged in multiple panels. It turns out (<a href="#sec-duncan-influence" class="quarto-xref"><span>Section 6.6.3</span></a>) that the observations for minister and reporter noted in the residuals vs.&nbsp;leverage plot are highly influential and largely responsible for Duncan’s finding that the slopes for income and education could be considered equal.</li>
<li>The <span style="color: red;">red</span> trend line in the scale-location plot indicates that residual variance is not constant, but rather increases from both ends. This is a consequence of the fact that <code>prestige</code> is measured as a percentage, bounded at [0, 100], and the standard deviation of a percentage <span class="math inline">\(p\)</span> is proportional to <span class="math inline">\(\sqrt{p \times (1-p)}\)</span> which is maximal at $p = 0.5.</li>
</ul>
<p>Similar, but nicer-looking diagnostic plots are provided by <code><a href="https://easystats.github.io/performance/reference/check_model.html">performance::check_model()</a></code> which uses <code>ggplot2</code> for graphics. These include helpful captions indicating what should be observed for each for a good-fitting model. However, they don’t have as good facilities for labeling unusual observations as the base R <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> or functions in the <code>car</code> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">duncan.mod</span>, check<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"linearity"</span>, <span class="st">"qq"</span>, <span class="st">"homogeneity"</span>, <span class="st">"outliers"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-duncan-check-model" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-duncan-check-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-duncan-check-model-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-duncan-check-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.3: Diagnostic plots for the <code>Duncan</code> data, using <code><a href="https://easystats.github.io/performance/reference/check_model.html">check_model()</a></code>.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-example-prestige" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="sec-example-prestige">
<span class="header-section-number">6.1.2</span> Example: Canadian occupational prestige</h3>
<!-- **TODO**:  Already introduced in @sec-prestige Pair this down & integrate with that -->
<p>Following <span class="citation" data-cites="Duncan:61">Duncan (<a href="95-references.html#ref-Duncan:61" role="doc-biblioref">1961</a>)</span>, occupational prestige was studied in a Canadian context by Bernard Blishen and others at York University, giving the dataset <code><a href="https://rdrr.io/pkg/carData/man/Prestige.html">carData::Prestige</a></code> which we looked at in <a href="03-multivariate_plots.html#sec-prestige" class="quarto-xref"><span>Section 3.2.3</span></a>. It differs from the <code>Duncan</code> dataset primarily in that the main variables—prestige, income and education were revamped to better reflect the underlying constructs in more meaningful units.</p>
<ul>
<li><p><code>prestige</code>: Rather than a simple percentage of “good+” ratings, this uses a wider and more reliable scale from <span class="citation" data-cites="Pineo-Porter-1967">Pineo &amp; Porter (<a href="95-references.html#ref-Pineo-Porter-1967" role="doc-biblioref">1967</a>)</span> on a scale from 10–90.</p></li>
<li><p><code>income</code> is measured as the average income of incumbents in each occupation, in 1971 dollars, rather than percent exceeding a given threshold ($3500)</p></li>
<li><p><code>education</code> is measured as the average education of occupational incumbents, years.</p></li>
</ul>
<p>The dataset again includes <code>type</code> of occupation with the same levels <code>"bc"</code> (blue collar), <code>"wc"</code> (white collar) and <code>"prof"</code> (professional)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, but in addition includes the percent of <code>women</code> in these occupational categories.</p>
<p>Our interest again is in understanding how <code>prestige</code> is related to census measures of the average education, income, percent women of incumbents in those occupations, but with attention to the scales of measurement and possibly more complex relationships.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Prestige</span>, package<span class="op">=</span><span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="co"># Reorder levels of type</span></span>
<span><span class="va">Prestige</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">$</span><span class="va">type</span>, </span>
<span>                        levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bc"</span>, <span class="st">"wc"</span>, <span class="st">"prof"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    102 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ education: num  13.1 12.3 12.8 11.4 14.6 ...</span></span>
<span><span class="co">#&gt;  $ income   : int  12351 25879 9271 8865 8403 11030 8258 14163 11377 11023 ...</span></span>
<span><span class="co">#&gt;  $ women    : num  11.16 4.02 15.7 9.11 11.68 ...</span></span>
<span><span class="co">#&gt;  $ prestige : num  68.8 69.1 63.4 56.8 73.5 77.6 72.6 78.1 73.1 68.8 ...</span></span>
<span><span class="co">#&gt;  $ census   : int  1113 1130 1171 1175 2111 2113 2133 2141 2143 2153 ...</span></span>
<span><span class="co">#&gt;  $ type     : Factor w/ 3 levels "bc","wc","prof": 3 3 3 3 3 3 3 3 3 3 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit a main-effects model using all predictors (ignoring <code>census</code>, the Canadian Census occupational code):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prestige.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">type</span>,</span>
<span>                   data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>plot(model)</code> produces four separate plots. For a quick look, I like to arrange them in a single 2x2 figure.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>          mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">prestige.mod</span>, lwd<span class="op">=</span><span class="fl">2</span>, cex.lab<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-plot-prestige-mod" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-plot-prestige-mod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-plot-prestige-mod-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot-prestige-mod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.4: Regression quartet of diagnostic plots for the <code>Prestige</code> data. Several possibly unusual observations are labeled in each plot.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="other-model-plots" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="other-model-plots">
<span class="header-section-number">6.2</span> Other Model plots</h2>
<p><strong>TODO</strong>: What goes here?</p>
</section><section id="coefficient-displays" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="coefficient-displays">
<span class="header-section-number">6.3</span> Coefficient displays</h2>
<p>The results of linear models are most often reported in tables and typically with “significance stars” (<code>*, **, ***</code>) to indicate the outcome of hypothesis tests. These are useful for looking up precise values and you can use this format to compare a small number of competing models side-by-side. However, as illustrated by <span class="citation" data-cites="KastellecLeoni:2007">Kastellec &amp; Leoni (<a href="95-references.html#ref-KastellecLeoni:2007" role="doc-biblioref">2007</a>)</span>, plots of coefficients can increase the clarity of presentation and make it easier to draw correct conclusions. Yet, when you need to present tables, there is a variety of tools in R that can help make them attractive in publications.</p>
<p>For illustration, I’ll consider three models for the <code>Prestige</code> data of increasing complexity:</p>
<ul>
<li>
<code>mod1</code> fits the main effects of the three quantitative predictors;</li>
<li>
<code>mod2</code> adds the categorical variable <code>type</code> of occupation;</li>
<li>
<code>mod3</code> allows an interaction of <code>income</code> with <code>type</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">type</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">income</span> <span class="op">*</span> <span class="va">type</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From our earlier analyses (<a href="03-multivariate_plots.html#sec-prestige" class="quarto-xref"><span>Section 3.2.3</span></a>) we saw that the marginal relationship between <code>income</code> and <code>prestige</code> was nonlinear <a href="03-multivariate_plots.html#fig-Prestige-scatterplot-income1" class="quarto-xref">Figure&nbsp;<span>3.11</span></a>), and was better represented in a linear model using <code>log(income)</code> (<a href="03-multivariate_plots.html#sec-log-scale" class="quarto-xref"><span>Section 3.2.3.1</span></a>) shown in <a href="03-multivariate_plots.html#fig-Prestige-scatterplot2" class="quarto-xref">Figure&nbsp;<span>3.14</span></a>. However, this possibly non-linear relationship could also be explained by stratifying (<a href="03-multivariate_plots.html#sec-stratifying" class="quarto-xref"><span>Section 3.2.3.2</span></a>) the data by <code>type</code> of occupation (<a href="03-multivariate_plots.html#fig-Prestige-scatterplot3" class="quarto-xref">Figure&nbsp;<span>3.15</span></a>).</p>
<section id="displaying-coefficients" class="level3" data-number="6.3.1"><h3 data-number="6.3.1" class="anchored" data-anchor-id="displaying-coefficients">
<span class="header-section-number">6.3.1</span> Displaying coefficients</h3>
<p><code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> gives the complete precis of a fitted model, with information about the estimated coefficients, residuals and goodness-of fit statistics like <span class="math inline">\(R^2\)</span>. But if you only want to see the coefficients, standard errors, etc. <code><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">lmtest::coeftest()</a></code> gives these results in the familiar format for console output. <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code> places these in a tidy format common to many modeling functions which is useful for futher processing (e.g., comparing models).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; t test of coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) -6.794334   3.239089   -2.10    0.039 *  </span></span>
<span><span class="co">#&gt; education    4.186637   0.388701   10.77  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; income       0.001314   0.000278    4.73  7.6e-06 ***</span></span>
<span><span class="co">#&gt; women       -0.008905   0.030407   -0.29    0.770    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 5</span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic  p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 (Intercept) -6.79     3.24        -2.10  3.85e- 2</span></span>
<span><span class="co">#&gt; 2 education    4.19     0.389       10.8   2.59e-18</span></span>
<span><span class="co">#&gt; 3 income       0.00131  0.000278     4.73  7.58e- 6</span></span>
<span><span class="co">#&gt; 4 women       -0.00891  0.0304      -0.293 7.70e- 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <span style="color: brown;"><strong>modelsummary</strong></span> package <span class="citation" data-cites="R-modelsummary">(<a href="95-references.html#ref-R-modelsummary" role="doc-biblioref">Arel-Bundock, 2024</a>)</span> is an easy to use, very general package to summarize data and statistical models in R. The main function <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> can produce highly customizable tables of coefficients in a wide variety of output formats, including HTML, PDF, LaTeX, Markdown, and MS Word. You can select the statistics displayed for any model term with the <code>estimate</code> and <code>statistic</code> arguments.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html">modelsummary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Model1"</span> <span class="op">=</span> <span class="va">mod1</span><span class="op">)</span>,</span>
<span>  coef_omit <span class="op">=</span> <span class="st">"Intercept"</span>,</span>
<span>  shape <span class="op">=</span> <span class="va">term</span> <span class="op">~</span> <span class="va">statistic</span>,</span>
<span>  estimate <span class="op">=</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span>  statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"std.error"</span>, <span class="st">"p.value"</span><span class="op">)</span>,</span>
<span>  fmt <span class="op">=</span> <span class="fu"><a href="https://modelsummary.com/man/fmt_statistic.html">fmt_statistic</a></span><span class="op">(</span><span class="st">"estimate"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"conf.low"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"conf.high"</span> <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  gof_omit <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-modelsummary1" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-modelsummary1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6.1: Table of coefficients for the main effects model.
</figcaption><div aria-describedby="tbl-modelsummary1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_bj8ysfr4r1hnh4kzzhqc(i, j, css_id) {
        var table = document.getElementById("tinytable_bj8ysfr4r1hnh4kzzhqc");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_bj8ysfr4r1hnh4kzzhqc');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_bj8ysfr4r1hnh4kzzhqc(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_bj8ysfr4r1hnh4kzzhqc");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(0, 0, 'tinytable_css_idgt99x3opwli5oto18a5u') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(0, 1, 'tinytable_css_idi9c0ap9eg7z59qjonff2') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(0, 2, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(0, 3, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(1, 0, 'tinytable_css_id4d09bl0324jxmzj8q2uh') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(1, 1, 'tinytable_css_idvk29k6isnstyxkpw5mhk') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(1, 2, 'tinytable_css_idvk29k6isnstyxkpw5mhk') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(1, 3, 'tinytable_css_idvk29k6isnstyxkpw5mhk') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(2, 0, 'tinytable_css_id9wj5s3q8mpb9mqxforem') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(2, 1, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(2, 2, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(2, 3, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(3, 0, 'tinytable_css_id9wj5s3q8mpb9mqxforem') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(3, 1, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(3, 2, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(3, 3, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(4, 0, 'tinytable_css_id9wj5s3q8mpb9mqxforem') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(4, 1, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(4, 2, 'tinytable_css_idwad1yrff77um9aqmwle3') })
window.addEventListener('load', function () { styleCell_bj8ysfr4r1hnh4kzzhqc(4, 3, 'tinytable_css_idwad1yrff77um9aqmwle3') })
    </script><style>
    .table td.tinytable_css_idgt99x3opwli5oto18a5u, .table th.tinytable_css_idgt99x3opwli5oto18a5u {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idi9c0ap9eg7z59qjonff2, .table th.tinytable_css_idi9c0ap9eg7z59qjonff2 {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idwad1yrff77um9aqmwle3, .table th.tinytable_css_idwad1yrff77um9aqmwle3 {  text-align: center; }
    .table td.tinytable_css_id4d09bl0324jxmzj8q2uh, .table th.tinytable_css_id4d09bl0324jxmzj8q2uh {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idvk29k6isnstyxkpw5mhk, .table th.tinytable_css_idvk29k6isnstyxkpw5mhk {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id9wj5s3q8mpb9mqxforem, .table th.tinytable_css_id9wj5s3q8mpb9mqxforem {  text-align: left; }
    </style>
<div class="container">
      <table class="table table-borderless" id="tinytable_bj8ysfr4r1hnh4kzzhqc" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Model1</th>
</tr>
<tr>
<th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">S.E.</th>
                <th scope="col">p</th>
              </tr>
</thead>
<tbody>
<tr>
<td>education</td>
                  <td>4.187 [3.4153, 4.9580]  </td>
                  <td>0.389</td>
                  <td>0.000</td>
                </tr>
<tr>
<td>income   </td>
                  <td>0.001 [0.0008, 0.0019]  </td>
                  <td>0.000</td>
                  <td>0.000</td>
                </tr>
<tr>
<td>women    </td>
                  <td>-0.009 [-0.0692, 0.0514]</td>
                  <td>0.030</td>
                  <td>0.770</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p><code>gof_omit</code> allows you to omit or select the goodness-of-fit statistics and other model information available from those listed by <code><a href="https://modelsummary.com/man/get_gof.html">get_gof()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/get_gof.html">get_gof</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt;   aic bic r.squared adj.r.squared rmse nobs   F logLik</span></span>
<span><span class="co">#&gt; 1 716 729     0.798         0.792 7.69  102 129   -353</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="visualizing-coefficients" class="level3" data-number="6.3.2"><h3 data-number="6.3.2" class="anchored" data-anchor-id="visualizing-coefficients">
<span class="header-section-number">6.3.2</span> Visualizing coefficients</h3>
<p><code><a href="https://modelsummary.com/man/modelplot.html">modelplot()</a></code> is the companion function. It allows you to plot model estimates and confidence intervals. It makes it easy to subset, rename, reorder, and customize plots using same mechanics as in <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html">modelplot</a></span><span class="op">(</span><span class="va">mod1</span>, coef_omit<span class="op">=</span><span class="st">"Intercept"</span>, </span>
<span>          color<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">1</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Raw coefficients for mod1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-modelplot1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-modelplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-modelplot1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-modelplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.5: Plot of coefficients and their standard error bar for the simple main effects model
</figcaption></figure>
</div>
</div>
</div>
<p>But this plot is disappointing and misleading because it show the <strong>raw</strong> coefficients. From the plot, it looks like only <code>education</code> has a non-zero effect, but the effect of <code>income</code> is also highly significant. The problem is that the magnitude of the coefficient <span class="math inline">\(\hat{b}_{\text{education}}\)</span> is more than 40,000 times that of the other coefficients, because education is measured years, while income is measured in dollars. The 95% confidence interval for <span class="math inline">\(\hat{b}_{\text{income}} = [0.0008, 0.0019]\)</span>, but this is invisible in the plot.</p>
<p>Before figuring out how to fix this issue, I show the comparable displays from <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> and <code><a href="https://modelsummary.com/man/modelplot.html">modelplot()</a></code> for all three models. When you give <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> a list of models, it displays their coefficients side-by-side as shown in <a href="#tbl-modelsummary2" class="quarto-xref">Table&nbsp;<span>6.2</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Model1"</span> <span class="op">=</span> <span class="va">mod1</span>, <span class="st">"Model2"</span> <span class="op">=</span> <span class="va">mod2</span>, <span class="st">"Model3"</span> <span class="op">=</span> <span class="va">mod3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html">modelsummary</a></span><span class="op">(</span><span class="va">models</span>,</span>
<span>     coef_omit <span class="op">=</span> <span class="st">"Intercept"</span>,</span>
<span>     fmt <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     stars <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     shape <span class="op">=</span> <span class="va">term</span> <span class="op">~</span> <span class="va">statistic</span>,</span>
<span>     statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"std.error"</span>, <span class="st">"p.value"</span><span class="op">)</span>,</span>
<span>     gof_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rmse"</span>, <span class="st">"r.squared"</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-modelsummary2" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-modelsummary2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6.2: Table of coefficients for three models.
</figcaption><div aria-describedby="tbl-modelsummary2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_btyjpo7jrwkx4b2h07tj(i, j, css_id) {
        var table = document.getElementById("tinytable_btyjpo7jrwkx4b2h07tj");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_btyjpo7jrwkx4b2h07tj');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_btyjpo7jrwkx4b2h07tj(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_btyjpo7jrwkx4b2h07tj");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 0, 'tinytable_css_idricwb0iimqulcdj7d1dt') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 1, 'tinytable_css_id6fb5i17nkworow5izk00') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 2, 'tinytable_css_id6fb5i17nkworow5izk00') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 3, 'tinytable_css_id6fb5i17nkworow5izk00') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(0, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 0, 'tinytable_css_id91v2xrrt9oibhuh877y7') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 1, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 2, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 3, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 4, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 5, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 6, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 7, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 8, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(1, 9, 'tinytable_css_id0epqhktawt9i57fg7aeu') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 1, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 2, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 3, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(2, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 1, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 2, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 3, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(3, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 1, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 2, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 3, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(4, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 1, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 2, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 3, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(5, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 1, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 2, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 3, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(6, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 1, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 2, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 3, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(7, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 0, 'tinytable_css_idm4kgy9rxl4nbepwrmdbh') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 1, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 2, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 3, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 4, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 5, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 6, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 7, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 8, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(8, 9, 'tinytable_css_idnbrz1b0bu09u2g3oa9f6') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 1, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 2, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 3, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(9, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 1, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 2, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 3, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 4, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 5, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 6, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 7, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 8, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(10, 9, 'tinytable_css_idimo2rfkquw8qy4ra7k34') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 0, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 1, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 2, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 3, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 4, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 5, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 6, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 7, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 8, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
window.addEventListener('load', function () { styleCell_btyjpo7jrwkx4b2h07tj(11, 9, 'tinytable_css_id99xaj1uo9vzemnoaix4i') })
    </script><style>
    .table td.tinytable_css_idricwb0iimqulcdj7d1dt, .table th.tinytable_css_idricwb0iimqulcdj7d1dt {  text-align: center;  text-align: left; }
    .table td.tinytable_css_id6fb5i17nkworow5izk00, .table th.tinytable_css_id6fb5i17nkworow5izk00 {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idimo2rfkquw8qy4ra7k34, .table th.tinytable_css_idimo2rfkquw8qy4ra7k34 {  text-align: center; }
    .table td.tinytable_css_id91v2xrrt9oibhuh877y7, .table th.tinytable_css_id91v2xrrt9oibhuh877y7 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id0epqhktawt9i57fg7aeu, .table th.tinytable_css_id0epqhktawt9i57fg7aeu {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id99xaj1uo9vzemnoaix4i, .table th.tinytable_css_id99xaj1uo9vzemnoaix4i {  text-align: left; }
    .table td.tinytable_css_idm4kgy9rxl4nbepwrmdbh, .table th.tinytable_css_idm4kgy9rxl4nbepwrmdbh {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idnbrz1b0bu09u2g3oa9f6, .table th.tinytable_css_idnbrz1b0bu09u2g3oa9f6 {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
<div class="container">
      <table class="table table-borderless" id="tinytable_btyjpo7jrwkx4b2h07tj" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Model1</th>
<th scope="col" align="center" colspan="3">Model2</th>
<th scope="col" align="center" colspan="3">Model3</th>
</tr>
<tr>
<th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">S.E.</th>
                <th scope="col">p</th>
                <th scope="col">Est.</th>
                <th scope="col">S.E.</th>
                <th scope="col">p</th>
                <th scope="col">Est.</th>
                <th scope="col">S.E.</th>
                <th scope="col">p</th>
              </tr>
</thead>
<tfoot><tr><td colspan="10">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
<tbody>
<tr>
<td>education        </td>
                  <td>4.19***</td>
                  <td>0.39</td>
                  <td>&lt;0.01</td>
                  <td>3.66***</td>
                  <td>0.65</td>
                  <td>&lt;0.01</td>
                  <td>2.80*** </td>
                  <td>0.59</td>
                  <td>&lt;0.01</td>
                </tr>
<tr>
<td>income           </td>
                  <td>0.00***</td>
                  <td>0.00</td>
                  <td>&lt;0.01</td>
                  <td>0.00***</td>
                  <td>0.00</td>
                  <td>&lt;0.01</td>
                  <td>0.00*** </td>
                  <td>0.00</td>
                  <td>&lt;0.01</td>
                </tr>
<tr>
<td>women            </td>
                  <td>-0.01  </td>
                  <td>0.03</td>
                  <td>0.77 </td>
                  <td>0.01   </td>
                  <td>0.03</td>
                  <td>0.83 </td>
                  <td>0.08*   </td>
                  <td>0.03</td>
                  <td>0.02 </td>
                </tr>
<tr>
<td>typewc           </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>-2.92  </td>
                  <td>2.67</td>
                  <td>0.28 </td>
                  <td>3.43    </td>
                  <td>5.37</td>
                  <td>0.52 </td>
                </tr>
<tr>
<td>typeprof         </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>5.91   </td>
                  <td>3.94</td>
                  <td>0.14 </td>
                  <td>27.55***</td>
                  <td>5.41</td>
                  <td>&lt;0.01</td>
                </tr>
<tr>
<td>income × typewc  </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>0.00    </td>
                  <td>0.00</td>
                  <td>0.21 </td>
                </tr>
<tr>
<td>income × typeprof</td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>0.00*** </td>
                  <td>0.00</td>
                  <td>&lt;0.01</td>
                </tr>
<tr>
<td>RMSE             </td>
                  <td>7.69   </td>
                  <td>    </td>
                  <td>     </td>
                  <td>6.91   </td>
                  <td>    </td>
                  <td>     </td>
                  <td>6.02    </td>
                  <td>    </td>
                  <td>     </td>
                </tr>
<tr>
<td>R2               </td>
                  <td>0.798  </td>
                  <td>    </td>
                  <td>     </td>
                  <td>0.835  </td>
                  <td>    </td>
                  <td>     </td>
                  <td>0.875   </td>
                  <td>    </td>
                  <td>     </td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>Note that a factor predictor (like <code>type</code> here) with <span class="math inline">\(d\)</span> levels is represented by <span class="math inline">\(d-1\)</span> coefficients in main effects and in interactions with quantitative variables. These levels are coded with <em>treatment contrasts</em> by default. Also by default, the first level is set as the reference level in alphabetical order. Here the reference level is blue collar (<code>bc</code>), so the coefficient <code>typeprof = 5.91</code> indicates that professional occupations on average are rated 5.91 greater on the Prestige scale than blue collar workers.</p>
<p>Note also that unlike the table, the coefficients in <a href="#fig-modelplot1" class="quarto-xref">Figure&nbsp;<span>6.5</span></a> are ordered from bottom to top, because the Y axis starts at the lower left corner. In <a href="#fig-modelplot2" class="quarto-xref">Figure&nbsp;<span>6.6</span></a> I use <code><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete()</a></code> to reverse the order. It is also useful to add a vertical reference line at <span class="math inline">\(\beta = 0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html">modelplot</a></span><span class="op">(</span><span class="va">models</span>, </span>
<span>          coef_omit<span class="op">=</span><span class="st">"Intercept"</span>, </span>
<span>          size<span class="op">=</span><span class="fl">1.3</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Raw coefficients"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">rev</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-modelplot2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-modelplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-modelplot2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-modelplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.6: Plot of raw coefficients and their confidence intervals for all three models
</figcaption></figure>
</div>
</div>
</div>
</section><section id="more-useful-coefficient-plots" class="level3" data-number="6.3.3"><h3 data-number="6.3.3" class="anchored" data-anchor-id="more-useful-coefficient-plots">
<span class="header-section-number">6.3.3</span> More useful coefficient plots</h3>
<p>The problem with plots of raw coefficients shown in <a href="#fig-modelplot1" class="quarto-xref">Figure&nbsp;<span>6.5</span></a> and <a href="#fig-modelplot2" class="quarto-xref">Figure&nbsp;<span>6.6</span></a> is that the coefficients for different predictors are not directly comparable because they are measured in different units.</p>
<p>One alternative is to plot the <em>standardized coefficients</em>. Another way is to re-scale the predictors into more comparable and meaningful units. I illustrate these ideas below.</p>
<section id="standardized-coefficients" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="standardized-coefficients">Standardized coefficients</h4>
<p>The simplest way to do this is to transform all variables to standardized (<span class="math inline">\(z\)</span>) scores. The coefficients are then interpreted as the standardized change in prestige for a one standard deviation change in the predictors. The syntax below uses <code>scale</code> to transform all the numeric variables. Then, we re-fit the models using the standardized data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Prestige_std</span> <span class="op">&lt;-</span> <span class="va">Prestige</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">scale</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod1_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span>, </span>
<span>               data<span class="op">=</span><span class="va">Prestige_std</span><span class="op">)</span></span>
<span><span class="va">mod2_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">type</span>, </span>
<span>               data<span class="op">=</span><span class="va">Prestige_std</span><span class="op">)</span></span>
<span><span class="va">mod3_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">income</span> <span class="op">*</span> <span class="va">type</span>, </span>
<span>               data<span class="op">=</span><span class="va">Prestige_std</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plot in <a href="#fig-modelplot3" class="quarto-xref">Figure&nbsp;<span>6.7</span></a> now shows the significant effect of income in all three models. As well, it offers a more sensitive comparison of the coefficients of other terms across models; for example <code>women</code> is not significant in models 1 and 2, but becomes significant in Model 3 when the interaction of <code>income * type</code> is included.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Model1"</span> <span class="op">=</span> <span class="va">mod1_std</span>, <span class="st">"Model2"</span> <span class="op">=</span> <span class="va">mod2_std</span>, <span class="st">"Model3"</span> <span class="op">=</span> <span class="va">mod3_std</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html">modelplot</a></span><span class="op">(</span><span class="va">models</span>, </span>
<span>          coef_omit<span class="op">=</span><span class="st">"Intercept"</span>, size<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Standardized coefficients"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">rev</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-modelplot3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-modelplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-modelplot3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-modelplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.7: Plot of standardized coefficients and their confidence intervals for all three models
</figcaption></figure>
</div>
</div>
</div>
<p>It turns out there is an easier way to get plots of standardized coefficients. <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> extracts coefficients from model objects using the <code>parameters</code> package, and that package offers several options for standardization: See <a href="https://easystats.github.io/parameters/reference/model_parameters.default.html">model parameters documentation</a>. We can pass the <code>standardize="refit"</code> (or other) argument directly to <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> or <code><a href="https://modelsummary.com/man/modelplot.html">modelplot()</a></code>, and that argument will be forwarded to <code>parameters</code>. The plot produced by the code below is identical to <a href="#fig-modelplot3" class="quarto-xref">Figure&nbsp;<span>6.7</span></a> and is not shown.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html">modelplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"mod1"</span> <span class="op">=</span> <span class="va">mod1</span>, <span class="st">"mod2"</span> <span class="op">=</span> <span class="va">mod2</span>, <span class="st">"mod3"</span> <span class="op">=</span> <span class="va">mod3</span><span class="op">)</span>,</span>
<span>          standardize <span class="op">=</span> <span class="st">"refit"</span>,</span>
<span>          coef_omit<span class="op">=</span><span class="st">"Intercept"</span>, size<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Standardized coefficients"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">rev</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <span style="color: brown;"><strong>ggstats</strong></span> package <span class="citation" data-cites="R-ggstats">(<a href="95-references.html#ref-R-ggstats" role="doc-biblioref">Larmarange, 2024</a>)</span> provides even nicer versions of coefficient plots that handle factors in a more reasonable way, as levels within the factor. <code><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_model()</a></code> plots a single model and <code><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_compare()</a></code> plots a list of models using sensible defaults. A small but nice feature is that it explicitly shows the 0 value for the reference level of a factor (<code>type = "bc"</code> here) and uses better labels for factors and their interactions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Base model"</span>      <span class="op">=</span> <span class="va">mod1_std</span>,</span>
<span>  <span class="st">"Add type"</span>        <span class="op">=</span> <span class="va">mod2_std</span>,</span>
<span>  <span class="st">"Add interaction"</span> <span class="op">=</span> <span class="va">mod3_std</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_compare</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Standarized Coefficient"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ggcoef-compare" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ggcoef-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-ggcoef-compare-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ggcoef-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.8: Model comparison plot from <code><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_compare()</a></code>
</figcaption></figure>
</div>
</div>
</div>
</section><section id="more-meaningful-units" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="more-meaningful-units">More meaningful units</h4>
<p>Standardizing the variables makes the coefficients directly comparable, but it may be harder to understand what they mean in terms of the variables. For example, the coefficient of <code>income</code> in <code>mod2_std</code> is 0.25. A literal interpretation is that occupational prestige is expected to increase 0.25 standard deviations for each standard deviation increase in income, but it may be difficult to appreciate what this means.</p>
<p>A better substantive comparison of the coefficients could use understandable scales for the predictors, e.g., months of education, $100,000 of income or 10% of women’s participation. Note that the effect of this is just to multiply the coefficients and their standard errors by a factor. The statistical conclusions of significance are unchanged.</p>
<p>For simplicity, I do this just for Model 1.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Prestige_scaled</span> <span class="op">&lt;-</span> <span class="va">Prestige</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="va">education</span>,</span>
<span>         income <span class="op">=</span> <span class="va">income</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span>         women <span class="op">=</span> <span class="va">women</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod1_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>                  data<span class="op">=</span><span class="va">Prestige_scaled</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we plot this with <code><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_model()</a></code>, there are many options to control how variables are labeled and other details.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_model</a></span><span class="op">(</span><span class="va">mod1_scaled</span>,</span>
<span>  signif_stars <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  variable_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>education <span class="op">=</span> <span class="st">"education\n(months)"</span>,</span>
<span>                      income <span class="op">=</span> <span class="st">"income\n(/$100K)"</span>,</span>
<span>                      women <span class="op">=</span> <span class="st">"women\n(/10%)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Coefficients for prestige with scaled predictors"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ggcoef-compare2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ggcoef-compare2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-ggcoef-compare2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ggcoef-compare2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.9: Plot of coefficients for prestige with scaled predictors for Model 1.
</figcaption></figure>
</div>
</div>
</div>
<p>So, on average, each additional month of education increases the prestige rating by 0.34 units, while an additional $100,000 of income increases it by 0.13 units. While these are significant effects, they are not large in relation to the scale of <code>prestige</code> which ranges 14.8—87.2.</p>
<!-- ## Spread-level plot -->
</section></section></section><section id="sec-avplots" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="sec-avplots">
<span class="header-section-number">6.4</span> Added-variable and related plots</h2>
<p>In multiple regression problems, it is most often useful to construct a scatterplot matrix and examine the plot of the response vs.&nbsp;each of the predictors as well as those of the predictors against each other. However, the simple, <em>marginal</em> scatterplots of a response <span class="math inline">\(y\)</span> against <em>each</em> of several predictors <span class="math inline">\(x_1, x_2, \dots\)</span> can be misleading because each one ignores the other predictors.</p>
<p>To see this consider a toy dataset, <code>coffee</code>, giving measures of coffee consumption, occupational stress and an index of heart problems in a sample of <span class="math inline">\(n=20\)</span> graduate students and professors.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">coffee</span>, package<span class="op">=</span><span class="st">"matlib"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Heart</span> <span class="op">+</span> <span class="va">Coffee</span> <span class="op">+</span> <span class="va">Stress</span>, </span>
<span>  data<span class="op">=</span><span class="va">coffee</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels<span class="op">=</span><span class="fl">0.68</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>, cex.labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-coffee-spm" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-coffee-spm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-coffee-spm-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-spm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.10: Scatterplot matrix showing pairwise relations among <code>Heart</code> (<span class="math inline">\(y\)</span>), <code>Coffee</code> consumption (<span class="math inline">\(x_1\)</span>) and <code>Stress</code> (<span class="math inline">\(x_2\)</span>), with linear regression lines and 68% data ellipses for the bivariate relations
</figcaption></figure>
</div>
</div>
</div>
<p>The message from these marginal plots in <a href="#fig-coffee-spm" class="quarto-xref">Figure&nbsp;<span>6.10</span></a> seems to be that coffee is bad for your heart, stress is bad for your heart, and stress is also strongly related to coffee consumption. Yet, when we fit a model with both variables together, we get the following results:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit.both</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Heart</span> <span class="op">~</span> <span class="va">Coffee</span> <span class="op">+</span> <span class="va">Stress</span>, data<span class="op">=</span><span class="va">coffee</span><span class="op">)</span></span>
<span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">fit.both</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; t test of coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   -7.794      5.793   -1.35     0.20    </span></span>
<span><span class="co">#&gt; Coffee        -0.409      0.292   -1.40     0.18    </span></span>
<span><span class="co">#&gt; Stress         1.199      0.224    5.34  5.4e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The coefficients suggest that stress is indeed bad for your heart, but the negative (though non-significant) coefficient for coffee suggests that coffee is good for you.How can this be? Does that mean I should drink more coffee, while avoiding stress?</p>
<p>The reason for this apparent paradox is that the general linear model fit by <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> estimates all effects together and so the coefficients pertain to the <em>partial</em> effect of a given predictor, <em>adjusting</em> for the effects of all others. That is, the coefficient for coffee (<span class="math inline">\(\beta_1 = -0.41\)</span>) estimates the effect of coffee for people with <em>same</em> level of stress. In the marginal scatterplot, the positive slope for coffee (1.10) ignores the correlation of coffee and stress.</p>
<p>A solution to this problem is the <em>added-variable</em> plot (“AV plot”, also called <em>partial regression</em> plot, MostellerTukey-1977). This is a multivariate analog of a a simple marginal scatterplot, designed to visualize directly the partial relation between <span class="math inline">\(y\)</span> and the predictors <span class="math inline">\(x_1, x_2, \dots\)</span> in a multiple regression model. You can think of this as a magic window that hides the relations of all other variables with each of the <span class="math inline">\(y\)</span> and <span class="math inline">\(x_i\)</span> shown in a given added-variable plot, giving an unobstructed view of the net relation between <span class="math inline">\(y\)</span> and <span class="math inline">\(x_i\)</span> with the effect of all other variables removed. In effect, it reduces the problem of viewing the complete model in <span class="math inline">\(p\)</span>-dimensional space to a sequence of <span class="math inline">\(p\)</span> 2D plots, each of which tells the story of one predictor, unentangled with the others.</p>
<p>The construction of an AV plot is conceptually very simple. For variable <span class="math inline">\(x_i\)</span>, imagine that we fit two supplementary regressions:</p>
<ul>
<li><p>Regress <span class="math inline">\(\mathbf{y}\)</span> on <span class="math inline">\(\mathbf{X_{(-i)}}\)</span>, the model matrix of all of the regressors except <span class="math inline">\(x_i\)</span>. By definition, the residuals from this regression, <span class="math inline">\(\mathbf{y}^\star \equiv \mathbf{y} \,\vert\, \text{others} = \mathbf{y} - \widehat{\mathbf{y}} \,\vert\, \mathbf{X_{(-i)}}\)</span>, <!-- $r_y(x_i) = y - \widehat{y}_{\mathbf{X_{(-i)}}} \equiv y \,\vert\, \text{others}$, --> are the part of <span class="math inline">\(\mathbf{y}\)</span> that cannot be explained by all the other regression terms. These residuals are necessarily uncorrelated with the other predictors.</p></li>
<li><p>Regress <span class="math inline">\(x_i\)</span> on the other predictors, <span class="math inline">\(\mathbf{X_{(-i)}}\)</span> and again obtain the residuals. These residuals, <span class="math inline">\(\mathbf{x}_i^\star \equiv \mathbf{x}_i \,\vert\, \text{others} = \mathbf{x}_i - \widehat{\mathbf{x}}_i \,\vert\, \mathbf{X_{(-i)}}\)</span> give the part of <span class="math inline">\(x_i\)</span> that cannot be explained by the others, and so are uncorrelated with them.</p></li>
</ul>
<p>The AV plot is then just a simple scatterplot of these residuals, <span class="math inline">\(\mathbf{y}^\star\)</span> on the vertical axis, and <span class="math inline">\(\mathbf{x}^\star\)</span> on the horizontal. In practice, it is unnecessary to run the auxilliary regressions this way <span class="citation" data-cites="VellemanWelsh:81">(<a href="95-references.html#ref-VellemanWelsh:81" role="doc-biblioref">Velleman &amp; Welsh, 1981</a>)</span>. Both can be calculated using <code><a href="https://rdrr.io/r/stats/lsfit.html">stats::lsfit()</a></code> roughly as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">AVcalc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">variable</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.extract.html">model.response</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="va">variable</span><span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="va">variable</span><span class="op">]</span>, <span class="va">response</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lsfit.html">lsfit</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">resids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">resids</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that <code>y</code> here contains both the current predictor, <span class="math inline">\(\mathbf{x}_i\)</span> and the response <span class="math inline">\(\mathbf{y}\)</span>, so the residuals <code>resids</code> have two columns, one for <span class="math inline">\(x_i \,\vert\, \text{others}\)</span> and one for <span class="math inline">\(y \,\vert\, \text{others}\)</span>.</p>
<p>Added-variable plots are produced using <code><a href="https://rdrr.io/pkg/car/man/avPlots.html">car::avPlot()</a></code> (for one predictor) or <code><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlots()</a></code> for any number of model terms. The <code>id</code> argument controls which points are identified in the plots; <code>n=2</code> labels the two points that are furthest from the mean on the horizontal axis <em>and</em> the two with the largest absolute residuals. For instance, in <a href="#fig-coffee-avPlots" class="quarto-xref">Figure&nbsp;<span>6.11</span></a>, observations 5 and 13 are flagged because their conditional <span class="math inline">\(\mathbf{x}_i^\star\)</span> values are extreme; observation 17 has a large absolute residual, <span class="math inline">\(\mathbf{y}^\star = \text{Heart} \,\vert\, \text{others}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlots</a></span><span class="op">(</span><span class="va">fit.both</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span>, fill<span class="op">=</span><span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Added-variable plots for Coffee data"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-coffee-avPlots" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-coffee-avPlots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-coffee-avPlots-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-avPlots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.11: Added-variable plots for Coffee and Stress in the multiple regression model
</figcaption></figure>
</div>
</div>
</div>
<p>The data ellipses for <span class="math inline">\(\mathbf{x}_i^\star\)</span> and <span class="math inline">\(\mathbf{y}^\star\)</span> summarize the conditional (or partial) relations of the response to each predictor controlling for all other predictors in each plot. The essential idea is that the data ellipse for <span class="math inline">\((\mathbf{x}_i^\star, \mathbf{y}^\star)\)</span> has the identical relation to the estimate <span class="math inline">\(\hat{b}_i\)</span> in a multiple regression as the data ellipse of <span class="math inline">\((\mathbf{x}, \mathbf{y})\)</span> has to the3 slope in a simple regression.</p>
<section id="properties-of-av-plots" class="level3" data-number="6.4.1"><h3 data-number="6.4.1" class="anchored" data-anchor-id="properties-of-av-plots">
<span class="header-section-number">6.4.1</span> Properties of AV plots</h3>
<p>AV plots are particularly interesting and useful for the following noteworthy properties:</p>
<ul>
<li><p>The slope of the simple regression in the AV plot for variable <span class="math inline">\(x_i\)</span> is identical to the slope <span class="math inline">\(b_i\)</span> for that variable in the full multiple regression model.</p></li>
<li><p>The residuals in this plot are the same as the residuals using all predictors. This means you can see the degree of fit for observations directly in relation to the various predictors, which is not the case for marginal scatterplots.</p></li>
<li><p>Consequentially, the standard deviation of the (vertical) residuals in the AV plot is the same as <span class="math inline">\(s = \sqrt(MSE)\)</span> in the full model and the standard error of a coefficient is <span class="math inline">\(\text{SE}(b_i) = s / \sqrt{\Sigma (\mathbf{x}_i^\star)^2}\)</span>. This is shown by the size of the shadow of the data ellipses on the vertical axis in <a href="#fig-coffee-avPlots" class="quarto-xref">Figure&nbsp;<span>6.11</span></a>.</p></li>
<li><p>The horizontal positions, <span class="math inline">\(\mathbf{x}_i^\star\)</span>, of points adjust for all other predictors, and so we can see points at the extreme left and right as unusual in relation to the others. If these points are also badly fitted (large residuals), we can see their influence on the fitted relation in the full model. AV plots thus provide visual displays of (partial) <em>leverage</em> and <em>influence</em> on each of the regression coefficients.</p></li>
<li><p>The correlation of <span class="math inline">\(\mathbf{x}_i^\star\)</span> and <span class="math inline">\(\mathbf{y}^\star\)</span> shown by the shape of the data ellipses is the <em>partial correlation</em> between <span class="math inline">\(\mathbf{x}_i\)</span> and <span class="math inline">\(\mathbf{y}_i\)</span> with other predictors partialled out.</p></li>
</ul></section><section id="marginal---conditional-plots" class="level3" data-number="6.4.2"><h3 data-number="6.4.2" class="anchored" data-anchor-id="marginal---conditional-plots">
<span class="header-section-number">6.4.2</span> Marginal - conditional plots</h3>
<p>The relation of the <em>conditional</em> data ellipses in AV plots to those in <em>marginal</em> plots of the same variables provides further insight into what it means to “control for” other variables. <a href="#fig-coffee-mcplot" class="quarto-xref">Figure&nbsp;<span>6.12</span></a> shows the same added-variable plots for Heart disease on Stress and Coffee as in <a href="#fig-coffee-avPlots" class="quarto-xref">Figure&nbsp;<span>6.11</span></a> (with a zoomed-out scaling), but here we also overlay the marginal data ellipses for <span class="math inline">\((\mathbf{x}_i, \mathbf{y})\)</span> (centered at the means), and marginal regression lines for Stress and Coffee separately. Drawing arrows connecting the original data points to their positions in the AV plot shows what happens when we condition on or partial out the other variable.</p>
<p>These <em>marginal - conditional plots</em> are produced by <code><a href="https://rdrr.io/pkg/car/man/mcPlots.html">car::mcPlot()</a></code> (for one regressor) and <code><a href="https://rdrr.io/pkg/car/man/mcPlots.html">car::mcPlots()</a></code> (for several). The plots for the marginal and conditional relations can be compared separately using the same scales for both, or overlaid as shown here. The points labeled here are only those with large absolute residuals <span class="math inline">\(\mathbf{y}^\star\)</span> in the vertical direction.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/mcPlots.html">mcPlots</a></span><span class="op">(</span><span class="va">fit.both</span>, </span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels<span class="op">=</span><span class="fl">0.68</span>, fill<span class="op">=</span><span class="cn">TRUE</span>, fill.alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>  col.marginal <span class="op">=</span> <span class="st">"red"</span>, col.conditional <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  col.arrows <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-coffee-mcplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-coffee-mcplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-coffee-mcplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-mcplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.12: Marginal <span class="math inline">\(+\)</span> conditional (added-variable) plots for Coffee and Stress in the multiple regression predicting Heart disease. Each panel shows the 68% conditional data ellipse for <span class="math inline">\(x_i^\star, y^\star\)</span> residuals (shaded, blue) as well as the marginal 68% data ellipse for the <span class="math inline">\((x_i, y)\)</span> variables, shifted to the origin. Arrows connect the mean-centered marginal points (red) to the residual points (blue).
</figcaption></figure>
</div>
</div>
</div>
<p>The most obvious feature of <a href="#fig-coffee-mcplot" class="quarto-xref">Figure&nbsp;<span>6.12</span></a> is that Coffee has a negative slope in the conditional AV plot but a positive slope in the marginal plot. This is an example of Simpson’s paradox in a regression context: marginal and conditional relations can have opposite signs. </p>
<p>Less obvious is the relation between the marginal and AVP ellipses. In 3D, the marginal data ellipse is the shadow of the ellipsoid for <span class="math inline">\((\mathbf{y}, \mathbf{x}_1, \mathbf{x}_2)\)</span> on one of the coordinate planes, while the AV plot is a slice through the ellipsoid where either <span class="math inline">\(\mathbf{x}_1\)</span> or <span class="math inline">\(\mathbf{x}_2\)</span> is held constant. Thus, the AVP ellipse must be contained in the marginal ellipse, as we can see in <a href="#fig-coffee-mcplot" class="quarto-xref">Figure&nbsp;<span>6.12</span></a>. If there are only two <span class="math inline">\(x\)</span>s, then the AVP ellipse must touch the marginal ellipse at two points.</p>
<p>Finally, <a href="#fig-coffee-mcplot" class="quarto-xref">Figure&nbsp;<span>6.12</span></a> also shows how conditioning on other predictors works for individual observations, where each point of <span class="math inline">\((\mathbf{x}_i^\star, \mathbf{y}^\star)\)</span> is the image of <span class="math inline">\((\mathbf{x}_i, \mathbf{y})\)</span> along the path of the marginal regression. The variability in the response and in the focal predictor are both reduced, leaving only the uncontaminated relation of <span class="math inline">\(\mathbf{y}\)</span> with <span class="math inline">\(\mathbf{x}_i\)</span>.</p>
<p>These plots are similar in spirit to the ARES plot (“Adding REgressors Smoothly”) proposed by <span class="citation" data-cites="CookWeisberg-1994">Cook &amp; Weisberg (<a href="95-references.html#ref-CookWeisberg-1994" role="doc-biblioref">1994</a>)</span>, but their idea was an interactive animation, displaying a smooth transition between the fit of a marginal model and the fit of a larger model. They used linear interpolation, <span class="math display">\[
(\mathbf{x}_i, \mathbf{y})_{\text{interp}} = (\mathbf{x}_i, \mathbf{y}) + \lambda [(\mathbf{x}_i^\star, \mathbf{y}^\star) - (\mathbf{x}_i, \mathbf{y})] \:\: ,
\]</span> controlled by a slider whose value, <span class="math inline">\(\lambda \in [0, 1]\)</span>, was the weight given to the smaller marginal model. See <a href="https://www.datavis.ca/gallery/animation/duncanAV/">this animation</a> for an example using the Duncan data.</p>
</section><section id="prestige-data" class="level3" data-number="6.4.3"><h3 data-number="6.4.3" class="anchored" data-anchor-id="prestige-data">
<span class="header-section-number">6.4.3</span> Prestige data</h3>
<p>For a substantive example, let’s return to the model for income, education and women in the <code>Prestige</code> data. The plot in <a href="#fig-prestige-avplot" class="quarto-xref">Figure&nbsp;<span>6.13</span></a> shows the strong positive relations of income and education to prestige in the full model, and the negligible relation of percent women. But, in the plot for income, two occupations (physicians and general managers) with high income strongly pull the regression line down from what can be seen in the orientation of the conditional data ellipse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prestige.mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlots</a></span><span class="op">(</span><span class="va">prestige.mod1</span>, </span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Added-variable plots for prestige"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-avplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-avplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-prestige-avplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-avplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.13: Added-variable plot for the quantitative predictors in the <code>Prestige</code> data.
</figcaption></figure>
</div>
</div>
</div>
<p>The influential points for physicians and general managers could just be unusual, or suggest that the relation of income to prestige is nonlinear. A rough test of this is to fit a smoothed curve through the points in the AV plot as shown in <a href="#fig-prestige-av-income" class="quarto-xref">Figure&nbsp;<span>6.14</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlot</a></span><span class="op">(</span><span class="va">prestige.mod1</span>, <span class="st">"income"</span>,</span>
<span>              ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>              pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>              cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">res</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">smooth</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-av-income" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-av-income-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-prestige-av-income-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-av-income-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.14: Added-variable plot for income, with a loess smooth.
</figcaption></figure>
</div>
</div>
</div>
<p>However, this use of AV plots to diagnose nonlinearity or suggest transformations can be misleading <span class="citation" data-cites="Cook-1996">(<a href="95-references.html#ref-Cook-1996" role="doc-biblioref">Cook, 1996</a>)</span>. Curvature in these plots is an indication of <em>some</em> model deficiency, but unless the predictors are uncorrelated, they cannot determine the form of a possible transformation of the predictors.</p>
</section><section id="component-residual-plots" class="level3" data-number="6.4.4"><h3 data-number="6.4.4" class="anchored" data-anchor-id="component-residual-plots">
<span class="header-section-number">6.4.4</span> Component + Residual plots</h3>
<p>A plot more suited to detecting the need to transform a predictor <span class="math inline">\(\mathbf{x}_i\)</span> to a form <span class="math inline">\(f(\mathbf{x}_i)\)</span> to make it’s relationship with the response <span class="math inline">\(\mathbf{y}\)</span> more nearly linear is the <em>component + residual plot</em> (“C+R plot”, also called <em>partial residual plot</em>, <span class="citation" data-cites="LarsenMcCleary:72">Larsen &amp; McCleary (<a href="95-references.html#ref-LarsenMcCleary:72" role="doc-biblioref">1972</a>)</span>; <span class="citation" data-cites="Cook:93">Cook (<a href="95-references.html#ref-Cook:93" role="doc-biblioref">1993</a>)</span>). This plot displays the partial residual <span class="math inline">\(\mathbf{e} + \hat{b}_i \mathbf{x}_i\)</span> on the vertical axis against <span class="math inline">\(\mathbf{x}_i\)</span> on the horizontal, where <span class="math inline">\(\mathbf{e}\)</span> are the residuals from the full model. A smoothed curve through the points will often suggest the form of the transformation <span class="math inline">\(f()\)</span>. The fact that the horizontal axis is <span class="math inline">\(\mathbf{x}_i\)</span> itself rather than <span class="math inline">\(\mathbf{x}^\star_i\)</span> makes it easier to see the functional form.</p>
<p>The C+R plot has the same desirable properties as the AV plot: The slope <span class="math inline">\(\hat{b}_i\)</span> and residuals <span class="math inline">\(\mathbf{e}\)</span> in this plot are the same as those in the full model.</p>
<p>C+R plots are produced by <code><a href="https://rdrr.io/pkg/car/man/crPlots.html">car::crPlots()</a></code> and <code><a href="https://rdrr.io/pkg/car/man/crPlots.html">car::crPlot()</a></code>. <a href="#fig-prestige-crplot" class="quarto-xref">Figure&nbsp;<span>6.15</span></a> shows this just for income in the model <code>prestige.mod1</code>. (These plots for education and women show no strong evidence of curvilinearity.) The dashed <span style="color: blue;">blue</span> line is the linear <em>partial fit</em>, <span class="math inline">\(\hat{b}_i \mathbf{x}_i\)</span>, whose slope <span class="math inline">\(\hat{b}_2 = 0.0013\)</span> is the same as that for income in <code>prestige.mod1</code>. The solid <span style="color: red;">red</span> curve is the loess smooth through the points. The same points are identified as noteworthy as in AV plot in <a href="#fig-prestige-av-income" class="quarto-xref">Figure&nbsp;<span>6.14</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/crPlots.html">crPlot</a></span><span class="op">(</span><span class="va">prestige.mod1</span>, <span class="st">"income"</span>,</span>
<span>       smooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       order <span class="op">=</span> <span class="fl">2</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>       col.lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>       id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>       cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-crplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-crplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-prestige-crplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-crplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.15: Component + residual plot for income in the model for the quantitative predictors of prestige. The dashed <span style="color: blue;">blue</span> line is the partial linear fit for income. The solid <span style="color: red;">red</span> curve is the loess smooth.
</figcaption></figure>
</div>
</div>
</div>
<p>The partial relation between prestige and income is clearly curved, so it would be appropriate to transform income or to include a polynomial (quadratic) term and refit the model. As suggested earlier (<a href="03-multivariate_plots.html#sec-prestige" class="quarto-xref"><span>Section 3.2.3</span></a>) it makes sense statistically and substantively to model the effect of income on a log scale, so then the slope for <code>log(income)</code> would measure the increment in prestige for a constant <em>percentage increase</em> in income.</p>
<p>The effect of percent women on prestige seen in <a href="#fig-prestige-avplot" class="quarto-xref">Figure&nbsp;<span>6.13</span></a> appears very small and essentially linear. However, if we wished to examine this more closely, we could use the C+R plot in <a href="#fig-prestige-crplot-women" class="quarto-xref">Figure&nbsp;<span>6.16</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/crPlots.html">crPlot</a></span><span class="op">(</span><span class="va">prestige.mod1</span>, <span class="st">"women"</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>       col.lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>       id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>       cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-crplot-women" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-crplot-women-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-prestige-crplot-women-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-crplot-women-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.16: Component + residual plot for women in the model for the quantitative predictors of prestige.
</figcaption></figure>
</div>
</div>
</div>
<p>This shows a slight degree of curvature, with modestly larger values in the extremes. If we wished to test this statistically, we could fit a model with a quadratic effect of women, and compare that to the linear-only effect using <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prestige.mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">women</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">prestige.mod1</span>, <span class="va">prestige.mod2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: prestige ~ education + income + women</span></span>
<span><span class="co">#&gt; Model 2: prestige ~ education + income + poly(women, 2)</span></span>
<span><span class="co">#&gt;   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; 1     98 6034                         </span></span>
<span><span class="co">#&gt; 2     97 5907  1       127 2.08   0.15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This model ignores the <code>type</code> of occupation (“bc”, “wc”, “prof”) as well as any possible interactions of type with other predictors. We examine this next, using effect displays.</p>
</section></section><section id="effect-displays" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="effect-displays">
<span class="header-section-number">6.5</span> Effect displays</h2>
<p>For two predictors it is possible, even if awkward, to display the fitted response surface in a 3D plot or faceted 2D views in what I call a <em>full model plot</em>. For more than two predictors such displays become cumbersome if not impractical, particularly when there are interactions in the model, when some effects are curvilinear, or when the main substantive interest is focused understanding on one or more main effects or interaction terms in the presence of others. The method of <em>effect displays</em>, largely introduced by John Fox <span class="citation" data-cites="Fox:87 Fox:03:effects FoxWeisberg2018">(<a href="95-references.html#ref-Fox:87" role="doc-biblioref">Fox, 1987</a>, <a href="95-references.html#ref-Fox:03:effects" role="doc-biblioref">2003</a>; <a href="95-references.html#ref-FoxWeisberg2018" role="doc-biblioref">Fox &amp; Weisberg, 2018b</a>)</span> is a generally useful solution to this problem. <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> These plots are nearly always easier to understand than tables of coefficients.</p>
<p>The idea of effect displays is quite simple, but very general and handles models of arbitrary complexity. Imagine that in a model we have a particular subset of predictors (<em>focal predictors</em>) whose effects on the response variable we wish to visualize. The essence of an effect display is that we calculate the predicted values (and standard errors) of the response for the model term(s) involving the focal predictors (and all low-order relatives, e.g, main effects that are marginal to an interaction) as those predictors are allowed to vary over a grid covering their range.</p>
<p>For a given plot, the other, non-focal variables are “controlled” by being fixed at typical values. For example, a quantitative predictor could be fixed at it’s mean, median or some representative value. A factor could be fixed at equal proportions of its levels or its proportions in the data. The result, when plotted, shows the predicted effects of the focal variables, either with multiple lines or in a faceted display, but with all the other variables controlled, adjusted for or averaged over. For interaction effects all low-order relatives are typically included in the fitted values for the term being graphed.</p>
<p>In practical terms, a scoring matrix <span class="math inline">\(\mathbf{X}^\bullet\)</span> is defined by the focal variables varied over their ranges and the other variables held fixed. The fitted values for a model term are then calculated as <span class="math inline">\(\widehat{\mathbf{y}}^\bullet = \mathbf{X}^\bullet \; \widehat{\mathbf{b}}\)</span> using the equivalent of:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">X</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which also calculates the standard errors as the square roots of <span class="math inline">\(\mathrm{diag}\, (\mathbf{X}^\bullet \, \widehat{\mathbf{\mathsf{Var}}} (\mathbf{b}) \, \mathbf{X}^{\bullet\mathsf{T}} )\)</span> where <span class="math inline">\(\widehat{\mathbf{\mathsf{Var}}} (\mathbf{b})\)</span> is the estimated covariance matrix of the coefficients. Consequently, predictor effect values can be obtained for <em>any</em> modelling function that has <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> and <code><a href="https://rdrr.io/r/stats/vcov.html">vcov()</a></code> methods. To date, effect displays are available for over 100 different model types in various packages.</p>
<p>To illustrate the mechanics for the effect of education in the <code>prestige.mod1</code> model, construct a data frame varying education, but fixing income and women at their means:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>      education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">16</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">$</span><span class="va">income</span><span class="op">)</span>,</span>
<span>      women <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">$</span><span class="va">women</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   education income women</span></span>
<span><span class="co">#&gt; 1         8   6798    29</span></span>
<span><span class="co">#&gt; 2        10   6798    29</span></span>
<span><span class="co">#&gt; 3        12   6798    29</span></span>
<span><span class="co">#&gt; 4        14   6798    29</span></span>
<span><span class="co">#&gt; 5        16   6798    29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> then gives the fitted values for a simple effect plot of prestige against education. <code><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm()</a></code> returns list, so it is necessary to massage this to a data frame for graphing.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">prestige.mod1</span>, newdata<span class="op">=</span><span class="va">X</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">X</span>, fit <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">fit</span>, se <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   education income women  fit    se</span></span>
<span><span class="co">#&gt; 1         8   6798    29 35.4 1.318</span></span>
<span><span class="co">#&gt; 2        10   6798    29 43.7 0.828</span></span>
<span><span class="co">#&gt; 3        12   6798    29 52.1 0.919</span></span>
<span><span class="co">#&gt; 4        14   6798    29 60.5 1.487</span></span>
<span><span class="co">#&gt; 5        16   6798    29 68.9 2.188</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As <span class="citation" data-cites="FoxWeisberg2018">Fox &amp; Weisberg (<a href="95-references.html#ref-FoxWeisberg2018" role="doc-biblioref">2018b</a>)</span> note, effect displays can be combined with partial residuals to visualize <em>both</em> fit and potential lack of fit simultaneously, by plotting residuals from a model around 2D slices of the fitted response surface. This adds the benefits of C+R plots, in that we can see the impact of unmodeled curvilinearity and interactions in addition to those of predictor effect displays.</p>
<p>There are several implementations of effect displays in R, whose details, terminology and ease of use vary. Among these, <strong>ggeffects</strong> <span class="citation" data-cites="R-ggeffects">(<a href="95-references.html#ref-R-ggeffects" role="doc-biblioref">Lüdecke, 2024</a>)</span> calculates adjusted predicted values under several methods for conditioning. <strong>marginaleffects</strong> <span class="citation" data-cites="R-marginaleffects">(<a href="95-references.html#ref-R-marginaleffects" role="doc-biblioref">Arel-Bundock et al., Forthcoming</a>)</span> is similar and also provides estimation of marginal slopes, contrasts, odds ratios, etc. Both have <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> methods based on <code>ggplot2</code>. My favorite is the <strong>effects</strong> <span class="citation" data-cites="R-effects">(<a href="95-references.html#ref-R-effects" role="doc-biblioref">Fox et al., 2022</a>)</span> package, which alone provides partial residuals, and is somewhat easier to use, though it uses <strong>lattice</strong> graphics. See the vignette <a href="https://cran.r-project.org/web/packages/effects/vignettes/predictor-effects-gallery.pdf">Predictor Effects Graphics Gallery</a> for details of the computations for effect displays.</p>
<p>The main functions for computing fitted effects are <code><a href="https://rdrr.io/pkg/effects/man/predictorEffects.html">predictorEffect()</a></code> (for one predictor) and <code><a href="https://rdrr.io/pkg/effects/man/predictorEffects.html">predictorEffects()</a></code> (for one or more). For a model <code>mod</code> with formula <code>y ~ x1 + x2 + x3 + x1:x2</code>, the call to <code>predictorEffects(mod, ~ x1)</code> recognizes that an interaction is present and calculates the fitted values for combinations of <code>x1</code> and <code>x2</code>, holding <code>x3</code> fixed at its average value. This returns an object of class <code>"eff"</code> which can be graphed using the <code>plot.eff()</code> method.</p>
<p>The effect displays for several predictors can be plotted together, as with <code>avplots()</code> (<a href="#fig-prestige-avplot" class="quarto-xref">Figure&nbsp;<span>6.13</span></a>) by including them in the plot formula, e.g., <code>predictorEffects(mod, ~ x1 + x3)</code>. Another function, <code><a href="https://rdrr.io/pkg/effects/man/effect.html">allEffects()</a></code> calculates the effects for each high-order term in the model, so <code>allEffects(mod) |&gt; plot()</code> is handy for getting a visual overview of a fitted model.</p>
<section id="prestige-data-1" class="level3" data-number="6.5.1"><h3 data-number="6.5.1" class="anchored" data-anchor-id="prestige-data-1">
<span class="header-section-number">6.5.1</span> Prestige data</h3>
<p>To illustrate effect plots, I consider a more complex model, allowing a quadratic effect of women, representing income on a <span class="math inline">\(\log_{10}\)</span> scale, and allowing this to interact with type of occupation. <code><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova()</a></code> provides the Type II tests of each of the model terms.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prestige.mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">women</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">income</span><span class="op">)</span><span class="op">*</span><span class="va">type</span>, data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test model terms</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">prestige.mod3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Anova Table (Type II tests)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: prestige</span></span>
<span><span class="co">#&gt;                    Sum Sq Df F value  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; education             994  1   25.87 2.0e-06 ***</span></span>
<span><span class="co">#&gt; poly(women, 2)        414  2    5.38 0.00620 ** </span></span>
<span><span class="co">#&gt; log10(income)        1523  1   39.63 1.1e-08 ***</span></span>
<span><span class="co">#&gt; type                  589  2    7.66 0.00085 ***</span></span>
<span><span class="co">#&gt; log10(income):type    221  2    2.88 0.06133 .  </span></span>
<span><span class="co">#&gt; Residuals            3420 89                    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The fitted coefficients, standard errors and <span class="math inline">\(t\)</span>-tests from <code>coeftest()</code> are shown below. The coefficient for education means that an increase of one year of education, holding other predictors fixed, gives an expected increase of 2.96 in prestige. The other coefficients are more difficult to understand. For example, the effect of women is represented by two coefficients for the linear and quadratic components of <code>poly(women, 2)</code>. The interpretation of coefficients of terms involving <code>type</code> depend on the contrasts used. Here, with the default treatment contrasts, they represent comparisons with <code>type = "bc"</code> as the reference level. It is not obvious how to understand the interaction effects like <code>log10(income):typeprof</code>.</p>
<!-- Note that in this model, the linear effect of `women` is highly significant -->
<!-- and the quadratic effect is nearly so. -->
<!-- The coefficient for `log10(income) = 40.33` means that multiplying income by -->
<!-- 10 gives an expected increase of over 40 in the prestige of an occupation. -->
<!-- With `type = "bc"` as the reference level, the coefficient for -->
<!-- `typeprof` means that professional occupations are rated 74.3 higher -->
<!-- than blue collar ones; the interaction coefficient for -->
<!-- `log10(income):typeprof` pertains to the difference in slope -->
<!-- for professional vs. blue collar. -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">prestige.mod3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; t test of coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                        Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)            -137.500     23.522   -5.85  8.2e-08 ***</span></span>
<span><span class="co">#&gt; education                 2.959      0.582    5.09  2.0e-06 ***</span></span>
<span><span class="co">#&gt; poly(women, 2)1          28.339     10.190    2.78   0.0066 ** </span></span>
<span><span class="co">#&gt; poly(women, 2)2          12.566      7.095    1.77   0.0800 .  </span></span>
<span><span class="co">#&gt; log10(income)            40.326      6.714    6.01  4.1e-08 ***</span></span>
<span><span class="co">#&gt; typewc                    0.969     39.495    0.02   0.9805    </span></span>
<span><span class="co">#&gt; typeprof                 74.276     30.736    2.42   0.0177 *  </span></span>
<span><span class="co">#&gt; log10(income):typewc     -1.073     10.638   -0.10   0.9199    </span></span>
<span><span class="co">#&gt; log10(income):typeprof  -17.725      7.947   -2.23   0.0282 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is easiest to produce effect displays for all terms in the model using <code><a href="https://rdrr.io/pkg/effects/man/effect.html">allEffects()</a></code>, accepting all defaults. This gives (<a href="#fig-prestige-allEffects" class="quarto-xref">Figure&nbsp;<span>6.17</span></a>) effect plots for the main effects of education and income and the interaction of income with type, with the non-focal variables held fixed. Each plot shows the fitted regression relation and a default 95% pointwise confidence band using the standard errors. Rug plots at the bottom show the locations of observations for the horizontal focal variable, which is useful when the observations are not otherwise plotted.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/effects/man/effect.html">allEffects</a></span><span class="op">(</span><span class="va">prestige.mod3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-allEffects" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-allEffects-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-prestige-allEffects-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-allEffects-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.17: Predictor effect plot for all terms in the model with 95% confidence bands.
</figcaption></figure>
</div>
</div>
</div>
<p>The effect for women, holding education, income and type constant looks to be quite strong and curved upwards. But note that these plots use different vertical scales for prestige in each plot and the range in the plot for women is much smaller than in the others. The interaction is graphed showing separate curves for the three levels of type.</p>
<p>For a more detailed look, it is useful to make separate plots for the predictors in the model, which allows customizing options for calculation and display. Partial residuals for the observations are computed by using <code>residuals = TRUE</code> in the call to <code><a href="https://rdrr.io/pkg/effects/man/predictorEffects.html">predictorEffects()</a></code>. The slope of the fitted line (in <span style="color: blue;">blue</span>) is exactly coefficient for education in the full model. As with C+R plots, a smooth loess curve (in <span style="color: red;">red</span>) gives a visual assessment of linearity for a given predictor. A wide variety of graphing options are available in the call to <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>. <a href="#fig-prestige-effplot-educ" class="quarto-xref">Figure&nbsp;<span>6.18</span></a> shows the effect display for education with partial residuals and point identification of those points with the largest Mahalanobis distances from the centroid.</p>
<!-- #| fig-cap: Predictor effect plot for education displaying partial residuals. The blue line shows the slice of the fitted regression surface where other variables are held fixed. The red curve shows a loess smooth of the partial residuals. -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/trellis.par.get.html">trellis.par.set</a></span><span class="op">(</span>par.xlab.text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                         par.ylab.text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/effects/man/predictorEffects.html">predictorEffects</a></span><span class="op">(</span><span class="va">prestige.mod3</span>, <span class="op">~</span> <span class="va">education</span>,</span>
<span>                 residuals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>partial.residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>,</span>
<span>       id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">4</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-effplot-educ" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-effplot-educ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-prestige-effplot-educ-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-effplot-educ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.18: Predictor effect plot for education displaying partial residuals. The <span style="color: blue;">blue</span> line shows the slice of the fitted regression surface where other variables are held fixed. The <span style="color: red;">red</span> curve shows a loess smooth of the partial residuals.
</figcaption></figure>
</div>
</div>
</div>
<p>The effect plot for women in this model is shown in <a href="#fig-prestige-effplot-women" class="quarto-xref">Figure&nbsp;<span>6.19</span></a>. This uses the same vertical scale as in <a href="#fig-prestige-effplot-educ" class="quarto-xref">Figure&nbsp;<span>6.18</span></a>, showing a more modest effect of percent women.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/effects/man/predictorEffects.html">predictorEffects</a></span><span class="op">(</span><span class="va">prestige.mod3</span>, <span class="op">~</span><span class="va">women</span>,</span>
<span>                 residuals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>partial.residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, col<span class="op">=</span><span class="st">"blue"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>,</span>
<span>       id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">4</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-effplot-women" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-effplot-women-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-prestige-effplot-women-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-effplot-women-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.19: Predictor effect plot for women with partial residuals
</figcaption></figure>
</div>
</div>
</div>
<!--
for income:








::: {.cell layout-align="center"}

```{.r .cell-code}
predictorEffects(prestige.mod3, ~ income,
                 confidence.level = 0.68) |>
  plot(lines=list(multiline=TRUE, lwd=3),
       confint=list(style="bands"),
       key.args = list(x=.7, y=.35)) 
```

::: {.cell-output-display}
![Predictor effect plot for income ...](figs/ch06/fig-prestige-effplot-inc-1.png){#fig-prestige-effplot-inc fig-align='center' width=80%}
:::
:::







-->
<p>Because of the interaction with <code>type</code>, the fitted effects for <code>income</code> are calculated for the three types of occupation. It is easiest to compare these in the a single plot (using <code>multiline = TRUE</code>), rather than in separate panels as in <a href="#fig-prestige-allEffects" class="quarto-xref">Figure&nbsp;<span>6.17</span></a>. Income is represented as <code>log10(income)</code> in the model <code>prestige.mod3</code>, and it is also easier to understand the interaction by plotting income on a log scale, using the <code>axes</code> argument to specify a transformation of the <span class="math inline">\(x\)</span> axis. I use 68% confidence bands here to make the differences among type more apparent.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/effects/man/predictorEffects.html">predictorEffects</a></span><span class="op">(</span><span class="va">prestige.mod3</span>, <span class="op">~</span> <span class="va">income</span>,</span>
<span>                 confidence.level <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>lines<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>multiline<span class="op">=</span><span class="cn">TRUE</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>       confint<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>style<span class="op">=</span><span class="st">"bands"</span><span class="op">)</span>,</span>
<span>       axes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>          x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>income<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>transform<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trans<span class="op">=</span><span class="va">log</span>, inverse<span class="op">=</span><span class="va">exp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       key.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">.7</span>, y<span class="op">=</span><span class="fl">.35</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-effplot-inc-log" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prestige-effplot-inc-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-prestige-effplot-inc-log-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prestige-effplot-inc-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.20: Predictor effect plot for income, plotted on a log scale.
</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-prestige-effplot-inc-log" class="quarto-xref">Figure&nbsp;<span>6.20</span></a> provides a clear interpretation of the interaction, represented by the coefficients shown above for <code>log10(income):typewc</code> and <code>log10(income):typeprof</code> in the model. Averaging over three occupation types, prestige increases linearly with log income with a coefficient of 40.33. This means that increasing income by 10% (say) gives an increase of <span class="math inline">\(40.33 / 10 = 4.033\)</span> in prestige. The slope for professional workers is less steep: the coefficient for <code>log10(income):typeprof</code> is -17.725. For these workers compared with blue collar jobs, prestige increases 1.77 less with a 10% increase in income. The difference in slopes for blue collar and white collar jobs is negligible.</p>
<!-- ## Outliers, leverage influence -->
</section></section><section id="sec-leverage" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="sec-leverage">
<span class="header-section-number">6.6</span> Outliers, leverage and influence</h2>
<p>In small to moderate samples, “unusual” observations can have dramatic effects on a fitted regression model, as we saw in the analysis of Davis’s data on reported and measured weight (<a href="02-getting_started.html#sec-davis" class="quarto-xref"><span>Section 2.1.2</span></a>) where one erroneous observations hugely altered the fitted line. As well, it turns out that two observations in Duncan’s data are unusual enough that removing them alters his conclusion that income and education have nearly equal effects on occupational prestige.</p>
<p>An observation can be unusual in three archetypal ways, with different consequences:</p>
<ul>
<li><p>Unusual in the response <span class="math inline">\(y\)</span>, but typical in the predictor(s), <span class="math inline">\(\mathbf{x}\)</span> — a badly fitted case with a large absolute residual, but with <span class="math inline">\(x\)</span> not far from the mean, as in <a href="02-getting_started.html#fig-ch02-davis-reg2" class="quarto-xref">Figure&nbsp;<span>2.4</span></a>. This case does not do much harm to the fitted model.</p></li>
<li><p>Unusual in the predictor(s) <span class="math inline">\(\mathbf{x}\)</span>, but typical in <span class="math inline">\(y\)</span> — an otherwise well-fitted point. This case also does litle harm, and in fact can be considered to improve precision, a “good leverage” point.</p></li>
<li><p>Unusual in <strong>both</strong> <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(y\)</span> — This is the case, a “bad leverage” point, revealed in the analysis of Davis’s data, <a href="02-getting_started.html#fig-ch02-davis-reg1" class="quarto-xref">Figure&nbsp;<span>2.3</span></a>, where the one erroneous point for women was highly influential, pulling the regression line towards it and affecting the estimated coefficient as well as all the fitted values. In addition, subsets of observations can be <em>jointly</em> influential, in that their effects combine, or can mask each other’s influence.</p></li>
</ul>
<p>Influential cases are the ones that matter most. As suggested above, to be influential an observation must be unusual in <strong>both</strong> <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(y\)</span>, and affects the estimated coefficients, thereby also altering the predicted values for all observations. A heuristic formula capturing the relations among leverage, “outlyingness” on <span class="math inline">\(y\)</span> and influence is</p>
<p><span class="math display">\[
\text{Influence}_{\text{coefficients}} \;=\; X_\text{leverage} \;\times\; Y_\text{residual}
\]</span> As described below, leverage is proportional to the squared distance <span class="math inline">\((x_i - \bar{x})^2\)</span> of an observation <span class="math inline">\(x_i\)</span> from its mean in simple regression and to the squared Mahalanobis distance in the general case. The <span class="math inline">\(Y_\text{residual}\)</span> is best measured by a <em>studentized</em> residual, obtained by omitting each case <span class="math inline">\(i\)</span> in turn and calculating its residual from the coefficients obtained from the remaining cases.</p>
<section id="sec-lev-inf-quartet" class="level3" data-number="6.6.1"><h3 data-number="6.6.1" class="anchored" data-anchor-id="sec-lev-inf-quartet">
<span class="header-section-number">6.6.1</span> The leverage-influence quartet</h3>
<p>These ideas can be illustrated in the “leverage-influence quartet” by considering a standard simple linear regression for a sample and then adding one additional point reflecting the three situations described above. Below, I generate a sample of <span class="math inline">\(N = 15\)</span> points with <span class="math inline">\(x\)</span> uniformly distributed between (40, 60) and <span class="math inline">\(y \sim 10 + 0.75 x + \mathcal{N}(0, 1.25^2)\)</span>, duplicated four times.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">case_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OK"</span>, <span class="st">"Outlier"</span>, <span class="st">"Leverage"</span>, <span class="st">"Influence"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">levdemo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">case_labels</span>, </span>
<span>               each <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">40</span> <span class="op">+</span> <span class="fl">20</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">.75</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">1.25</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="st">" "</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">levdemo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)           x </span></span>
<span><span class="co">#&gt;      13.332       0.697</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The additional points, one for each situation are set to the values below.</p>
<ul>
<li>
<code>Outlier</code>: (52, 60) a low leverage point, but an outlier (<code>O</code>) with a large residual</li>
<li>
<code>Leverage</code>: (75, 65) a “good” high leverage point (<code>L</code>) that fits well with the regression line</li>
<li>
<code>Influence</code>: (70, 40) a “bad” high leverage point (<code>OL</code>) with a large residual.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  case <span class="op">=</span> <span class="va">case_labels</span>,</span>
<span>  x  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">52</span>, <span class="fl">75</span>, <span class="fl">70</span><span class="op">)</span>,</span>
<span>  y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">65</span>, <span class="fl">65</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"  "</span>, <span class="st">"O"</span>, <span class="st">"L"</span>, <span class="st">"OL"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Join these to the data</span></span>
<span><span class="va">both</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">levdemo</span>, <span class="va">extra</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">case</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plot these four situations with <code>ggplot2</code> in panels faceted by <code>case</code> as shown below. The standard version of this plot shows the regression line for the <span style="color: blue;">original data</span> and that for the <span style="color: red;">ammended data</span> with the additional point. Note that we use the <code>levdemo</code> dataset in <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> for the regression line with the original data, but specify <code>data = both</code> for that with the additional point.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">levdemo</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">both</span>, </span>
<span>              method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1.3</span>, linetype <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"longdash"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">both</span>, level <span class="op">=</span> <span class="fl">0.5</span>, color<span class="op">=</span><span class="st">"blue"</span>, type<span class="op">=</span><span class="st">"norm"</span>, linewidth <span class="op">=</span> <span class="fl">1.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">extra</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">extra</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">case</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-levdemo" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-levdemo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-levdemo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-levdemo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.21: Leverage influence quartet with data 50% ellipses. Case (1) original data; (2) adding one low-leverage outlier, “O”; (3) adding one “good” leverage point, “L”; (4) adding one “bad” leverage point, “OL”. The dashed <span style="color: blue;">blue</span> line is the fitted line for the original data, while the solid <span style="color: red;">red</span> line reflects the additional point. The data ellipses show the effect of the additional point on precision.
</figcaption></figure>
</div>
</div>
</div>
<p>The standard version of this graph shows only the fitted regression lines in each panel. As can be seen, the fitted line doesn’t change very much in panels (2) and (3); only the bad leverage point, “OL” in panel (4) is harmful. Adding data ellipses to each panel immediately makes it clear that there is another part to this story— the effect of the unusual point on <em>precision</em> (standard errors) of our estimates of the coefficients.</p>
<p>Now, we see <em>directly</em> that there is a big difference in impact between the low-leverage outlier [panel (2)] and the high-leverage, small-residual case [panel (3)], even though their effect on coefficient estimates is negligible. In panel (2), the single outlier inflates the estimate of residual variance (the size of the vertical slice of the data ellipse at <span class="math inline">\(\bar{x}\)</span>), while in panel (3) this is decreased.</p>
<p>To allow direct comparison and make the added value of the data ellipse more apparent, we overlay the data ellipses from <a href="#fig-levdemo" class="quarto-xref">Figure&nbsp;<span>6.21</span></a> in a single graph, shown in <a href="#fig-levdemo2" class="quarto-xref">Figure&nbsp;<span>6.22</span></a>. Here, we can also see why the high-leverage point “L” (added in panel (c) of <a href="#fig-levdemo" class="quarto-xref">Figure&nbsp;<span>6.21</span></a>) is called a “good leverage” point. By increasing the standard deviation of <span class="math inline">\(x\)</span>, it makes the data ellipse somewhat more elongated, giving increased precision of our estimates of <span class="math inline">\(\mathbf{\beta}\)</span>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb48" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">both</span>,</span>
<span>     <span class="op">{</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">case</span>, </span>
<span>          levels <span class="op">=</span> <span class="fl">0.68</span>,</span>
<span>          plot.points <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          center.pch <span class="op">=</span> <span class="st">"+"</span>,</span>
<span>          col <span class="op">=</span> <span class="va">colors</span>,</span>
<span>          fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>     <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">case1</span> <span class="op">&lt;-</span> <span class="va">both</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">case</span> <span class="op">==</span> <span class="st">"1 OK"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">case1</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, cex<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">extra</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>       col <span class="op">=</span> <span class="va">colors</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">extra</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>     labels <span class="op">=</span> <span class="va">extra</span><span class="op">$</span><span class="va">id</span>,</span>
<span>     col <span class="op">=</span> <span class="va">colors</span>, pos <span class="op">=</span> <span class="fl">2</span>, offset <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-levdemo2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-levdemo2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-levdemo2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-levdemo2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.22: Data ellipses in the Leverage-influence quartet. This graph overlays the data ellipses and additional points from the four panels of <a href="#fig-levdemo2" class="quarto-xref">Figure&nbsp;<span>6.22</span></a>. It can be seen that only the OL point affects the slope, while the O and L points affect precision of the estimates in opposite directions.
</figcaption></figure>
</div>
</div>
</div>
<section id="measuring-leverage" class="level4" data-number="6.6.1.1"><h4 data-number="6.6.1.1" class="anchored" data-anchor-id="measuring-leverage">
<span class="header-section-number">6.6.1.1</span> Measuring leverage</h4>
<p>Leverage is thus an index of the <em>potential</em> impact of an observation on the model due to its’ atypical value in the X space of the predictor(s). It is commonly measured by the “hat” value, <span class="math inline">\(h_i\)</span>, so called because it puts the hat <span class="math inline">\(\hat{(\bullet)}\)</span> on <span class="math inline">\(\mathbf{y}\)</span>, i.e., the vector of fitted values can be expressed as</p>
<p><span class="math display">\[\begin{aligned}
\hat{\mathbf{y}} &amp; =  \mathbf{H} \mathbf{y} \\
                 &amp; =  [\mathbf{X} (\mathbf{X}^\mathsf{T} \mathbf{X})^{-1} \mathbf{X}^\mathsf{T}] \; \mathbf{y} \; ,
\end{aligned}\]</span></p>
<p>where <span class="math inline">\(h_i \equiv h_{ii}\)</span> are the diagonal elements of the Hat matrix <span class="math inline">\(\mathbf{H}\)</span>. In simple regression, hat values are proportional to the squared distance of the observation <span class="math inline">\(x_i\)</span> from the mean, <span class="math inline">\(h_i \propto (x_i - \bar{x})^2\)</span>, <span class="math display">\[
h_i = \frac{1}{n} + \frac{(x_i - \bar{x})^2}{\Sigma_i (x_i - \bar{x})^2} \; ,
\]</span> and range from <span class="math inline">\(1/n\)</span> to 1, with an average value <span class="math inline">\(\bar{h} = 2/n\)</span>. Consequently, observations with <span class="math inline">\(h_i\)</span> greater than <span class="math inline">\(2 \bar{h}\)</span> or <span class="math inline">\(3 \bar{h}\)</span> are commonly considered to be of high leverage.</p>
<p>With <span class="math inline">\(p \ge 2\)</span> predictors, it is demonstrated below that <span class="math inline">\(h_i \propto D^2 (\mathbf{x} - \bar{\mathbf{x}})\)</span>, the squared distance of <span class="math inline">\(\mathbf{x}\)</span> from the centroid <span class="math inline">\(\bar{\mathbf{x}}\)</span><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>The analogous formula is</p>
<p><span class="math display">\[
h_i = \frac{1}{n} + \frac{1}{n-1} D^2 (\mathbf{x} - \bar{\mathbf{x}}) \; ,
\]</span></p>
<p>where <span class="math inline">\(D^2 (\mathbf{x} - \bar{\mathbf{x}}) = (\mathbf{x} - \bar{\mathbf{x}})^\mathsf{T} \mathbf{S}_X^{-1} (\mathbf{x} - \bar{\mathbf{x}})\)</span>. From <a href="03-multivariate_plots.html#sec-data-ellipse" class="quarto-xref"><span>Section 3.2</span></a>, it follows that contours of constant leverage correspond to data ellipses or ellipsoids of the predictors in <span class="math inline">\(\mathbf{x}\)</span>, whose boundaries, assuming normality, correspond to quantiles of the <span class="math inline">\(\chi^2_p\)</span> distribution</p>
<p><strong>Example</strong>:</p>
<p>To illustrate, I generate <span class="math inline">\(N = 100\)</span> points from a bivariate normal distribution with means <span class="math inline">\(\mu = (30, 30)\)</span>, variances = 10, and a correlation <span class="math inline">\(\rho = 0.7\)</span> and add two noteworthy points that show an apparently paradoxical result.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">421</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,   <span class="fl">10</span><span class="op">*</span><span class="va">r</span>,</span>
<span>                <span class="fl">10</span><span class="op">*</span><span class="va">r</span>, <span class="fl">10</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">mu</span>, <span class="va">cov</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add 2 points</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">X</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">38</span><span class="op">)</span>,</span>
<span>                      x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Mahalanobis squared distances of these points can be calculated using <code><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">heplots::Mahalanobis()</a></code>, and their corresponding hatvalues found using <code><a href="https://rdrr.io/r/stats/influence.measures.html">hatvalues()</a></code> for any linear model using both <code>x1</code> and <code>x2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Dsq <span class="op">=</span> <span class="fu">heplots</span><span class="fu">::</span><span class="fu"><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">Mahalanobis</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">x2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hatvalues</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting <code>x1</code> and <code>x2</code> with data ellipses shows the relation of leverage to squared distance from the mean. The <span style="color: blue;">blue</span> point looks to be farther from the <span style="color: green;">mean</span>, but the <span style="color: red;">red</span> point is actually very much further by Mahalanobis squared distance, which takes the correlation into account; it thus has much greater leverage.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x1</span>, <span class="va">X</span><span class="op">$</span><span class="va">x2</span>, </span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.40</span>, <span class="fl">0.68</span>, <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>            xlab <span class="op">=</span> <span class="st">"X1"</span>, ylab <span class="op">=</span> <span class="st">"X2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">N</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">16</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span>      <span class="co"># last two rows</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hatvalues-demo1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-hatvalues-demo1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-hatvalues-demo1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hatvalues-demo1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.23: Data ellipses for a bivariate normal sample with correlation 0.7, and two additional noteworthy points. The <span style="color: blue;">blue</span> point looks to be farther from the mean, but the <span style="color: red;">red</span> point is actually more than 5 times further by Mahalanobis squared distance, and thus has much greater leverage.
</figcaption></figure>
</div>
</div>
</div>
<p>The fact that hatvalues are proportional to leverage can be seen by plotting one against the other. I highlight the two noteworthy points in their colors from <a href="#fig-hatvalues-demo1" class="quarto-xref">Figure&nbsp;<span>6.23</span></a> to illustrate how much greater leverage the <span style="color: red;">red</span> point has compared to the <span style="color: blue;">blue</span> point.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hat</span> <span class="op">~</span> <span class="va">Dsq</span>, data <span class="op">=</span> <span class="va">X</span>,</span>
<span>     cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="va">N</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Hatvalue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Mahalanobis Dsq"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hatvalues-demo2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-hatvalues-demo2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-hatvalues-demo2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hatvalues-demo2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.24: Hat values are proportional to squared Mahalanobis distances from the mean.
</figcaption></figure>
</div>
</div>
</div>
<p>Look back at these two points in <a href="#fig-hatvalues-demo1" class="quarto-xref">Figure&nbsp;<span>6.23</span></a>. Can you guess how much further the <span style="color: red;">red</span> point is from the mean than the <span style="color: blue;">blue</span> point? You might be surprised that its’ <span class="math inline">\(D^2\)</span> and leverage are about five times as great!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x1 x2   Dsq   y    hat</span></span>
<span><span class="co">#&gt; 1 28 42 25.65 179 0.2638</span></span>
<span><span class="co">#&gt; 2 38 35  4.95 175 0.0588</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="outliers-measuring-residuals" class="level4" data-number="6.6.1.2"><h4 data-number="6.6.1.2" class="anchored" data-anchor-id="outliers-measuring-residuals">
<span class="header-section-number">6.6.1.2</span> Outliers: Measuring residuals</h4>
<p>From the discussion in <a href="#sec-leverage" class="quarto-xref"><span>Section 6.6</span></a>, outliers for the response <span class="math inline">\(y\)</span> are those observations for which the residual <span class="math inline">\(e_i = y_i - \hat{y}_i\)</span> are unusually large in magnitude. However, as demonstrated in <a href="#fig-levdemo" class="quarto-xref">Figure&nbsp;<span>6.21</span></a>, a high-leverage point will pull the fitted line towards it, reducing its’ residual and thus making them look less unusual.</p>
<p>The standard approach <span class="citation" data-cites="CookWeisberg:82 HoaglinWelsch1978">(<a href="95-references.html#ref-CookWeisberg:82" role="doc-biblioref">Cook &amp; Weisberg, 1982</a>; <a href="95-references.html#ref-HoaglinWelsch1978" role="doc-biblioref">Hoaglin &amp; Welsch, 1978</a>)</span> is to consider a <em>deleted residual</em> <span class="math inline">\(e_{(-i)}\)</span>, conceptually as that obtained by re-fitting the model with observation <span class="math inline">\(i\)</span> omitted and obtaining the fitted value <span class="math inline">\(\hat{y}_{(-i)}\)</span> from the remaining <span class="math inline">\(n-1\)</span> observations, <span class="math display">\[
e_{(-i)} = y_i - \hat{y}_{(-i)} \; .
\]</span> The (externally) <em>studentized residual</em> is then obtained by dividing <span class="math inline">\(e_{(-i)}\)</span> by it’s estimated standard error, giving <span class="math display">\[
e^\star_{(-i)} = \frac{e_{(-i)}}{\text{sd}(e_{(-i)})} = \frac{e_i}{\sqrt{\text{MSE}_{(-i)}\; (1 - h_i)}} \; .
\]</span></p>
<p>This is just the ordinary residual <span class="math inline">\(e_i\)</span> divided by a factor that increases with the residual variance but decreases with leverage. It can be shown that these studentized residuals follow a <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(n - p -2\)</span> degrees of freedom, so a value <span class="math inline">\(|e^\star_{(-i)}| &gt; 2\)</span> can be considered large enough to pay attention to.<br>
In practice for classical linear models, it is unnecessary to actually re-fit the model <span class="math inline">\(n\)</span> times. <span class="citation" data-cites="VellemanWelsh:81">Velleman &amp; Welsh (<a href="95-references.html#ref-VellemanWelsh:81" role="doc-biblioref">1981</a>)</span> show that all these leave-one-out quantities can be calculated from the model fitted to the full data set and the hat (projection) matrix <span class="math inline">\(\mathbf{H} = (\mathbf{X}^\mathsf{T}\mathbf{X})^{-1} \mathbf{X}^\mathsf{T}\)</span> from which <span class="math inline">\(\widehat{\mathbf{b}} = \mathbf{H} \mathbf{y}\)</span>.</p>
</section><section id="measuring-influence" class="level4" data-number="6.6.1.3"><h4 data-number="6.6.1.3" class="anchored" data-anchor-id="measuring-influence">
<span class="header-section-number">6.6.1.3</span> Measuring influence</h4>
<p>As described at the start of this section, the actual influence of a given case depends multiplicatively on its’ leverage and residual. But how can we measure it?</p>
<p>The essential idea introduced above, is to delete the observations one at a time, each time refitting the regression model on the remaining <span class="math inline">\(n–1\)</span> observations. Then, for observation <span class="math inline">\(i\)</span> compare the results using all <span class="math inline">\(n\)</span> observations to those with the <span class="math inline">\(i^{th}\)</span> observation deleted to see how much influence the observation has on the analysis.</p>
<p>The simplest such measure, called DFFITS, compares the predicted value for case <span class="math inline">\(i\)</span> with what would be obtained when that observation is excluded.</p>
<p><span class="math display">\[\begin{aligned}
\text{DFFITS}_i &amp; = &amp; \frac{\hat{y}_i - \hat{y}_{(-i)}}{\sqrt{\text{MSE}_{(-i)}\; h_i}} \\
   &amp; = &amp; e^\star_{(-i)} \times \sqrt{\frac{h_i}{1-h_i}} \;\; .
\end{aligned}\]</span></p>
<p>The first equation gives the signed difference in fitted values in units of the standard deviation of that difference weighted by leverage; the second version <span class="citation" data-cites="Belsley-etal:80">(<a href="95-references.html#ref-Belsley-etal:80" role="doc-biblioref">Belsley et al., 1980</a>)</span> represents that as a product of residual and leverage. A rule of thumb is that an observation is deemed to be influential if <span class="math inline">\(| \text{DFFITS}_i | &gt; 2 \sqrt{(p+1) / n}\)</span>.</p>
<p>Influence can also be assessed in terms of the change in the estimated coefficients <span class="math inline">\(\mathbf{b} = \widehat{\mathbf{\beta}}\)</span> versus their values <span class="math inline">\(\mathbf{b}_{(-i)}\)</span> when case <span class="math inline">\(i\)</span> is removed. Cook’s distance, <span class="math inline">\(D_i\)</span>, summarizes the size of the difference as a weighted sum of squares of the differences <span class="math inline">\(\mathbf{d} =\mathbf{b} - \mathbf{b}_{(-i)}\)</span> <span class="citation" data-cites="Cook:77">(<a href="95-references.html#ref-Cook:77" role="doc-biblioref">Cook, 1977</a>)</span>.</p>
<p><span class="math display">\[
D_i = \mathbf{d}^\mathsf{T}\, (\mathbf{X}^\mathsf{T}\mathbf{X}) \,\mathbf{d} / (p+1) \hat{\sigma}^2
\]</span> This can be re-expressed in terms of the components of residual and leverage</p>
<p><span class="math display">\[
D_i = \frac{e^{\star 2}_{(-i)}}{p+1} \times \frac{h_i}{(1- h_i)}
\]</span></p>
<p>Cook’s distance is in the metric of an <span class="math inline">\(F\)</span> distribution with <span class="math inline">\(p\)</span> and <span class="math inline">\(n − p\)</span> degrees of freedom, so values <span class="math inline">\(D_i &gt; 4/n\)</span> are considered large.</p>
</section></section><section id="influence-plots" class="level3" data-number="6.6.2"><h3 data-number="6.6.2" class="anchored" data-anchor-id="influence-plots">
<span class="header-section-number">6.6.2</span> Influence plots</h3>
<p>The most common plot to detect influence is a bubble plot of the studentized residuals versus hat values, with the size (area) of the plotting symbol proportional to Cook’s <span class="math inline">\(D\)</span>. These plots are constructed using <code><a href="https://rdrr.io/pkg/car/man/influencePlot.html">car::influencePlot()</a></code> which also fills the bubble symbols with color whose opacity is proportional to Cook’s <span class="math inline">\(D\)</span>.</p>
<p>This is shown in <a href="#fig-levdemo-infl" class="quarto-xref">Figure&nbsp;<span>6.25</span></a> for the demonstration dataset constructed in <a href="#sec-lev-inf-quartet" class="quarto-xref"><span>Section 6.6.1</span></a>. In this plot, notable cutoffs for hatvalues at <span class="math inline">\(2 \bar{h}\)</span> and <span class="math inline">\(3 \bar{h}\)</span> are shown by dashed vertical lines and horizontal cutoffs for studentized residuals are shown at values of <span class="math inline">\(\pm 2\)</span>.</p>
<p>The demonstration data of <a href="#sec-lev-inf-quartet" class="quarto-xref"><span>Section 6.6.1</span></a> has four copies of the same <span class="math inline">\((x, y)\)</span> data, three of which have an unusual observation. The influence plot in <a href="#fig-levdemo-infl" class="quarto-xref">Figure&nbsp;<span>6.25</span></a> subsets the data to give the <span class="math inline">\(19 = 15 + 4\)</span> unique observations, including the three unusual cases. As can be seen, the high “Leverage” point has has less influence than the point labeled “Influence”, which has moderate leverage but a large absolute residual.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>See the code</summary><div class="sourceCode" id="cb54" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">once</span> <span class="op">&lt;-</span> <span class="va">both</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">62</span>, <span class="fl">63</span>, <span class="fl">64</span><span class="op">)</span>,<span class="op">]</span>      <span class="co"># unique observations</span></span>
<span><span class="va">once.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">once</span><span class="op">)</span></span>
<span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">once.mod</span>, </span>
<span>                     id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                     fill.alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                     cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co"># custom labels</span></span>
<span><span class="va">unusual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">once</span><span class="op">[</span><span class="fl">17</span><span class="op">:</span><span class="fl">19</span>,<span class="op">]</span>, <span class="va">inf</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 7</span></span>
<span><span class="co">#&gt;   case            x     y id    StudRes    Hat CookD</span></span>
<span><span class="co">#&gt; * &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2 Outlier      52    65 O        3.11 0.0591 0.201</span></span>
<span><span class="co">#&gt; 2 3 Leverage     75    65 L        1.52 0.422  0.784</span></span>
<span><span class="co">#&gt; 3 4 Influence    70    40 OL      -4.93 0.262  1.82</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">unusual</span>, <span class="op">{</span></span>
<span>  <span class="va">casetype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\d "</span>, <span class="st">""</span>, <span class="va">case</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">Hat</span>, <span class="va">StudRes</span>, label <span class="op">=</span> <span class="va">casetype</span>,</span>
<span>       pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-levdemo-infl" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-levdemo-infl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-levdemo-infl-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-levdemo-infl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.25: Influence plot for the demonstration data. The areas of the bubble symbols are proportional to Cook’s <span class="math inline">\(D\)</span>. The impact of the three unusual points on Cook’s <span class="math inline">\(D\)</span> is clearly seen.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-duncan-influence" class="level3" data-number="6.6.3"><h3 data-number="6.6.3" class="anchored" data-anchor-id="sec-duncan-influence">
<span class="header-section-number">6.6.3</span> Duncan data</h3>
<p>Let’s return to the <code>Duncan</code> data used as an example in <a href="#sec-example-duncan" class="quarto-xref"><span>Section 6.1.1</span></a> where a few points stood out as unusual in the basic diagnostic plots (<a href="#fig-duncan-plot-model" class="quarto-xref">Figure&nbsp;<span>6.2</span></a>). The influence plot in <a href="#fig-duncan-infl" class="quarto-xref">Figure&nbsp;<span>6.26</span></a> helps to make sense of these noteworthy observations. The default method for identifying points in <code><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot()</a></code> labels points with any of large studentized residuals, hat-values or Cook’s distances.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb55" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">duncan.mod</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                     cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-duncan-infl" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-duncan-infl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch06/fig-duncan-infl-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-duncan-infl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.26: Influence plot for the model predicting occupational prestige in Duncan’s data. Cases with large studentized residuals, hat-values or Cook’s distances are labeled.
</figcaption></figure>
</div>
</div>
</div>
<p><code><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot()</a></code> returns (invisibly) the influence diagnostics for the cases identified in the plot. It is often useful to look at data values for these cases to understand why each of these was flagged.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb56" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Duncan</span>, <span class="va">inf</span>, by<span class="op">=</span><span class="st">"row.names"</span>, all.x <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">CookD</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Row.names type income education prestige StudRes    Hat  CookD</span></span>
<span><span class="co">#&gt; 1    minister prof     21        84       87   3.135 0.1731 0.5664</span></span>
<span><span class="co">#&gt; 2   conductor   wc     76        34       38  -1.704 0.1945 0.2236</span></span>
<span><span class="co">#&gt; 3    reporter   wc     67        87       52  -2.397 0.0544 0.0990</span></span>
<span><span class="co">#&gt; 4 RR.engineer   bc     81        28       67   0.809 0.2691 0.0810</span></span>
<span><span class="co">#&gt; 5  contractor prof     53        45       76   2.044 0.0433 0.0585</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p><em>minister</em> has by far the largest influence, because it has an extremely positive residual and a large hat value. Looking at the data, we see that ministers have very low income, so their prestige is under-predicted. The large hat value reflects the fact that ministers have low income combined with very high education.</p></li>
<li><p><em>conductor</em> has the next largest Cook’s <span class="math inline">\(D\)</span>. It has a large hat value because its combination of relatively high income and low education is unusual in the data.</p></li>
<li><p>Among the others, <em>reporter</em> has a relatively large negative residual—its prestige is far less than the model predicts—but its low leverage make it not highly influential. <em>railroad engineer</em> has an extremely large hat value because its income is very high in relation to education. But this case is well-predicted and has a small residual, so its leverage is not large.</p></li>
</ul></section><section id="influence-in-added-variable-plots" class="level3" data-number="6.6.4"><h3 data-number="6.6.4" class="anchored" data-anchor-id="influence-in-added-variable-plots">
<span class="header-section-number">6.6.4</span> Influence in added-variable plots</h3>
<p>The properties of added-variable plots discussed in <a href="#sec-avplots" class="quarto-xref"><span>Section 6.4</span></a> make them also useful for understanding why cases are influential because they control for other predictors in each plot, and therefore show the <em>partial</em> contributions of each observation to hat values and residuals. As a consequence, we can see directly the how individual cases become individually or jointly influential.</p>
<p>The Duncan data provides a particularly instructive example of this. <a href="#fig-duncan-av-influence" class="quarto-xref">Figure&nbsp;<span>6.27</span></a> shows the AV plots for both income and education in the model <code>duncan.mod</code>, with some annotations added. I want to focus here on the <em>joint</em> influence of the occupations minister and conductor which were seen to be the most influential in <a href="#fig-duncan-infl" class="quarto-xref">Figure&nbsp;<span>6.26</span></a>. The <span style="color: green;">green</span> vertical lines show their residuals in each panel and the <span style="color: red;">red</span> lines show the regressions when these two observations are deleted.</p>
<p>The basic AV plots are produced using the call to <code><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlots()</a></code> below. To avoid clutter, I use the argument <code>id = list(method = "mahal", n=3)</code> so that only the three points with the greatest Mahalanobis distances from the centroid in each plot are labeled. These are the cases with the largest leverage seen in <a href="#fig-duncan-infl" class="quarto-xref">Figure&nbsp;<span>6.26</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlots</a></span><span class="op">(</span><span class="va">duncan.mod</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mahal"</span>, n<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-duncan-av-influence" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-duncan-av-influence-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/duncan-av-influence.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-duncan-av-influence-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.27: Added variable plots for the Duncan model, highlighting the impact of the observations for minister and conductor in each plot. The green lines show the residuals for these observations. The red line in each panel shows the regression line omitting these observations.
</figcaption></figure>
</div>
</div>
</div>
<p>The two cases—minister and conductor—are the most highly influential, but as we can see in <a href="#fig-duncan-av-influence" class="quarto-xref">Figure&nbsp;<span>6.27</span></a> their influence combines because they are at opposite sides of the horizontal axis and their residuals are of opposite signs. They act together to decrease the slope for income and increase that for education.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code for income AV plot</summary><div class="sourceCode" id="cb58" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlot</a></span><span class="op">(</span><span class="va">duncan.mod</span>, <span class="st">"income"</span>,</span>
<span>              ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>              id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mahal"</span>, n<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>              pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>              cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">res</span><span class="op">)</span></span>
<span><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">res</span>, fitted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, </span>
<span>             resids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>,</span>
<span>             hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hatvalues</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>,</span>
<span>             cookd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># noteworthy points in this plot</span></span>
<span><span class="va">big</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">info</span><span class="op">$</span><span class="va">cookd</span> <span class="op">&gt;</span> <span class="fl">.20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">info</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="va">income</span><span class="op">[</span><span class="va">big</span><span class="op">]</span>, <span class="va">fitted</span><span class="op">[</span><span class="va">big</span><span class="op">]</span>, <span class="va">income</span><span class="op">[</span><span class="va">big</span><span class="op">]</span>, <span class="va">prestige</span><span class="op">[</span><span class="va">big</span><span class="op">]</span>, </span>
<span>         angle <span class="op">=</span> <span class="fl">12</span>, length <span class="op">=</span> <span class="fl">.18</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># line w/o the unusual points</span></span>
<span><span class="va">duncan.mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">duncan.mod</span>, subset <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">duncan.mod2</span><span class="op">)</span><span class="op">[</span><span class="st">"income"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="va">bs</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Duncan’s hypothesis that the slopes for income and education were equal thus fails when these two observations are deleted. The slope for income then becomes 2.6 times that of education.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">duncan.mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">duncan.mod</span>, subset <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">duncan.mod2</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)      income   education </span></span>
<span><span class="co">#&gt;      -6.409       0.867       0.332</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Package summary</strong></p>
<div class="cell" data-layout-align="center">
<p>29 packages used here: bayestestR, car, carData, correlation, datawizard, dplyr, easystats, effects, effectsize, forcats, ggeffects, ggplot2, ggstats, insight, knitr, lubridate, marginaleffects, modelbased, modelsummary, parameters, performance, purrr, readr, report, see, stringr, tibble, tidyr, tidyverse</p>
</div>
<!-- ## References {.unnumbered} -->


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-R-modelsummary" class="csl-entry" role="listitem">
Arel-Bundock, V. (2024). <em>Modelsummary: Summary tables and plots for statistical models and data: Beautiful, customizable, and publication-ready</em>. <a href="https://modelsummary.com">https://modelsummary.com</a>
</div>
<div id="ref-R-marginaleffects" class="csl-entry" role="listitem">
Arel-Bundock, V., Greifer, N., &amp; Heiss, A. (Forthcoming). How to interpret statistical models using <code>marginaleffects</code> in <code>R</code> and <code>Python</code>. <em>Journal of Statistical Software</em>. <a href="https://marginaleffects.com">https://marginaleffects.com</a>
</div>
<div id="ref-Belsley-etal:80" class="csl-entry" role="listitem">
Belsley, D. A., Kuh, E., &amp; Welsch, R. E. (1980). <em>Regression diagnostics: Identifying influential data and sources of collinearity</em>. John Wiley; Sons.
</div>
<div id="ref-Cook:77" class="csl-entry" role="listitem">
Cook, R. D. (1977). Detection of influential observation in linear regression. <em>Technometrics</em>, <em>19</em>(1), 15–18. <a href="http://links.jstor.org/sici?sici=0040-1706%28197702%2919%3A1%3C15%3ADOIOIL%3E2.0.CO%3B2-8">http://links.jstor.org/sici?sici=0040-1706%28197702%2919%3A1%3C15%3ADOIOIL%3E2.0.CO%3B2-8</a>
</div>
<div id="ref-Cook:93" class="csl-entry" role="listitem">
Cook, R. D. (1993). Exploring partial residual plots. <em>Technometrics</em>, <em>35</em>(4), 351–362.
</div>
<div id="ref-Cook-1996" class="csl-entry" role="listitem">
Cook, R. D. (1996). Added-variable plots and curvature in linear regression. <em>Technometrics</em>, <em>38</em>(3), 275–278. <a href="https://doi.org/10.1080/00401706.1996.10484507">https://doi.org/10.1080/00401706.1996.10484507</a>
</div>
<div id="ref-CookWeisberg:82" class="csl-entry" role="listitem">
Cook, R. D., &amp; Weisberg, S. (1982). <em>Residuals and influence in regression</em>. Chapman; Hall.
</div>
<div id="ref-CookWeisberg-1994" class="csl-entry" role="listitem">
Cook, R. D., &amp; Weisberg, S. (1994). ARES plots for generalized linear models. <em>Computational Statistics &amp; Data Analysis</em>, <em>17</em>(3), 303–315. <a href="https://doi.org/10.1016/0167-9473(92)00075-3">https://doi.org/10.1016/0167-9473(92)00075-3</a>
</div>
<div id="ref-Duncan:61" class="csl-entry" role="listitem">
Duncan, O. D. (1961). A socioeconomic index for all occupations. In Jr. A. J. Reiss, P. K. H. O. D. Duncan, &amp; C. C. North (Eds.), <em>Occupations and social status</em>. The Free Press.
</div>
<div id="ref-Fisher-1936" class="csl-entry" role="listitem">
Fisher, R. A. (1925). <em>Statistical methods for research workers</em> (6th ed.). Oliver &amp; Boyd.
</div>
<div id="ref-Fox:87" class="csl-entry" role="listitem">
Fox, J. (1987). Effect displays for generalized linear models. In C. C. Clogg (Ed.), <em>Sociological methodology, 1987</em> (pp. 347–361). Jossey-Bass.
</div>
<div id="ref-Fox:03:effects" class="csl-entry" role="listitem">
Fox, J. (2003). Effect displays in <span>R</span> for generalized linear models. <em>Journal of Statistical Software</em>, <em>8</em>(15), 1–27.
</div>
<div id="ref-Fox2020" class="csl-entry" role="listitem">
Fox, J. (2020). <em>Regression diagnostics</em> (2nd ed.). <span>SAGE</span> Publications, Inc. <a href="https://doi.org/10.4135/9781071878651">https://doi.org/10.4135/9781071878651</a>
</div>
<div id="ref-FoxWeisberg:2018" class="csl-entry" role="listitem">
Fox, J., &amp; Weisberg, S. (2018a). <em>An <span>R</span> companion to applied regression</em> (Third). SAGE Publications. <a href="https://books.google.ca/books?id=uPNrDwAAQBAJ">https://books.google.ca/books?id=uPNrDwAAQBAJ</a>
</div>
<div id="ref-FoxWeisberg2018" class="csl-entry" role="listitem">
Fox, J., &amp; Weisberg, S. (2018b). Visualizing fit and lack of fit in complex regression models with predictor effect plots and partial residuals. <em>Journal of Statistical Software</em>, <em>87</em>(9). <a href="https://doi.org/10.18637/jss.v087.i09">https://doi.org/10.18637/jss.v087.i09</a>
</div>
<div id="ref-R-car" class="csl-entry" role="listitem">
Fox, J., Weisberg, S., &amp; Price, B. (2023). <em>Car: Companion to applied regression</em>. <a href="https://CRAN.R-project.org/package=car">https://CRAN.R-project.org/package=car</a>
</div>
<div id="ref-R-effects" class="csl-entry" role="listitem">
Fox, J., Weisberg, S., Price, B., Friendly, M., &amp; Hong, J. (2022). <em>Effects: Effect displays for linear, generalized linear, and other models</em>. <a href="https://www.r-project.org">https://www.r-project.org</a>
</div>
<div id="ref-HoaglinWelsch1978" class="csl-entry" role="listitem">
Hoaglin, D. C., &amp; Welsch, R. E. (1978). The hat matrix in regression and <span>ANOVA</span>. <em>The American Statistician</em>, <em>32</em>(1), 17–22. <a href="https://doi.org/10.1080/00031305.1978.10479237">https://doi.org/10.1080/00031305.1978.10479237</a>
</div>
<div id="ref-KastellecLeoni:2007" class="csl-entry" role="listitem">
Kastellec, J. P., &amp; Leoni, E. L. (2007). Using graphs instead of tables in political science. <em>Perspectives on Politics</em>, <em>5</em>(04), 755–771. <a href="https://doi.org/10.1017/S1537592707072209">https://doi.org/10.1017/S1537592707072209</a>
</div>
<div id="ref-R-ggstats" class="csl-entry" role="listitem">
Larmarange, J. (2024). <em>Ggstats: Extension to ggplot2 for plotting stats</em>. <a href="https://larmarange.github.io/ggstats/">https://larmarange.github.io/ggstats/</a>
</div>
<div id="ref-LarsenMcCleary:72" class="csl-entry" role="listitem">
Larsen, W. A., &amp; McCleary, S. J. (1972). The use of partial residual plots in regression analysis. <em>Technometrics</em>, <em>14</em>, 781–790.
</div>
<div id="ref-R-ggeffects" class="csl-entry" role="listitem">
Lüdecke, D. (2024). <em>Ggeffects: Create tidy data frames of marginal effects for ggplot from model outputs</em>. <a href="https://strengejacke.github.io/ggeffects/">https://strengejacke.github.io/ggeffects/</a>
</div>
<div id="ref-Ludecke-etal-performance" class="csl-entry" role="listitem">
Lüdecke, D., Ben-Shachar, M. S., Patil, I., Waggoner, P., &amp; Makowski, D. (2021). <span class="nocase">performance</span>: An <span>R</span> package for assessment, comparison and testing of statistical models. <em>Journal of Open Source Software</em>, <em>6</em>(60), 3139. <a href="https://doi.org/10.21105/joss.03139">https://doi.org/10.21105/joss.03139</a>
</div>
<div id="ref-R-easystats" class="csl-entry" role="listitem">
Lüdecke, D., Ben-Shachar, M. S., Patil, I., Wiernik, B. M., &amp; Makowski, D. (2022). Easystats: Framework for easy statistical modeling, visualization, and reporting. In <em>CRAN</em>. <a href="https://easystats.github.io/easystats/">https://easystats.github.io/easystats/</a>
</div>
<div id="ref-Pineo-Porter-1967" class="csl-entry" role="listitem">
Pineo, P. O., &amp; Porter, J. (1967). Occupational prestige in canada*. <em>Canadian Review of Sociology</em>, <em>4</em>(1), 24–40. https://doi.org/<a href="https://doi.org/10.1111/j.1755-618X.1967.tb00472.x">https://doi.org/10.1111/j.1755-618X.1967.tb00472.x</a>
</div>
<div id="ref-Searle-etal:80" class="csl-entry" role="listitem">
Searle, S. R., Speed, F. M., &amp; Milliken, G. A. (1980). Population marginal means in the linear model: An alternative to least squares means. <em>The American Statistician</em>, <em>34</em>(4), 216–221.
</div>
<div id="ref-VellemanWelsh:81" class="csl-entry" role="listitem">
Velleman, P. F., &amp; Welsh, R. E. (1981). Efficient computing of regression diagnostics. <em>The American Statistician</em>, <em>35</em>(4), 234–242.
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Note that the factor <code>type</code> in the dataset has its levels ordered alphabetically. For analysis and graphing it is useful to reorder the levels in the natural increasing order. An alternative is to make <code>type</code> an <em>ordered</em> factor, but this would represent it using polynomial contrasts for linear and quadratic trends, which seems unuseful in this context.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Earlier, but less general expression of these ideas go back to the use of <strong>adjusted means</strong> in analysis of covariance <span class="citation" data-cites="Fisher-1936">(<a href="95-references.html#ref-Fisher-1936" role="doc-biblioref">Fisher, 1925</a>)</span> or <strong>least squares means</strong> or <strong>population marginal means</strong> in analysis of variance <span class="citation" data-cites="Searle-etal:80">(<a href="95-references.html#ref-Searle-etal:80" role="doc-biblioref">Searle et al., 1980</a>)</span><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>See this <a href="https://bit.ly/45x2T0Q">Stats StackExchange discussion</a> for a proof.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./05-linear_models.html" class="pagination-link" aria-label="Overview of Linear models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-lin-mod-topics.html" class="pagination-link" aria-label="Topics in Linear Models">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>