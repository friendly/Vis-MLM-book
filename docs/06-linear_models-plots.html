<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Visualizing Multivariate Data and Models in R - 6&nbsp; Plots for univariate response models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-lin-mod-topics.html" rel="next">
<link href="./05-linear_models.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-linear_models-plots.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title"><span id="sec-linear-models-plots" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Visualizing Tests for Equality of Covariance Matrices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./90-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#the-regression-quartet" id="toc-the-regression-quartet" class="nav-link active" data-scroll-target="#the-regression-quartet"><span class="header-section-number">6.1</span> The “regression quartet”</a></li>
  <li><a href="#other-model-plots" id="toc-other-model-plots" class="nav-link" data-scroll-target="#other-model-plots"><span class="header-section-number">6.2</span> Other Model plots</a></li>
  <li>
<a href="#coefficient-displays" id="toc-coefficient-displays" class="nav-link" data-scroll-target="#coefficient-displays"><span class="header-section-number">6.3</span> Coefficient displays</a>
  <ul class="collapse">
<li><a href="#displaying-coefficients" id="toc-displaying-coefficients" class="nav-link" data-scroll-target="#displaying-coefficients"><span class="header-section-number">6.3.1</span> Displaying coefficients</a></li>
  <li><a href="#visualizing-coefficients" id="toc-visualizing-coefficients" class="nav-link" data-scroll-target="#visualizing-coefficients"><span class="header-section-number">6.3.2</span> Visualizing coefficients</a></li>
  <li><a href="#more-useful-coefficient-plots" id="toc-more-useful-coefficient-plots" class="nav-link" data-scroll-target="#more-useful-coefficient-plots"><span class="header-section-number">6.3.3</span> More useful coefficient plots</a></li>
  </ul>
</li>
  <li><a href="#spread-level-plot" id="toc-spread-level-plot" class="nav-link" data-scroll-target="#spread-level-plot"><span class="header-section-number">6.4</span> Spread-level plot</a></li>
  <li>
<a href="#sec-avplots" id="toc-sec-avplots" class="nav-link" data-scroll-target="#sec-avplots"><span class="header-section-number">6.5</span> Added-variable plots</a>
  <ul class="collapse">
<li><a href="#properties-of-av-plots" id="toc-properties-of-av-plots" class="nav-link" data-scroll-target="#properties-of-av-plots"><span class="header-section-number">6.5.1</span> Properties of AV plots</a></li>
  <li><a href="#marginal---conditional-plots" id="toc-marginal---conditional-plots" class="nav-link" data-scroll-target="#marginal---conditional-plots"><span class="header-section-number">6.5.2</span> Marginal - conditional plots</a></li>
  <li><a href="#prestige-data" id="toc-prestige-data" class="nav-link" data-scroll-target="#prestige-data"><span class="header-section-number">6.5.3</span> Prestige data</a></li>
  <li><a href="#component-residual-plots" id="toc-component-residual-plots" class="nav-link" data-scroll-target="#component-residual-plots"><span class="header-section-number">6.5.4</span> Component + Residual plots</a></li>
  </ul>
</li>
  <li><a href="#marginal-effect-plots" id="toc-marginal-effect-plots" class="nav-link" data-scroll-target="#marginal-effect-plots"><span class="header-section-number">6.6</span> Marginal effect plots</a></li>
  <li>
<a href="#sec-leverage" id="toc-sec-leverage" class="nav-link" data-scroll-target="#sec-leverage"><span class="header-section-number">6.7</span> Outliers, leverage and influence</a>
  <ul class="collapse">
<li><a href="#the-leverage-influence-quartet" id="toc-the-leverage-influence-quartet" class="nav-link" data-scroll-target="#the-leverage-influence-quartet"><span class="header-section-number">6.7.1</span> The leverage-influence quartet</a></li>
  <li><a href="#measuring-leverage" id="toc-measuring-leverage" class="nav-link" data-scroll-target="#measuring-leverage"><span class="header-section-number">6.7.2</span> Measuring leverage</a></li>
  <li><a href="#outliers-measuring-residuals" id="toc-outliers-measuring-residuals" class="nav-link" data-scroll-target="#outliers-measuring-residuals"><span class="header-section-number">6.7.3</span> Outliers: Measuring residuals</a></li>
  <li><a href="#measuring-influence" id="toc-measuring-influence" class="nav-link" data-scroll-target="#measuring-influence"><span class="header-section-number">6.7.4</span> Measuring influence</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \newcommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- % R stuff --><p>For a univariate linear model fit using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> and similar functions, the standard <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method gives basic versions of <em>diagnostic</em> plots of residuals and other calculated quantities for assessing possible violations of the model assumptions. Some of these can be considerably enhanced using other packages.</p>
<p>Beyond this,</p>
<ul>
<li><p>tables of model coefficients, standard errors and test statistics can often be usefully supplemented or even replaced by suitable <em>coeficient plots</em> providing essentially the same information.</p></li>
<li><p>when there are two or more predictors, standard plots of <span class="math inline">\(y\)</span> vs.&nbsp;each <span class="math inline">\(x\)</span> ignore the other predictors in the model. <em>Added-variable plots</em> (also called <em>partial regression plots</em>) allow you to visualize <em>partial</em> relations between the response and a predictor by adjusting (controlling for) all other predictors.</p></li>
<li><p>in this same situation, you can more easily understand their separate impact on the response by plotting the <em>marginal effects</em> of one or more focal variables, averaging over other variables not shown in a given plot.</p></li>
<li><p>when there are highly correlated predictors, some specialized plots are useful to understand the nature of <em>multicolinearity</em>.</p></li>
</ul>
<p>The classic reference on regression diagnostics is <span class="citation" data-cites="Belsley-etal:80">Belsley et al. (<a href="90-references.html#ref-Belsley-etal:80" role="doc-biblioref">1980</a>)</span>. My favorite modern texts are the brief <span class="citation" data-cites="Fox2020">Fox (<a href="90-references.html#ref-Fox2020" role="doc-biblioref">2020</a>)</span> and the more complete <span class="citation" data-cites="FoxWeisberg:2018">Fox &amp; Weisberg (<a href="90-references.html#ref-FoxWeisberg:2018" role="doc-biblioref">2018</a>)</span>, both of which are supported by the <strong>car</strong> package <span class="citation" data-cites="R-car">(<a href="90-references.html#ref-R-car" role="doc-biblioref">Fox et al., 2023</a>)</span>.</p>
<section id="the-regression-quartet" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="the-regression-quartet">
<span class="header-section-number">6.1</span> The “regression quartet”</h2>
<p>For a fitted model, plotting the model object with <code>plot(model)</code> provides for any of six basic plots, of which four are produced by default, giving rise to the term <em>regression quartet</em> for this collection. These are:</p>
<ul>
<li><p><strong>Residuals vs.&nbsp;Fitted</strong>: For well-behaved data, the points should hover around a horizontal line at residual = 0, with no obvious pattern or trend.</p></li>
<li><p><strong>Normal Q-Q plot</strong>: A plot of sorted standardized residuals <span class="math inline">\(e_i\)</span> (obtained from<code>rstudent(model)</code>) against the theoretical values those values would have in a standard normal <span class="math inline">\(\mathcal{N}(0, 1)\)</span> distribution.</p></li>
<li><p><strong>Scale-Location</strong>: Plots the square-root of the absolute values of the standardized residuals <span class="math inline">\(\sqrt{| e_i |}\)</span> as a measure of “scale” against the fitted values <span class="math inline">\(\hat{y}_i\)</span> as a measure of “location”. This provides an assessment of homogeneity of variance, which appears as a tendency for scale to vary with location.</p></li>
<li><p><strong>Residuals vs.&nbsp;Leverage</strong>: Plots standardized residuals against leverage to help identify possibly influential observations. Leverage, or “hat” values (given by <code>hat(model)</code>) are proportional to the squared Mahalanobis distances of the predictor values <span class="math inline">\(\mathbf{x}_i\)</span> from the means, and measure the potential of an observation to change the fitted coefficients if that observation was deleted. Actual influence is measured by Cooks’s distance (<code>cooks.distance(model)</code>) and is proportional to the product of residual times leverage. Contours of constant Cook’s <span class="math inline">\(D\)</span> are added to the plot.</p></li>
</ul>
<p>One key feature of these plots is providing <strong>reference</strong> lines or smoothed curves for ease of judging the extent to which a plot conforms to the expected pattern; another is the <strong>labeling</strong> of observations which deviate from an assumption.</p>
<p>The base-R <code>plot(model)</code> plots are done much better in a variety of packages. I illustrate some versions from the <strong>car</strong> <span class="citation" data-cites="R-car">(<a href="90-references.html#ref-R-car" role="doc-biblioref">Fox et al., 2023</a>)</span> and <strong>performance</strong> <span class="citation" data-cites="Ludecke-etal-performance">(<a href="90-references.html#ref-Ludecke-etal-performance" role="doc-biblioref">Lüdecke et al., 2021</a>)</span> packages, part of the <strong>easystats</strong> <span class="citation" data-cites="R-easystats">(<a href="90-references.html#ref-R-easystats" role="doc-biblioref">Lüdecke et al., 2022</a>)</span> suite of packages.</p>
<p><strong>Packages</strong>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/easystats/">easystats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://modelsummary.com">modelsummary</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://larmarange.github.io/ggstats/">ggstats</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="example-duncans-occupational-prestige" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="example-duncans-occupational-prestige">Example: Duncan’s occupational prestige</h4>
<p>In a classic study in sociology, <span class="citation" data-cites="Duncan:61">Duncan (<a href="90-references.html#ref-Duncan:61" role="doc-biblioref">1961</a>)</span> used data from the U.S. Census in 1950 to study how one could predict the prestige of occupational categories — which is hard to measure — from available information in the census for those occupations. His data is available in <code>carData:Duncan</code>, and contains</p>
<ul>
<li>
<code>type</code>: the category of occupation, one of <code>prof</code> (professional), <code>wc</code> (white collar) or <code>bc</code> (blue collar);</li>
<li>
<code>income</code>: the percentage of occupational incumbents with a reported income &gt; $3500 (about $40,000 in current dollars);</li>
<li>
<code>education</code>: the percentage of occupational incumbents who were high school graduates;</li>
<li>
<code>prestige</code>: the percentage of respondents in a social survey who rated the occupation as “good” or better in prestige.</li>
</ul>
<p>These variables are a bit quirky in they are measured in percents, 0-100, rather dollars for <code>income</code> and years for <code>education</code>, but this common scale permitted Duncan to ask an interesting sociological question: Assuming that both income and education predict prestige, are they equally important, as might be assessed by testing the hypothesis <span class="math inline">\(H_0: \beta_{\text{income}} = \beta_{\text{education}}\)</span>.</p>
<p>A quick look at the data shows the variables and a selection of the occupational categories, which are the <code><a href="https://rdrr.io/r/base/row.names.html">row.names()</a></code> of the dataset.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Duncan</span>, package <span class="op">=</span> <span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/some.html">some</a></span><span class="op">(</span><span class="va">Duncan</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  type income education prestige</span></span>
<span><span class="co">#&gt; accountant       prof     62        86       82</span></span>
<span><span class="co">#&gt; professor        prof     64        93       93</span></span>
<span><span class="co">#&gt; engineer         prof     72        86       88</span></span>
<span><span class="co">#&gt; factory.owner    prof     60        56       81</span></span>
<span><span class="co">#&gt; store.clerk        wc     29        50       16</span></span>
<span><span class="co">#&gt; carpenter          bc     21        23       33</span></span>
<span><span class="co">#&gt; machine.operator   bc     21        20       24</span></span>
<span><span class="co">#&gt; barber             bc     16        26       20</span></span>
<span><span class="co">#&gt; soda.clerk         bc     12        30        6</span></span>
<span><span class="co">#&gt; janitor            bc      7        20        8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s start by fitting a simple model using just income and education as predictors. The results look very good! Both <code>income</code> and <code>education</code> are highly significant and the <span class="math inline">\(R^2 = 0.828\)</span> for the model indicates that <code>prestige</code> is very well predicted by just these variables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">duncan.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span>, data<span class="op">=</span><span class="va">Duncan</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">duncan.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = prestige ~ income + education, data = Duncan)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -29.54  -6.42   0.65   6.61  34.64 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  -6.0647     4.2719   -1.42     0.16    </span></span>
<span><span class="co">#&gt; income        0.5987     0.1197    5.00  1.1e-05 ***</span></span>
<span><span class="co">#&gt; education     0.5458     0.0983    5.56  1.7e-06 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 13.4 on 42 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.828,  Adjusted R-squared:  0.82 </span></span>
<span><span class="co">#&gt; F-statistic:  101 on 2 and 42 DF,  p-value: &lt;2e-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Beyond this, Duncan was interested in the coefficients and whether income and education could be said to have equal impacts on predicting occupational prestige. A nice display of model coefficients with confidence intervals is provided by <code><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters::model_parameters()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">duncan.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(42) |      p</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       -6.06 | 4.27 | [-14.69, 2.56] | -1.42 | 0.163 </span></span>
<span><span class="co">#&gt; income      |        0.60 | 0.12 | [  0.36, 0.84] |  5.00 | &lt; .001</span></span>
<span><span class="co">#&gt; education   |        0.55 | 0.10 | [  0.35, 0.74] |  5.56 | &lt; .001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also test Duncan’s hypothesis that income and education have equal effects on prestige with <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">car::linearHypothesis()</a></code>. This is constructed as a test of a restricted model in which the two coefficients are forced to be equal against the unrestricted model. Duncan was very happy with this result.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">duncan.mod</span>, <span class="st">"income = education"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear hypothesis test:</span></span>
<span><span class="co">#&gt; income - education = 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: restricted model</span></span>
<span><span class="co">#&gt; Model 2: prestige ~ income + education</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; 1     43 7519                         </span></span>
<span><span class="co">#&gt; 2     42 7507  1      12.2 0.07    0.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But, should Duncan be <strong>so</strong> happy? It is unlikely that he ran any model diagnostics or plotted his model; we do so now. Here is the regression quartet for this model. Each plot shows some trend lines, and importantly, labels some observations that stand out and might deserve attention.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>          mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">duncan.mod</span>, lwd<span class="op">=</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-duncan-plot-model" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-duncan-plot-model-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.1: Regression quartet of diagnostic plots for the <code>Duncan</code> data. Several possibly unusual observations are labeled.</figcaption></figure>
</div>
</div>
</div>
<p>Some points to note:</p>
<ul>
<li>A few observations (minister, reporter, conductor) are flagged in multiple panels</li>
<li>The red trend line in the scale-location plot indicates that residual variance is not constant, but rather increases from both ends. This is a consequence of the fact that <code>prestige</code> is measured as a percentage, bounded at [0, 100], and the standard deviation of a percentage <span class="math inline">\(p\)</span> is proportional to <span class="math inline">\(\sqrt{p \times (1-p)}\)</span>.</li>
</ul></section><section id="sec-prestige2" class="level4" data-number="6.1.0.1"><h4 data-number="6.1.0.1" class="anchored" data-anchor-id="sec-prestige2">
<span class="header-section-number">6.1.0.1</span> Example: Canadian occupational prestige</h4>
<!-- **CUT THIS EXAMPLE** -->
<p><strong>TODO</strong>: Already introduced in <a href="03-multivariate_plots.html#sec-prestige"><span>Section&nbsp;3.2.3</span></a> Pair this down &amp; integrate with that</p>
<p>These examples use the data on the prestige of 102 occupational categories and other measures from the 1971 Canadian Census, recorded in <code><a href="https://rdrr.io/pkg/carData/man/Prestige.html">carData::Prestige</a></code>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> It differs from the <code>Duncan</code> dataset primarily in that the main variables—prestige, income and education were revamped to better reflect the underlying constructs in more meaningful units.</p>
<ul>
<li><p><code>prestige</code>: Rather than a simple percentage of “good+” ratings, this uses a wider and more reliable scale from <span class="citation" data-cites="Pineo-Porter-1967">Pineo &amp; Porter (<a href="90-references.html#ref-Pineo-Porter-1967" role="doc-biblioref">1967</a>)</span> on a scale from 10–90.</p></li>
<li><p><code>income</code> is measured as the average income of incumbents in each occupation, in 1971 dollars, rather than percent exceeding a given threshold ($3500)</p></li>
<li><p><code>education</code> is measured as the average education of occupational incumbents, years.</p></li>
</ul>
<p>The dataset again includes <code>type</code> of occupation with the same levels <code>"bc"</code> (blue collar), <code>"wc"</code> (white collar) and <code>"prof"</code> (professional), but in addition includes the percent of <code>women</code> in these occupational categories.</p>
<p>Our interest again is in understanding how <code>prestige</code> is related to census measures of the average education, income, percent women of incumbents in those occupations, but with attention to the scales of measurement and possibly more complex relationships …</p>
<!-- **TODO**: These data should be introduced earlier with descriptive plots, scatterplots, ... -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Prestige</span>, package<span class="op">=</span><span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="co"># `type` is really an ordered factor. Make it so.</span></span>
<span><span class="co"># Prestige$type &lt;- ordered(Prestige$type,</span></span>
<span><span class="co">#                          levels=c("bc", "wc", "prof"))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    102 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ education: num  13.1 12.3 12.8 11.4 14.6 ...</span></span>
<span><span class="co">#&gt;  $ income   : int  12351 25879 9271 8865 8403 11030 8258 14163 11377 11023 ...</span></span>
<span><span class="co">#&gt;  $ women    : num  11.16 4.02 15.7 9.11 11.68 ...</span></span>
<span><span class="co">#&gt;  $ prestige : num  68.8 69.1 63.4 56.8 73.5 77.6 72.6 78.1 73.1 68.8 ...</span></span>
<span><span class="co">#&gt;  $ census   : int  1113 1130 1171 1175 2111 2113 2133 2141 2143 2153 ...</span></span>
<span><span class="co">#&gt;  $ type     : Factor w/ 3 levels "bc","prof","wc": 2 2 2 2 2 2 2 2 2 2 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit a main-effects model using all predictors (ignoring <code>census</code>, the Canadian Census occupational code):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prestige.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">type</span>,</span>
<span>                   data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>plot(model)</code> produces four separate plots. For a quick look, I like to arrange them in a single 2x2 figure.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>          mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">prestige.mod</span>, lwd<span class="op">=</span><span class="fl">2</span>, cex.lab<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-plot-prestige-mod" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-plot-prestige-mod-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.2: Regression quartet of diagnostic plots for the <code>Prestige</code> data. Several possibly unusual observations are labeled.</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="other-model-plots" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="other-model-plots">
<span class="header-section-number">6.2</span> Other Model plots</h2>
</section><section id="coefficient-displays" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="coefficient-displays">
<span class="header-section-number">6.3</span> Coefficient displays</h2>
<p>The results of linear models are most often reported in tables and typically with “significance stars” (<code>*, **, ***</code>) to indicate the outcome of hypothesis tests. These are useful for looking up precise values and you can use this format to compare a small number of competing models side-by-side. However, as illustrated by <span class="citation" data-cites="KastellecLeoni:2007">Kastellec &amp; Leoni (<a href="90-references.html#ref-KastellecLeoni:2007" role="doc-biblioref">2007</a>)</span>, plots of coefficients can increase the clarity of presentation and make it easier to draw correct conclusions. Yet, when you need to present tables, there is a variety of tools in R that can help make them attractive in publications.</p>
<p>For illustration, I’ll consider three models for the <code>Prestige</code> data of increasing complexity:</p>
<ul>
<li>
<code>mod1</code> fits the main effects of the three quantitative predictors;</li>
<li>
<code>mod2</code> adds the categorical variable <code>type</code> of occupation;</li>
<li>
<code>mod3</code> allows an interaction of <code>income</code> with <code>type</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">type</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">income</span> <span class="op">*</span> <span class="va">type</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From our earlier analyses (<a href="03-multivariate_plots.html#sec-prestige"><span>Section&nbsp;3.2.3</span></a>) we saw that the marginal relationship between <code>income</code> and <code>prestige</code> was nonlinear <a href="03-multivariate_plots.html#fig-Prestige-scatterplot-income1">Figure&nbsp;<span>3.11</span></a>), and was better represented in a linear model using <code>log(income)</code> (<a href="03-multivariate_plots.html#sec-log-scale"><span>Section&nbsp;3.2.3.1</span></a>) shown in <a href="03-multivariate_plots.html#fig-Prestige-scatterplot2">Figure&nbsp;<span>3.14</span></a>. However, this possibly non-linear relationship could also be explained by stratifying (<a href="03-multivariate_plots.html#sec-stratifying"><span>Section&nbsp;3.2.3.2</span></a>) the data by <code>type</code> of occupation (<a href="03-multivariate_plots.html#fig-Prestige-scatterplot3">Figure&nbsp;<span>3.15</span></a>).</p>
<section id="displaying-coefficients" class="level3" data-number="6.3.1"><h3 data-number="6.3.1" class="anchored" data-anchor-id="displaying-coefficients">
<span class="header-section-number">6.3.1</span> Displaying coefficients</h3>
<p><code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> gives the complete precis of a fitted model, with information about the estimated coefficients, redisuals and goodness-of fit statistics like <span class="math inline">\(R^2\)</span>. But if you only want to see the coefficients, standard errors, etc. <code><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">lmtest::coeftest()</a></code> gives these results in the familiar format for console output. <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code> places these in a tidy format common to many modeling functions which is useful for futher processing (e.g., comparing models).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; t test of coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) -6.794334   3.239089   -2.10    0.039 *  </span></span>
<span><span class="co">#&gt; education    4.186637   0.388701   10.77  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; income       0.001314   0.000278    4.73  7.6e-06 ***</span></span>
<span><span class="co">#&gt; women       -0.008905   0.030407   -0.29    0.770    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 5</span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic  p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 (Intercept) -6.79     3.24        -2.10  3.85e- 2</span></span>
<span><span class="co">#&gt; 2 education    4.19     0.389       10.8   2.59e-18</span></span>
<span><span class="co">#&gt; 3 income       0.00131  0.000278     4.73  7.58e- 6</span></span>
<span><span class="co">#&gt; 4 women       -0.00891  0.0304      -0.293 7.70e- 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <strong>modelsummary</strong> package (<span class="citation" data-cites="R-modelsummary">Arel-Bundock (<a href="90-references.html#ref-R-modelsummary" role="doc-biblioref">2024</a>)</span>) is an easy to use, very general package to summarize data and statistical models in R. The main function <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> can produce highly customizable tables of coefficients in a wide variety of output formats, including HTML, PDF, LaTeX, Markdown, and MS Word. You can select the statistics displayed for any model term with the <code>estimate</code> and <code>statistic</code> arguments.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html">modelsummary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Model1"</span> <span class="op">=</span> <span class="va">mod1</span><span class="op">)</span>,</span>
<span>  coef_omit <span class="op">=</span> <span class="st">"Intercept"</span>,</span>
<span>  shape <span class="op">=</span> <span class="va">term</span> <span class="op">~</span> <span class="va">statistic</span>,</span>
<span>  estimate <span class="op">=</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span>  statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"std.error"</span>, <span class="st">"p.value"</span><span class="op">)</span>,</span>
<span>  fmt <span class="op">=</span> <span class="fu"><a href="https://modelsummary.com/man/fmt_statistic.html">fmt_statistic</a></span><span class="op">(</span><span class="st">"estimate"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"conf.low"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"conf.high"</span> <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  gof_omit <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummary1" class="anchored">

 

  
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tinytable_je6qt4ljar8mpairkzlo</title>
<style>
.table td.tinytable_css_tkk59n6db9o1yxquqfzn, .table th.tinytable_css_tkk59n6db9o1yxquqfzn {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_kjawdrwszvl64uvhct1r, .table th.tinytable_css_kjawdrwszvl64uvhct1r {    text-align: center; }
.table td.tinytable_css_2wsj896rho98ie2ljxmg, .table th.tinytable_css_2wsj896rho98ie2ljxmg {    border-bottom: solid 0.05em #d3d8dc; }
.table td.tinytable_css_uh9wj5s3q8mpb9mqxfor, .table th.tinytable_css_uh9wj5s3q8mpb9mqxfor {    text-align: left; }
.table td.tinytable_css_emi9c0ap9eg7z59qjonf, .table th.tinytable_css_emi9c0ap9eg7z59qjonf {    text-align: center; }
.table td.tinytable_css_f2vk29k6isnstyxkpw5m, .table th.tinytable_css_f2vk29k6isnstyxkpw5m {    text-align: center; }
.table td.tinytable_css_hkwad1yrff77um9aqmwl, .table th.tinytable_css_hkwad1yrff77um9aqmwl {    text-align: center; }
.table td.tinytable_css_e397uryj7v2achk4ujh2, .table th.tinytable_css_e397uryj7v2achk4ujh2 {    text-align: center; }
    </style>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script><div class="container">
      <table class="table table-borderless" id="tinytable_je6qt4ljar8mpairkzlo" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<caption>Table&nbsp;6.1:  <p>Table of coefficients for the main effects model.</p> </caption>
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Model1</th>
</tr>
<tr>
<th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">S.E.</th>
                <th scope="col">p</th>
              </tr>
</thead>
<tbody>
<tr>
<td>education</td>
                  <td>4.187 [3.4153, 4.9580]  </td>
                  <td>0.389</td>
                  <td>0.000</td>
                </tr>
<tr>
<td>income   </td>
                  <td>0.001 [0.0008, 0.0019]  </td>
                  <td>0.000</td>
                  <td>0.000</td>
                </tr>
<tr>
<td>women    </td>
                  <td>-0.009 [-0.0692, 0.0514]</td>
                  <td>0.030</td>
                  <td>0.770</td>
                </tr>
</tbody>
</table>
</div>

    <script>
      function styleCell_tinytable_1u7f2cb0tu5f968o2hre(i, j, css_id) {
        var table = document.getElementById("tinytable_je6qt4ljar8mpairkzlo");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_je6qt4ljar8mpairkzlo');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_1u7f2cb0tu5f968o2hre(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_je6qt4ljar8mpairkzlo");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(1, 0, 'tinytable_css_tkk59n6db9o1yxquqfzn') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(1, 1, 'tinytable_css_tkk59n6db9o1yxquqfzn') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(1, 2, 'tinytable_css_tkk59n6db9o1yxquqfzn') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(1, 3, 'tinytable_css_tkk59n6db9o1yxquqfzn') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 0, 'tinytable_css_kjawdrwszvl64uvhct1r') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 1, 'tinytable_css_kjawdrwszvl64uvhct1r') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 2, 'tinytable_css_kjawdrwszvl64uvhct1r') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 3, 'tinytable_css_kjawdrwszvl64uvhct1r') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 1, 'tinytable_css_2wsj896rho98ie2ljxmg') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 0, 'tinytable_css_uh9wj5s3q8mpb9mqxfor') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(1, 0, 'tinytable_css_uh9wj5s3q8mpb9mqxfor') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(2, 0, 'tinytable_css_uh9wj5s3q8mpb9mqxfor') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(3, 0, 'tinytable_css_uh9wj5s3q8mpb9mqxfor') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(4, 0, 'tinytable_css_uh9wj5s3q8mpb9mqxfor') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 1, 'tinytable_css_emi9c0ap9eg7z59qjonf') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(1, 1, 'tinytable_css_emi9c0ap9eg7z59qjonf') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(2, 1, 'tinytable_css_emi9c0ap9eg7z59qjonf') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(3, 1, 'tinytable_css_emi9c0ap9eg7z59qjonf') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(4, 1, 'tinytable_css_emi9c0ap9eg7z59qjonf') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 2, 'tinytable_css_f2vk29k6isnstyxkpw5m') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(1, 2, 'tinytable_css_f2vk29k6isnstyxkpw5m') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(2, 2, 'tinytable_css_f2vk29k6isnstyxkpw5m') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(3, 2, 'tinytable_css_f2vk29k6isnstyxkpw5m') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(4, 2, 'tinytable_css_f2vk29k6isnstyxkpw5m') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 3, 'tinytable_css_hkwad1yrff77um9aqmwl') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(1, 3, 'tinytable_css_hkwad1yrff77um9aqmwl') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(2, 3, 'tinytable_css_hkwad1yrff77um9aqmwl') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(3, 3, 'tinytable_css_hkwad1yrff77um9aqmwl') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(4, 3, 'tinytable_css_hkwad1yrff77um9aqmwl') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 0, 'tinytable_css_e397uryj7v2achk4ujh2') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 1, 'tinytable_css_e397uryj7v2achk4ujh2') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 2, 'tinytable_css_e397uryj7v2achk4ujh2') })
window.addEventListener('load', function () { styleCell_tinytable_1u7f2cb0tu5f968o2hre(0, 3, 'tinytable_css_e397uryj7v2achk4ujh2') })
    </script>
</div>
</div>
</div>
<p><code>gof_omit</code> allows you to omit or select the goodness-of-fit statistics and other model information available from those listed by <code><a href="https://modelsummary.com/man/get_gof.html">get_gof()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/get_gof.html">get_gof</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt;   aic bic r.squared adj.r.squared rmse nobs   F logLik</span></span>
<span><span class="co">#&gt; 1 716 729     0.798         0.792 7.69  102 129   -353</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="visualizing-coefficients" class="level3" data-number="6.3.2"><h3 data-number="6.3.2" class="anchored" data-anchor-id="visualizing-coefficients">
<span class="header-section-number">6.3.2</span> Visualizing coefficients</h3>
<p><code><a href="https://modelsummary.com/man/modelplot.html">modelplot()</a></code> is the companion function. It allows you to plot model estimates and confidence intervals. It makes it easy to subset, rename, reorder, and customize plots using same mechanics as in <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html">modelplot</a></span><span class="op">(</span><span class="va">mod1</span>, coef_omit<span class="op">=</span><span class="st">"Intercept"</span>, </span>
<span>          color<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">1</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Raw coefficients for mod1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-modelplot1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-modelplot1-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.3: Plot of coefficients and their standard error bar for the simple main effects model</figcaption></figure>
</div>
</div>
</div>
<p>But this plot is disappointing and misleading because it show the <strong>raw</strong> coefficients. From the plot, it looks like only <code>education</code> has a non-zero effect, but the effect of <code>income</code> is also highly significant. The problem is that the magnitude of the coefficient <span class="math inline">\(\hat{b}_{\text{education}}\)</span> is more than 40,000 times that of the other coefficients, because education is measured years, while income is measured in dollars. The 95% confidence interval for <span class="math inline">\(\hat{b}_{\text{income}} = [0.0008, 0.0019]\)</span>, but this is invisible in the plot.</p>
<p>Before figuring out how to fix this issue, I show the comparable displays from <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> and <code><a href="https://modelsummary.com/man/modelplot.html">modelplot()</a></code> for all three models. When you give <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> a list of models, it displays their coefficients side-by-side as shown in <a href="#tbl-modelsummary2">Table&nbsp;<span>6.2</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Model1"</span> <span class="op">=</span> <span class="va">mod1</span>, <span class="st">"Model2"</span> <span class="op">=</span> <span class="va">mod2</span>, <span class="st">"Model3"</span> <span class="op">=</span> <span class="va">mod3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelsummary.html">modelsummary</a></span><span class="op">(</span><span class="va">models</span>,</span>
<span>     coef_omit <span class="op">=</span> <span class="st">"Intercept"</span>,</span>
<span>     fmt <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     stars <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     shape <span class="op">=</span> <span class="va">term</span> <span class="op">~</span> <span class="va">statistic</span>,</span>
<span>     statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"std.error"</span>, <span class="st">"p.value"</span><span class="op">)</span>,</span>
<span>     gof_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rmse"</span>, <span class="st">"r.squared"</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummary2" class="anchored">

 

  
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tinytable_7mkfusq9jhf7km1wrur8</title>
<style>
.table td.tinytable_css_wg5biwarqfdmi6wne75x, .table th.tinytable_css_wg5biwarqfdmi6wne75x {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_wtqqggptqich92rk9wac, .table th.tinytable_css_wtqqggptqich92rk9wac {    text-align: center; }
.table td.tinytable_css_6zd4jmi219ryng9omcqg, .table th.tinytable_css_6zd4jmi219ryng9omcqg {    border-bottom: solid 0.05em #d3d8dc; }
.table td.tinytable_css_y799xaj1uo9vzemnoaix, .table th.tinytable_css_y799xaj1uo9vzemnoaix {    text-align: left; }
.table td.tinytable_css_4im4kgy9rxl4nbepwrmd, .table th.tinytable_css_4im4kgy9rxl4nbepwrmd {    text-align: center; }
.table td.tinytable_css_bh6fb5i17nkworow5izk, .table th.tinytable_css_bh6fb5i17nkworow5izk {    text-align: center; }
.table td.tinytable_css_000epqhktawt9i57fg7a, .table th.tinytable_css_000epqhktawt9i57fg7a {    text-align: center; }
.table td.tinytable_css_euimo2rfkquw8qy4ra7k, .table th.tinytable_css_euimo2rfkquw8qy4ra7k {    text-align: center; }
.table td.tinytable_css_34nbrz1b0bu09u2g3oa9, .table th.tinytable_css_34nbrz1b0bu09u2g3oa9 {    text-align: center; }
.table td.tinytable_css_f6yukpsc37y8c4b3o92g, .table th.tinytable_css_f6yukpsc37y8c4b3o92g {    text-align: center; }
.table td.tinytable_css_pjjbjry2byujm9pu0yc4, .table th.tinytable_css_pjjbjry2byujm9pu0yc4 {    text-align: center; }
.table td.tinytable_css_dqqwv0vdwj22mw55dj78, .table th.tinytable_css_dqqwv0vdwj22mw55dj78 {    text-align: center; }
.table td.tinytable_css_zze6setfg0i7a9qr1p7t, .table th.tinytable_css_zze6setfg0i7a9qr1p7t {    text-align: center; }
.table td.tinytable_css_rfvm6b5tgmr0lkh0bysu, .table th.tinytable_css_rfvm6b5tgmr0lkh0bysu {    text-align: center; }
.table td.tinytable_css_0n201c5l6bs0cuyooean, .table th.tinytable_css_0n201c5l6bs0cuyooean {    border-bottom: solid 0.05em black; }
    </style>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script><div class="container">
      <table class="table table-borderless" id="tinytable_7mkfusq9jhf7km1wrur8" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<caption>Table&nbsp;6.2:  <p>Table of coefficients for three models.</p> </caption>
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Model1</th>
<th scope="col" align="center" colspan="3">Model2</th>
<th scope="col" align="center" colspan="3">Model3</th>
</tr>
<tr>
<th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">S.E.</th>
                <th scope="col">p</th>
                <th scope="col">Est.</th>
                <th scope="col">S.E.</th>
                <th scope="col">p</th>
                <th scope="col">Est.</th>
                <th scope="col">S.E.</th>
                <th scope="col">p</th>
              </tr>
</thead>
<tfoot><tr><td colspan="10">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
<tbody>
<tr>
<td>education        </td>
                  <td>4.19***</td>
                  <td>0.39</td>
                  <td>&lt;0.01</td>
                  <td>3.66***</td>
                  <td>0.65</td>
                  <td>&lt;0.01</td>
                  <td>2.80*** </td>
                  <td>0.59</td>
                  <td>&lt;0.01</td>
                </tr>
<tr>
<td>income           </td>
                  <td>0.00***</td>
                  <td>0.00</td>
                  <td>&lt;0.01</td>
                  <td>0.00***</td>
                  <td>0.00</td>
                  <td>&lt;0.01</td>
                  <td>0.00*** </td>
                  <td>0.00</td>
                  <td>&lt;0.01</td>
                </tr>
<tr>
<td>women            </td>
                  <td>-0.01  </td>
                  <td>0.03</td>
                  <td>0.77 </td>
                  <td>0.01   </td>
                  <td>0.03</td>
                  <td>0.83 </td>
                  <td>0.08*   </td>
                  <td>0.03</td>
                  <td>0.02 </td>
                </tr>
<tr>
<td>typeprof         </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>5.91   </td>
                  <td>3.94</td>
                  <td>0.14 </td>
                  <td>27.55***</td>
                  <td>5.41</td>
                  <td>&lt;0.01</td>
                </tr>
<tr>
<td>typewc           </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>-2.92  </td>
                  <td>2.67</td>
                  <td>0.28 </td>
                  <td>3.43    </td>
                  <td>5.37</td>
                  <td>0.52 </td>
                </tr>
<tr>
<td>income × typeprof</td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>0.00*** </td>
                  <td>0.00</td>
                  <td>&lt;0.01</td>
                </tr>
<tr>
<td>income × typewc  </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>       </td>
                  <td>    </td>
                  <td>     </td>
                  <td>0.00    </td>
                  <td>0.00</td>
                  <td>0.21 </td>
                </tr>
<tr>
<td>RMSE             </td>
                  <td>7.69   </td>
                  <td>    </td>
                  <td>     </td>
                  <td>6.91   </td>
                  <td>    </td>
                  <td>     </td>
                  <td>6.02    </td>
                  <td>    </td>
                  <td>     </td>
                </tr>
<tr>
<td>R2               </td>
                  <td>0.798  </td>
                  <td>    </td>
                  <td>     </td>
                  <td>0.835  </td>
                  <td>    </td>
                  <td>     </td>
                  <td>0.875   </td>
                  <td>    </td>
                  <td>     </td>
                </tr>
</tbody>
</table>
</div>

    <script>
      function styleCell_tinytable_99icm0xmzb5g0jpi2iju(i, j, css_id) {
        var table = document.getElementById("tinytable_7mkfusq9jhf7km1wrur8");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_7mkfusq9jhf7km1wrur8');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_99icm0xmzb5g0jpi2iju(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_7mkfusq9jhf7km1wrur8");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 0, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 1, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 2, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 3, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 4, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 5, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 6, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 7, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 8, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 9, 'tinytable_css_wg5biwarqfdmi6wne75x') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 0, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 1, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 2, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 3, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 4, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 5, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 6, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 7, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 8, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 9, 'tinytable_css_wtqqggptqich92rk9wac') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 1, 'tinytable_css_6zd4jmi219ryng9omcqg') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 2, 'tinytable_css_6zd4jmi219ryng9omcqg') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 3, 'tinytable_css_6zd4jmi219ryng9omcqg') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 0, 'tinytable_css_y799xaj1uo9vzemnoaix') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 1, 'tinytable_css_4im4kgy9rxl4nbepwrmd') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 2, 'tinytable_css_bh6fb5i17nkworow5izk') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 3, 'tinytable_css_000epqhktawt9i57fg7a') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 4, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 5, 'tinytable_css_34nbrz1b0bu09u2g3oa9') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 6, 'tinytable_css_f6yukpsc37y8c4b3o92g') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 7, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 8, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(1, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(2, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(3, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(4, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(5, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(6, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(7, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(9, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(10, 9, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 0, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 1, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 2, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 3, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 4, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 5, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 6, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 7, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 8, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(0, 9, 'tinytable_css_rfvm6b5tgmr0lkh0bysu') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 0, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 1, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 2, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 3, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 4, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 5, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 6, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 7, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 8, 'tinytable_css_0n201c5l6bs0cuyooean') })
window.addEventListener('load', function () { styleCell_tinytable_99icm0xmzb5g0jpi2iju(8, 9, 'tinytable_css_0n201c5l6bs0cuyooean') })
    </script>
</div>
</div>
</div>
<p>Note that a factor predictor (like <code>type</code> here) with <span class="math inline">\(d\)</span> levels is represented by <span class="math inline">\(d-1\)</span> coefficients in main effects and in interactions with quantitative variables. These levels are coded with <em>treatment contrasts</em> by default. Also by default, the first level is set as the reference level in alphabetical order. Here the reference level is blue collar (<code>bc</code>), so the coefficient <code>typeprof = 5.91</code> indicates that professional occupations on average are rated 5.91 greater on the Prestige scale than blue collar workers.</p>
<p>Note also that unlike the table, the coefficients in <a href="#fig-modelplot1">Figure&nbsp;<span>6.3</span></a> are ordered from bottom to top, because the Y axis starts at the lower left corner. In <a href="#fig-modelplot2">Figure&nbsp;<span>6.4</span></a> I use <code><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete()</a></code> to reverse the order. It is also useful to add a vertical reference line at <span class="math inline">\(\beta = 0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html">modelplot</a></span><span class="op">(</span><span class="va">models</span>, </span>
<span>          coef_omit<span class="op">=</span><span class="st">"Intercept"</span>, </span>
<span>          size<span class="op">=</span><span class="fl">1.3</span>, linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Raw coefficients"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">rev</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-modelplot2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-modelplot2-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.4: Plot of raw coefficients and their confidence intervals for all three models</figcaption></figure>
</div>
</div>
</div>
</section><section id="more-useful-coefficient-plots" class="level3" data-number="6.3.3"><h3 data-number="6.3.3" class="anchored" data-anchor-id="more-useful-coefficient-plots">
<span class="header-section-number">6.3.3</span> More useful coefficient plots</h3>
<p>The problem with plots of raw coefficients shown in <a href="#fig-modelplot1">Figure&nbsp;<span>6.3</span></a> and <a href="#fig-modelplot2">Figure&nbsp;<span>6.4</span></a> is that the coefficients for different predictors are not directly comparable because they are measured in different units.</p>
<p>One alternative is to plot the <em>standardized coefficients</em>. Another way is to re-scale the predictors into more comparable and meaningful units. I illustrate these ideas below.</p>
<section id="standardized-coefficients" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="standardized-coefficients">Standardized coefficients</h4>
<p>The simplest way to do this is to transform all variables to standardized (<span class="math inline">\(z\)</span>) scores. The coefficients are then interpreted as the standardized change in prestige for a one standard deviation change in the predictors. The syntax below uses <code>scale</code> to transform all the numeric variables. Then, we re-fit the models using the standardized data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Prestige_std</span> <span class="op">&lt;-</span> <span class="va">Prestige</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">scale</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod1_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span>, </span>
<span>               data<span class="op">=</span><span class="va">Prestige_std</span><span class="op">)</span></span>
<span><span class="va">mod2_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">type</span>, </span>
<span>               data<span class="op">=</span><span class="va">Prestige_std</span><span class="op">)</span></span>
<span><span class="va">mod3_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span> <span class="op">+</span> <span class="va">income</span> <span class="op">*</span> <span class="va">type</span>, </span>
<span>               data<span class="op">=</span><span class="va">Prestige_std</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plot in <a href="#fig-modelplot3">Figure&nbsp;<span>6.5</span></a> now shows the significant effect of income in all three models. As well, it offers a more sensitive comparison of the coefficients of other terms across models; for example <code>women</code> is not significant in models 1 and 2, but becomes significant in Model 3 when the interaction of <code>income * type</code> is included.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Model1"</span> <span class="op">=</span> <span class="va">mod1_std</span>, <span class="st">"Model2"</span> <span class="op">=</span> <span class="va">mod2_std</span>, <span class="st">"Model3"</span> <span class="op">=</span> <span class="va">mod3_std</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html">modelplot</a></span><span class="op">(</span><span class="va">models</span>, </span>
<span>          coef_omit<span class="op">=</span><span class="st">"Intercept"</span>, size<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Standardized coefficients"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">rev</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-modelplot3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-modelplot3-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.5: Plot of standardized coefficients and their confidence intervals for all three models</figcaption></figure>
</div>
</div>
</div>
<p>It turns out there is an easier way to get plots of standardized coefficients. <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> extracts coefficients from model objects using the <code>parameters</code> package, and that package offers several options for standardization: See <a href="https://easystats.github.io/parameters/reference/model_parameters.default.html">model parameters documentation</a>. We can pass the <code>standardize="refit"</code> (or other) argument directly to <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary()</a></code> or <code><a href="https://modelsummary.com/man/modelplot.html">modelplot()</a></code>, and that argument will be forwarded to <code>parameters</code>. The plot produced by the code below is identical to <a href="#fig-modelplot3">Figure&nbsp;<span>6.5</span></a> and is not shown.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html">modelplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"mod1"</span> <span class="op">=</span> <span class="va">mod1</span>, <span class="st">"mod2"</span> <span class="op">=</span> <span class="va">mod2</span>, <span class="st">"mod3"</span> <span class="op">=</span> <span class="va">mod3</span><span class="op">)</span>,</span>
<span>          standardize <span class="op">=</span> <span class="st">"refit"</span>,</span>
<span>          coef_omit<span class="op">=</span><span class="st">"Intercept"</span>, size<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Standardized coefficients"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">rev</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <strong>ggstats</strong> package (<span class="citation" data-cites="R-ggstats">Larmarange (<a href="90-references.html#ref-R-ggstats" role="doc-biblioref">2024</a>)</span>) package provides even nicer versions of coefficient plots that handle factors in a more reasonable way, as levels within the factor. <code><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_model()</a></code> plots a single model and <code><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_compare()</a></code> plots a list of models using sensible defaults. A small but nice feature is that it explicitly shows the 0 value for the reference level of a factor (<code>type = "bc"</code> here) and uses better labels for factors and their interactions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Base model"</span>      <span class="op">=</span> <span class="va">mod1_std</span>,</span>
<span>  <span class="st">"Add type"</span>        <span class="op">=</span> <span class="va">mod2_std</span>,</span>
<span>  <span class="st">"Add interaction"</span> <span class="op">=</span> <span class="va">mod3_std</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_compare</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Standarized Coefficient"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ggcoef-compare" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-ggcoef-compare-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.6: Model comparison plot from <code><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_compare()</a></code></figcaption></figure>
</div>
</div>
</div>
</section><section id="more-meaningful-units" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="more-meaningful-units">More meaningful units</h4>
<p>Standardizing the variables makes the coefficients directly comparable, but it may be harder to understand what they mean in terms of the variables. For example, the coefficient of <code>income</code> in <code>mod2_std</code> is 0.25. A literal interpretation is that occupational prestige is expected to increase 0.25 standard deviations for each standard deviation increase in income, but it may be difficult to appreciate what this means.</p>
<p>A better substantive comparison of the coefficients could use understandable scales for the predictors, e.g., months of education, $100,000 of income or 10% of women’s participation. Note that the effect of this is just to multiply the coefficients and their standard errors by a factor. The statistical conclusions of significance are unchanged.</p>
<p>For simplicity, I do this just for Model 1.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Prestige_scaled</span> <span class="op">&lt;-</span> <span class="va">Prestige</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="va">education</span>,</span>
<span>         income <span class="op">=</span> <span class="va">income</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span>         women <span class="op">=</span> <span class="va">women</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod1_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>                  data<span class="op">=</span><span class="va">Prestige_scaled</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we plot this with <code><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_model()</a></code>, there are many options to control how variables are labeled and other details.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://larmarange.github.io/ggstats/reference/ggcoef_model.html">ggcoef_model</a></span><span class="op">(</span><span class="va">mod1_scaled</span>,</span>
<span>  signif_stars <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  variable_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>education <span class="op">=</span> <span class="st">"education\n(months)"</span>,</span>
<span>                      income <span class="op">=</span> <span class="st">"income\n(/$100K)"</span>,</span>
<span>                      women <span class="op">=</span> <span class="st">"women\n(/10%)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Coefficients for prestige with scaled predictors"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ggcoef-compare2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-ggcoef-compare2-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.7: Plot of coefficients for prestige with scaled predictors for Model 1.</figcaption></figure>
</div>
</div>
</div>
<p>So, on average, each additional month of education increases the prestige rating by 0.34 units, while an additional $100,000 of income increases it by 0.13 units. While these are significant effects, they are not large in relation to the scale of <code>prestige</code> which ranges 14.8 – 87.2.</p>
</section></section></section><section id="spread-level-plot" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="spread-level-plot">
<span class="header-section-number">6.4</span> Spread-level plot</h2>
</section><section id="sec-avplots" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="sec-avplots">
<span class="header-section-number">6.5</span> Added-variable plots</h2>
<p>In multiple regression problems, it is most often useful to construct a scatterplot matrix and examine the plot of the response vs.&nbsp;each of the predictors as well as those of the predictors against each other. However, the simple, <em>marginal</em> scatterplots of a response <span class="math inline">\(y\)</span> against <em>each</em> of several predictors <span class="math inline">\(x_1, x_2, \dots\)</span> can be misleading because each one ignores the other predictors.</p>
<p>To see this consider a toy dataset, <code>coffee</code>, giving measures of coffee consumption, occupational stress and an index of heart problems in a sample of <span class="math inline">\(n=20\)</span> graduate students and professors.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"coffee.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Heart</span> <span class="op">+</span> <span class="va">Coffee</span> <span class="op">+</span> <span class="va">Stress</span>, </span>
<span>  data<span class="op">=</span><span class="va">coffee</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels<span class="op">=</span><span class="fl">0.68</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>, cex.labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-coffee-spm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-coffee-spm-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.8: Scatterplot matrix showing pairwise relations among <code>Heart</code> (<span class="math inline">\(y\)</span>), <code>Coffee</code> consumption (<span class="math inline">\(x_1\)</span>) and <code>Stress</code> (<span class="math inline">\(x_2\)</span>), with linear regression lines and 68% data ellipses for the bivariate relations</figcaption></figure>
</div>
</div>
</div>
<p>The message from these marginal plots in <a href="#fig-coffee-spm">Figure&nbsp;<span>6.8</span></a> seems to be that coffee is bad for your heart, stress is bad for your heart, and stress is also strongly related to coffee consumption. Yet, when we fit a model with both variables together, we get the following results:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit.both</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Heart</span> <span class="op">~</span> <span class="va">Coffee</span> <span class="op">+</span> <span class="va">Stress</span>, data<span class="op">=</span><span class="va">coffee</span><span class="op">)</span></span>
<span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">fit.both</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; t test of coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   -7.794      5.793   -1.35     0.20    </span></span>
<span><span class="co">#&gt; Coffee        -0.409      0.292   -1.40     0.18    </span></span>
<span><span class="co">#&gt; Stress         1.199      0.224    5.34  5.4e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The coefficients suggest that stress is indeed bad for your heart, but the negative (though non-significant) coefficient for coffee suggests that coffee is good for you.How can this be? Does that mean I should drink more coffee, while avoiding stress?</p>
<p>The reason for this apparent paradox is that the general linear model fit by <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> estimates all effects together and so the coefficients pertain to the <em>partial</em> effect of a given predictor, <em>adjusting</em> for the effects of all others. That is, the coefficient for coffee (<span class="math inline">\(\beta_1 = -0.41\)</span>) estimates the effect of coffee for people with <em>same</em> level of stress. In the marginal scatterplot, the positive slope for coffee (1.10) ignores the correlation of coffee and stress.</p>
<p>A solution to this problem is the <em>added-variable</em> plot (“AV plot”, also called <em>partial regression</em> plot, MostellerTukey-1977). <span class="citation" data-cites="LarsenMcCleary:72">Larsen &amp; McCleary (<a href="90-references.html#ref-LarsenMcCleary:72" role="doc-biblioref">1972</a>)</span>; <span class="citation" data-cites="Cook:93">Cook (<a href="90-references.html#ref-Cook:93" role="doc-biblioref">1993</a>)</span>). This is a multivariate analog of a a simple marginal scatterplot, designed to visualize directly the partial relation between <span class="math inline">\(y\)</span> and the predictors <span class="math inline">\(x_1, x_2, \dots\)</span> in a multiple regression model. You can think of this as a magic window that hides the relations of all other variables with each of the <span class="math inline">\(y\)</span> and <span class="math inline">\(x_i\)</span> shown in a given added-variable plot, giving an unobstructed view of the net relation between <span class="math inline">\(y\)</span> and <span class="math inline">\(x_i\)</span> with the effect of all other variables removed. In effect, it reduces the problem of viewing the complete model in <span class="math inline">\(p\)</span>-dimensional space to a sequence of <span class="math inline">\(p\)</span> 2D plots, each of which tells the story of one predictor, unentangled with the others.</p>
<p>The construction of an AV plot is conceptually very simple. For variable <span class="math inline">\(x_i\)</span>, imagine that we fit two supplementary regressions:</p>
<ul>
<li><p>Regress <span class="math inline">\(\mathbf{y}\)</span> on <span class="math inline">\(\mathbf{X_{(-i)}}\)</span>, the model matrix of all of the regressors except <span class="math inline">\(x_i\)</span>. By definition, the residuals from this regression, <span class="math inline">\(\mathbf{y}^\star \equiv \mathbf{y} \,\vert\, \text{others} = \mathbf{y} - \widehat{\mathbf{y}} \,\vert\, \mathbf{X_{(-i)}}\)</span>, <!-- $r_y(x_i) = y - \widehat{y}_{\mathbf{X_{(-i)}}} \equiv y \,\vert\, \text{others}$, --> are the part of <span class="math inline">\(\mathbf{y}\)</span> that cannot be explained by all the other regression terms. These residuals are necessarily uncorrelated with the other predictors.</p></li>
<li><p>Regress <span class="math inline">\(x_i\)</span> on the other predictors, <span class="math inline">\(\mathbf{X_{(-i)}}\)</span> and again obtain the residuals. These residuals, <span class="math inline">\(\mathbf{x}_i^\star \equiv \mathbf{x}_i \,\vert\, \text{others} = \mathbf{x}_i - \widehat{\mathbf{x}}_i \,\vert\, \mathbf{X_{(-i)}}\)</span> give the part of <span class="math inline">\(x_i\)</span> that cannot be explained by the others, and so are uncorrelated with them.</p></li>
</ul>
<p>The AV plot is then just a simple scatterplot of these residuals, <span class="math inline">\(\mathbf{y}^\star\)</span> on the vertical axis, and <span class="math inline">\(\mathbf{x}^\star\)</span> on the horizontal. In practice, it is unnecessary to run the auxilliary regressions this way <span class="citation" data-cites="VellemanWelsh:81">(<a href="90-references.html#ref-VellemanWelsh:81" role="doc-biblioref">Velleman &amp; Welsh, 1981</a>)</span>. Both can be calculated using <code><a href="https://rdrr.io/r/stats/lsfit.html">stats::lsfit()</a></code> roughly as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">AVcalc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">variable</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.extract.html">model.response</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="va">variable</span><span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="va">variable</span><span class="op">]</span>, <span class="va">response</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lsfit.html">lsfit</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">resids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">resids</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that <code>y</code> here contains both the current predictor, <span class="math inline">\(\mathbf{x}_i\)</span> and the response <span class="math inline">\(\mathbf{y}\)</span>, so the residuals <code>resids</code> have two columns, one for <span class="math inline">\(x_i \,\vert\, \text{others}\)</span> and one for <span class="math inline">\(y \,\vert\, \text{others}\)</span>.</p>
<p>Added-variable plots are produced using <code><a href="https://rdrr.io/pkg/car/man/avPlots.html">car::avPlot()</a></code> (for one predictor) or <code><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlots()</a></code> for any number of model terms. The <code>id</code> argument controls which points are identified in the plots; <code>n=2</code> labels the two points that are furthest from the mean on the horizontal axis <em>and</em> the two with the largest absolute residuals. For instance, in <a href="#fig-coffee-avPlots">Figure&nbsp;<span>6.9</span></a>, observations 5 and 13 are flagged because their conditional <span class="math inline">\(\mathbf{x}_i^\star\)</span> values are extreme; observation 17 has a large absolute residual, <span class="math inline">\(\mathbf{y}^\star = \text{Heart} \,\vert\, \text{others}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlots</a></span><span class="op">(</span><span class="va">fit.both</span>,</span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span>, fill<span class="op">=</span><span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Added-variable plots for Coffee data"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-coffee-avPlots" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-coffee-avPlots-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.9: Added-variable plots for Coffee and Stress in the multiple regression model</figcaption></figure>
</div>
</div>
</div>
<p>The data ellipses for <span class="math inline">\(\mathbf{x}_i^\star\)</span> and <span class="math inline">\(\mathbf{y}^\star\)</span> summarize the conditional (or partial) relations of the response to each predictor controlling for all other predictors in each plot. The essential idea is that the data ellipse for <span class="math inline">\((\mathbf{x}_i^\star, \mathbf{y}^\star)\)</span> has the identical relation to the estimate <span class="math inline">\(\hat{b}_i\)</span> in a multiple regression as the data ellipse of <span class="math inline">\((\mathbf{x}, \mathbf{y})\)</span> has to the3 slope in a simple regression.</p>
<section id="properties-of-av-plots" class="level3" data-number="6.5.1"><h3 data-number="6.5.1" class="anchored" data-anchor-id="properties-of-av-plots">
<span class="header-section-number">6.5.1</span> Properties of AV plots</h3>
<p>AV plots are particularly interesting and useful for the following noteworthy properties:</p>
<ul>
<li><p>The slope of the simple regression in the AV plot for variable <span class="math inline">\(x_i\)</span> is identical to the slope <span class="math inline">\(b_i\)</span> for that variable in the full multiple regression model.</p></li>
<li><p>The residuals in this plot are the same as the residuals using all predictors. This means you can see the degree of fit for observations directly in relation to the various predictors, which is not the case for marginal scatterplots.</p></li>
<li><p>Consequentially, the standard deviation of the (vertical) residuals in the AV plot is the same as <span class="math inline">\(s = \sqrt(MSE)\)</span> in the full model and the standard error of a coefficient is <span class="math inline">\(\text{SE}(b_i) = s / \sqrt{\Sigma (\mathbf{x}_i^\star)^2}\)</span>. This is shown by the size of the shadow of the data ellipses on the vertical axis in <a href="#fig-coffee-avPlots">Figure&nbsp;<span>6.9</span></a>.</p></li>
<li><p>The horizontal positions, <span class="math inline">\(\mathbf{x}_i^\star\)</span>, of points adjust for all other predictors, and so we can see points at the extreme left and right as unusual in relation to the others. If these points are also badly fitted (large residuals), we can see their influence on the fitted relation in the full model. AV plots thus provide visual displays of (partial) <em>leverage</em> and <em>influence</em> on each of the regression coefficients.</p></li>
<li><p>The correlation of <span class="math inline">\(\mathbf{x}_i^\star\)</span> and <span class="math inline">\(\mathbf{y}^\star\)</span> shown by the shape of the data ellipses is the <em>partial correlation</em> between <span class="math inline">\(\mathbf{x}_i\)</span> and <span class="math inline">\(\mathbf{y}_i\)</span> with other predictors partialled out.</p></li>
</ul></section><section id="marginal---conditional-plots" class="level3" data-number="6.5.2"><h3 data-number="6.5.2" class="anchored" data-anchor-id="marginal---conditional-plots">
<span class="header-section-number">6.5.2</span> Marginal - conditional plots</h3>
<p>The relation of the <em>conditional</em> data ellipses in AV plots to those in <em>marginal</em> plots of the same variables provides further insight into what it means to “control for” other variables. <a href="#fig-coffee-mcplot">Figure&nbsp;<span>6.10</span></a> shows the same added-variable plots for Heart disease on Stress and Coffee as in <a href="#fig-coffee-avPlots">Figure&nbsp;<span>6.9</span></a> (with a zoomed-out scaling), but here we also overlay the marginal data ellipses for <span class="math inline">\((\mathbf{x}_i, \mathbf{y})\)</span> (centered at the means), and marginal regression lines for Stress and Coffee separately. Drawing arrows connecting the original data points to their positions in the AV plot shows what happens when we condition on or partial out the other variable.</p>
<p>These <em>marginal - conditional plots</em> are produced by <code><a href="https://rdrr.io/pkg/car/man/mcPlots.html">car::mcPlot()</a></code> (for one regressor) and <code><a href="https://rdrr.io/pkg/car/man/mcPlots.html">car::mcPlots()</a></code> (for several). The plots for the marginal and conditional relations can be compared separately using the same scales for both, or overlaid as shown here. The points labeled here are only those with large absolute residuals <span class="math inline">\(\mathbf{y}^\star\)</span> in the vertical direction.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/mcPlots.html">mcPlots</a></span><span class="op">(</span><span class="va">fit.both</span>, </span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels<span class="op">=</span><span class="fl">0.68</span>, fill<span class="op">=</span><span class="cn">TRUE</span>, fill.alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>  col.marginal <span class="op">=</span> <span class="st">"red"</span>, col.conditional <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  col.arrows <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-coffee-mcplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-coffee-mcplot-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.10: Marginal <span class="math inline">\(+\)</span> conditional (added-variable) plots for Coffee and Stress in the multiple regression predicting Heart disease. Each panel shows the 68% conditional data ellipse for <span class="math inline">\(x_i^\star, y^\star\)</span> residuals (shaded, blue) as well as the marginal 68% data ellipse for the <span class="math inline">\((x_i, y)\)</span> variables, shifted to the origin. Arrows connect the mean-centered marginal points (red) to the residual points (blue).</figcaption></figure>
</div>
</div>
</div>
<p>The most obvious feature of <a href="#fig-coffee-mcplot">Figure&nbsp;<span>6.10</span></a> is that Coffee has a negative slope in the conditional AV plot but a positive slope in the marginal plot. This is an example of Simpson’s paradox in a regression context: marginal and conditional relations can have opposite signs. </p>
<p>Less obvious is the relation between the marginal and AVP ellipses. In 3D, the marginal data ellipse is the shadow of the ellipsoid for <span class="math inline">\((\mathbf{y}, \mathbf{x}_1, \mathbf{x}_2)\)</span> on one of the coordinate planes, while the AV plot is a slice through the ellipsoid where either <span class="math inline">\(\mathbf{x}_1\)</span> or <span class="math inline">\(\mathbf{x}_2\)</span> is held constant. Thus, the AVP ellipse must be contained in the marginal ellipse, as we can see in <a href="#fig-coffee-mcplot">Figure&nbsp;<span>6.10</span></a>. If there are only two <span class="math inline">\(x\)</span>s, then the AVP ellipse must touch the marginal ellipse at two points.</p>
<p>Finally, <a href="#fig-coffee-mcplot">Figure&nbsp;<span>6.10</span></a> also shows how conditioning on other predictors works for individual observations, where each point of <span class="math inline">\((\mathbf{x}_i^\star, \mathbf{y}^\star)\)</span> is the image of <span class="math inline">\((\mathbf{x}_i, \mathbf{y})\)</span> along the path of the marginal regression. The variability in the response and in the focal predictor are both reduced, leaving only the uncontaminated relation of <span class="math inline">\(\mathbf{y}\)</span> with <span class="math inline">\(\mathbf{x}_i\)</span>.</p>
<p>These plots are similar in spirit to the ARES plot (“Adding REgressors Smoothly”) proposed by <span class="citation" data-cites="CookWeisberg-1994">Cook &amp; Weisberg (<a href="90-references.html#ref-CookWeisberg-1994" role="doc-biblioref">1994</a>)</span>, but their idea was an interactive animation, displaying a smooth transition between the fit of a marginal model and the fit of a larger model. They used linear interpolation controlled by a slider, whose value, <span class="math inline">\(\lambda \in [0, 1]\)</span>, was the weight given to the smaller marginal model.</p>
</section><section id="prestige-data" class="level3" data-number="6.5.3"><h3 data-number="6.5.3" class="anchored" data-anchor-id="prestige-data">
<span class="header-section-number">6.5.3</span> Prestige data</h3>
<p>For a substantive example, let’s return to the model for income, education and women in the <code>Prestige</code> data. The plot in <a href="#fig-prestige-avplot">Figure&nbsp;<span>6.11</span></a> shows the strong positive relations of income and education to prestige in the full model, and the negligible relation of percent women. But, in the plot for income, two occupations (physicians and general managers) with high income strongly pull the regression line down from what can be seen in the orientation of the conditional data ellipse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>           data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlots</a></span><span class="op">(</span><span class="va">mod1</span>, </span>
<span>  ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Added-variable plots for prestige"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-avplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-prestige-avplot-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.11: Added-variable plot for the quantitative predictors in the <code>Prestige</code> data.</figcaption></figure>
</div>
</div>
</div>
<p>The influential points for physicians and general managers could just be unusual, or suggest that the relation of income to prestige is nonlinear. A rough test of this is to fit a smoothed curve through the points in the AV plot as shown in <a href="#fig-prestige-av-income">Figure&nbsp;<span>6.12</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/avPlots.html">avPlot</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="st">"income"</span>,</span>
<span>              ellipse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">0.68</span><span class="op">)</span>,</span>
<span>              pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>              cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">res</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">smooth</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-av-income" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-prestige-av-income-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.12: Added-variable plot for income, with a loess smooth.</figcaption></figure>
</div>
</div>
</div>
<p>However, this use of AV plots to diagnose nonlinearity or suggest transformations can be misleading <span class="citation" data-cites="Cook-1996">(<a href="90-references.html#ref-Cook-1996" role="doc-biblioref">Cook, 1996</a>)</span>. Curvature in these plots is an indication of some model deficiency, but unless the predictors are uncorrelated, cannot determine the form of a possible transformation of the predictors.</p>
</section><section id="component-residual-plots" class="level3" data-number="6.5.4"><h3 data-number="6.5.4" class="anchored" data-anchor-id="component-residual-plots">
<span class="header-section-number">6.5.4</span> Component + Residual plots</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/crPlots.html">crPlot</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="st">"income"</span>,</span>
<span>       smooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       order <span class="op">=</span> <span class="fl">2</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>       col.lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>       id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>       cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co">#&gt;         newsboys          farmers general.managers       physicians </span></span>
<span><span class="co">#&gt;               53               67                2               24</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prestige-crplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-prestige-crplot-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.13: Component + residual plot for income…</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="marginal-effect-plots" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="marginal-effect-plots">
<span class="header-section-number">6.6</span> Marginal effect plots</h2>
<!-- ## Outliers, leverage influence -->
</section><section id="sec-leverage" class="level2" data-number="6.7"><h2 data-number="6.7" class="anchored" data-anchor-id="sec-leverage">
<span class="header-section-number">6.7</span> Outliers, leverage and influence</h2>
<p>In small to moderate samples, “unusual” observations can have dramatic effects on a fitted regression model, as we saw in the analysis of Davis’s data on reported and measured weight (<a href="02-getting_started.html#sec-davis"><span>Section&nbsp;2.1.2</span></a>) where one erroneous observations hugely altered the fitted line.</p>
<p>An observation can be unusual in three archetypal ways, with different consequences:</p>
<ul>
<li><p>Unusual in the response <span class="math inline">\(y\)</span>, but typical in the predictor(s), <span class="math inline">\(\mathbf{x}\)</span> — a badly fitted case with a large absolute residual, but with <span class="math inline">\(x\)</span> not far from the mean, as in <a href="02-getting_started.html#fig-ch02-davis-reg2">Figure&nbsp;<span>2.4</span></a>. This case does not do much harm to the fitted model.</p></li>
<li><p>Unusual in the predictor(s) <span class="math inline">\(\mathbf{x}\)</span>, but typical in <span class="math inline">\(y\)</span> — an otherwise well-fitted point. This case also does litle harm, and in fact can be considered to improve precision, a “good leverage” point.</p></li>
<li><p>Unusual in <strong>both</strong> <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(y\)</span> — This is the case, a “bad leverage” point, revealed in the analysis of Davis’s data, <a href="02-getting_started.html#fig-ch02-davis-reg1">Figure&nbsp;<span>2.3</span></a>, where the one erroneous point for women was highly influential, pulling the regression line towards it and affecting the estimated coefficient as well as all the fitted values.</p></li>
</ul>
<p>Influential cases are the ones that matter most. As suggested above, to be influential an observation must be unusual in <strong>both</strong> <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(y\)</span>, and affects the estimated coefficients, thereby also altering the predicted values for all observations. A heuristic formula capturing the relations among leverage, “outlyingness” on <span class="math inline">\(y\)</span> and influence is</p>
<p><span class="math display">\[
\text{Influence}_{\text{coefficients}} \;=\; X_\text{leverage} \;\times\; Y_\text{residual}
\]</span> As described below, leverage is proportional to the squared distance <span class="math inline">\((x_i - \bar{x})^2\)</span> of an observation <span class="math inline">\(x_i\)</span> from its mean in simple regression and to the squared Mahalanobis distance in the general case. The <span class="math inline">\(Y_\text{residual}\)</span> is best measured by a <em>studentized</em> residual, obtained by omitting each case <span class="math inline">\(i\)</span> in turn and calculating its residual from the coefficients obtained from the remaining cases.</p>
<section id="the-leverage-influence-quartet" class="level3" data-number="6.7.1"><h3 data-number="6.7.1" class="anchored" data-anchor-id="the-leverage-influence-quartet">
<span class="header-section-number">6.7.1</span> The leverage-influence quartet</h3>
<p>These ideas can be illustrated in the “leverage-influence quartet” by considering a standard simple linear regression for a sample and then adding one additional point reflecting the three situations described above. Below, I generate a sample of <span class="math inline">\(N = 15\)</span> points with <span class="math inline">\(x\)</span> uniformly distributed between (40, 60) and <span class="math inline">\(y \sim 10 + 0.75 x + \mathcal{N}(0, 1.25^2)\)</span>, duplicated four times.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">case_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OK"</span>, <span class="st">"Outlier"</span>, <span class="st">"Leverage"</span>, <span class="st">"Influence"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">levdemo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">case_labels</span>, </span>
<span>               each <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">40</span> <span class="op">+</span> <span class="fl">20</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">.75</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">1.25</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="st">" "</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">levdemo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)           x </span></span>
<span><span class="co">#&gt;      13.332       0.697</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The additional points, one for each situation are set to the values below.</p>
<ul>
<li>
<code>Outlier</code>: (52, 60) a low leverage point, but an outlier (<code>O</code>) with a large residual</li>
<li>
<code>Leverage</code>: (75, 65) a “good” high leverage point (<code>L</code>) that fits well with the regression line</li>
<li>
<code>Influence</code>: (70, 40) a “bad” high leverage point (<code>OL</code>) with a large residual.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  case <span class="op">=</span> <span class="va">case_labels</span>,</span>
<span>  x  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">52</span>, <span class="fl">75</span>, <span class="fl">70</span><span class="op">)</span>,</span>
<span>  y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">65</span>, <span class="fl">65</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"  "</span>, <span class="st">"O"</span>, <span class="st">"L"</span>, <span class="st">"OL"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Join these to the data</span></span>
<span><span class="va">both</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">levdemo</span>, <span class="va">extra</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">case</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plot these four situations with <code>ggplot2</code> in panels faceted by <code>case</code> as shown below. The standard version of this plot shows the regression line for the <span style="color: blue;">original data</span> and that for the <span style="color: red;">ammended data</span> with the additional point. Note that we use the <code>levdemo</code> dataset in <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> for the regression line with the original data, but specify <code>data = both</code> for that with the additional point.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">levdemo</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">both</span>, </span>
<span>              method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1.3</span>, linetype <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"longdash"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">both</span>, level <span class="op">=</span> <span class="fl">0.5</span>, color<span class="op">=</span><span class="st">"blue"</span>, type<span class="op">=</span><span class="st">"norm"</span>, linewidth <span class="op">=</span> <span class="fl">1.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">extra</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">extra</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">case</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-levdemo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-levdemo-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.14: Leverage influence quartet with data 50% ellipses. Case (1) original data; (2) adding one low-leverage outlier, “O”; (3) adding one “good” leverage point, “L”; (4) adding one “bad” leverage point, “OL”. The dashed line is the fitted line for the original data, while the solid line reflects the additional point. The data ellipses show the effect of the additional point on precision.</figcaption></figure>
</div>
</div>
</div>
<p>The standard version of this graph shows only the fitted regression lines in each panel. As can be seen, the fitted line doesn’t change very much in panels (2) and (3); only the bad leverage point, “OL” in panel (4) is harmful. Adding data ellipses to each panel immediately makes it clear that there is another part to this story— the effect of the unusual point on <em>precision</em> (standard errors) of our estimates of the coefficients.</p>
<p>Now, we see <em>directly</em> that there is a big difference in impact between the low-leverage outlier [panel (2)] and the high-leverage, small-residual case [panel (3)], even though their effect on coefficient estimates is negligible. In panel (2), the single outlier inflates the estimate of residual variance (the size of the vertical slice of the data ellipse at <span class="math inline">\(\bar{x}\)</span>), while in panel (3) this is decreased.</p>
<p>To allow direct comparison and make the added value of the data ellipse more apparent, we overlay the data ellipses from <a href="#fig-levdemo">Figure&nbsp;<span>6.14</span></a> in a single graph, shown in <a href="#fig-levdemo2">Figure&nbsp;<span>6.15</span></a>.<br>
Here, we can also see why the high-leverage point “L” <a href="#fig-levdemo">added in panel (c) of&nbsp;<span>6.14</span></a> is called a “good leverage” point. By increasing the standard deviation of <span class="math inline">\(x\)</span>, it makes the data ellipse somewhat more elongated, giving increased precision of our estimates of <span class="math inline">\(\mathbf{\beta}\)</span>.</p>
<div class="cell" data-layout-align="center">
<details><summary>Code</summary><div class="sourceCode" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">both</span>,</span>
<span>     <span class="op">{</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">case</span>, </span>
<span>          levels <span class="op">=</span> <span class="fl">0.68</span>,</span>
<span>          plot.points <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          center.pch <span class="op">=</span> <span class="st">"+"</span>,</span>
<span>          col <span class="op">=</span> <span class="va">colors</span>,</span>
<span>          fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>     <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">case1</span> <span class="op">&lt;-</span> <span class="va">both</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">case</span> <span class="op">==</span> <span class="st">"1 OK"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">case1</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, cex<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">extra</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>       col <span class="op">=</span> <span class="va">colors</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">extra</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>     labels <span class="op">=</span> <span class="va">extra</span><span class="op">$</span><span class="va">id</span>,</span>
<span>     col <span class="op">=</span> <span class="va">colors</span>, pos <span class="op">=</span> <span class="fl">2</span>, offset <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-levdemo2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-levdemo2-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.15: Data ellipses in the Leverage-influence quartet. This graph overlays the data ellipses and additional points from the four panels of <a href="#fig-levdemo2">Figure&nbsp;<span>6.15</span></a>. It can be seen that only the OL point affects the slope, while the O and L points affect precision of the estimates in opposite directions.</figcaption></figure>
</div>
</div>
</div>
</section><section id="measuring-leverage" class="level3" data-number="6.7.2"><h3 data-number="6.7.2" class="anchored" data-anchor-id="measuring-leverage">
<span class="header-section-number">6.7.2</span> Measuring leverage</h3>
<p>Leverage is thus an index of the <em>potential</em> impact of an observation on the model due to its’ atypical value in the X space of the predictor(s). It is commonly measured by the “hat” value, <span class="math inline">\(h_i\)</span>, so called because it puts the hat <span class="math inline">\(\hat{(\bullet)}\)</span> on <span class="math inline">\(\mathbf{y}\)</span>, i.e., the vector of fitted values can be expressed as</p>
<p><span class="math display">\[\begin{eqnarray*}
\hat{\mathbf{y}} &amp; = &amp; \mathbf{H} \mathbf{y} \\
                 &amp; = &amp; [\mathbf{X} (\mathbf{X}^\textsf{T} \mathbf{X})^{-1} \mathbf{X}^\textsf{T}] \; \mathbf{y} \; ,
\end{eqnarray*}\]</span></p>
<p>where <span class="math inline">\(h_i \equiv h_{ii}\)</span> are the diagonal elements of the Hat matrix <span class="math inline">\(\mathbf{H}\)</span>. In simple regression, hat values are proportional to the squared distance of the observation <span class="math inline">\(x_i\)</span> from the mean, <span class="math inline">\(h_i \propto (x_i - \bar{x})^2\)</span>, <span class="math display">\[
h_i = \frac{1}{n} + \frac{(x_i - \bar{x})^2}{\Sigma_i (x_i - \bar{x})^2} \; ,
\]</span> and range from <span class="math inline">\(1/n\)</span> to 1, with an average value <span class="math inline">\(\bar{h} = 2/n\)</span>. Consequently, observations with <span class="math inline">\(h_i\)</span> greater than <span class="math inline">\(2 \bar{h}\)</span> or <span class="math inline">\(3 \bar{h}\)</span> are commonly considered to be of high leverage.</p>
<p>With <span class="math inline">\(p \ge 2\)</span> predictors, it is demonstrated below that <span class="math inline">\(h_i \propto D^2 (\mathbf{x} - \bar{\mathbf{x}})\)</span>, the squared distance of <span class="math inline">\(\mathbf{x}\)</span> from the centroid <span class="math inline">\(\bar{\mathbf{x}}\)</span>[^1]. [^1]: See <a href="https://bit.ly/45x2T0Q">this Stats StackExchange discussion</a> for a proof. The analogous formula is</p>
<p><span class="math display">\[
h_i = \frac{1}{n} + \frac{1}{n-1} D^2 (\mathbf{x} - \bar{\mathbf{x}}) \; ,
\]</span></p>
<p>where <span class="math inline">\(D^2 (\mathbf{x} - \bar{\mathbf{x}}) = (\mathbf{x} - \bar{\mathbf{x}})^\textsf{T} \mathbf{S}_X^{-1} (\mathbf{x} - \bar{\mathbf{x}})\)</span>. From <a href="03-multivariate_plots.html#sec-data-ellipse"><span>Section&nbsp;3.2</span></a>, it follows that contours of constant leverage correspond to data ellipses or ellipsoids of the predictors in <span class="math inline">\(\mathbf{x}\)</span>, whose boundaries, assuming normality, correspond to quantiles of the <span class="math inline">\(\chi^2_p\)</span> distribution</p>
<p><strong>Example</strong>:</p>
<p>To illustrate, I generate <span class="math inline">\(N = 100\)</span> points from a bivariate normal distribution with means <span class="math inline">\(\mu = (30, 30)\)</span>, variances = 10, and a correlation <span class="math inline">\(\rho = 0.7\)</span> and add two noteworthy points that show an apparently paradoxical result.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">421</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,   <span class="fl">10</span><span class="op">*</span><span class="va">r</span>,</span>
<span>                <span class="fl">10</span><span class="op">*</span><span class="va">r</span>, <span class="fl">10</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">mu</span>, <span class="va">cov</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add 2 points</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">X</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">38</span><span class="op">)</span>,</span>
<span>                      x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Mahalanobis squared distances of these points can be calculated using <code><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">heplots::Mahalanobis()</a></code>, and their corresponding hatvalues found using <code><a href="https://rdrr.io/r/stats/influence.measures.html">hatvalues()</a></code> for any linear model using both <code>x1</code> and <code>x2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Dsq <span class="op">=</span> <span class="fu">heplots</span><span class="fu">::</span><span class="fu"><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">Mahalanobis</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">x2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hatvalues</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting <code>x1</code> and <code>x2</code> with data ellipses shows the relation of leverage to squared distance from the mean. The <span style="color: blue;">blue</span> point looks to be farther from the <span style="color: green;">mean</span>, but the <span style="color: red;">red</span> point is actually very much further by Mahalanobis squared distance, which takes the correlation into account; it thus has much greater leverage.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x1</span>, <span class="va">X</span><span class="op">$</span><span class="va">x2</span>, </span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.40</span>, <span class="fl">0.68</span>, <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>            xlab <span class="op">=</span> <span class="st">"X1"</span>, ylab <span class="op">=</span> <span class="st">"X2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">N</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">16</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span>      <span class="co"># last two rows</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hatvalues-demo1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-hatvalues-demo1-1.png" class="img-fluid figure-img" width="2100"></p>
<figcaption class="figure-caption">Figure&nbsp;6.16: Data ellipses for a bivariate normal sample with correlation 0.7, and two additional noteworthy points. The blue point looks to be farther from the mean, but the red point is actually more than 5 times further by Mahalanobis squared distance, and thus has much greater leverage.</figcaption></figure>
</div>
</div>
</div>
<p>The fact that hatvalues are proportional to leverage can be seen by plotting one against the other. I highlight the two noteworthy points in their colors from <a href="#fig-hatvalues-demo1">Figure&nbsp;<span>6.16</span></a> to illustrate how much greater leverage the <span style="color: red;">red</span> point has compared to the <span style="color: blue;">blue</span> point.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hat</span> <span class="op">~</span> <span class="va">Dsq</span>, data <span class="op">=</span> <span class="va">X</span>,</span>
<span>     cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="va">N</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Hatvalue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Mahalanobis Dsq"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hatvalues-demo2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/ch06/fig-hatvalues-demo2-1.png" class="img-fluid figure-img" width="2100"></p>
<figcaption class="figure-caption">Figure&nbsp;6.17: Hat values are proportional to squared Mahalanobis distances from the mean.</figcaption></figure>
</div>
</div>
</div>
<p>Look back at these two points in <a href="#fig-hatvalues-demo1">Figure&nbsp;<span>6.16</span></a>. Can you guess how much further the <span style="color: red;">red</span> point is from the mean than the <span style="color: blue;">blue</span> point? You might be surprised that its’ <span class="math inline">\(D^2\)</span> and leverage are about five times as great!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x1 x2   Dsq   y    hat</span></span>
<span><span class="co">#&gt; 1 28 42 25.65 179 0.2638</span></span>
<span><span class="co">#&gt; 2 38 35  4.95 175 0.0588</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="outliers-measuring-residuals" class="level3" data-number="6.7.3"><h3 data-number="6.7.3" class="anchored" data-anchor-id="outliers-measuring-residuals">
<span class="header-section-number">6.7.3</span> Outliers: Measuring residuals</h3>
<p>From the discussion in <a href="#sec-leverage"><span>Section&nbsp;6.7</span></a>, outliers for the response <span class="math inline">\(y\)</span> are those observations for which the residual <span class="math inline">\(e_i = y_i - \hat{y}_i\)</span> are unusually large in magnitude. However, as demonstrated in <a href="#fig-levdemo">Figure&nbsp;<span>6.14</span></a>, a high-leverage point will pull the fitted line towards it, reducing its’ residual and thus making them look less unusual.</p>
<p>The standard approach <span class="citation" data-cites="CookWeisberg:82 HoaglinWelsch1978">(<a href="90-references.html#ref-CookWeisberg:82" role="doc-biblioref">Cook &amp; Weisberg, 1982</a>; <a href="90-references.html#ref-HoaglinWelsch1978" role="doc-biblioref">Hoaglin &amp; Welsch, 1978</a>)</span> is to consider a <em>deleted residual</em> <span class="math inline">\(e_{(-i)}\)</span>, conceptually as that obtained by re-fitting the model with observation <span class="math inline">\(i\)</span> omitted and obtaining the fitted value <span class="math inline">\(\hat{y}_{(-i)}\)</span> from the remaining <span class="math inline">\(n-1\)</span> observations, <span class="math display">\[
e_{(-i)} = y_i - \hat{y}_{(-i)} \; .
\]</span> The (externally) <em>studentized residual</em> is then obtained by dividing <span class="math inline">\(e_{(-i)}\)</span> by it’s estimated standard error, giving <span class="math display">\[
e^\star_{(-i)} = \frac{e_{(-i)}}{\text{sd}(e_{(-i)})} = \frac{e_i}{\sqrt{\text{MSE}_{(-i)}\; (1 - h_i)}} \; .
\]</span></p>
<p>This is just the ordinary residual <span class="math inline">\(e_i\)</span> divided by a factor that increases with the residual variance but decreases with leverage. It can be shown that these studentized residuals follow a <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(n - p -2\)</span> degrees of freedom, so a value <span class="math inline">\(|e^\star_{(-i)}| &gt; 2\)</span> can be considered large enough to pay attention to.<br>
In practice for classical linear models, it is unnecessary to actually re-fit the model <span class="math inline">\(n\)</span> times …</p>
</section><section id="measuring-influence" class="level3" data-number="6.7.4"><h3 data-number="6.7.4" class="anchored" data-anchor-id="measuring-influence">
<span class="header-section-number">6.7.4</span> Measuring influence</h3>
<p>As described at the start of this section, the actual influence of a given case depends multiplicatively on its’ leverage and residual. But how can we measure it?</p>
<p>The essential idea introduced above, is to delete the observations one at a time, each time refitting the regression model on the remaining <span class="math inline">\(n–1\)</span> observations. Then, for observation <span class="math inline">\(i\)</span> compare the results using all <span class="math inline">\(n\)</span> observations to those with the <span class="math inline">\(i^{th}\)</span> observation deleted to see how much influence the observation has on the analysis.</p>
<p>The simplest such measure, called DFFITS, compares the predicted value for case <span class="math inline">\(i\)</span> with what would be obtained when that observation is excluded.</p>
<p><span class="math display">\[\begin{eqnarray*}
\text{DFFITS}_i &amp; = &amp; \frac{\hat{y}_i - \hat{y}_{(-i)}}{\sqrt{\text{MSE}_{(-i)}\; h_i}} \\
   &amp; = &amp; e^\star_{(-i)} \times \sqrt{\frac{h_i}{1-h_i}} \;\; .
\end{eqnarray*}\]</span></p>
<p>The first equation gives the signed difference in fitted values in units of the standard deviation of that difference weighted by leverage; the second version <span class="citation" data-cites="Belsley-etal:80">(<a href="90-references.html#ref-Belsley-etal:80" role="doc-biblioref">Belsley et al., 1980</a>)</span> represents that as a product of residual and leverage. A rule of thumb is that an observation is deemed to be influential if <span class="math inline">\(| \text{DFFITS}_i | &gt; 2 \sqrt{(p+1) / n}\)</span>.</p>
<div class="cell" data-layout-align="center">
<pre data-code-line-numbers=""><code>#&gt; Writing packages to  C:/R/Projects/Vis-MLM-book/bib/pkgs.txt
#&gt; 26  packages used here:
#&gt;  bayestestR, car, carData, correlation, datawizard, dplyr, easystats, effectsize, forcats, ggplot2, ggstats, insight, knitr, lubridate, modelbased, modelsummary, parameters, performance, purrr, readr, report, see, stringr, tibble, tidyr, tidyverse</code></pre>
</div>
<!-- ## References {.unnumbered} -->


<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-R-modelsummary" class="csl-entry" role="listitem">
Arel-Bundock, V. (2024). <em>Modelsummary: Summary tables and plots for statistical models and data: Beautiful, customizable, and publication-ready</em>. <a href="https://modelsummary.com">https://modelsummary.com</a>
</div>
<div id="ref-Belsley-etal:80" class="csl-entry" role="listitem">
Belsley, D. A., Kuh, E., &amp; Welsch, R. E. (1980). <em>Regression diagnostics: Identifying influential data and sources of collinearity</em>. John Wiley; Sons.
</div>
<div id="ref-Blishen-etal-1987" class="csl-entry" role="listitem">
Blishen, B., Carroll, W., &amp; Moore, C. (1987). The 1981 socioeconomic index for occupations in canada. <em>Canadian Review of Sociology/Revue Canadienne de Sociologie</em>, <em>24</em>(4), 465–488. <a href="https://doi.org/10.1111/j.1755-618x.1987.tb00639.x">https://doi.org/10.1111/j.1755-618x.1987.tb00639.x</a>
</div>
<div id="ref-Cook:93" class="csl-entry" role="listitem">
Cook, R. D. (1993). Exploring partial residual plots. <em>Technometrics</em>, <em>35</em>(4), 351–362.
</div>
<div id="ref-Cook-1996" class="csl-entry" role="listitem">
Cook, R. D. (1996). Added-variable plots and curvature in linear regression. <em>Technometrics</em>, <em>38</em>(3), 275–278. <a href="https://doi.org/10.1080/00401706.1996.10484507">https://doi.org/10.1080/00401706.1996.10484507</a>
</div>
<div id="ref-CookWeisberg:82" class="csl-entry" role="listitem">
Cook, R. D., &amp; Weisberg, S. (1982). <em>Residuals and influence in regression</em>. Chapman; Hall.
</div>
<div id="ref-CookWeisberg-1994" class="csl-entry" role="listitem">
Cook, R. D., &amp; Weisberg, S. (1994). ARES plots for generalized linear models. <em>Computational Statistics &amp; Data Analysis</em>, <em>17</em>(3), 303–315. <a href="https://doi.org/10.1016/0167-9473(92)00075-3">https://doi.org/10.1016/0167-9473(92)00075-3</a>
</div>
<div id="ref-Duncan:61" class="csl-entry" role="listitem">
Duncan, O. D. (1961). A socioeconomic index for all occupations. In Jr. A. J. Reiss, P. K. H. O. D. Duncan, &amp; C. C. North (Eds.), <em>Occupations and social status</em>. The Free Press.
</div>
<div id="ref-Fox2020" class="csl-entry" role="listitem">
Fox, J. (2020). <em>Regression diagnostics</em> (2nd ed.). <span>SAGE</span> Publications, Inc. <a href="https://doi.org/10.4135/9781071878651">https://doi.org/10.4135/9781071878651</a>
</div>
<div id="ref-FoxWeisberg:2018" class="csl-entry" role="listitem">
Fox, J., &amp; Weisberg, S. (2018). <em>An r companion to applied regression</em> (Third). SAGE Publications. <a href="https://books.google.ca/books?id=uPNrDwAAQBAJ">https://books.google.ca/books?id=uPNrDwAAQBAJ</a>
</div>
<div id="ref-R-car" class="csl-entry" role="listitem">
Fox, J., Weisberg, S., &amp; Price, B. (2023). <em>Car: Companion to applied regression</em>. <a href="https://CRAN.R-project.org/package=car">https://CRAN.R-project.org/package=car</a>
</div>
<div id="ref-HoaglinWelsch1978" class="csl-entry" role="listitem">
Hoaglin, D. C., &amp; Welsch, R. E. (1978). The hat matrix in regression and <span>ANOVA</span>. <em>The American Statistician</em>, <em>32</em>(1), 17–22. <a href="https://doi.org/10.1080/00031305.1978.10479237">https://doi.org/10.1080/00031305.1978.10479237</a>
</div>
<div id="ref-KastellecLeoni:2007" class="csl-entry" role="listitem">
Kastellec, J. P., &amp; Leoni, E. L. (2007). Using graphs instead of tables in political science. <em>Perspectives on Politics</em>, <em>5</em>(04), 755–771. <a href="https://doi.org/10.1017/S1537592707072209">https://doi.org/10.1017/S1537592707072209</a>
</div>
<div id="ref-R-ggstats" class="csl-entry" role="listitem">
Larmarange, J. (2024). <em>Ggstats: Extension to ggplot2 for plotting stats</em>. <a href="https://larmarange.github.io/ggstats/">https://larmarange.github.io/ggstats/</a>
</div>
<div id="ref-LarsenMcCleary:72" class="csl-entry" role="listitem">
Larsen, W. A., &amp; McCleary, S. J. (1972). The use of partial residual plots in regression analysis. <em>Technometrics</em>, <em>14</em>, 781–790.
</div>
<div id="ref-Ludecke-etal-performance" class="csl-entry" role="listitem">
Lüdecke, D., Ben-Shachar, M. S., Patil, I., Waggoner, P., &amp; Makowski, D. (2021). <span class="nocase">performance</span>: An <span>R</span> package for assessment, comparison and testing of statistical models. <em>Journal of Open Source Software</em>, <em>6</em>(60), 3139. <a href="https://doi.org/10.21105/joss.03139">https://doi.org/10.21105/joss.03139</a>
</div>
<div id="ref-R-easystats" class="csl-entry" role="listitem">
Lüdecke, D., Ben-Shachar, M. S., Patil, I., Wiernik, B. M., &amp; Makowski, D. (2022). Easystats: Framework for easy statistical modeling, visualization, and reporting. In <em>CRAN</em>. <a href="https://easystats.github.io/easystats/">https://easystats.github.io/easystats/</a>
</div>
<div id="ref-Pineo-Porter-1967" class="csl-entry" role="listitem">
Pineo, P. O., &amp; Porter, J. (1967). Occupational prestige in canada*. <em>Canadian Review of Sociology</em>, <em>4</em>(1), 24–40. https://doi.org/<a href="https://doi.org/10.1111/j.1755-618X.1967.tb00472.x">https://doi.org/10.1111/j.1755-618X.1967.tb00472.x</a>
</div>
<div id="ref-VellemanWelsh:81" class="csl-entry" role="listitem">
Velleman, P. F., &amp; Welsh, R. E. (1981). Efficient computing of regression diagnostics. <em>The American Statistician</em>, <em>35</em>(4), 234–242.
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>The dataset was collected by Bernard Blishen, William Carroll and Catherine Moore, but apparently unpublished. A version updated to the 1981 census is described in <span class="citation" data-cites="Blishen-etal-1987">Blishen et al. (<a href="90-references.html#ref-Blishen-etal-1987" role="doc-biblioref">1987</a>)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./05-linear_models.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-lin-mod-topics.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>