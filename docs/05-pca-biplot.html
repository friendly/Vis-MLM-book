<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>5&nbsp; Dimension Reduction – Visualizing Multivariate Data and Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-linear_models.html" rel="next">
<link href="./04-multivariate_plots.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-54ba0423ea0ae7481c4c4fc8775fd264.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-multivariate_plots.html">Exploratory Methods</a></li><li class="breadcrumb-item"><a href="./05-pca-biplot.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-multivariate_plots.html">Exploratory Methods</a></li><li class="breadcrumb-item"><a href="./05-pca-biplot.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></a></li></ol></nav>
      <h1 class="title"><span id="sec-pca-biplot" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-Author.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Author</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Orienting Ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Prelude.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Warm-up Exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Exploratory Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-pca-biplot.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Univariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Plots for Univariate Response Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Multivariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-infl-robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multiviate Influence and Robust Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Case Studies</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">End Matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./95-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-discrim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Discriminant analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-spaceland" id="toc-sec-spaceland" class="nav-link active" data-scroll-target="#sec-spaceland"><span class="header-section-number">5.1</span> <em>Flatland</em> and <em>Spaceland</em></a>
  <ul class="collapse">
<li><a href="#multivariate-juicers" id="toc-multivariate-juicers" class="nav-link" data-scroll-target="#multivariate-juicers"><span class="header-section-number">5.1.1</span> Multivariate juicers</a></li>
  </ul>
</li>
  <li>
<a href="#sec-pca" id="toc-sec-pca" class="nav-link" data-scroll-target="#sec-pca"><span class="header-section-number">5.2</span> Principal components analysis (PCA)</a>
  <ul class="collapse">
<li><a href="#pca-by-springs" id="toc-pca-by-springs" class="nav-link" data-scroll-target="#pca-by-springs"><span class="header-section-number">5.2.1</span> PCA by springs</a></li>
  <li><a href="#mathematics-and-geometry-of-pca" id="toc-mathematics-and-geometry-of-pca" class="nav-link" data-scroll-target="#mathematics-and-geometry-of-pca"><span class="header-section-number">5.2.2</span> Mathematics and geometry of PCA</a></li>
  <li><a href="#finding-principal-components" id="toc-finding-principal-components" class="nav-link" data-scroll-target="#finding-principal-components"><span class="header-section-number">5.2.3</span> Finding principal components</a></li>
  <li><a href="#visualizing-variance-proportions-screeplots" id="toc-visualizing-variance-proportions-screeplots" class="nav-link" data-scroll-target="#visualizing-variance-proportions-screeplots"><span class="header-section-number">5.2.4</span> Visualizing variance proportions: screeplots</a></li>
  <li><a href="#visualizing-pca-scores-and-variable-vectors" id="toc-visualizing-pca-scores-and-variable-vectors" class="nav-link" data-scroll-target="#visualizing-pca-scores-and-variable-vectors"><span class="header-section-number">5.2.5</span> Visualizing PCA scores and variable vectors</a></li>
  </ul>
</li>
  <li>
<a href="#sec-biplot" id="toc-sec-biplot" class="nav-link" data-scroll-target="#sec-biplot"><span class="header-section-number">5.3</span> Biplots</a>
  <ul class="collapse">
<li><a href="#sec-biplot-svd" id="toc-sec-biplot-svd" class="nav-link" data-scroll-target="#sec-biplot-svd"><span class="header-section-number">5.3.1</span> Constructing a biplot</a></li>
  <li><a href="#biplots-in-r" id="toc-biplots-in-r" class="nav-link" data-scroll-target="#biplots-in-r"><span class="header-section-number">5.3.2</span> Biplots in R</a></li>
  <li><a href="#example-crime-data-1" id="toc-example-crime-data-1" class="nav-link" data-scroll-target="#example-crime-data-1"><span class="header-section-number">5.3.3</span> Example: Crime data</a></li>
  <li><a href="#biplot-contributions-and-quality" id="toc-biplot-contributions-and-quality" class="nav-link" data-scroll-target="#biplot-contributions-and-quality"><span class="header-section-number">5.3.4</span> Biplot contributions and quality</a></li>
  <li><a href="#sec-supp-vars" id="toc-sec-supp-vars" class="nav-link" data-scroll-target="#sec-supp-vars"><span class="header-section-number">5.3.5</span> Supplementary variables</a></li>
  <li><a href="#example-diabetes-data" id="toc-example-diabetes-data" class="nav-link" data-scroll-target="#example-diabetes-data"><span class="header-section-number">5.3.6</span> Example: Diabetes data</a></li>
  </ul>
</li>
  <li>
<a href="#sec-nonlinear" id="toc-sec-nonlinear" class="nav-link" data-scroll-target="#sec-nonlinear"><span class="header-section-number">5.4</span> Nonlinear dimension reduction</a>
  <ul class="collapse">
<li><a href="#multidimensional-scaling" id="toc-multidimensional-scaling" class="nav-link" data-scroll-target="#multidimensional-scaling"><span class="header-section-number">5.4.1</span> Multidimensional scaling</a></li>
  <li><a href="#t-sne" id="toc-t-sne" class="nav-link" data-scroll-target="#t-sne"><span class="header-section-number">5.4.2</span> t-SNE</a></li>
  </ul>
</li>
  <li><a href="#sec-var-order" id="toc-sec-var-order" class="nav-link" data-scroll-target="#sec-var-order"><span class="header-section-number">5.5</span> Application: Variable ordering for data displays</a></li>
  <li><a href="#sec-eigenfaces" id="toc-sec-eigenfaces" class="nav-link" data-scroll-target="#sec-eigenfaces"><span class="header-section-number">5.6</span> Application: Eigenfaces</a></li>
  <li>
<a href="#sec-outlier-detection" id="toc-sec-outlier-detection" class="nav-link" data-scroll-target="#sec-outlier-detection"><span class="header-section-number">5.7</span> Elliptical insights: Outlier detection</a>
  <ul class="collapse">
<li><a href="#sec-dsq-penguin" id="toc-sec-dsq-penguin" class="nav-link" data-scroll-target="#sec-dsq-penguin"><span class="header-section-number">5.7.1</span> Example: Penguin data</a></li>
  </ul>
</li>
  <li><a href="#what-have-we-learned" id="toc-what-have-we-learned" class="nav-link" data-scroll-target="#what-have-we-learned"><span class="header-section-number">5.8</span> What have we learned?</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- \require{newcommand} --><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \providecommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- \newcommand*{\E}{\mathcal{E}} --><!-- Index generation --><!-- % R packages:  indexed under both package name and packages! --><!-- % data sets:  --><!-- % R stuff --><section id="sec-spaceland" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="sec-spaceland">
<span class="header-section-number">5.1</span> <em>Flatland</em> and <em>Spaceland</em>
</h2>
<blockquote class="blockquote">
<p><em>It is high time that I should pass from these brief and discursive notes about Flatland to the central event of this book, my initiation into the mysteries of Space. THAT is my subject; all that has gone before is merely preface</em> — Edwin Abbott, <em>Flatland</em>, p.&nbsp;57.</p>
</blockquote>
<p>There was a cloud in the sky above <em>Flatland</em> one day. But it was a huge, multidimensional cloud of sparkly points that might contain some important message, perhaps like the hidden EUREKA (<a href="01-Prelude.html#fig-pollen-eureka" class="quarto-xref">Figure&nbsp;<span>1.5</span></a>), or perhaps forecasting the upcoming harvest, if only Flatlanders could appreciate it.</p>
<p>A leading citizen, A SQUARE, who had traveled once to Spaceland and therefore had an inkling of its majesty beyond the simple world of his life in the plane looked at that cloud and had a brilliant thought, an OMG moment:</p>
<blockquote class="blockquote">
<p><em>Oh, can I, in my imagination, rotate that cloud and squeeze its juice so that it rains down on Flatland with greatest joy?</em>”</p>
</blockquote>
<p>As it happened, our Square friend, although he could never really <em>see</em> in three dimensions, he could now at least <em>think</em> of a world described by <strong>height</strong> as well as breadth and width, and think of the <strong>shadow</strong> cast by a cloud as something mutable, changing size and shape depending on its’ orientation over Flatland.</p>
<p>And what a world it was, inhabited by Pyramids, Cubes and wondrous creatures called Polyhedrons with many <span class="math inline">\(C\)</span>orners, <span class="math inline">\(F\)</span>aces and <span class="math inline">\(E\)</span>dges. Not only that, but all those Polyhedra were forced in Spaceland to obey a magic formula: <span class="math inline">\(C + F - E = 2\)</span>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> How cool was that!</p>
<p>Indeed, there were even exalted Spheres, having so many faces that its surface became as smooth as a baby’s bottom with no need for pointed corners or edges, just as Circles were the smoothest occupants of his world with far too many sides to count. It was his dream of a Sphere passing through Flatland (<a href="01-Prelude.html#fig-flatland-spheres" class="quarto-xref">Figure&nbsp;<span>1.1</span></a>) that first awakened him to a third dimension.</p>
<p>He also marveled at Ellipsoids, as smooth as Spheres, but in Spaceland having three natural axes of different extent and capable of being appearing fatter or slimmer when rotated from different views. An Ellipsoid had magical properties: it could appear as so thin in one or more dimensions that it became a simple 2D ellipse, or a 1D line, or even a 0D point <span class="citation" data-cites="Friendly-etal:ellipses:2013">(<a href="95-references.html#ref-Friendly-etal:ellipses:2013" role="doc-biblioref">Friendly et al., 2013</a>)</span>. <!-- **TODO**: somehow mention the `gellipsoid` package here. --></p>
<p>All of these now arose in Square’s richer 3D imagination. And, all of this came from just one more dimension than his life in Flatland.</p>
<section id="multivariate-juicers" class="level3" data-number="5.1.1"><h3 data-number="5.1.1" class="anchored" data-anchor-id="multivariate-juicers">
<span class="header-section-number">5.1.1</span> Multivariate juicers</h3>
<p>Up to now, we have also been living in Flatland. We have been trying to understand data in <strong>data space</strong> of possibly many dimensions, but confined to the 2D plane of a graph window. Scatterplot matrices and parallel coordinate plots provided some relief. The former did so by <strong>projecting</strong> the data into sets of 2D views in the coordinates of data space; the latter did so by providing multiple axes in a 2D space along which we could trace the paths of individual observations.</p>
<p>This chapter is about seeing data in a different projection—a low-dimensional (usually 2D) space—that squeezes out the most juice from multidimensional data for a particular purpose (<a href="#fig-MV-juicer" class="quarto-xref">Figure&nbsp;<span>5.1</span></a>), where what we want to understand can be more easily seen.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-MV-juicer" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-MV-juicer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/MV-juicer.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-MV-juicer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: A multivariate juicer takes data from possibly high-dimensional data space and transforms it to a lower-dimenional space in which important effects can be more easily seen.
</figcaption></figure>
</div>
</div>
</div>
<p>Here, I concentrate on <strong>principal components analysis</strong> (PCA), whose goal reflects A Square’s desire to see that sparkly cloud of points in <span class="math inline">\(nD\)</span> space in the plane showing the greatest variation (squeezing the most juice) among all other possible views. This appealed to his sense of geometry, but left him wondering how the variables in that high-D cloud were related to the dimensions he could see in a best-fitting plane. </p>
<p>The idea of a <strong>biplot</strong>, showing the data points in the plane, together with thick pointed arrows—variable vectors— in one view is the other topic explained in this chapter (<a href="#sec-biplot" class="quarto-xref"><span>Section 5.3</span></a>). The biplot is the simplest example of a multivariate juicer. The essential idea is to project the cloud of data points in <span class="math inline">\(n\)</span> dimensions into the 2D space of principal components and <em>simultaneously</em> show how the original variables relate to this space. For exploratory analysis to get an initial, incisive view of a multivariate dataset, a biplot is often my first choice. </p>
<div class="callout callout-style-default callout-note callout-titled" title="Looking ahead">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Looking ahead
</div>
</div>
<div class="callout-body-container callout-body">
<p>I’m using the term <em>multivariate juicer</em> here to refer the wider class of <strong>dimension reduction</strong> techniques, used for various purposes in data analysis and visualization. PCA is the simplest example and illustrates the general ideas.</p>
<p>The key point is that these methods are designed to transform the data into a low-dimensional space for a particular goal or purpose. In PCA, the goal is to extract the greatest amount of total variability in the data. In the context of univariate multiple regression, the goal is often to reduce the number of predictors necessary to account for an outcome variable, called <em>feature extraction</em> in the machine learning literature.</p>
<p>When the goal is to best distinguish among groups <strong>discriminant analysis</strong> finds uncorrelated weighted sums of predictors on which the means of groups are most widely separated in a reduced space of hopefully fewer dimensions.</p>
<p>The methods I cover in this book are all linear methods, but there is also a wide variety of non-linear dimension reduction techniques.</p>
</div>
</div>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/ggbiplot">ggbiplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://factominer.free.fr">FactoMineR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra">factoextra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/matlib">matlib</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-pca" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="sec-pca">
<span class="header-section-number">5.2</span> Principal components analysis (PCA)</h2>
<p>When Francis Galton <span class="citation" data-cites="Galton:1886">(<a href="95-references.html#ref-Galton:1886" role="doc-biblioref">1886</a>)</span> first discovered the idea of regression toward the mean and presented his famous diagram (<a href="04-multivariate_plots.html#fig-galton-corr" class="quarto-xref">Figure&nbsp;<span>4.10</span></a>), he had little thought that he had provided a window to a higher-dimensional world, beyond what even A Square could imagine. His friend, Karl Pearson <span class="citation" data-cites="Pearson:1896">(<a href="95-references.html#ref-Pearson:1896" role="doc-biblioref">1896</a>)</span> took that idea and developed it into a theory of regression and a measure of correlation that would bear his name, Pearson’s <span class="math inline">\(r\)</span>.</p>
<p>But then Pearson <span class="citation" data-cites="Pearson:1901">(<a href="95-references.html#ref-Pearson:1901" role="doc-biblioref">1901</a>)</span> had a further inspiration, akin to that of A Square. If he also had a cloud of sparkly points in <span class="math inline">\(2, 3, 4, ..., p\)</span> dimensions, could he find a point (<span class="math inline">\(0D\)</span>), or line (<span class="math inline">\(1D\)</span>), or plane (<span class="math inline">\(2D\)</span>), or even a hyperplane (<span class="math inline">\(nD\)</span>) that best summarized — squeezed out the most juice—from multivariate data? This was the first truly multivariate problem in the history of statistics <span class="citation" data-cites="FriendlyWainer:2021:TOGS">(<a href="95-references.html#ref-FriendlyWainer:2021:TOGS" role="doc-biblioref">Friendly &amp; Wainer, 2021, p. 186</a>)</span>.</p>
<p>The best <span class="math inline">\(0D\)</span> point was easy— it was simply the centroid, the means of each of the variables in the data, <span class="math inline">\((\bar{x}_1, \bar{x}_2, ..., \bar{x}_p)\)</span>, because that was “closest” to the data in the sense of minimizing the sum of squared differences, <span class="math inline">\(\Sigma_i\Sigma_j (x_{ij} - \bar{x}_j)^2\)</span>. In higher dimensions, his solution was also an application of the method of least squares, but he argued it geometrically and visually as shown in <a href="#fig-Pearson1901" class="quarto-xref">Figure&nbsp;<span>5.2</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-Pearson1901" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Pearson1901-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/Pearson1901.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Pearson1901-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.2: Karl Pearson’s (1901) geometric, visual argument for finding the line or plane of closest fit to a collection of points, P1, P2, P3, …
</figcaption></figure>
</div>
</div>
</div>
<p>For a <span class="math inline">\(1D\)</span> summary, the line of best fit to the points <span class="math inline">\(P_1, P_2, \dots P_n\)</span> is the line that goes through the centroid and made the average squared length of the <em>perpendicular</em> segments from those points to a line as small as possible. This was different from the case in linear regression, for fitting <span class="math inline">\(y\)</span> from <span class="math inline">\(x\)</span>, where the average squared length of the <em>vertical</em> segments, <span class="math inline">\(\Sigma_i (y_i - \hat{y}_i)^2\)</span> was minimized by least squares.</p>
<p>He went on to prove the visual insights from simple smoothing of <span class="citation" data-cites="Galton:1886">Galton (<a href="95-references.html#ref-Galton:1886" role="doc-biblioref">1886</a>)</span> (shown in <a href="04-multivariate_plots.html#fig-galton-corr" class="quarto-xref">Figure&nbsp;<span>4.10</span></a>) regarding the regression lines of <code>y ~ x</code> and <code>x ~ y</code>. More importantly, he proved that the cloud of points is captured, for the purpose of finding a best line, plane or hyperplane, by the ellipsoid that encloses it, as seen in his diagram, <a href="#fig-Pearson1901-2" class="quarto-xref">Figure&nbsp;<span>5.3</span></a>. The major axis of the 2D ellipse is the line of best fit, along which the data points have the smallest average squared distance from the line. The axis at right angles to that—the minor axis— is labeled “line of worst fit” with the largest average squared distance.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-Pearson1901-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Pearson1901-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/Pearson1901_2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Pearson1901-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.3: Karl Pearson’s diagram showing the elliptical geometry of regression and principal components analysis … <em>Source</em>: Pearson (1901), p.&nbsp;566.
</figcaption></figure>
</div>
</div>
</div>
<p>Even more importantly— and this is the basis for PCA — he recognized that the two orthogonal axes of the ellipse gave new coordinates for the data which were uncorrelated, whatever the correlation of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>.</p>
<blockquote class="blockquote">
<p><em>Physically, the axes of the correlation type-ellipse are the directions of independent and uncorrelated variation.</em> — <span class="citation" data-cites="Pearson:1901">Pearson (<a href="95-references.html#ref-Pearson:1901" role="doc-biblioref">1901</a>)</span>, p.&nbsp;566.</p>
</blockquote>
<p>It was but a small step to recognize that for two variables, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>:</p>
<ul>
<li>The line of best fit, the major axis (PC1) had the greatest variance of points projected onto it.</li>
<li>The line of worst fit, the minor axis (PC2), had the least variance.</li>
<li>These could be seen as a rotation of the data space of <span class="math inline">\((x, y)\)</span> to a new space (PC1, PC2) with uncorrelated variables.</li>
<li>The total variation of the points in data space, <span class="math inline">\(\text{Var}(x) + \text{Var}(y)\)</span>, being unchanged by rotation, was equally well expressed as the total variation <span class="math inline">\(\text{Var}(PC1) + \text{Var}(PC2)\)</span> of the scores on what are now called the principal component axes.</li>
</ul>
<p>It would have appealed to Pearson (and also to A Square) to see these observations demonstrated in a 3D video. <!-- @fig-pca-animation --> <a href="#fig-pca-animation-html" class="quarto-xref">Figure&nbsp;<span>5.4</span></a> shows a 3D plot of the variables <code>Sepal.Length</code>, <code>Sepal.Width</code> and <code>Petal.Length</code> in Edgar Anderson’s <code>iris</code> data, with points colored by species and the 95% data ellipsoid. This is rotated smoothly by interpolation until the first two principal axes, PC1 and PC2 are aligned with the horizontal and vertical dimensions. Because this is a rigid rotation of the cloud of points, the total variability is obviously unchanged.</p>
<!-- ::: {#fig-pca-animation} -->
<!-- <div align="center"> -->
<!-- <iframe width="946" height="594" src="images/pca-animation1.gif"></iframe> -->
<!-- </div> -->
<!-- Animation of PCA as a rotation in 3D space. The plot shows three variables for the `iris` data, initially -->
<!-- in data space and its' data ellipsoid, with points colored according to species of the iris flowers. This is rotated smoothly until the first two principal axes are aligned with the horizontal and vertical dimensions. -->
<!-- ::: -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-pca-animation-html" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pca-animation-html-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/pca-animation1.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pca-animation-html-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.4: Animation of PCA as a rotation in 3D space. The plot shows three variables for the <code>iris</code> data, initially in data space and its’ data ellipsoid, with points colored according to species of the iris flowers. This is rotated smoothly until the first two principal axes are aligned with the horizontal and vertical directions in the final frame.
</figcaption></figure>
</div>
</div>
</div>
<section id="pca-by-springs" class="level3" data-number="5.2.1"><h3 data-number="5.2.1" class="anchored" data-anchor-id="pca-by-springs">
<span class="header-section-number">5.2.1</span> PCA by springs</h3>
<p>Before delving into the mathematics of PCA, it is useful to see how Pearson’s problem, and fitting by least squares generally, could be solved in a physical realization.</p>
<p>From elementary statistics, you may be familiar with a physical demonstration that the mean, <span class="math inline">\(\bar{x}\)</span>, of a sample is the value for which the sum of deviations, <span class="math inline">\(\Sigma_i (x_i - \bar{x})\)</span> is zero, so the mean can be visualized as the point of balance on a line where those differences <span class="math inline">\((x_i - \bar{x})\)</span> are placed. Equally well, there is a physical realization of the mean as the point along an axis where weights connected by springs will minimize the sum of squared differences, because springs with a constant stiffness, <span class="math inline">\(k\)</span>, exert forces proportional to <span class="math inline">\(k (x_i - \bar{x}) ^2\)</span>. That’s the reason it is useful as a measure of central tendency: it minimizes the average squared error.</p>
<p>In two dimensions, imagine that we have points, <span class="math inline">\((x_i, y_i)\)</span> and these are attached by springs of equal stiffness <span class="math inline">\(k\)</span>, to a line anchored at the centroid, <span class="math inline">\((\bar{x}, \bar{y})\)</span> as shown in <a href="#fig-pca-springs" class="quarto-xref">Figure&nbsp;<span>5.5</span></a>. If we rotate the line to some initial position and release it, the springs will pull the line clockwise or counterclockwise and the line will bounce around until the forces, proportional to the squares of the lengths of the springs, will eventually balance out at the position (shown by the <span style="color: red;">red</span> fixed line segments at the ends). This is the position that minimizes the the sum of squared lengths of the connecting springs, and also minimizes the kinetic energy in the system.</p>
<p>If you look closely at <a href="#fig-pca-springs" class="quarto-xref">Figure&nbsp;<span>5.5</span></a> you will see something else: When the line is at its final position of minimum squared length and energy, the positions of the <span style="color: red;">red</span> points on this line are spread out furthest, i.e., have <strong>maximum</strong> variance. Conversely, when the line is at right angles to its final position (shown by the black line at 90<span class="math inline">\(^o\)</span>) the projected points have the smallest possible variance.</p>
<div id="fig-pca-springs" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pca-springs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div data-align="center">
<iframe width="412" height="364" src="images/pca-springs-cropped.gif">
</iframe>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pca-springs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.5: Animation of PCA fitted by springs. The <span style="color: blue;">blue</span> data points are connected to their projections on the <span style="color: red;">red</span> line by springs perpendicular to that line. From an initial position, the springs pull that line in proportion to their squared distances, until the line finally settles down to the position where the forces are balanced and the minimum is achieved. <em>Source</em>: Amoeba, <a href="https://bit.ly/46tAicu">https://bit.ly/46tAicu</a>.
</figcaption></figure>
</div>
<!-- See: https://joshualoftus.com/posts/2020-11-23-least-squares-as-springs/least-squares-as-springs.html -->
</section><section id="mathematics-and-geometry-of-pca" class="level3" data-number="5.2.2"><h3 data-number="5.2.2" class="anchored" data-anchor-id="mathematics-and-geometry-of-pca">
<span class="header-section-number">5.2.2</span> Mathematics and geometry of PCA</h3>
<p>As the ideas of principal components developed, there was a happy marriage of Galton’s geometrical intuition and Pearson’s mathematical analysis. The best men at the wedding were ellipses and higher-dimensional ellipsoids. The bridesmaids were eigenvectors, pointing in as many different directions as space would allow, each sized according to their associated eigenvalues. Attending the wedding were the ghosts of uncles, Leonhard Euler, Jean-Louis Lagrange, Augustin-Louis Cauchy and others who had earlier discovered the mathematical properties of ellipses and quadratic forms in relation to problems in physics.</p>
<p>The key idea in the statistical application was that, for a set of variables <span class="math inline">\(\mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_p\)</span>, the <span class="math inline">\(p \times p\)</span> covariance matrix <span class="math inline">\(\mathbf{S}\)</span> could be expressed <strong>exactly</strong> as a matrix product involving a matrix <span class="math inline">\(\mathbf{V}\)</span>, whose columns are <em>eigenvectors</em> (<span class="math inline">\(\mathbf{v}_i\)</span>) and a diagonal matrix <span class="math inline">\(\boldsymbol{\Lambda}\)</span>, whose diagonal elements (<span class="math inline">\(\lambda_i\)</span>) are the corresponding <em>eigenvalues</em>.</p>
<p>To explain this, it is helpful to use a bit of matrix math:</p>
<p><span id="eq-S-eigen"><span class="math display">\[
\begin{aligned}
\mathbf{S}_{p \times p} &amp; = \mathbf{V}_{p \times p} \phantom{0000000000}
                            \boldsymbol{\Lambda}_{p \times p} \phantom{00000000000000}
                            \mathbf{V}_{p \times p}^\mathsf{T} \\
           &amp; = \left( \mathbf{v}_1, \, \mathbf{v}_2, \,\dots, \, \mathbf{v}_p \right)
           \begin{pmatrix}
             \lambda_1 &amp;  &amp;  &amp; \\
             &amp; \lambda_2  &amp;   &amp; \\
             &amp;  &amp; \ddots &amp; \\
             &amp;  &amp;  &amp; \lambda_p
            \end{pmatrix}
            \;
            \begin{pmatrix}
            \mathbf{v}_1^\mathsf{T}\\
            \mathbf{v}_2^\mathsf{T}\\
            \vdots\\
            \mathbf{v}_p^\mathsf{T}\\
            \end{pmatrix}
           \\
           &amp; = \lambda_1 \mathbf{v}_1 \mathbf{v}_1^\mathsf{T} + \lambda_2 \mathbf{v}_2 \mathbf{v}_2^\mathsf{T} + \cdots + \lambda_p \mathbf{v}_p \mathbf{v}_p^\mathsf{T}
\end{aligned}
\tag{5.1}\]</span></span></p>
<p>In this equation,</p>
<ol type="1">
<li><p>The last line follows because <span class="math inline">\(\boldsymbol{\Lambda}\)</span> is a diagonal matrix, so <span class="math inline">\(\mathbf{S}\)</span> is expressed as a sum of outer products of each <span class="math inline">\(\mathbf{v}_i\)</span> with itself, times the eigenvalue <span class="math inline">\(\lambda_i\)</span>.</p></li>
<li><p>The columns of <span class="math inline">\(\mathbf{V}\)</span> are the eigenvectors of <span class="math inline">\(\mathbf{S}\)</span>. They are orthogonal and of unit length, so <span class="math inline">\(\mathbf{V}^\mathsf{T} \mathbf{V} = \mathbf{I}\)</span>. Thus they represent orthogonal (uncorrelated) directions in data space.</p></li>
<li><p>The column <span class="math inline">\(\mathbf{v}_i\)</span> gives the weights applied to the variables to produce the scores on the <span class="math inline">\(i\)</span>-th principal component _i$. For example, the first principal component is the weighted sum:</p></li>
</ol>
<p><span class="math display">\[
\text{PC}_1 = v_{11} \mathbf{x}_1 + v_{12} \mathbf{x}_2 + \cdots + v_{1p} \mathbf{x}_p \:\: .
\]</span></p>
<ol start="4" type="1">
<li><p>The matrix of <em>all</em> scores on the principal components can be calculated by multiplying the data matrix <span class="math inline">\(\mathbf{X}\)</span> by the eigenvectors, <span class="math inline">\(\mathbf{PC} = \mathbf{X} \mathbf{V}\)</span>.</p></li>
<li><p>The eigenvalues, <span class="math inline">\(\lambda_1, \lambda_2, \dots, \lambda_p\)</span> are the variances of the the components, because <span class="math inline">\(\mathbf{v}_i^\mathsf{T} \;\mathbf{S} \; \mathbf{v}_i = \lambda_i\)</span>.</p></li>
<li><p>It is usually the case that the variables <span class="math inline">\(\mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_p\)</span> are linearly independent, which means that none of these is an <em>exact</em> linear combination of the others. In this case, all eigenvalues <span class="math inline">\(\lambda_i\)</span> are positive and the covariance matrix <span class="math inline">\(\mathbf{S}\)</span> is said to have <strong>rank</strong> <span class="math inline">\(p\)</span>. (Rank is the number of non-zero eigenvalues.)</p></li>
<li><p>Here is a key fact: If, as usual, the eigenvalues are arranged in order, so that <span class="math inline">\(\lambda_1 &gt; \lambda_2 &gt; \dots &gt; \lambda_p\)</span>, then the first <span class="math inline">\(d\)</span> components give a <span class="math inline">\(d\)</span>-dimensional approximation to <span class="math inline">\(\mathbf{S}\)</span>. This approximation accounts for <span class="math inline">\(\Sigma_i^d \lambda_i\)</span> of the <span class="math inline">\(\Sigma_i^p \lambda_i\)</span> total variance, and is usually interpreted as the proportion, <span class="math inline">\((\Sigma_i^d \lambda_i) / (\Sigma_i^p \lambda_i)\)</span>.</p></li>
</ol>
<p>For the case of two variables, <span class="math inline">\(\mathbf{x}_1\)</span> and <span class="math inline">\(\mathbf{x}_2\)</span> <a href="#fig-pca-rotation" class="quarto-xref">Figure&nbsp;<span>5.6</span></a> shows the transformation from data space to component space. The eigenvectors, <span class="math inline">\(\mathbf{v}_1, \mathbf{v}_2\)</span> are the major and minor axes of the data ellipse, whose lengths are the square roots <span class="math inline">\(\sqrt{\lambda_1}, \sqrt{\lambda_2}\)</span> of the eigenvalues.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-pca-rotation" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pca-rotation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/pca-rotation.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pca-rotation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.6: Geometry of PCA as a rotation from data space to principal component space, defined by the eigenvectors v1 and v2 of a covariance matrix
</figcaption></figure>
</div>
</div>
</div>
<!-- #### Example: Workers' experience and income {#sec-workers-data-pca} -->
<div id="exm-workers-pca" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.1</strong></span> <strong>Workers’ experience and income</strong></p>
<p>For a small example, consider the relation between years of experience and income in a small (contrived) sample (<span class="math inline">\(n = 10\)</span>) of workers in a factory. The dataset <code>workers</code> contains these and other variables. In a wider context, we might want to fit a regression model to predict <code>Income</code>, but here we focus on a PCA of just these two variables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">workers</span>, package <span class="op">=</span> <span class="st">"matlib"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">workers</span><span class="op">)</span></span>
<span><span class="co">#         Income Experience Skill Gender</span></span>
<span><span class="co"># Abby        20          0     2 Female</span></span>
<span><span class="co"># Betty       35          5     5 Female</span></span>
<span><span class="co"># Charles     40          5     8   Male</span></span>
<span><span class="co"># Doreen      30         10     6 Female</span></span>
<span><span class="co"># Ethan       50         10    10   Male</span></span>
<span><span class="co"># Francie     50         15     7 Female</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s start with a simple scatterplot of <code>Income</code> vs.&nbsp;<code>Experience</code>, with points labeled by <code>Name</code> (and colored by <code>Gender</code>). There’s a fairly strong correlation (<span class="math inline">\(r\)</span> = 0.853). How does a PCA capture this?</p>
<!-- fig.code: R/workers-pca.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experience"</span>, <span class="st">"Income"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>     cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span>, </span>
<span>     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">workers</span><span class="op">)</span>,</span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">workers</span><span class="op">$</span><span class="va">Gender</span> <span class="op">==</span> <span class="st">"Female"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>     pos <span class="op">=</span> <span class="fl">3</span>, xpd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-workers-scat" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-workers-scat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-workers-scat-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-workers-scat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.7: Scatterplot of Income vs.&nbsp;Experience for the <code>workers</code> data.
</figcaption></figure>
</div>
</div>
</div>
<p>To carry out a PCA of these variables, first calculate the vector of means (<span class="math inline">\(\bar{\mathbf{x}}\)</span>) and covariance matrix <span class="math inline">\(\mathbf{S}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Experience     Income </span></span>
<span><span class="co">#       15.5       46.5</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#            Experience Income</span></span>
<span><span class="co"># Experience        136    152</span></span>
<span><span class="co"># Income            152    234</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The eigenvalues and eigenvectors of <code>S</code> are calculated by <code><a href="https://rdrr.io/r/base/eigen.html">eigen()</a></code>. This returns a list with components <code>values</code> for the <span class="math inline">\(\lambda_i\)</span> and <code>vectors</code> for <span class="math inline">\(\mathbf{V}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">S.eig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span>
<span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="va">S.eig</span><span class="op">$</span><span class="va">values</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] 344.3  25.1</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="va">S.eig</span><span class="op">$</span><span class="va">vectors</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#       [,1]   [,2]</span></span>
<span><span class="co"># [1,] 0.589 -0.808</span></span>
<span><span class="co"># [2,] 0.808  0.589</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From this, you can verify the points above regarding the relations between variances of the variables and the eigenvalues:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#total variances of the variables = sum of eigenvalues</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] 369</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Lambda</span><span class="op">)</span></span>
<span><span class="co"># [1] 369</span></span>
<span></span>
<span><span class="co"># percent of variance of each PC</span></span>
<span><span class="fl">100</span> <span class="op">*</span> <span class="va">Lambda</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Lambda</span><span class="op">)</span></span>
<span><span class="co"># [1] 93.2  6.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using these, you can express the eigenvalue decomposition of <span class="math inline">\(\mathbf{S}\)</span> in <a href="#eq-S-eigen" class="quarto-xref">Equation&nbsp;<span>5.1</span></a> with <code><a href="http://friendly.github.io/matlib/reference/latexMatrix.html">latexMatrix()</a></code> and <code><a href="http://friendly.github.io/matlib/reference/Eqn.html">Eqn()</a></code> from the <span style="color: brown;"><strong>matlib</strong></span> package <span class="citation" data-cites="R-matlib">(<a href="95-references.html#ref-R-matlib" role="doc-biblioref">Friendly et al., 2024</a>)</span> as:</p>
<!-- This works in HTML, but not in PDF
ERROR: 
compilation failed- error
Package amsmath Error: Erroneous nesting of equation structures;
(amsmath)                trying to recover with `aligned'.
-->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"\\small \\text{Exp}"</span>, </span>
<span>                                <span class="st">"\\small \\text{Inc}"</span><span class="op">)</span></span>
<span><span class="va">spacer</span> <span class="op">&lt;-</span> <span class="st">"\\phantom{00000000000000}"</span></span>
<span><span class="fu"><a href="http://friendly.github.io/matlib/reference/Eqn.html">Eqn</a></span><span class="op">(</span><span class="st">"\\mathbf{S} &amp; = \\mathbf{V}"</span>, <span class="va">spacer</span>,</span>
<span>    <span class="st">"\\mathbf{\\Lambda}"</span>, <span class="va">spacer</span>,  </span>
<span>    <span class="st">"\\mathbf{V}^\\top"</span>, <span class="fu"><a href="http://friendly.github.io/matlib/reference/Eqn_helpers.html">Eqn_newline</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="http://friendly.github.io/matlib/reference/latexMatrix.html">latexMatrix</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span>, <span class="st">"&amp; ="</span>, </span>
<span>    <span class="fu"><a href="http://friendly.github.io/matlib/reference/latexMatrix.html">latexMatrix</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span>, <span class="st">"  "</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">Lambda</span><span class="op">)</span>, <span class="st">"  "</span>, <span class="fu"><a href="http://friendly.github.io/matlib/reference/latexMatrix.html">latexMatrix</a></span><span class="op">(</span><span class="va">V</span>, transpose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    align <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- Phil's version:
Eqn("\\mathbf{S} & = & \\mathbf{V} & &\\mathbf{\\Lambda} & &\\mathbf{V}^\\top", Eqn_newline(),
    latexMatrix(S), "& = & ", latexMatrix(V), "& &", diag(Lambda), "& &", latexMatrix(V, transpose=TRUE),
    align = TRUE)
-->
<p><span class="math display">\[\begin{aligned}
\mathbf{S} &amp; = \mathbf{V} \phantom{00000000000000}
     \boldsymbol{\Lambda} \phantom{00000000000000}  
     \mathbf{V}^\top \\
\begin{matrix}
  &amp;  \begin{matrix} \phantom{i} Exp &amp; Inc
  \end{matrix} \\
\begin{matrix}  
   Exp\\
   Inc\\
\end{matrix}  &amp;
\begin{pmatrix}  
136 &amp; 152 \\
152 &amp; 234 \\
\end{pmatrix}
\\
\end{matrix}
&amp; =\begin{pmatrix}
0.589 &amp; -0.808 \\
0.808 &amp;  0.589 \\
\end{pmatrix}
  \begin{pmatrix}
344.3 &amp;   0.0 \\
  0.0 &amp;  25.1 \\
\end{pmatrix}
  \begin{pmatrix}
0.589 &amp; -0.808 \\
0.808 &amp;  0.589 \\
\end{pmatrix}^\top
\end{aligned}\]</span></p>
<p>The “scores” on the principal components can be calculated (point (5) above) as <span class="math inline">\(\mathbf{PC} = \mathbf{X} \mathbf{V}\)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">PC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">V</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">PC</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">PC</span><span class="op">)</span></span>
<span><span class="co">#          PC1   PC2</span></span>
<span><span class="co"># Abby    16.2 11.78</span></span>
<span><span class="co"># Betty   31.2 16.57</span></span>
<span><span class="co"># Charles 35.3 19.52</span></span>
<span><span class="co"># Doreen  30.1  9.59</span></span>
<span><span class="co"># Ethan   46.3 21.37</span></span>
<span><span class="co"># Francie 49.2 17.32</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you can visualize the geometry of PCA as in <a href="#fig-pca-rotation" class="quarto-xref">Figure&nbsp;<span>5.6</span></a> (left) by plotting the data ellipse for the points, along with the PCA axes (<code><a href="https://friendly.github.io/heplots/reference/ellipse.axes.html">heplots::ellipse.axes()</a></code>). <a href="#fig-workers-pca" class="quarto-xref">Figure&nbsp;<span>5.8</span></a> also shows the bounding box of the data ellipse, which are parallel to the PC axes and scaled to have the same “radius” as the data ellipse.</p>
<!-- Nasty conflict loading `spida2`: labs() conflicts with ggplot2 -->
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># calculate conjugate axes for PCA factorization</span></span>
<span><span class="va">pca.fac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html">svd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">xx</span><span class="op">$</span><span class="va">v</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span> <span class="va">xx</span><span class="op">$</span><span class="va">d</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ret</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">dataEllipse</a></span><span class="op">(</span><span class="va">Income</span> <span class="op">~</span> <span class="va">Experience</span>, data<span class="op">=</span><span class="va">workers</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span>    center.pch <span class="op">=</span> <span class="st">"+"</span>, center.cex <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    levels <span class="op">=</span> <span class="fl">0.68</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>    asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">mu</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, v <span class="op">=</span> <span class="va">mu</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>       lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># axes of the ellipse = PC1, PC2</span></span>
<span><span class="va">radius</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span><span class="op">(</span><span class="fl">0.68</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">workers</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">heplots</span><span class="fu">::</span><span class="fu"><a href="https://friendly.github.io/heplots/reference/ellipse.axes.html">ellipse.axes</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">mu</span>, </span>
<span>     radius <span class="op">=</span> <span class="va">radius</span>,</span>
<span>     labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     cex <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bounding box of the ellipse</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu">spida2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spida2/man/ell.html">ellplus</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">S</span>, radius <span class="op">=</span> <span class="va">radius</span>,</span>
<span>              box <span class="op">=</span> <span class="cn">TRUE</span>, fac <span class="op">=</span> <span class="va">pca.fac</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>      lwd <span class="op">=</span> <span class="fl">2</span>, lty<span class="op">=</span><span class="st">"longdash"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-workers-pca" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-workers-pca-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-workers-pca-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-workers-pca-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.8: Geometry of the PCA for the <code>workers</code> data, showing the data ellipse, the eigenvectors of <span class="math inline">\(\mathbf{S}\)</span>, whose half-lengths are the square roots <span class="math inline">\(\sqrt{\lambda_i}\)</span> of the eigenvalues, and the bounding box of the ellipse.
</figcaption></figure>
</div>
</div>
</div>
<p>Finally, to preview the methods of the next section, the results calculated “by hand” above can be obtained using <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code>. The values labeled <code>"Standard deviations"</code> are the square roots <span class="math inline">\(\sqrt{\lambda}_i\)</span> of the two eigenvalues. The eigenvectors are labeled <code>"Rotation"</code> because <span class="math inline">\(\mathbf{V}\)</span> is the matrix that rotates the data matrix to produce the component scores.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">workers.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Standard deviations (1, .., p=2):</span></span>
<span><span class="co"># [1] 18.56  5.01</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Rotation (n x k) = (2 x 2):</span></span>
<span><span class="co">#              PC1    PC2</span></span>
<span><span class="co"># Experience 0.589  0.808</span></span>
<span><span class="co"># Income     0.808 -0.589</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section><section id="finding-principal-components" class="level3" data-number="5.2.3"><h3 data-number="5.2.3" class="anchored" data-anchor-id="finding-principal-components">
<span class="header-section-number">5.2.3</span> Finding principal components</h3>
<p>In R, PCA is most easily carried out using <code><a href="https://rdrr.io/r/stats/prcomp.html">stats::prcomp()</a></code> or <code><a href="https://rdrr.io/r/stats/princomp.html">stats::princomp()</a></code> or similar functions in other packages such as <code>FactomineR::PCA()</code>. The <span style="color: brown;"><strong>FactoMineR</strong></span> package <span class="citation" data-cites="R-FactoMineR Husson-etal-2017">(<a href="95-references.html#ref-Husson-etal-2017" role="doc-biblioref">Husson et al., 2017</a>; <a href="95-references.html#ref-R-FactoMineR" role="doc-biblioref">Lê et al., 2008</a>)</span> has extensive capabilities for exploratory analysis of multivariate data (PCA, correspondence analysis, cluster analysis).</p>
<p>A particular strength of FactoMineR for PCA is that it allows the inclusion of <em>supplementary variables</em> (which can be categorical or quantitative) and <em>supplementary points</em> for individuals. These are not used in the analysis, but are projected into the plots to facilitate interpretation. For example, in the analysis of the <code>crime</code> data described below, it would be useful to have measures of other characteristics of the U.S. states, such as poverty and average level of education (<a href="#sec-supp-vars" class="quarto-xref"><span>Section 5.3.5</span></a>).</p>
<p>Unfortunately, although all of these functions perform similar calculations, the options for analysis and the details of the result they return differ.</p>
<p>The important options for analysis include:</p>
<ul>
<li>whether or not the data variables are <strong>centered</strong>, to a mean of <span class="math inline">\(\bar{x}_j =0\)</span>
</li>
<li>whether or not the data variables are <strong>scaled</strong>, to a variance of <span class="math inline">\(\text{Var}(x_j) =1\)</span>.</li>
</ul>
<p>It nearly always makes sense to center and scale the variables. This choice of scaling determines whether the correlation matrix is analyzed, so that each variable contributes <em>equally</em> to the total variance that is to be accounted for. The unscaled choice analyzes the covariance matrix, where each variable contributes its <em>own variance</em> to the total. Analysis of the covariance matrix makes little sense when the variables are measured in different units<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, unless you want to interpret total variance on the scales of the different variables.</p>
<p>You don’t need to scale your data in advance, but be aware of the options: <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code> has default options <code>center = TRUE, scale. = FALSE</code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> so in most cases you should specify <code>scale. = TRUE</code>. I mostly use this. The older <code><a href="https://rdrr.io/r/stats/princomp.html">princomp()</a></code> has only the option <code>cor = FALSE</code> which centers the data and uses the covariance matrix, so in most cases you should set <code>cor = TRUE</code>.</p>
<p>To illustrate, the analysis of the <code>workers</code> data presented above used <code>scale. = FALSE</code> by default, so the eigenvalues reflected the variances of Experience and Income. The analogous result, using standardized variables (<span class="math inline">\(z\)</span>-scores) can be computed in any of the forms shown below, using either <code>scale. = FALSE</code> or standardizing first using <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Standard deviations (1, .., p=2):</span></span>
<span><span class="co"># [1] 1.361 0.383</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Rotation (n x k) = (2 x 2):</span></span>
<span><span class="co">#              PC1    PC2</span></span>
<span><span class="co"># Experience 0.707  0.707</span></span>
<span><span class="co"># Income     0.707 -0.707</span></span>
<span></span>
<span><span class="co"># same as (output suppressed):</span></span>
<span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span>scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this form, each of Experience and Income have variance = 1, and the <code>"Standard deviations"</code> reported are the square roots (<span class="math inline">\(\sqrt{\lambda}_i\)</span>) of the eigenvalues <span class="math inline">\(\lambda_i\)</span> of the correlation matrix <span class="math inline">\(\mathbf{R}\)</span>. The eigenvalues of a correlation matrix always sum to <span class="math inline">\(p\)</span>, the number of variables. This fact prompted the rough <em>rule of thumb</em> to extract principal components whose eigenvalues exceed 1.0, which is their average value, <span class="math inline">\(\bar{\lambda} = (\Sigma^p \lambda_i) / p = p / p\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">sdev</span></span>
<span><span class="co"># [1] 1.361 0.383</span></span>
<span></span>
<span><span class="co"># eiven values of correlation matrix</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">workers</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">R.eig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span></span>
<span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="va">R.eig</span><span class="op">$</span><span class="va">values</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] 1.853 0.147</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Lambda</span><span class="op">)</span></span>
<span><span class="co"># [1] 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="example-crime-data" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="example-crime-data">Example: Crime data</h4>
<p>The dataset <code>crime</code>, analysed in <a href="04-multivariate_plots.html#sec-corrgram" class="quarto-xref"><span>Section 4.8</span></a>, showed all positive correlations among the rates of various crimes in the corrgram, <a href="04-multivariate_plots.html#fig-crime-corrplot" class="quarto-xref">Figure&nbsp;<span>4.34</span></a>. What can we see from a PCA? Is it possible that a few dimensions can account for most of the juice in this data?</p>
<p>In this example, you can easily find the PCA solution using <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code> in a single line in base-R. You need to specify the numeric variables to analyze by their columns in the data frame. The most important option here is <code>scale. = TRUE</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">crime</span>, package <span class="op">=</span> <span class="st">"ggbiplot"</span><span class="op">)</span></span>
<span><span class="va">crime.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">crime</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The tidy equivalent is more verbose, but also more expressive about what is being done. It selects the variables to analyze by a function, <code><a href="https://rdrr.io/r/base/numeric.html">is.numeric()</a></code> applied to each of the columns and feeds the result to <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime.pca</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">crime</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span>scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As is typical with models in R, the result, <code>crime.pca</code> of <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code> is an object of class <code>"prcomp"</code>, a list of components, and there are a variety of methods for <code>"prcomp"</code> objects. Among the simplest is <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, which gives the contributions of each component to the total variance in the dataset.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">crime.pca</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Importance of components:</span></span>
<span><span class="co">#                         PC1  PC2  PC3   PC4   PC5   PC6   PC7</span></span>
<span><span class="co"># Standard deviation     2.03 1.11 0.85 0.563 0.508 0.471 0.352</span></span>
<span><span class="co"># Proportion of Variance 0.59 0.18 0.10 0.045 0.037 0.032 0.018</span></span>
<span><span class="co"># Cumulative Proportion  0.59 0.76 0.87 0.914 0.951 0.982 1.000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The object, <code>crime.pca</code> returned by <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code> is a list of the following the following elements:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">crime.pca</span><span class="op">)</span></span>
<span><span class="co"># [1] "sdev"     "rotation" "center"   "scale"    "x"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Of these, for <span class="math inline">\(n\)</span> observations and <span class="math inline">\(p\)</span> variables,</p>
<ul>
<li>
<code>sdev</code> is the length <span class="math inline">\(p\)</span> vector of the standard deviations of the principal components (i.e., the square roots <span class="math inline">\(\sqrt{\lambda_i}\)</span> of the eigenvalues of the covariance/correlation matrix). When the variables are standardized, the sum of squares of the eigenvalues is equal to <span class="math inline">\(p\)</span>.</li>
<li>
<code>rotation</code> is the <span class="math inline">\(p \times p\)</span> matrix of weights or <strong>loadings</strong> of the variables on the components; the columns are the eigenvectors of the covariance or correlation matrix of the data;</li>
<li>
<code>x</code> is the <span class="math inline">\(n \times p\)</span> matrix of <strong>scores</strong> for the observations on the components, the result of multiplying (rotating) the data matrix by the loadings. These are uncorrelated, so <code>cov(x)</code> is a <span class="math inline">\(p \times p\)</span> diagonal matrix whose diagonal elements are the eigenvalues <span class="math inline">\(\lambda_i\)</span> = <code>sdev^2</code>.</li>
<li>
<code>center</code> gives the means of the variables when the option <code>center. = TRUE</code> (the default)</li>
</ul></section></section><section id="visualizing-variance-proportions-screeplots" class="level3" data-number="5.2.4"><h3 data-number="5.2.4" class="anchored" data-anchor-id="visualizing-variance-proportions-screeplots">
<span class="header-section-number">5.2.4</span> Visualizing variance proportions: screeplots</h3>
<p>For a high-D dataset, such as the crime data in seven dimensions, a natural question is how much of the variation in the data can be captured in 1D, 2D, 3D, … summaries and views. This is answered by considering the proportions of variance accounted by each of the dimensions, or their cumulative values. The components returned by various PCA methods have (confusingly) different names, so <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code> provides methods to unify extraction of these values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">crime.eig</span> <span class="op">&lt;-</span> <span class="va">crime.pca</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"eigenvalues"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 7 × 4</span></span>
<span><span class="co">#      PC std.dev percent cumulative</span></span>
<span><span class="co">#   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co"># 1     1   2.03   0.588       0.588</span></span>
<span><span class="co"># 2     2   1.11   0.177       0.765</span></span>
<span><span class="co"># 3     3   0.852  0.104       0.868</span></span>
<span><span class="co"># 4     4   0.563  0.0452      0.914</span></span>
<span><span class="co"># 5     5   0.508  0.0368      0.951</span></span>
<span><span class="co"># 6     6   0.471  0.0317      0.982</span></span>
<span><span class="co"># 7     7   0.352  0.0177      1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, a simple visualization is a plot of the proportion of variance for each component (or cumulative proportion) against the component number, usually called a <strong>screeplot</strong>. The idea, introduced by <span class="citation" data-cites="Cattell1966">Cattell (<a href="95-references.html#ref-Cattell1966" role="doc-biblioref">1966</a>)</span>, is that after the largest, dominant components, the remainder should resemble the rubble, or scree formed by rocks falling from a cliff.</p>
<p>From this plot, imagine drawing a straight line through the plotted eigenvalues, starting with the largest one. The typical rough guidance is that the last point to fall on this line represents the last component to extract, the idea being that beyond this, the amount of additional variance explained is non-meaningful. Another rule of thumb is to choose the number of components to extract a desired proportion of total variance, usually in the range of 80 - 90%.</p>
<p><code>stats::plot(crime.pca)</code> would give a bar plot of the variances of the components, however <code><a href="http://friendly.github.io/ggbiplot/reference/ggscreeplot.html">ggbiplot::ggscreeplot()</a></code> gives nicer and more flexible displays as shown in <a href="#fig-crime-ggscreeplot" class="quarto-xref">Figure&nbsp;<span>5.9</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggscreeplot.html">ggscreeplot</a></span><span class="op">(</span><span class="va">crime.pca</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crime.eig</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PC</span><span class="op">&gt;=</span><span class="fl">4</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC</span>, y<span class="op">=</span><span class="va">percent</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>              se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              fullrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggscreeplot.html">ggscreeplot</a></span><span class="op">(</span><span class="va">crime.pca</span>, type <span class="op">=</span> <span class="st">"cev"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.9</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-ggscreeplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-ggscreeplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-crime-ggscreeplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-ggscreeplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.9: Screeplots for the PCA of the crime data. The left panel shows the traditional version, plotting variance proportions against component number, with linear guideline for the scree rule of thumb. The right panel plots cumulative proportions, showing cutoffs of 80%, 90%.
</figcaption></figure>
</div>
</div>
</div>
<p>From this we might conclude that four components are necessary to satisfy the scree criterion or to account for 90% of the total variation in these crime statistics. However two components, giving 76.5%, might be enough juice to tell a reasonable story.</p>
</section><section id="visualizing-pca-scores-and-variable-vectors" class="level3" data-number="5.2.5"><h3 data-number="5.2.5" class="anchored" data-anchor-id="visualizing-pca-scores-and-variable-vectors">
<span class="header-section-number">5.2.5</span> Visualizing PCA scores and variable vectors</h3>
<p>To see and attempt to understand PCA results, it is useful to plot both the scores for the observations on a few of the largest components and also the loadings or variable vectors that give the weights for the variables in determining the principal components.</p>
<p>In <a href="#sec-biplot" class="quarto-xref"><span>Section 5.3</span></a> I discuss the biplot technique that plots both in a single display. However, I do this directly here, using tidy processing to explain what is going on in PCA and in these graphical displays.</p>
<section id="scores" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="scores">Scores</h4>
<p>The (uncorrelated) principal component scores can be extracted as <code>crime.pca$x</code> or using <code>purrr::pluck("x")</code>. As noted above, these are uncorrelated and have variances equal to the eigenvalues of the correlation matrix.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="va">crime.pca</span> <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/zapsmall.html">zapsmall</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#      PC1  PC2  PC3  PC4  PC5  PC6  PC7</span></span>
<span><span class="co"># PC1 4.11 0.00 0.00 0.00 0.00 0.00 0.00</span></span>
<span><span class="co"># PC2 0.00 1.24 0.00 0.00 0.00 0.00 0.00</span></span>
<span><span class="co"># PC3 0.00 0.00 0.73 0.00 0.00 0.00 0.00</span></span>
<span><span class="co"># PC4 0.00 0.00 0.00 0.32 0.00 0.00 0.00</span></span>
<span><span class="co"># PC5 0.00 0.00 0.00 0.00 0.26 0.00 0.00</span></span>
<span><span class="co"># PC6 0.00 0.00 0.00 0.00 0.00 0.22 0.00</span></span>
<span><span class="co"># PC7 0.00 0.00 0.00 0.00 0.00 0.00 0.12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For plotting, it is more convenient to use <code><a href="https://generics.r-lib.org/reference/augment.html">broom::augment()</a></code> which extracts the scores (named <code>.fittedPC*</code>) and appends these to the variables in the dataset.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime.pca</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">crime</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 6 × 18</span></span>
<span><span class="co">#   .rownames state      murder  rape robbery assault burglary larceny</span></span>
<span><span class="co">#   &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co"># 1 1         Alabama      14.2  25.2    96.8    278.    1136.   1882.</span></span>
<span><span class="co"># 2 2         Alaska       10.8  51.6    96.8    284     1332.   3370.</span></span>
<span><span class="co"># 3 3         Arizona       9.5  34.2   138.     312.    2346.   4467.</span></span>
<span><span class="co"># 4 4         Arkansas      8.8  27.6    83.2    203.     973.   1862.</span></span>
<span><span class="co"># 5 5         California   11.5  49.4   287      358     2139.   3500.</span></span>
<span><span class="co"># 6 6         Colorado      6.3  42     171.     293.    1935.   3903.</span></span>
<span><span class="co"># # ℹ 10 more variables: auto &lt;dbl&gt;, st &lt;chr&gt;, region &lt;fct&gt;,</span></span>
<span><span class="co"># #   .fittedPC1 &lt;dbl&gt;, .fittedPC2 &lt;dbl&gt;, .fittedPC3 &lt;dbl&gt;,</span></span>
<span><span class="co"># #   .fittedPC4 &lt;dbl&gt;, .fittedPC5 &lt;dbl&gt;, .fittedPC6 &lt;dbl&gt;,</span></span>
<span><span class="co"># #   .fittedPC7 &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we can use <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> to plot any pair of components. To aid interpretation, I label the points by their state abbreviation and color them by <code>region</code> of the U.S.. A geometric interpretation of the plot requires an aspect ratio of 1.0 (via <code><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed()</a></code>) so that a unit distance on the horizontal axis is the same length as a unit distance on the vertical. To demonstrate that the components are uncorrelated, I also added their data ellipse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime.pca</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">crime</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># add original dataset back in</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.fittedPC1</span>, <span class="va">.fittedPC2</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">st</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"PC Dimension 1"</span>, y <span class="op">=</span> <span class="st">"PC Dimension 2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-scores-plot12" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-scores-plot12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-crime-scores-plot12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-scores-plot12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.10: Plot of component scores on the first two principal components for the <code>crime</code> data. States are colored by <code>region</code>.
</figcaption></figure>
</div>
</div>
</div>
<p>To interpret such plots, it is useful consider the observations that are a high and low on each of the axes as well as other information, such as region here, and ask how these differ on the crime statistics. The first component, PC1, contrasts Nevada and California with North Dakota, South Dakota and West Virginia. The second component has most of the southern states on the low end and Massachusetts, Rhode Island and Hawaii on the high end. However, interpretation is easier when we also consider how the various crimes contribute to these dimensions.</p>
<p>When, as here, there are more than two components that seem important in the scree plot, we could obviously go further and plot other pairs.</p>
</section><section id="variable-vectors" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="variable-vectors">Variable vectors</h4>
<p>You can extract the variable loadings using either <code>crime.pca$rotation</code> or <code>purrr::pluck("rotation")</code>, similar to what I did with the scores.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime.pca</span> <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"rotation"</span><span class="op">)</span></span>
<span><span class="co">#             PC1     PC2     PC3     PC4     PC5     PC6     PC7</span></span>
<span><span class="co"># murder   -0.300 -0.6292 -0.1782  0.2321  0.5381  0.2591  0.2676</span></span>
<span><span class="co"># rape     -0.432 -0.1694  0.2442 -0.0622  0.1885 -0.7733 -0.2965</span></span>
<span><span class="co"># robbery  -0.397  0.0422 -0.4959  0.5580 -0.5200 -0.1144 -0.0039</span></span>
<span><span class="co"># assault  -0.397 -0.3435  0.0695 -0.6298 -0.5067  0.1724  0.1917</span></span>
<span><span class="co"># burglary -0.440  0.2033  0.2099  0.0576  0.1010  0.5360 -0.6481</span></span>
<span><span class="co"># larceny  -0.357  0.4023  0.5392  0.2349  0.0301  0.0394  0.6017</span></span>
<span><span class="co"># auto     -0.295  0.5024 -0.5684 -0.4192  0.3698 -0.0573  0.1470</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But note something important in this output: All of the weights for the first component are negative. In PCA, the directions of the eigenvectors are completely arbitrary, in the sense that the vector <span class="math inline">\(-\mathbf{v}_i\)</span> gives the same linear combination as <span class="math inline">\(\mathbf{v}_i\)</span>, but with its’ sign reversed. For interpretation, it is useful (and usually recommended) to reflect the loadings to a positive orientation by multiplying them by -1. In general, you are free to reflect any of the components for ease of interpretation, and not necessarily if all the signs are negative.</p>
<p>To reflect the PCA loadings (multiplying PC1 and PC2 by -1) and get them into a convenient format for plotting with <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, it is necessary to do a bit of processing, including making the <code><a href="https://rdrr.io/r/base/row.names.html">row.names()</a></code> into an explicit variable for the purpose of labeling.</p>
<!-- **TODO**: Should this be a callout-warning or a footnote?? -->
<div class="callout callout-style-default callout-warning callout-titled" title="`rownames` in R">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>rownames</code> in R
</div>
</div>
<div class="callout-body-container callout-body">
<p>R software evolved over many years, particularly in conventions for labeling cases in printed output and graphics. In base-R, the convention was that the <code><a href="https://rdrr.io/r/base/row.names.html">row.names()</a></code> of a matrix or data.frame served as observation labels in all printed output and plots, with a default to use numbers <code>1:n</code> if there were no rownames.</p>
<p>In <code>ggplot2</code> and the <code>tidyverse</code> framework, the decision was made that observation labels had to be an <strong>explicit</strong> variable in a “tidy” dataset, so it could be used as a variable in constructs like <code>geom_text(aes(label = label))</code> as in this example. This change often requires extra steps in pre-tidy software that uses the rownames convention.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vectors</span> <span class="op">&lt;-</span> <span class="va">crime.pca</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"rotation"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>PC1 <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">PC1</span>, PC2 <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">PC2</span><span class="op">)</span> <span class="op">|&gt;</span>      <span class="co"># reflect axes</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"label"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">vectors</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#      label   PC1     PC2</span></span>
<span><span class="co"># 1   murder 0.300  0.6292</span></span>
<span><span class="co"># 2     rape 0.432  0.1694</span></span>
<span><span class="co"># 3  robbery 0.397 -0.0422</span></span>
<span><span class="co"># 4  assault 0.397  0.3435</span></span>
<span><span class="co"># 5 burglary 0.440 -0.2033</span></span>
<span><span class="co"># 6  larceny 0.357 -0.4023</span></span>
<span><span class="co"># 7     auto 0.295 -0.5024</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, I plot these using <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment()</a></code>, taking some care to use arrows from the origin with a nice shape and add <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text()</a></code> labels for the variables positioned slightly to the right. Again, <code><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed()</a></code> ensures equal scales for the axes, which is important because we want to interpret the angles between the variable vectors and the PCA coordinate axes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">arrow_style</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span></span>
<span>  angle <span class="op">=</span> <span class="fl">20</span>, ends <span class="op">=</span> <span class="st">"first"</span>, type <span class="op">=</span> <span class="st">"closed"</span>, </span>
<span>  length <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"pt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vectors</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fl">0</span>, </span>
<span>               linewidth <span class="op">=</span> <span class="fl">1</span>, </span>
<span>               arrow <span class="op">=</span> <span class="va">arrow_style</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"brown"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>, </span>
<span>            size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>            hjust <span class="op">=</span> <span class="st">"outward"</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"brown"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_circle.html">geom_circle</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>, y0 <span class="op">=</span> <span class="fl">0</span>, r <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,  color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op">(</span><span class="fl">.50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.8</span>, <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>         <span class="co"># fix aspect ratio to 1:1</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-vectors" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-vectors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-crime-vectors-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-vectors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.11: Plot of component loadings the first two principal components for the <code>crime</code> data. These are interpreted as the contributions of the variables to the components.
</figcaption></figure>
</div>
</div>
</div>
<p>The variable vectors (arrows) shown in <a href="#fig-crime-vectors" class="quarto-xref">Figure&nbsp;<span>5.11</span></a> have the following interpretations:</p>
<ol type="1">
<li><p>The lengths of the variable vectors, <span class="math inline">\(\lVert\mathbf{v}_i\rVert = \sqrt{\Sigma_{j} \; v_{ij}^2}\)</span> give the relative proportion of variance of each variable accounted for in a two-dimensional display.</p></li>
<li><p>Each vector points in the direction in component space with which that variable is most highly correlated: the value, <span class="math inline">\(v_{ij}\)</span>, of the vector for variable <span class="math inline">\(\mathbf{x}_i\)</span> on component <span class="math inline">\(j\)</span> reflects the correlation of that variable with the <span class="math inline">\(j\)</span>th principal component. Thus,</p></li>
</ol>
<pre data-code-line-numbers=""><code>* A variable that is perfectly correlated with a component is parallel to it.
* A variable uncorrelated with an component is perpendicular to it.</code></pre>
<ol start="3" type="1">
<li>The angle between vectors shows the strength and direction of the correlation between those variables: the cosine of the angle <span class="math inline">\(\theta\)</span> between two variable vectors, <span class="math inline">\(\mathbf{v}_i\)</span> and <span class="math inline">\(\mathbf{v}_j\)</span>, which is <span class="math inline">\(\cos(\theta) = \mathbf{v}_i^\prime \; \mathbf{v}_j \;/ \; \| \mathbf{v}_i \| \cdot \| \mathbf{v}_j \|\)</span> gives the approximation of the correlation <span class="math inline">\(r_{ij}\)</span> between <span class="math inline">\(\mathbf{x}_i\)</span> and <span class="math inline">\(\mathbf{x}_j\)</span> that is shown in this space. This means that:</li>
</ol>
<pre data-code-line-numbers=""><code>* two variable vectors that point in the same direction are highly correlated; $r = 1$ if they are completely aligned.
* Variable vectors at right angles are approximately uncorrelated, while those</code></pre>
<p>pointing in opposite directions are negatively correlated; <span class="math inline">\(r = -1\)</span> if they are at 180<span class="math inline">\(^o\)</span>.</p>
<p>To illustrate point (1), the following indicates that almost 70% of the variance of <code>murder</code> is represented in the the 2D plot shown in <a href="#fig-crime-scores-plot12" class="quarto-xref">Figure&nbsp;<span>5.10</span></a>, but only 40% of the variance of <code>robbery</code> is captured. For point (2), the correlation of <code>murder</code> with the dimensions is 0.3 for PC1 and 0.63 for PC2. For point (3), the angle between <code>murder</code> and <code>burglary</code> looks to be about 90<span class="math inline">\(^o\)</span>, but the actual correlation is 0.39.</p>
<!-- •  Each vector corresponds to a variable, and points in the direction in which that variable is most strongly linearly correlated. -->
<!-- •  Variables that are perfectly correlated with an axis are parallel to it. -->
<!-- •  Variables that are uncorrelated with an axis are perpendicular to it. -->
<!-- •  Each vector can be thought of as the hypotenuse of a triangle with sides along the two axes of the graph.  The length of these sides is proportional to the loading for that variable with those PCs. -->
<!-- •  The angle between vectors shows the strength and direction of the correlation between those variables.  You should be able to find examples of each of these cases in the above biplot:  -->
<!-- o  Vectors that are very close to one another represent variables that are strongly positively correlated -->
<!-- o  Vectors that are perpendicular represent variables that are uncorrelated -->
<!-- o  Vectors that point in opposite directions represent variables that are strongly negatively correlated -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vectors</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">label</span>, <span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">PC1</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">PC2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#      label   PC1     PC2 length</span></span>
<span><span class="co"># 1   murder 0.300  0.6292  0.697</span></span>
<span><span class="co"># 2     rape 0.432  0.1694  0.464</span></span>
<span><span class="co"># 3  robbery 0.397 -0.0422  0.399</span></span>
<span><span class="co"># 4  assault 0.397  0.3435  0.525</span></span>
<span><span class="co"># 5 burglary 0.440 -0.2033  0.485</span></span>
<span><span class="co"># 6  larceny 0.357 -0.4023  0.538</span></span>
<span><span class="co"># 7     auto 0.295 -0.5024  0.583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section></section><section id="sec-biplot" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="sec-biplot">
<span class="header-section-number">5.3</span> Biplots</h2>
<p>The biplot is a visual multivariate juicer. It is the simple and powerful idea that came from the recognition that you can overlay a plot of observation scores in a principal components analysis with the information of the variable loadings (weights) to give a simultaneous display that is easy to interpret. In this sense, a biplot is generalization of a scatterplot, projecting from data space to PCA space, where the observations are shown by points, as in the plots of component scores in <a href="#fig-crime-scores-plot12" class="quarto-xref">Figure&nbsp;<span>5.10</span></a>, but with the variables also shown by vectors (or scaled linear axes aligned with those vectors).</p>
<p>The idea of the biplot was introduced by Ruben Gabriel <span class="citation" data-cites="Gabriel:71 Gabriel:81">(<a href="95-references.html#ref-Gabriel:71" role="doc-biblioref">1971</a>, <a href="95-references.html#ref-Gabriel:81" role="doc-biblioref">1981</a>)</span> and later expanded in scope by <span class="citation" data-cites="GowerHand:96">Gower &amp; Hand (<a href="95-references.html#ref-GowerHand:96" role="doc-biblioref">1996</a>)</span>. The book by <span class="citation" data-cites="Greenacre:2010:biplots">Greenacre (<a href="95-references.html#ref-Greenacre:2010:biplots" role="doc-biblioref">2010</a>)</span> gives a practical overview of the many variety of biplots. <span class="citation" data-cites="Gower-etal:2011">Gower et al. (<a href="95-references.html#ref-Gower-etal:2011" role="doc-biblioref">2011</a>)</span> <em>Understanding biplots</em> provides a full treatment of many topics, including how to calibrate biplot axes, 3D plots, and so forth.</p>
<p>Biplot methodolgy is far more general than I cover here. Categorical variables can be incorporated in PCA using points that represent the levels of discrete categories. Two-way frequency tables of categorical variables can be analysed using <em>correspondence analysis</em>, which is similar to PCA, but designed to account for the maximum amount of the <span class="math inline">\(\chi^2\)</span> statistic for association; <em>multiple correspondence analysis</em> extends this to method to multi-way tables <span class="citation" data-cites="FriendlyMeyer:2016:DDAR Greenacre:84">(<a href="95-references.html#ref-FriendlyMeyer:2016:DDAR" role="doc-biblioref">Friendly &amp; Meyer, 2016</a>; <a href="95-references.html#ref-Greenacre:84" role="doc-biblioref">Greenacre, 1984</a>)</span>.</p>
<section id="sec-biplot-svd" class="level3" data-number="5.3.1"><h3 data-number="5.3.1" class="anchored" data-anchor-id="sec-biplot-svd">
<span class="header-section-number">5.3.1</span> Constructing a biplot</h3>
<p>The biplot is constructed by using the singular value decomposition (SVD) to obtain a low-rank approximation to the data matrix <span class="math inline">\(\mathbf{X}_{n \times p}\)</span> (centered, and optionally scaled to unit variances) whose <span class="math inline">\(n\)</span> rows are the observations and whose <span class="math inline">\(p\)</span> columns are the variables.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-svd-diagram" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-svd-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/SVD.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-svd-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.12: The singular value decomposition expresses a data matrix <strong>X</strong> as the product of a matrix <strong>U</strong> of observation scores, a diagonal matrix <span class="math inline">\(\Lambda\)</span> of singular values and a matrix <strong>V</strong> of variable weights.
</figcaption></figure>
</div>
</div>
</div>
<p>Using the SVD, the matrix <span class="math inline">\(\mathbf{X}\)</span>, of rank <span class="math inline">\(r \le p\)</span> can be expressed <em>exactly</em> as:</p>
<p><span id="eq-svd1"><span class="math display">\[
\mathbf{X} = \mathbf{U} \boldsymbol{\Lambda} \mathbf{V}'
                 = \sum_i^r \lambda_i \mathbf{u}_i \mathbf{v}_i' \; ,
\tag{5.2}\]</span></span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(\mathbf{U}\)</span> is an <span class="math inline">\(n \times r\)</span> orthonormal matrix of uncorrelated observation scores; these are also the eigenvectors of <span class="math inline">\(\mathbf{X} \mathbf{X}'\)</span>,</li>
<li>
<span class="math inline">\(\boldsymbol{\Lambda}\)</span> is an <span class="math inline">\(r \times r\)</span> diagonal matrix of singular values, <span class="math inline">\(\lambda_1 \ge \lambda_2 \ge \cdots \lambda_r\)</span>, which are also the square roots of the eigenvalues of <span class="math inline">\(\mathbf{X} \mathbf{X}'\)</span>.</li>
<li>
<span class="math inline">\(\mathbf{V}\)</span> is an <span class="math inline">\(r \times p\)</span> orthonormal matrix of variable weights and also the eigenvectors of <span class="math inline">\(\mathbf{X}' \mathbf{X}\)</span>.</li>
</ul>
<p>Then, a rank 2 (or 3) PCA approximation <span class="math inline">\(\widehat{\mathbf{X}}\)</span> to the data matrix used in the biplot can be obtained from the first 2 (or 3) singular values <span class="math inline">\(\lambda_i\)</span> and the corresponding <span class="math inline">\(\mathbf{u}_i, \mathbf{v}_i\)</span> as:</p>
<p><span class="math display">\[
\mathbf{X} \approx \widehat{\mathbf{X}} = \lambda_1 \mathbf{u}_1 \mathbf{v}_1' + \lambda_2 \mathbf{u}_2 \mathbf{v}_2' \; .
\]</span></p>
<p>The variance of <span class="math inline">\(\mathbf{X}\)</span> accounted for by each term is <span class="math inline">\(\lambda_i^2\)</span>.</p>
<p>A biplot is then obtained by overlaying two scatterplots that share a common set of axes and have a between-set scalar product interpretation. Typically, the observations (rows of <span class="math inline">\(\mathbf{X}\)</span>) are represented as points and the variables (columns of <span class="math inline">\(\mathbf{X}\)</span>) are represented as vectors from the origin.</p>
<p>The <code>scale</code> factor, <span class="math inline">\(\alpha\)</span> allows the variances of the components to be apportioned between the row points and column vectors, with different interpretations, by representing the approximation <span class="math inline">\(\widehat{\mathbf{X}}\)</span> as the product of two matrices,</p>
<p><span class="math display">\[
\widehat{\mathbf{X}} = (\mathbf{U} \boldsymbol{\Lambda}^\alpha) (\boldsymbol{\Lambda}^{1-\alpha} \mathbf{V}') = \mathbf{A} \mathbf{B}'
\]</span></p>
<p>This notation uses a little math trick involving a power, <span class="math inline">\(0 \le \alpha \le 1\)</span>: When <span class="math inline">\(\alpha = 1\)</span>, <span class="math inline">\(\boldsymbol{\Lambda}^\alpha = \boldsymbol{\Lambda}^1  =\boldsymbol{\Lambda}\)</span>, and <span class="math inline">\(\boldsymbol{\Lambda}^{1-\alpha} = \boldsymbol{\Lambda}^0  =\mathbf{I}\)</span>. <span class="math inline">\(\alpha = 1/2\)</span> gives the diagonal matrix <span class="math inline">\(\boldsymbol{\Lambda}^{1/2}\)</span> whose elements are the square roots of the singular values.</p>
<p>The choice <span class="math inline">\(\alpha = 1\)</span> assigns the singular values totally to the left factor; then, the angle between two variable vectors, reflecting the inner product <span class="math inline">\(\mathbf{x}_j^\mathsf{T}, \mathbf{x}_{j'}\)</span> approximates their correlation or covariance, and the distance between the points approximates their Mahalanobis distances. <span class="math inline">\(\alpha = 0\)</span> gives a distance interpretation to the column display. <span class="math inline">\(\alpha = 1/2\)</span> gives a symmetrically scaled biplot. <strong>TODO</strong>: Explain this better.</p>
<p>When the singular values are assigned totally to the left or to the right factor, the resultant coordinates are called <em>principal coordinates</em> and the sum of squared coordinates on each dimension equal the corresponding singular value. The other matrix, to which no part of the singular values is assigned, contains the so-called <em>standard coordinates</em> and have sum of squared values equal to 1.0.</p>
</section><section id="biplots-in-r" class="level3" data-number="5.3.2"><h3 data-number="5.3.2" class="anchored" data-anchor-id="biplots-in-r">
<span class="header-section-number">5.3.2</span> Biplots in R</h3>
<p>There are a large number of R packages providing biplots. The most basic, <code><a href="https://rdrr.io/r/stats/biplot.html">stats::biplot()</a></code>, provides methods for <code>"prcomp"</code> and <code>"princomp"</code> objects. Among other packages, <span style="color: brown;"><strong>factoextra</strong></span> <span class="citation" data-cites="R-factoextra">(<a href="95-references.html#ref-R-factoextra" role="doc-biblioref">Kassambara &amp; Mundt, 2020</a>)</span>, an extension of <span style="color: brown;"><strong>FactoMineR</strong></span> <span class="citation" data-cites="R-FactoMineR">(<a href="95-references.html#ref-R-FactoMineR" role="doc-biblioref">Lê et al., 2008</a>)</span>, is perhaps the most comprehensive and provides <code>ggplot2</code> graphics. In addition to biplot methods for quantitative data using PCA (<code><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html">fviz_pca()</a></code>), it offers biplots for categorical data using correspondence analysis (<code><a href="https://rdrr.io/pkg/factoextra/man/fviz_ca.html">fviz_ca()</a></code>) and multiple correspondence analysis (<code><a href="https://rdrr.io/pkg/factoextra/man/fviz_mca.html">fviz_mca()</a></code>); factor analysis with mixed quantitative and categorical variables (<code><a href="https://rdrr.io/pkg/factoextra/man/fviz_famd.html">fviz_famd()</a></code>) and cluster analysis (<code><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster()</a></code>). The <span style="color: brown;"><strong>adegraphics</strong></span> package <span class="citation" data-cites="R-adegraphics">(<a href="95-references.html#ref-R-adegraphics" role="doc-biblioref">Dray &amp; Siberchicot, 2025</a>)</span> produces lovely biplots using <span style="color: brown;"><strong>lattice</strong></span> graphics, but with its own analytic framework.</p>
<p>Here, I use the <span style="color: brown;"><strong>ggbiplot</strong></span> package <span class="citation" data-cites="R-ggbiplot">(<a href="95-references.html#ref-R-ggbiplot" role="doc-biblioref">Vu &amp; Friendly, 2024</a>)</span>, which aims to provide a simple interface to biplots within the <code>ggplot2</code> framework. I also use some convenient utility functions from <span style="color: brown;"><strong>factoextra</strong></span>.</p>
</section><section id="example-crime-data-1" class="level3" data-number="5.3.3"><h3 data-number="5.3.3" class="anchored" data-anchor-id="example-crime-data-1">
<span class="header-section-number">5.3.3</span> Example: Crime data</h3>
<p>A basic biplot of the <code>crime</code> data, using standardized principal components and labeling the observation by their state abbreviation is shown in <a href="#fig-crime-biplot1" class="quarto-xref">Figure&nbsp;<span>5.13</span></a>. The correlation circle reflects the data ellipse of the standardized components. This reminds us that these components are uncorrelated and have equal variance in the display.</p>
<!-- fig.code: R/crime/crime-ggbiplot.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/reflect.html">reflect</a></span><span class="op">(</span><span class="va">crime.pca</span><span class="op">)</span> <span class="co"># reflect the axes</span></span>
<span></span>
<span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggbiplot.html">ggbiplot</a></span><span class="op">(</span><span class="va">crime.pca</span>,</span>
<span>   obs.scale <span class="op">=</span> <span class="fl">1</span>, var.scale <span class="op">=</span> <span class="fl">1</span>,</span>
<span>   labels <span class="op">=</span> <span class="va">crime</span><span class="op">$</span><span class="va">st</span> ,</span>
<span>   circle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   varname.size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>   varname.color <span class="op">=</span> <span class="st">"brown"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-biplot1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-biplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-crime-biplot1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-biplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.13: Basic biplot of the crime data. State abbreviations are shown at their standardized scores on the first two dimensions. The variable vectors reflect the correlations of the variables with the biplot dimensions.
</figcaption></figure>
</div>
</div>
</div>
<p>In this dataset the states are grouped by region and we saw some differences among regions in the plot (<a href="#fig-crime-scores-plot12" class="quarto-xref">Figure&nbsp;<span>5.10</span></a>) of component scores. <code><a href="http://friendly.github.io/ggbiplot/reference/ggbiplot.html">ggbiplot()</a></code> provides options to include a <code>groups =</code> variable, used to color the observation points and also to draw their data ellipses, facilitating interpretation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggbiplot.html">ggbiplot</a></span><span class="op">(</span><span class="va">crime.pca</span>,</span>
<span>   obs.scale <span class="op">=</span> <span class="fl">1</span>, var.scale <span class="op">=</span> <span class="fl">1</span>,</span>
<span>   groups <span class="op">=</span> <span class="va">crime</span><span class="op">$</span><span class="va">region</span>,</span>
<span>   labels <span class="op">=</span> <span class="va">crime</span><span class="op">$</span><span class="va">st</span>,</span>
<span>   labels.size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>   var.factor <span class="op">=</span> <span class="fl">1.4</span>,</span>
<span>   ellipse <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>   ellipse.prob <span class="op">=</span> <span class="fl">0.5</span>, ellipse.alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>   circle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   varname.size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>   varname.color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>   clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Region"</span>, color <span class="op">=</span> <span class="st">"Region"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.direction <span class="op">=</span> <span class="st">'horizontal'</span>, legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-biplot2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-biplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-crime-biplot2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-biplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.14: Enhanced biplot of the crime data, grouping the states by region and adding data ellipses.
</figcaption></figure>
</div>
</div>
</div>
<p>This plot provides what is necessary to interpret the nature of the components and also the variation of the states in relation to these. In this, the data ellipses for the regions provide a visual summary that aids interpretation.</p>
<ul>
<li><p>From the variable vectors, it seems that PC1, having all positive and nearly equal loadings, reflects a total or overall index of crimes. Nevada, California, New York and Florida are highest on this, while North Dakota, South Dakota and West Virginia are lowest.</p></li>
<li><p>The second component, PC2, shows a contrast between crimes against persons (murder, assault, rape) at the top and property crimes (auto theft, larceny) at the bottom. Nearly all the Southern states are high on personal crimes; states in the North East are generally higher on property crimes.</p></li>
<li><p>Western states tend to be somewhat higher on overall crime rate, while North Central are lower on average. In these states there is not much variation in the relative proportions of personal vs.&nbsp;property crimes.</p></li>
</ul>
<p>Moreover, in this biplot you can interpret the the value for a particular state on a given crime by considering its projection on the variable vector, where the origin corresponds to the mean, positions along the vector have greater than average values on that crime, and the opposite direction have lower than average values. For example, Massachusetts has the highest value on auto theft, but a value less than the mean. Louisiana and South Carolina on the other hand are highest in the rate of murder and slightly less than average on auto theft.</p>
<p>These 2D plots account for only 76.5% of the total variance of crimes, so it is useful to also examine the third principal component, which accounts for an additional 10.4%. The <code>choices =</code> option controls which dimensions are plotted.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggbiplot.html">ggbiplot</a></span><span class="op">(</span><span class="va">crime.pca</span>,</span>
<span>         choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>         obs.scale <span class="op">=</span> <span class="fl">1</span>, var.scale <span class="op">=</span> <span class="fl">1</span>,</span>
<span>         groups <span class="op">=</span> <span class="va">crime</span><span class="op">$</span><span class="va">region</span>,</span>
<span>         labels <span class="op">=</span> <span class="va">crime</span><span class="op">$</span><span class="va">st</span>,</span>
<span>         labels.size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>         var.factor <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         ellipse <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         ellipse.prob <span class="op">=</span> <span class="fl">0.5</span>, ellipse.alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>         circle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         varname.size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>         varname.color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>         clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Region"</span>, color <span class="op">=</span> <span class="st">"Region"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.direction <span class="op">=</span> <span class="st">'horizontal'</span>, legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-biplot3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-biplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-crime-biplot3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-biplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.15: Biplot of dimensions 1 &amp; 3 of the crime data, with data ellipses for the regions.
</figcaption></figure>
</div>
</div>
</div>
<p>Dimension 3 in <a href="#fig-crime-biplot3" class="quarto-xref">Figure&nbsp;<span>5.15</span></a> is more subtle. One interpretation is a contrast between larceny, which is a larceny (simple theft) and robbery, which involves stealing something from a person and is considered a more serious crime with an element of possible violence. In this plot, murder has a relatively short variable vector, so does not contribute very much to differences among the states.</p>
</section><section id="biplot-contributions-and-quality" class="level3" data-number="5.3.4"><h3 data-number="5.3.4" class="anchored" data-anchor-id="biplot-contributions-and-quality">
<span class="header-section-number">5.3.4</span> Biplot contributions and quality</h3>
<p>To better understand how much each variable contributes to the biplot dimensions, it is helpful to see information about the variance of variables along each dimension. Graphically, this is nothing more than a measure of the lengths of projections of the variables on each of the dimensions. <code><a href="https://rdrr.io/pkg/factoextra/man/get_pca.html">factoextra::get_pca_var()</a></code> calculates a number of tables from a <code>"prcomp"</code> or similar object.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">var_info</span> <span class="op">&lt;-</span> <span class="fu">factoextra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/get_pca.html">get_pca_var</a></span><span class="op">(</span><span class="va">crime.pca</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">var_info</span><span class="op">)</span></span>
<span><span class="co"># [1] "coord"   "cor"     "cos2"    "contrib"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The component <code>cor</code> gives correlations of the variables with the dimensions and <code>contrib</code> gives their variance contributions as percents, where each row and column sums to 100.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">contrib</span> <span class="op">&lt;-</span> <span class="va">var_info</span><span class="op">$</span><span class="va">contrib</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">contrib</span>, Total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">contrib</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>Total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">contrib</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#           Dim.1  Dim.2  Dim.3  Dim.4  Dim.5  Dim.6  Dim.7 Total</span></span>
<span><span class="co"># murder     9.02  39.59   3.18   5.39  28.96   6.71   7.16   100</span></span>
<span><span class="co"># rape      18.64   2.87   5.96   0.39   3.55  59.79   8.79   100</span></span>
<span><span class="co"># robbery   15.75   0.18  24.59  31.14  27.04   1.31   0.00   100</span></span>
<span><span class="co"># assault   15.73  11.80   0.48  39.67  25.67   2.97   3.68   100</span></span>
<span><span class="co"># burglary  19.37   4.13   4.41   0.33   1.02  28.73  42.01   100</span></span>
<span><span class="co"># larceny   12.77  16.19  29.08   5.52   0.09   0.16  36.20   100</span></span>
<span><span class="co"># auto       8.71  25.24  32.31  17.58  13.67   0.33   2.16   100</span></span>
<span><span class="co"># Total    100.00 100.00 100.00 100.00 100.00 100.00 100.00    NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These contributions can be visualized as sorted barcharts for a given axis using <code><a href="https://rdrr.io/pkg/factoextra/man/fviz_contrib.html">factoextra::fviz_contrib()</a></code>. The dashed horizontal lines are at the average value for each dimension.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_contrib.html">fviz_contrib</a></span><span class="op">(</span><span class="va">crime.pca</span>, choice <span class="op">=</span> <span class="st">"var"</span>, axes <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   fill <span class="op">=</span> <span class="st">"lightgreen"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_contrib.html">fviz_contrib</a></span><span class="op">(</span><span class="va">crime.pca</span>, choice <span class="op">=</span> <span class="st">"var"</span>, axes <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   fill <span class="op">=</span> <span class="st">"lightgreen"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fviz-contrib" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fviz-contrib-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-fviz-contrib-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fviz-contrib-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.16: Contributions of the crime variables to dimensions 1 (left) &amp; 2 (right) of the PCA solution. The dashed horizontal lines show the average contribution for each dimension.
</figcaption></figure>
</div>
</div>
</div>
<p>A simple rubric for interpreting the dimensions in terms of the variable contributions is to mention those that are largest or above average on each dimension. So, burglary and rape contribute most to the first dimension, while murder and auto theft contribute most to the second.</p>
<p>Another useful measure is called <code>cos2</code>, the <em>quality</em> of representation, meaning how much of a variable is represented in a given component. The columns sum to the eigenvalue for each dimension. The rows each sum to 1.0, meaning each variable is completely represented on all components, but we can find the quality of a <span class="math inline">\(k\)</span>-D solution by summing the values in the first <span class="math inline">\(k\)</span> columns. These can be plotted in a style similar to <a href="#fig-fviz-contrib" class="quarto-xref">Figure&nbsp;<span>5.16</span></a> using <code><a href="https://rdrr.io/pkg/factoextra/man/fviz_cos2.html">factoextra::fviz_cos2()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">quality</span> <span class="op">&lt;-</span> <span class="va">var_info</span><span class="op">$</span><span class="va">cos2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">quality</span><span class="op">)</span></span>
<span><span class="co">#   murder     rape  robbery  assault burglary  larceny     auto </span></span>
<span><span class="co">#        1        1        1        1        1        1        1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">quality</span><span class="op">)</span></span>
<span><span class="co"># Dim.1 Dim.2 Dim.3 Dim.4 Dim.5 Dim.6 Dim.7 </span></span>
<span><span class="co"># 4.115 1.239 0.726 0.316 0.258 0.222 0.124</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">quality</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>      Total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">quality</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#          Dim.1 Dim.2 Total</span></span>
<span><span class="co"># murder    0.37  0.49  0.86</span></span>
<span><span class="co"># rape      0.77  0.04  0.80</span></span>
<span><span class="co"># robbery   0.65  0.00  0.65</span></span>
<span><span class="co"># assault   0.65  0.15  0.79</span></span>
<span><span class="co"># burglary  0.80  0.05  0.85</span></span>
<span><span class="co"># larceny   0.53  0.20  0.73</span></span>
<span><span class="co"># auto      0.36  0.31  0.67</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In two dimensions, murder and burglary are best represented; robbery and larceny are the worst, but as we saw above (<a href="#fig-crime-biplot3" class="quarto-xref">Figure&nbsp;<span>5.15</span></a>), these crimes are implicated in the third dimension.</p>
</section><section id="sec-supp-vars" class="level3" data-number="5.3.5"><h3 data-number="5.3.5" class="anchored" data-anchor-id="sec-supp-vars">
<span class="header-section-number">5.3.5</span> Supplementary variables</h3>
<p>An important feature of biplot methodology is that once you have a reduced-rank display of the relations among a set of variables, you can use <em>other available data</em> to help interpret what is shown in the biplot. In a sense, this is what I did above in <a href="#fig-crime-biplot2" class="quarto-xref">Figure&nbsp;<span>5.14</span></a> and <a href="#fig-crime-biplot3" class="quarto-xref">Figure&nbsp;<span>5.15</span></a> using <code>region</code> as a grouping variable and summarizing the variability in the scores for states with their data ellipses by region.</p>
<p>When we have other quantitative variables on the same observations, these can be represented as supplementary variables in the same space. Geometrically, this amounts to projecting the new variables on the space of the principal components. It is carried out by regressions of these supplementary variables on the scores for the principal component dimensions.</p>
<p>For example, the left panel of <a href="#fig-supp-regession" class="quarto-xref">Figure&nbsp;<span>5.17</span></a> depicts the vector geometry of a regression of a variable <span class="math inline">\(\mathbf{y}\)</span> on two predictors, <span class="math inline">\(\mathbf{x}_1\)</span> and <span class="math inline">\(\mathbf{x}_2\)</span>. The fitted vector, <span class="math inline">\(\widehat{\mathbf{y}}\)</span>, is the perpendicular projection of <span class="math inline">\(\mathbf{y}\)</span> onto the plane of <span class="math inline">\(\mathbf{x}_1\)</span> and <span class="math inline">\(\mathbf{x}_2\)</span>. In the same way, in the right panel, a <span style="color: green;">supplementary variable</span> is projected into the plane of two principal component axes shown as an ellipse. The black fitted vector shows how that additional variable relates to the biplot dimensions.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-supp-regession" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-supp-regession-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/pca4ds-figure-2-11.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-supp-regession-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.17: Fitting supplementary variables in a biplot is analogous (right) to regression on the principal component dimensions (left). <em>Source</em>: <span class="citation" data-cites="Aluja-etal-2018">Aluja et al. (<a href="95-references.html#ref-Aluja-etal-2018" role="doc-biblioref">2018</a>)</span>, Figure 2.11
</figcaption></figure>
</div>
</div>
</div>
<p>For this example, it happens that some suitable supplementary variables to aid interpretation of crime rates are available in the dataset <code>datsets::state.x77</code>, which was obtained from the U.S. Bureau of the Census <em>Statistical Abstract of the United States</em> for 1977. I select a few of these below and make the state name a column variable so it can be merged with the <code>crime</code> data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">supp_data</span> <span class="op">&lt;-</span> <span class="va">state.x77</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Life_Exp <span class="op">=</span> <span class="va">`Life Exp`</span>,</span>
<span>         HS_Grad <span class="op">=</span> <span class="va">`HS Grad`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">Income</span><span class="op">:</span><span class="va">Life_Exp</span>, <span class="va">HS_Grad</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">supp_data</span><span class="op">)</span></span>
<span><span class="co">#        state Income Illiteracy Life_Exp HS_Grad</span></span>
<span><span class="co"># 1    Alabama   3624        2.1     69.0    41.3</span></span>
<span><span class="co"># 2     Alaska   6315        1.5     69.3    66.7</span></span>
<span><span class="co"># 3    Arizona   4530        1.8     70.5    58.1</span></span>
<span><span class="co"># 4   Arkansas   3378        1.9     70.7    39.9</span></span>
<span><span class="co"># 5 California   5114        1.1     71.7    62.6</span></span>
<span><span class="co"># 6   Colorado   4884        0.7     72.1    63.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we can merge the <code>crime</code> data with the <code>supp_data</code> dataset to produce something suitable for analysis using <code>factoMineR::PCA()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime_joined</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">crime</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, <span class="va">supp_data</span>, by <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">crime_joined</span><span class="op">)</span></span>
<span><span class="co">#  [1] "state"      "murder"     "rape"       "robbery"   </span></span>
<span><span class="co">#  [5] "assault"    "burglary"   "larceny"    "auto"      </span></span>
<span><span class="co">#  [9] "Income"     "Illiteracy" "Life_Exp"   "HS_Grad"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/pkg/FactoMineR/man/PCA.html">PCA()</a></code> can only get the labels for the observations from the <code><a href="https://rdrr.io/r/base/row.names.html">row.names()</a></code> of the dataset, so I assign them explicitly. The supplementary variables are specified by the argument <code>quanti.sup</code> as the indices of the columns in what is passed as the data argument.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">crime_joined</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">crime</span><span class="op">$</span><span class="va">st</span></span>
<span><span class="va">crime.PCA_sup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/PCA.html">PCA</a></span><span class="op">(</span><span class="va">crime_joined</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                     quanti.sup <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">11</span>,</span>
<span>                     scale.unit<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                     ncp<span class="op">=</span><span class="fl">3</span>, </span>
<span>                     graph <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The essential difference between the result of <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code> used earlier to get the <code>crime.pca</code> object and the result of <code><a href="https://rdrr.io/pkg/FactoMineR/man/PCA.html">PCA()</a></code> with supplementary variables is that the <code>crime.PCA_sup</code> object now contains a <code>quanti.sup</code> component containing the coordinates for the supplementary variables in PCA space.</p>
<p>These can be calculated directly as a the coefficients of a multivariate regression of the <em>standardized</em> supplementary variables on the PCA scores for the dimensions, with no intercept—which forces the fitted vectors to go through the origin. For example, in the plot below (<a href="#fig-crime-factominer" class="quarto-xref">Figure&nbsp;<span>5.18</span></a>), the vector for Income has coordinates (0.192, -0.530) on the first two PCA dimensions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reg.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">supp_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                  <span class="va">crime.PCA_sup</span><span class="op">$</span><span class="va">ind</span><span class="op">$</span><span class="va">coord</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sup.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Income</span>, <span class="va">Illiteracy</span>, <span class="va">Life_Exp</span>, <span class="va">HS_Grad</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                    <span class="fl">0</span> <span class="op">+</span> <span class="va">Dim.1</span> <span class="op">+</span> <span class="va">Dim.2</span> <span class="op">+</span> <span class="va">Dim.3</span>, </span>
<span>              data <span class="op">=</span> <span class="va">reg.data</span> <span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">sup.mod</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#             Dim.1  Dim.2   Dim.3</span></span>
<span><span class="co"># Income      0.192  0.530  0.0482</span></span>
<span><span class="co"># Illiteracy  0.112 -0.536  0.1689</span></span>
<span><span class="co"># Life_Exp   -0.131  0.649 -0.2158</span></span>
<span><span class="co"># HS_Grad     0.103  0.610 -0.4095</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that, because the supplementary variables are standardized, these coefficients are the same as the correlations between the supplementary variables and the scores on the principal components, up to a scaling factor for each dimension. This provides a general way to relate dimensions found in other methods to the original data variables using vectors as in biplot techniques.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">reg.data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">reg.data</span><span class="op">[</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#             Dim.1  Dim.2   Dim.3</span></span>
<span><span class="co"># Income      0.393  0.596  0.0415</span></span>
<span><span class="co"># Illiteracy  0.230 -0.602  0.1453</span></span>
<span><span class="co"># Life_Exp   -0.268  0.730 -0.1857</span></span>
<span><span class="co"># HS_Grad     0.211  0.686 -0.3524</span></span>
<span></span>
<span><span class="va">R</span> <span class="op">/</span> <span class="va">coefs</span></span>
<span><span class="co">#            Dim.1 Dim.2 Dim.3</span></span>
<span><span class="co"># Income      2.05  1.12 0.861</span></span>
<span><span class="co"># Illiteracy  2.05  1.12 0.861</span></span>
<span><span class="co"># Life_Exp    2.05  1.12 0.861</span></span>
<span><span class="co"># HS_Grad     2.05  1.12 0.861</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/pkg/FactoMineR/man/PCA.html">PCA()</a></code> result can then be plotted using <code>FactoMiner::plot()</code> or various <code>factoextra</code> functions like <code><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html">fviz_pca_var()</a></code> for a plot of the variable vectors or <code><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html">fviz_pca_biplot()</a></code> for a biplot. When a <code>quanti.sup</code> component is present, supplementary variables are also shown in the displays.</p>
<p>For simplicity I use <code>FactoMiner::plot()</code> here and only show the variable vectors. For consistency with earlier plots, I first reflect the orientation of the 2nd PCA dimension so that crimes of personal violence are at the top, as in <a href="#fig-crime-vectors" class="quarto-xref">Figure&nbsp;<span>5.11</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># reverse coordinates of Dim 2</span></span>
<span><span class="va">crime.PCA_sup</span> <span class="op">&lt;-</span> <span class="fu">ggbiplot</span><span class="fu">::</span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/reflect.html">reflect</a></span><span class="op">(</span><span class="va">crime.PCA_sup</span>, columns <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">crime.PCA_sup</span>, choix <span class="op">=</span> <span class="st">"var"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-factominer" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crime-factominer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-crime-factominer-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crime-factominer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.18: PCA plot of variables for the crime data, with vectors for the supplementary variables showing their association with the principal component dimensions.
</figcaption></figure>
</div>
</div>
</div>
<p>Recall that from earlier analyses, I interpreted the the dominant PC1 dimension as reflecting overall rate of crime. The contributions to this dimension, which are the projections of the variable vectors on the horizontal axis in <a href="#fig-crime-vectors" class="quarto-xref">Figure&nbsp;<span>5.11</span></a> and <a href="#fig-crime-biplot2" class="quarto-xref">Figure&nbsp;<span>5.14</span></a> were shown graphically by barcharts in the left panel of <a href="#fig-fviz-contrib" class="quarto-xref">Figure&nbsp;<span>5.16</span></a>.</p>
<p>But now in <a href="#fig-crime-factominer" class="quarto-xref">Figure&nbsp;<span>5.18</span></a>, with the addition of variable vectors for the supplementary variables, you can see how income, rate of illiteracy, life expectancy and proportion of high school graduates are related to the variation in rates of crimes for the U.S. states.</p>
<p>On dimension 1, what stands out is that life expectancy is associated with lower overall crime, while other supplementary variable have positive associations. On dimension 2, crimes against persons (murder, assault, rape) are associated with greater rates of illiteracy among the states, which as we earlier saw (<a href="#fig-crime-biplot2" class="quarto-xref">Figure&nbsp;<span>5.14</span></a>) were more often Southern states. Crimes against property (auto theft, larceny) at the bottom of this dimension are associated with higher levels of income and high school graduates.</p>
</section><section id="example-diabetes-data" class="level3" data-number="5.3.6"><h3 data-number="5.3.6" class="anchored" data-anchor-id="example-diabetes-data">
<span class="header-section-number">5.3.6</span> Example: Diabetes data</h3>
<p>As another example, consider the data from <span class="citation" data-cites="ReavenMiller:79">Reaven &amp; Miller (<a href="95-references.html#ref-ReavenMiller:79" role="doc-biblioref">1979</a>)</span> on measures of insulin and glucose shown in <a href="01-Prelude.html#fig-diabetes1" class="quarto-xref">Figure&nbsp;<span>1.6</span></a> and that led to the discovery of two distinct types of development of Type 2 diabetes (<a href="01-Prelude.html#sec-discoveries" class="quarto-xref"><span>Section 1.5</span></a>). This dataset is available as <code>Diabetes</code>. The three groups are <code>Normal</code>, <code>Chemical_Diabetic</code> and <code>Overt_Diabetic</code>, and the (numerical) diagnostic variables are:</p>
<ul>
<li>
<code>relwt</code>: relative weight, the ratio of actual to expected weight, given the person’s height,</li>
<li>
<code>glufast</code>: fasting blood plasma glucose level</li>
<li>
<code>glutest</code>: test blood plasma glucose level, a measure of glucose intolerance</li>
<li>
<code>instest</code>: plasma insulin during test, a measure of insulin response to oral glucose</li>
<li>
<code>sspg</code>: steady state plasma glucose, a measure of insulin resistance</li>
</ul>
<p><strong>TODO</strong>: Should introduce 3D plots earlier, in Ch3 before <a href="04-multivariate_plots.html#sec-scatmat" class="quarto-xref"><span>Section 4.7</span></a>.</p>
<p>First, let’s try to create a 3D plot, analogous to the artist’s drawing from PRIM-9 shown in <a href="01-Prelude.html#fig-ReavenMiller-3d" class="quarto-xref">Figure&nbsp;<span>1.7</span></a>. For this, I use <code><a href="https://rdrr.io/pkg/car/man/scatter3d.html">car::scatter3d()</a></code> which can show data ellipsoids summarizing each group. The formula notation, <code>z ~ x + y</code> assigns the <code>z</code> variable to the vertical direction in the plot, and the <code>x</code> and <code>y</code> variable form a base plane. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatter3d.html">scatter3d</a></span><span class="op">(</span><span class="va">sspg</span> <span class="op">~</span> <span class="va">instest</span> <span class="op">+</span> <span class="va">glutest</span>, data<span class="op">=</span><span class="va">Diabetes</span>,</span>
<span>          groups <span class="op">=</span> <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span>,</span>
<span>          ellipsoid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          surface <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          col <span class="op">=</span> <span class="va">cols</span>,</span>
<span>          surface.col <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/pkg/car/man/scatter3d.html">car::scatter3d()</a></code> uses the <span style="color: brown;"><strong>rgl</strong></span> package <span class="citation" data-cites="R-rgl">(<a href="95-references.html#ref-R-rgl" role="doc-biblioref">Murdoch &amp; Adler, 2025</a>)</span> to render 3D graphics on a display device, which means that it has facilities for perspective, lighting and other visual properties. You can interactively zoom in or out or rotate the display in any of the three dimensions and use <code><a href="https://dmurdoch.github.io/rgl/dev/reference/spin3d.html">rgl::spin3d()</a></code> to animate rotations around any axes and record this a a <code>movie3d()</code>. <a href="#fig-diabetes-3d" class="quarto-xref">Figure&nbsp;<span>5.19</span></a> shows two views of this plot, one from the front and one from the back. The data ellipsoids are not as evocative as the artist’s rendering, but they give a sense of the relative sizes and shapes of the clouds of points for the three diagnostic groups.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diabetes-3d" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-3d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/diabetes-3d-both.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-3d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.19: Two views of a 3D scatterplot of three main diagnostic variables in the <code>Diabetes</code> dataset. The left panel shows an orientation similar to that of <a href="01-Prelude.html#fig-ReavenMiller-3d" class="quarto-xref">Figure&nbsp;<span>1.7</span></a>; the right panel shows a view from the back.
</figcaption></figure>
</div>
</div>
</div>
<p>The normal group is concentrated near the origin, with relatively low values on all three diagnostic measures. The chemical diabetic group forms a wing with higher values on insulin response to oral glucose (<code>instest</code>), while the overt diabetics form the other wing, with higher values on glucose intolerance (<code>glutest</code>). The relative sizes and orientations of the data ellipsoids are also informative.</p>
<p>Given this, what can we see in a biplot view based on PCA? The PCA of these data shows that 83% of the variance is captured in two dimensions and 96% in three. The result for 3D is interesting, in that the view from PRIM-9 shown in <a href="01-Prelude.html#fig-ReavenMiller-3d" class="quarto-xref">Figure&nbsp;<span>1.7</span></a> and <a href="#fig-diabetes-3d" class="quarto-xref">Figure&nbsp;<span>5.19</span></a> nearly captured all available information. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Diabetes</span>, package<span class="op">=</span><span class="st">"heplots"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diab.pca</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">Diabetes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span>scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">diab.pca</span><span class="op">)</span></span>
<span><span class="co"># Importance of components:</span></span>
<span><span class="co">#                          PC1   PC2   PC3    PC4     PC5</span></span>
<span><span class="co"># Standard deviation     1.662 1.177 0.818 0.3934 0.17589</span></span>
<span><span class="co"># Proportion of Variance 0.552 0.277 0.134 0.0309 0.00619</span></span>
<span><span class="co"># Cumulative Proportion  0.552 0.829 0.963 0.9938 1.00000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A 2D biplot, with data ellipses for the groups, can be produced as before, but I also want to illustrate labeling the groups directly, rather than in a legend.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggbiplot.html">ggbiplot</a></span><span class="op">(</span><span class="va">diab.pca</span>,</span>
<span>     obs.scale <span class="op">=</span> <span class="fl">1</span>, var.scale <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     groups <span class="op">=</span> <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span>,</span>
<span>     var.factor <span class="op">=</span> <span class="fl">1.4</span>,</span>
<span>     ellipse <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>     ellipse.prob <span class="op">=</span> <span class="fl">0.5</span>, ellipse.alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>     circle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     point.size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     varname.size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Group"</span>, color <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, find the centroids of the component scores and use <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label()</a></code> to plot the group labels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">diab.pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, group <span class="op">=</span> <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span><span class="va">centroids</span> <span class="op">&lt;-</span> <span class="va">scores</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>PC1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">PC1</span><span class="op">)</span>,</span>
<span>            PC2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">PC2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">centroids</span>, </span>
<span>                 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, </span>
<span>                     label<span class="op">=</span><span class="va">group</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,</span>
<span>                 nudge_y <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diabetes-ggbiplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-ggbiplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-diabetes-ggbiplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-ggbiplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.20: 2D biplot of the Diabetes data
</figcaption></figure>
</div>
</div>
</div>
<p>What can we see here, and how does it relate to the artist’s depiction shown earlier in <a href="01-Prelude.html#fig-ReavenMiller-3d" class="quarto-xref">Figure&nbsp;<span>1.7</span></a>? The variables <code>instest</code>, <code>sspg</code> and <code>glutest</code> correspond approximately to the coordinate axes in the artist’s drawing. <code>glutest</code> and <code>glufast</code> primarily separate the overt diabetics from the others. The chemical diabetics are distinguished by having larger values of insulin response (<code>instest</code>) and are also higher in relative weight (<code>relwt</code>).</p>
</section></section><section id="sec-nonlinear" class="level2" data-number="5.4"><h2 data-number="5.4" class="anchored" data-anchor-id="sec-nonlinear">
<span class="header-section-number">5.4</span> Nonlinear dimension reduction</h2>
<p>The world of dimension reduction methods reflected by PCA is a simple and attractive one in which relationships among variable are at least approximately linear, and can be made visible in a lower-dimensional view by linear transformations and projections. PCA does an optimal job of capturing <em>global</em> linear relationships in the data. But many phenomena defy linear description or involve <em>local</em> nonlinear relationships and clusters within the data. Our understanding of high-D data can sometimes be improved by nonlinear dimension reduction techniques.</p>
<p>To see why, consider the data shown in the left panel of <a href="#fig-nonlin-demo" class="quarto-xref">Figure&nbsp;<span>5.21</span></a> and suppose we want to be able to separate the two classes by a line. The groups are readily seen in this simple 2D example, but there is no linear combination or projection that shows them as distinct categories. The right panel shows the same data after a nonlinear transformation to polar coordinates, where the two groups are readily distinguished by radius. Such problems arise in higher dimensions where direct visualization is far more difficult and nonlinear methods become attractive.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-nonlin-demo" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-nonlin-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/nonlin-demo.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nonlin-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.21: <strong>Nonlinear patterns</strong>: Two representations of the same data are shown. In the plot at the left, the clusters are clear to the eye, but there is no linear relation that separates them. Transforming the data nonlinearly, to polar coordinates in the plot at the right, makes the two groups distinct.
</figcaption></figure>
</div>
</div>
</div>
<section id="multidimensional-scaling" class="level3" data-number="5.4.1"><h3 data-number="5.4.1" class="anchored" data-anchor-id="multidimensional-scaling">
<span class="header-section-number">5.4.1</span> Multidimensional scaling</h3>
<p>One way to break out of the “linear-combination, maximize-variance PCA” mold is to consider a more intrinsic property of points in <em>Spaceland</em>: similarity or distance. The earliest expression of this idea was in <strong>multidimensional scaling</strong> (MDS) by <span class="citation" data-cites="Torgerson1952">Torgerson (<a href="95-references.html#ref-Torgerson1952" role="doc-biblioref">1952</a>)</span>, which involved trying to determine a metric low-D representation of objects from their interpoint distances via an application of the SVD.</p>
<p>The break-through for nonlinear methods came from Roger Shepard and William Kruskal <span class="citation" data-cites="Shepard1962a Shepard1962b Kruskal1964">(<a href="95-references.html#ref-Kruskal1964" role="doc-biblioref">Kruskal, 1964</a>; <a href="95-references.html#ref-Shepard1962a" role="doc-biblioref">Shepard, 1962a</a>, <a href="95-references.html#ref-Shepard1962b" role="doc-biblioref">1962b</a>)</span> who recognized that a more general, <em>nonmetric</em> version (nMDS) could be achieved using only the <em>rank order</em> of input distances <span class="math inline">\(d_{ij}\)</span> among objects. nMDS maps these into a low-D spatial representation of points, <span class="math inline">\(\mathbf{x}_i, \mathbf{x}_j\)</span> whose fitted distances, <span class="math inline">\(\hat{d}_{ij} = \lVert\mathbf{x}_i - \mathbf{x}_j\rVert\)</span> matches the order of the <span class="math inline">\(d_{ij}\)</span> as closely as possible. That is, rather than assume that the observed distances are linearly related to the fitted <span class="math inline">\(\hat{d}_{ij}\)</span>, nMDS assumes only that their order is the same. <span class="citation" data-cites="BorgGroenen2005">Borg &amp; Groenen (<a href="95-references.html#ref-BorgGroenen2005" role="doc-biblioref">2005</a>)</span> and <span class="citation" data-cites="Borg2018">Borg et al. (<a href="95-references.html#ref-Borg2018" role="doc-biblioref">2018</a>)</span> give a comprehensive overview of modern developments in MDS.</p>
<p>The impetus for MDS stemmed largely from psychology and the behavioral sciences, where simple experimental measures of similarity or dissimilarity of psychological objects (color names, facial expressions, words, Morse code symbols) could be obtained by direct ratings, confusions, or other tasks <span class="citation" data-cites="Shepard-etal-1972a Shepard-etal-1972b">(<a href="95-references.html#ref-Shepard-etal-1972a" role="doc-biblioref">Shepard et al., 1972b</a>, <a href="95-references.html#ref-Shepard-etal-1972b" role="doc-biblioref">1972a</a>)</span>. MDS was revolutionary in that it provided a coherent method to study the dimensions of perceptual and cognitive space in applications where the explanation of a cognitive process was derived directly from an MDS solution <span class="citation" data-cites="Shoben1983">(<a href="95-references.html#ref-Shoben1983" role="doc-biblioref">Shoben, 1983</a>)</span>.</p>
<p>To perform nMDS, you need to calculate the matrix of distances between all pairs of observations (<code><a href="https://rdrr.io/r/stats/dist.html">dist()</a></code>). The basic function is <code><a href="https://rdrr.io/pkg/MASS/man/isoMDS.html">MASS::isoMDS()</a></code>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> In the call, you can specify the number of dimensions (<code>k</code>) desired, with <code>k=2</code> as default. It returns the coordinates in a dataset called <code>points</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diab.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">Diabetes</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mds</span> <span class="op">&lt;-</span> <span class="va">diab.dist</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/isoMDS.html">isoMDS</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"points"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dim1"</span>, <span class="st">"Dim2"</span><span class="op">)</span></span>
<span><span class="va">mds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">mds</span>, group <span class="op">=</span> <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span><span class="va">mds</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 6 × 3</span></span>
<span><span class="co">#     Dim1   Dim2 group            </span></span>
<span><span class="co">#    &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;            </span></span>
<span><span class="co"># 1 -213.  -42.1  Normal           </span></span>
<span><span class="co"># 2  191.   47.3  Overt_Diabetic   </span></span>
<span><span class="co"># 3   12.0 -63.2  Overt_Diabetic   </span></span>
<span><span class="co"># 4   25.0 -38.1  Chemical_Diabetic</span></span>
<span><span class="co"># 5  774.    9.44 Overt_Diabetic   </span></span>
<span><span class="co"># 6   79.0 136.   Overt_Diabetic</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The method works by trying to minimize a measure, “Stress”, of the average difference between the fitted distances <span class="math inline">\(\hat{d}_{ij}\)</span> and an optimal monotonic (order-preserving) transformation, <span class="math inline">\(f_{\text{mon}}(d_{ij})\)</span>, of the distances in the data. Values of Stress around 5-8% and smaller are generally considered adequate.</p>
<p>Unlike PCA, where you can fit all possible dimensions once and choose the number of components to retain by examining the eigenvalues or variance proportions, in MDS it is necessary to fit the data for several values of <code>k</code> and consider the trade-off between goodness of fit and complexity.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">stress</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/isoMDS.html">isoMDS</a></span><span class="op">(</span><span class="va">diab.dist</span>, k<span class="op">=</span><span class="va">k</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">stress</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">stress</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">stress</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># [1] 17.755  3.525  0.256  0.000  0.000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting these shows that a 3D solution is nearly perfect, while a 2D solution is certainly adequate. This plot is the MDS analog of a screeplot for PCA.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">stress</span>, type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Number of dimensions"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Stress (%)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diabetes-stress" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-stress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-diabetes-stress-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-stress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.22: Badness of fit (Stress) of the MDS solution in relation to number of dimensions.
</figcaption></figure>
</div>
</div>
</div>
<p>To plot the 2D solution, I’ll use <code><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html">ggpubr::ggscatter()</a></code> here because it handles grouping, provides concentration ellipses and other graphical features.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mplot</span> <span class="op">&lt;-</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html">ggscatter</a></span><span class="op">(</span><span class="va">mds</span>, x <span class="op">=</span> <span class="st">"Dim1"</span>, y <span class="op">=</span> <span class="st">"Dim2"</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>          shape <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>          palette <span class="op">=</span> <span class="va">cols</span>,</span>
<span>          size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          ellipse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          ellipse.level <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>          ellipse.type <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this and other examples using MDS, it would be nice to also show how the dimensions of this space relate to the original variables, as in a biplot. Using the idea of correlations between variables and dimensions from <a href="#sec-supp-vars" class="quarto-xref"><span>Section 5.3.5</span></a>, I do this as shown below. Only the relative directions and lengths of the variable vectors matter, so you can choose any convenient scale factor to make the vectors fill the plot region.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Diabetes</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">mds</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">scale_fac</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">mplot</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">vectors</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, xend<span class="op">=</span><span class="va">scale_fac</span><span class="op">*</span><span class="va">Dim1</span>, y<span class="op">=</span><span class="fl">0</span>, yend<span class="op">=</span><span class="va">scale_fac</span><span class="op">*</span><span class="va">Dim2</span><span class="op">)</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span>,</span>
<span>               linewidth <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vectors</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.15</span><span class="op">*</span><span class="va">scale_fac</span><span class="op">*</span><span class="va">Dim1</span>, y <span class="op">=</span> <span class="fl">1.07</span><span class="op">*</span><span class="va">scale_fac</span><span class="op">*</span><span class="va">Dim2</span>, </span>
<span>                label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">vectors</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">4</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.8</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diabetes-mds" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-mds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-diabetes-mds-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-mds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.23: Nonmetric MDS representation of the Diabetes data. The vectors reflect the correlations of the variables with the MDS dimensions.
</figcaption></figure>
</div>
</div>
</div>
<p>The configuration of the groups in <a href="#fig-diabetes-mds" class="quarto-xref">Figure&nbsp;<span>5.23</span></a> is similar to that of the biplot in <a href="#fig-diabetes-ggbiplot" class="quarto-xref">Figure&nbsp;<span>5.20</span></a>, but the groups are more widely separated along the first MDS dimension. The variable vectors are also similar, except that <code>relwt</code> is not well-represented in the MDS solution.</p>
</section><section id="t-sne" class="level3" data-number="5.4.2"><h3 data-number="5.4.2" class="anchored" data-anchor-id="t-sne">
<span class="header-section-number">5.4.2</span> t-SNE</h3>
<p>With the rise of “machine learning” methods for “feature extraction” in “supervised” vs.&nbsp;“unsupervised” settings, a variety of new algorithms have been proposed for the task of finding low-D representations of high-D data. Among these, t-distributed Stochastic Neighbor Embedding (t-SNE) developed by <span class="citation" data-cites="MaatenHinton2008">Maaten &amp; Hinton (<a href="95-references.html#ref-MaatenHinton2008" role="doc-biblioref">2008</a>)</span> is touted as method for revealing <em>local structure</em> and clustering better in possibly complex high-D data and at different scales.</p>
<p>t-SNE differs from MDS in what it tries to preserve in the mapping to low-D space: Multidimensional scaling aims to preserve the distances between pairs of data points, focusing on pairs of <em>distant points</em> in the original space. t-SNE, on the other hand focuses on preserving <em>neighboring</em> data points. Data points that are close in the original data space will be tight in the t-SNE embeddings.</p>
<!-- Simpler description, from: https://www.displayr.com/using-t-sne-to-visualize-data-before-prediction/ -->
<p>“The t-SNE algorithm models the probability distribution of neighbors around each point. Here, the term <em>neighbors</em> refers to the set of points which are closest to each point. In the original, high-dimensional space, this is modeled as a Gaussian distribution. In the 2-dimensional output space this is modeled as a <span class="math inline">\(t\)</span>-distribution. The goal of the procedure is to find a mapping onto the 2-dimensional space that minimizes the differences between these two distributions over all points. The fatter tails of a <span class="math inline">\(t\)</span>-distribution compared to a Gaussian help to spread the points more evenly in the 2-dimensional space.” (Jake Hoare, <a href="https://www.displayr.com/using-t-sne-to-visualize-data-before-prediction/">How t-SNE works and Dimensionality Reduction</a>).</p>
<p>t-SNE also uses the idea of mapping distance measures into a low-D space, but converts Euclidean distances into conditional probabilities. Stochastic neighbor embedding means that t-SNE constructs a probability distribution over pairs of high-dimensional objects in such a way that similar objects are assigned a higher probability while dissimilar points are assigned a lower probability.</p>
<p>As van der Maaten and Hinton explained: “The similarity of datapoint <span class="math inline">\(\mathbf{x}_{j}\)</span> to datapoint <span class="math inline">\(\mathbf{x}_{i}\)</span> is the conditional probability, <span class="math inline">\(p_{j|i}\)</span>, that <span class="math inline">\(\mathbf{x}_{i}\)</span> would pick <span class="math inline">\(\mathbf{x}_{j}\)</span> as its neighbor if neighbors were picked in proportion to their probability density under a Gaussian distribution centered at <span class="math inline">\(\mathbf{x}_{i}\)</span>.” For <span class="math inline">\(i \ne j\)</span>, they define:</p>
<p><span class="math display">\[
p_{j\mid i} = \frac{\exp(-\lVert\mathbf{x}_i - \mathbf{x}_j\rVert^2 / 2\sigma_i^2)}{\sum_{k \neq i} \exp(-\lVert\mathbf{x}_i - \mathbf{x}_k\rVert^2 / 2\sigma_i^2)} \;.
\]</span> and set <span class="math inline">\(p_{i\mid i} = 0\)</span>. <span class="math inline">\(\sigma^2_i\)</span> is the variance of the normal distribution that centered on datapoint <span class="math inline">\(\mathbf{x}_{i}\)</span> and serves as a tuning bandwidth so smaller values of <span class="math inline">\(\sigma _{i}\)</span> are used in denser parts of the data space. These conditional probabilities are made symmetric via averaging, giving <span class="math inline">\(p_{ij} = \frac{p_{j\mid i} + p_{i\mid j}}{2n}\)</span>.</p>
<p>t-SNE defines a similar probability distribution <span class="math inline">\(q_{ij}\)</span> over the points <span class="math inline">\(\mathbf{y}_i\)</span> in the low-dimensional map, and it minimizes the Kullback–Leibler divergence (KL divergence) between the two distributions with respect to the locations of the points in the map,</p>
<p><span class="math display">\[
D_\mathrm{KL}\left(P \parallel Q\right) = \sum_{i \neq j} p_{ij} \log \frac{p_{ij}}{q_{ij}} \; ,
\]</span> a measure of how different the distribution of <span class="math inline">\(P\)</span> in the data is from that of <span class="math inline">\(Q\)</span> in the low-D representation. The <em>t</em> in t-SNE comes from the fact that the probability distribution of the points <span class="math inline">\(\mathbf{y}_i\)</span> in the embedding space is taken to be a heavy-tailed <span class="math inline">\(t_{(1)}\)</span> distribution with one degree of freedom to spread the points more evenly in the 2-dimensional space, rather than the Gaussian distribution for the points in the high-D data space.</p>
<p>t-SNE is implemented in the <span style="color: brown;"><strong>Rtsne</strong></span> package <span class="citation" data-cites="R-Rtsne">(<a href="95-references.html#ref-R-Rtsne" role="doc-biblioref">Krijthe, 2023</a>)</span> which is capable of handling thousands of points in very high dimensions. It uses a tuning parameter, “perplexity” to choose the bandwidth <span class="math inline">\(\sigma^2_i\)</span> for each point. This value effectively controls how many nearest neighbors are taken into account when constructing the embedding in the low-dimensional space. It can be thought of as the means to balance between preserving the global and the local structure of the data.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p><code><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html">Rtsne::Rtsne()</a></code> finds the locations of the points in the low-D space, of dimension <code>k=2</code> by default. It returns the coordinates in a component named <code>Y</code>. The package has no <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> or plot methods, so you’re on your own.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jkrijthe/Rtsne">Rtsne</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> </span>
<span><span class="va">diab.tsne</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html">Rtsne</a></span><span class="op">(</span><span class="va">Diabetes</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">diab.tsne</span><span class="op">$</span><span class="va">Y</span>, group <span class="op">=</span> <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dim1"</span>, <span class="st">"Dim2"</span>, <span class="st">"group"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can plot this as shown below:</p>
<!-- fig.code: R/diabetes/diabetes-pca-tsne.R -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Dim1</span>, y<span class="op">=</span><span class="va">Dim2</span>, color <span class="op">=</span> <span class="va">group</span>, shape<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fl">0.68</span>, linewidth<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Dimension 1"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Dimension 2"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"tSNE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> </span>
<span><span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diabetes-tsne" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-tsne-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-diabetes-tsne-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-tsne-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.24: t-SNE representation of the Diabetes data with data ellipses for the diagnostic groups.
</figcaption></figure>
</div>
</div>
</div>
<section id="compare-solutions" class="level4" data-number="5.4.2.1"><h4 data-number="5.4.2.1" class="anchored" data-anchor-id="compare-solutions">
<span class="header-section-number">5.4.2.1</span> Comparing solutions</h4>
<p>For the Diabetes data, I’ve shown the results of three different dimension reduction techniques, PCA (<a href="#fig-diabetes-ggbiplot" class="quarto-xref">Figure&nbsp;<span>5.20</span></a>), MDS (<a href="#fig-diabetes-mds" class="quarto-xref">Figure&nbsp;<span>5.23</span></a>), and t-SNE (<a href="#fig-diabetes-tsne" class="quarto-xref">Figure&nbsp;<span>5.24</span></a>). How are these similar, and how do they differ?</p>
<p>One way is to view them side by side as shown in <a href="#fig-diabetes-pca-tsne" class="quarto-xref">Figure&nbsp;<span>5.25</span></a>. To an initial glance, the t-SNE solution looks like a rotated version of the PCA solution, but there are differences in the shapes of the clusters as well.</p>
<!-- fig.code: R/diabetes/diabetes-pca-tsne.R -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diabetes-pca-tsne" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-pca-tsne-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/diabetes-pca-tsne.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-pca-tsne-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.25: Comparison of the PCA and t-SNE 2D representations of the Diabetes data.
</figcaption></figure>
</div>
</div>
</div>
<p>Another way to compare these two views is to animate the transition from the PCA to the t-SNE representation by a series of smooth interpolated views. This is a more generally useful visualization technique, so it is useful to spell out the details.</p>
<p>The essential idea is calculate interpolated views as a weighted average of the two endpoints using a weight <span class="math inline">\(\gamma\)</span> that is varied from 0 to 1.</p>
<p><span class="math display">\[
\mathbf{X}_{\text{View}} = \gamma \;\mathbf{X}_{\text{PCA}} + (1-\gamma) \;\mathbf{X}_{\text{t-SNE}}
\]</span> The same idea can be applied to other graphical features: lines, paths (ellipses), and so forth. These methods are implemented in the <span style="color: brown;"><strong>gganimate</strong></span> package <span class="citation" data-cites="R-gganimate">(<a href="95-references.html#ref-R-gganimate" role="doc-biblioref">Pedersen &amp; Robinson, 2025</a>)</span>.</p>
<p>In this case, to create an animation you can extract the coordinates for the PCA, <span class="math inline">\(\mathbf{X}_{\text{PCA}}\)</span>, as a data.frame <code>df1</code>, and those for the t-SNE, <span class="math inline">\(\mathbf{X}_{\text{t-SNE}}\)</span> as <code>df2</code>, each with a constant <code>method</code> variable. These two are then stacked (using <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>) to give a combined <code>df3</code>. The animation can then interpolate over <code>method</code> going from pure PCA to pure t-SNE.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diab.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">Diabetes</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, rank.<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">diab.pca</span><span class="op">$</span><span class="va">x</span>, group <span class="op">=</span> <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dim1"</span>, <span class="st">"Dim2"</span>, <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df1</span>, method<span class="op">=</span><span class="st">"PCA"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> </span>
<span><span class="va">diab.tsne</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html">Rtsne</a></span><span class="op">(</span><span class="va">Diabetes</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">diab.tsne</span><span class="op">$</span><span class="va">Y</span>, group <span class="op">=</span> <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dim1"</span>, <span class="st">"Dim2"</span>, <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df2</span>, method<span class="op">=</span><span class="st">"tSNE"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># stack the PCA and t-SNE solutions</span></span>
<span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, plot the configuration of the points and add data ellipses as before. The key thing for animating the difference between the solutions is to add <code>transition_states(method, ...)</code>, tweening from PCA to t-SNE. The <code>state_length</code> argument <code><a href="https://gganimate.com/reference/transition_states.html">transition_states()</a></code> controls the relative length of the pause between states.</p>
<p>This animated graphic is shown only in the online version of the book.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span></span>
<span><span class="va">animated_plot</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Dim1</span>, y<span class="op">=</span><span class="va">Dim2</span>, color<span class="op">=</span><span class="va">group</span>, shape<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fl">0.68</span>, linewidth<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"PCA vs. tSNE Dimension Reduction: {closest_state}"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Frame {frame} of {nframes}"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Dimension 1"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Dimension 2"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_states.html">transition_states</a></span><span class="op">(</span> <span class="va">method</span>, transition_length <span class="op">=</span> <span class="fl">3</span>, state_length <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/view_follow.html">view_follow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">animated_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diabetes-pca-tsne-anim-gif" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diabetes-pca-tsne-anim-gif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/diabetes-pca-tsne.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diabetes-pca-tsne-anim-gif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.26: Animation of the relationship of PCA to the t-SNE embedding for the Diabetes data. The method name in the title reflects the closest state
</figcaption></figure>
</div>
</div>
</div>
<p>You can see that the PCA configuration is morphed into the that for t-SNE largely by rotation 90<span class="math inline">\(^o\)</span> clockwise, so that dimension 1 in PCA becomes dimension 2 in t-SNE. This is not unexpected, because PCA finds the dimensions in to order of maximum variance, whereas t-SNE is only trying to match the distances in the data to those in the solution. To interpret the result from t-SNE you are free to interchange the axes, or indeed to rotate the solution arbitrarily.</p>
<p>It is more interesting that the sizes and shapes of the group clusters change from one solution to the other. The normal group is most compact in the PCA solution, but becomes the least compact in t-SNE.</p>
</section></section></section><section id="sec-var-order" class="level2" data-number="5.5"><h2 data-number="5.5" class="anchored" data-anchor-id="sec-var-order">
<span class="header-section-number">5.5</span> Application: Variable ordering for data displays</h2>
<p>In many multivariate data displays, such as scatterplot matrices, parallel coordinate plots and others reviewed in <a href="04-multivariate_plots.html" class="quarto-xref"><span>Chapter 4</span></a>, the order of different variables might seem arbitrary. They might appear in alphabetic order, or more often in the order they appear in your dataset, for example when you use <code>pairs(mydata)</code>. Yet, the principle of <em>effect ordering</em> (<span class="citation" data-cites="FriendlyKwan:03:effect">Friendly &amp; Kwan (<a href="95-references.html#ref-FriendlyKwan:03:effect" role="doc-biblioref">2003</a>)</span>) for variables says you should try to arrange the variables so that adjacent ones are as similar as possible.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>For example, the <code>mtcars</code> dataset contains data on 32 automobiles from the 1974 U.S. magazine <em>Motor Trend</em> and consists of fuel comsumption (<code>mpg</code>) and 10 aspects of automobile design (<code>cyl</code>: number of cyliners; <code>hp</code>: horsepower, <code>wt</code>: weight) and performance (<code>qsec</code>: time to drive a quarter-mile). What can we see from a simple <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot()</a></code> of their correlations? No coherent pattern stands out in <a href="#fig-mtcars-corrplot-varorder" class="quarto-xref">Figure&nbsp;<span>5.27</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot">corrplot</a></span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">R</span>, </span>
<span>         method <span class="op">=</span> <span class="st">'ellipse'</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"Dataset variable order"</span>,</span>
<span>         tl.srt <span class="op">=</span> <span class="fl">0</span>, tl.col <span class="op">=</span> <span class="st">"black"</span>, tl.pos <span class="op">=</span> <span class="st">'d'</span>,</span>
<span>         mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mtcars-corrplot-varorder" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mtcars-corrplot-varorder-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-mtcars-corrplot-varorder-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mtcars-corrplot-varorder-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.27: Corrplot of <code>mtcars</code> data, with the variables arranged in the order they appear in the dataset.
</figcaption></figure>
</div>
</div>
</div>
<p>In this display you can scan the rows and columns to “look up” the sign and approximate magnitude of a given correlation; for example, the correlation between <code>mpg</code> and <code>cyl</code> appears to be about -0.9, while that between <code>mpg</code> and <code>gear</code> is about 0.5. Of course, you could print the correlation matrix to find the actual values (-0.86 and 0.48 respectively):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb55" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">R</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#      mpg cyl disp  hp drat  wt qsec  vs  am gear carb</span></span>
<span><span class="co"># mpg  100 -86  -85 -78   68 -87   41  66  59   48  -56</span></span>
<span><span class="co"># cyl  -86 100   90  83  -70  78  -60 -82 -53  -50   52</span></span>
<span><span class="co"># disp -85  90  100  79  -72  88  -44 -72 -60  -56   39</span></span>
<span><span class="co"># hp   -78  83   79 100  -45  65  -71 -73 -25  -13   74</span></span>
<span><span class="co"># drat  68 -70  -72 -45  100 -72    9  44  71   69  -10</span></span>
<span><span class="co"># wt   -87  78   88  65  -72 100  -18 -56 -70  -59   42</span></span>
<span><span class="co"># qsec  41 -60  -44 -71    9 -18  100  74 -23  -22  -66</span></span>
<span><span class="co"># vs    66 -82  -72 -73   44 -56   74 100  16   20  -57</span></span>
<span><span class="co"># am    59 -53  -60 -25   71 -70  -23  16 100   79    5</span></span>
<span><span class="co"># gear  48 -50  -56 -13   69 -59  -22  20  79  100   27</span></span>
<span><span class="co"># carb -56  52   39  74  -10  42  -66 -57   5   27  100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because the angles between variable vectors in the biplot reflect their correlations, <span class="citation" data-cites="FriendlyKwan:03:effect">Friendly &amp; Kwan (<a href="95-references.html#ref-FriendlyKwan:03:effect" role="doc-biblioref">2003</a>)</span> defined <strong>principal component variable ordering</strong> as the order of angles, <span class="math inline">\(a_i\)</span> of the first two eigenvectors, <span class="math inline">\(\mathbf{v}_1, \mathbf{v}_2\)</span> around the unit circle. These values are calculated going counter-clockwise from the 12:00 position as:</p>
<p><span id="eq-angle-AOE"><span class="math display">\[
a_i =
  \begin{cases}
    \tan^{-1} (v_{i2}/v_{i1}), &amp; \text{if $v_{i1}&gt;0$;}
     \\
    \tan^{-1} (v_{i2}/v_{i1}) + \pi, &amp; \text{otherwise.}
  \end{cases}     
\tag{5.3}\]</span></span></p>
<p>In <a href="#eq-angle-AOE" class="quarto-xref">Equation&nbsp;<span>5.3</span></a> <span class="math inline">\(\tan^{-1}(x)\)</span> is read as “the angle whose tangent is <span class="math inline">\(x\)</span>”, and so the angles are determined by the tangent ratios “opposite” / “adjacent” = <span class="math inline">\(v_{i2} / v_{i1}\)</span> in the right triangle defined by the vector and the horizontal axis.</p>
<!-- **TODO**: Make a diagram of this -->
<p>For the <code>mtcars</code> data the biplot in <a href="#fig-mtcars-biplot" class="quarto-xref">Figure&nbsp;<span>5.28</span></a> accounts for 84% of the total variance so a 2D representation is fairly good. The plot shows the variables as widely dispersed. There is a collection at the left of positively correlated variables and another positively correlated set at the right.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb56" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mtcars.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">mtcars</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggbiplot.html">ggbiplot</a></span><span class="op">(</span><span class="va">mtcars.pca</span>,</span>
<span>         circle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         point.size <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>         varname.size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>         varname.color <span class="op">=</span> <span class="st">"brown"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mtcars-biplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mtcars-biplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-mtcars-biplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mtcars-biplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.28: Biplot of the <code>mtcars</code> data. The order of the variables around the circle, starting from “gear” (say) arranges them so that the most similar variables are adjacent in graphical displays.
</figcaption></figure>
</div>
</div>
</div>
<p>In <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot()</a></code> principal component variable ordering is implemented using the <code>order = "AOE"</code> option. There are a variety of other methods based on hierarchical cluster analysis described in the <a href="https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html">package vignette</a>.</p>
<p><a href="#fig-mtcars-corrplot-pcaorder" class="quarto-xref">Figure&nbsp;<span>5.29</span></a> shows the result of ordering the variables by this method. A nice feature of <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot()</a></code> is the ability to manually highlight blocks of variables that have a similar pattern of signs by outlining them with rectangles. From the biplot, the two main clusters of positively correlated variables seemed clear, and are outlined in the plot using <code><a href="https://rdrr.io/pkg/corrplot/man/corrRect.html">corrplot::corrRect()</a></code>. What became clear in the corrplot is that <code>qsec</code>, the time to drive a quarter-mile from a dead start didn’t quite fit this pattern, so I highlighted it separately.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">R</span>, </span>
<span>         method <span class="op">=</span> <span class="st">'ellipse'</span>, </span>
<span>         order <span class="op">=</span> <span class="st">"AOE"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"PCA variable order"</span>,</span>
<span>         tl.srt <span class="op">=</span> <span class="fl">0</span>, tl.col <span class="op">=</span> <span class="st">"black"</span>, tl.pos <span class="op">=</span> <span class="st">'d'</span>,</span>
<span>         mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrRect.html">corrRect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mtcars-corrplot-pcaorder" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mtcars-corrplot-pcaorder-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-mtcars-corrplot-pcaorder-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mtcars-corrplot-pcaorder-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.29: Corrplot of <code>mtcars</code> data, with the variables ordered according to the variable vectors in the biplot.
</figcaption></figure>
</div>
</div>
</div>
<p>But wait, there is something else to be seen in <a href="#fig-mtcars-corrplot-pcaorder" class="quarto-xref">Figure&nbsp;<span>5.29</span></a>. Can you see one cell that doesn’t fit with the rest?</p>
<p>Yes, the correlation of number of forward gears (<code>gear</code>) and number of carburators (<code>carb</code>) in the upper left and lower right corners stands out as moderately positive (0.27) while all the others in their off-diagonal blocks are negative. This is another benefit of effect ordering: when you arrange the variables so that the most highly related variable are together, features that deviate from dominant pattern become visible.</p>
</section><section id="sec-eigenfaces" class="level2" data-number="5.6"><h2 data-number="5.6" class="anchored" data-anchor-id="sec-eigenfaces">
<span class="header-section-number">5.6</span> Application: Eigenfaces</h2>
<p>There are many applications of principal components analysis beyond the use for visualization for multivariate data covered here, that rely on its’ ability as a <strong>dimension reduction</strong> technique, that is, to find a low-dimensional approximation to a high-dimensional dataset.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Machine learning uses">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Machine learning uses
</div>
</div>
<div class="callout-body-container callout-body">
<p>In machine learning, for example, PCA is a method used to reduce model complexity and avoid overfitting by <em>feature extraction</em>, which amounts to fitting a response variable in a low-D space of the predictors. This is just another name for <em>principal components regression</em>, where, instead of regressing the dependent variable on all the explanatory variables directly, a smaller number principal components of the explanatory variables is used as predictors. This has the added benefit that it avoids problems of collinearity (section-ref) due to high correlations of the predictors, because the principal component scores are necessarily uncorrelated. When the goal is model explanation rather than pure prediction, it has the disadvantage that the components may be hard to interpret.</p>
</div>
</div>
<p>An interesting class of problems have to do with image processing, where an image of size width <span class="math inline">\(\times\)</span> height in pixels can be represented by a <span class="math inline">\(w \times h\)</span> array of greyscale values <span class="math inline">\(x_{ij}\)</span> in the range of [0, 1] or <span class="math inline">\(h \times w \times 3\)</span> array <span class="math inline">\(x_{ijk}\)</span> of (<span style="color: red;">red</span>, <span style="color: green;">green</span>, <span style="color: blue;">blue</span>) color values. For example a single <span class="math inline">\(640 \times 640\)</span> photo is comprised of about 400K pixels in B/W and 1200K pixels in color.</p>
<p>The uses here include</p>
<ul>
<li>
<strong>Image compression</strong>: a process applied to a graphics file to minimize its size in bytes for storage or transmission, without degrading image quality below an acceptable threshold</li>
<li>
<strong>image enhancement</strong>: improving the quality of an image, with applications in Computer Vision tasks, remote sensing, and satellite imagery.</li>
<li>
<strong>facial recognition</strong>: classifying or matching a facial image against a large corpus of stored images.</li>
</ul>
<p>When PCA is used on facial images, you can think of the process as generating <strong>eigenfaces</strong> (<span class="citation" data-cites="Turk1991">Turk &amp; Pentland (<a href="95-references.html#ref-Turk1991" role="doc-biblioref">1991</a>)</span>) a representation of the pixels in the image in terms of an eigenvalue decomposition. Dimension reduction means that a facial image can be considerably compressed by removing the components associated with small dimensions.</p>
<p>As an example, consider the black and white version of the Mona Lisa shown in <a href="#fig-MonaLisa" class="quarto-xref">Figure&nbsp;<span>5.30</span></a>. The idea and code for this example is adapted from this <a href="https://kieranhealy.org/blog/archives/2019/10/27/reconstructing-images-using-pca/">blog post</a> by Kieran Healy.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<!-- **TODO**: Web links like this should be footnotes for PDF -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-MonaLisa" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-MonaLisa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/MonaLisa-BW.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:35.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-MonaLisa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.30: 640 x 954 black and white image of the <em>Mona Lisa</em>. <em>Source</em>: <a href="https://bit.ly/3Rgo41f">Wikipedia</a>
</figcaption></figure>
</div>
</div>
</div>
<p>It would take too long to explain the entire method, so I’ll just sketch the essential parts here. The complete script for this example is contained in <a href="R/PCA-MonaLisa.R">PCA-MonaLisa.R</a>. …</p>
<!-- **TODO**: Show the necessary parts, including the screeplot. -->
<p>An image can be imported using <code><a href="https://rdrr.io/pkg/imager/man/load.image.html">imager::load.image()</a></code> which creates a <code>"cimg"</code> object, a 4-dimensional array with dimensions named <code>x,y,z,c</code>. <code>x</code> and <code>y</code> are the usual spatial dimensions, <code>z</code> is a depth dimension (which would correspond to time in a movie), and <code>c</code> is a color dimension containing R, G, B values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb58" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://asgr.github.io/imager/">imager</a></span><span class="op">)</span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu">imager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/imager/man/load.image.html">load.image</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"images"</span>, <span class="st">"MonaLisa-BW.jpg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span>
<span><span class="co"># [1] 640 954   1   1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- img <- imager::load.image("https://github.com/friendly/Vis-MLM-book/blob/master/images/MonaLisa-BW.jpg?raw=true") -->
<p>An <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> method converts this to a data frame with <code>x</code> and <code>y</code> coordinates. Each x-y pair is a location in the 640 by 954 pixel grid, and the <code>value</code> is a grayscale value ranging from zero to one.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">img_df_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">img_df_long</span><span class="op">)</span></span>
<span><span class="co">#   x y value</span></span>
<span><span class="co"># 1 1 1 0.431</span></span>
<span><span class="co"># 2 2 1 0.337</span></span>
<span><span class="co"># 3 3 1 0.467</span></span>
<span><span class="co"># 4 4 1 0.337</span></span>
<span><span class="co"># 5 5 1 0.376</span></span>
<span><span class="co"># 6 6 1 0.361</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, to do a PCA we will need a matrix of data in wide format containing the grayscale pixel values. We can do this using <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">tidyr::pivot_wider()</a></code>, giving a result with 640 rows and 954 columns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb60" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">img_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span><span class="va">img_df_long</span>, </span>
<span>                     names_from <span class="op">=</span> <span class="va">y</span>, </span>
<span>                     values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">img_df</span><span class="op">)</span></span>
<span><span class="co"># [1] 640 954</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mona’s PCA is produced from this <code>img_df</code> with <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb61" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">img_pca</span> <span class="op">&lt;-</span> <span class="va">img_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With 955 columns, the PCA comprises 955 eigenvalue/eigenvector pairs. However, the rank of a matrix is the smaller of the number of rows and columns, so only 640 eigenvalues can be non-zero. Printing the first 10 shows that the first three dimensions account for 46% of the variance and we only get to 63% with 10 components.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb62" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">img_pca</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"eigenvalues"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 10 × 4</span></span>
<span><span class="co">#       PC std.dev percent cumulative</span></span>
<span><span class="co">#    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#  1     1   14.1  0.209        0.209</span></span>
<span><span class="co">#  2     2   11.6  0.141        0.350</span></span>
<span><span class="co">#  3     3   10.1  0.107        0.457</span></span>
<span><span class="co">#  4     4    7.83 0.0643       0.522</span></span>
<span><span class="co">#  5     5    6.11 0.0392       0.561</span></span>
<span><span class="co">#  6     6    4.75 0.0237       0.585</span></span>
<span><span class="co">#  7     7    3.70 0.0143       0.599</span></span>
<span><span class="co">#  8     8    3.52 0.0130       0.612</span></span>
<span><span class="co">#  9     9    3.12 0.0102       0.622</span></span>
<span><span class="co"># 10    10    2.86 0.00855      0.631</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-mona-screeplot" class="quarto-xref">Figure&nbsp;<span>5.31</span></a> shows a screeplot of proportions of variance. Because there are so many components and most of the information is concentrated in the largest dimensions, I’ve used a <span class="math inline">\(\log_{10}()\)</span> scale on the horizontal axis. Beyond 10 or so dimensions, the variance of additional components looks quite tiny.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb63" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggscreeplot.html">ggscreeplot</a></span><span class="op">(</span><span class="va">img_pca</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mona-screeplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mona-screeplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch05/fig-mona-screeplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mona-screeplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.31: Screeplot of the variance proportions in the Mona Lisa PCA.
</figcaption></figure>
</div>
</div>
</div>
<p>Then, if <span class="math inline">\(\mathbf{M}\)</span> is the <span class="math inline">\(640 \times 955\)</span> matrix of pixel values, a best approximation <span class="math inline">\(\widehat{\mathbf{M}}_k\)</span> using <span class="math inline">\(k\)</span> dimensions can be obtained as <span class="math inline">\(\widehat{\mathbf{M}}_k = \mathbf{X}_k\;\mathbf{V}_k^\mathsf{T}\)</span> where <span class="math inline">\(\mathbf{X}_k\)</span> are the principal component scores and <span class="math inline">\(\mathbf{V}_k\)</span> are the eigenvectors corresponding to the <span class="math inline">\(k\)</span> largest eigenvalues. The function <code>approx_pca()</code> does this, and also undoes the scaling and centering carried out in PCA.</p>
<!-- **TODO**: ~~Also, separate approximation from the pivot_longer code...~~ -->
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb64" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">approx_pca</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_comp</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">pca_object</span> <span class="op">=</span> <span class="va">img_pca</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">## Multiply the matrix of rotated data (component scores) by the transpose of </span></span>
<span>  <span class="co">## the matrix of eigenvectors (i.e. the component loadings) to get back to a </span></span>
<span>  <span class="co">## matrix of original data values</span></span>
<span></span>
<span>  <span class="va">recon</span> <span class="op">&lt;-</span> <span class="va">pca_object</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_comp</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">pca_object</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_comp</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Reverse any scaling and centering that was done by prcomp()</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">pca_object</span><span class="op">$</span><span class="va">scale</span> <span class="op">!=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">## Rescale by the reciprocal of the scaling factor, i.e. back to</span></span>
<span>    <span class="co">## original range.</span></span>
<span>    <span class="va">recon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">recon</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">pca_object</span><span class="op">$</span><span class="va">scale</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">pca_object</span><span class="op">$</span><span class="va">center</span> <span class="op">!=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">## Remove any mean centering by adding the subtracted mean back in</span></span>
<span>    <span class="va">recon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">recon</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, center <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">pca_object</span><span class="op">$</span><span class="va">center</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">## Make it a data frame that we can easily pivot to long format</span></span>
<span>  <span class="co">## for drawing with ggplot</span></span>
<span>  <span class="va">recon_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">recon</span><span class="op">)</span>, <span class="va">recon</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">recon_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">recon_df</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## Return the data to long form </span></span>
<span>  <span class="va">recon_df_long</span> <span class="op">&lt;-</span> <span class="va">recon_df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">x</span>, </span>
<span>                        names_to <span class="op">=</span> <span class="st">"y"</span>, </span>
<span>                        values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">recon_df_long</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, the recovered images, using 2, 3 , 4, 5, 10, 15, 20, 50, and 100 principal components can be plotted using ggplot. In the code below, the <code>approx_pca()</code> function is run for each of the 9 values specified by <code>n_pcs</code> giving a data frame <code>recovered_imgs</code> containing all reconstructed images, with variables <code>x</code>, <code>y</code> and <code>value</code> (the greyscale pixel value).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb65" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n_pcs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">n_pcs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"First"</span>, <span class="va">n_pcs</span>, <span class="st">"Components"</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">recovered_imgs</span> <span class="op">&lt;-</span> <span class="fu">map_dfr</span><span class="op">(</span><span class="va">n_pcs</span>, </span>
<span>                          <span class="va">approx_pca</span>, </span>
<span>                          .id <span class="op">=</span> <span class="st">"pcs"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pcs <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">pcs</span>, <span class="st">"_"</span>, <span class="st">" "</span><span class="op">)</span>, </span>
<span>         pcs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pcs</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">pcs</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, each is plotted using <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster()</a></code>, using <code>value</code> to as the fill color. A quirk of images imported to R is that origin is taken as the upper left corner, so the Y axis scale needs to be reversed. The 9 images are then plotted together using <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb66" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recovered_imgs</span>, </span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_out</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">pcs</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Recovering Mona Lisa from PCA of her pixels"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_out</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result, in <a href="#fig-mona-pca" class="quarto-xref">Figure&nbsp;<span>5.32</span></a> is instructive about how much visual information is contained in lower-dimensional reconstructions, or conversely, how much the image can be compressed by omitting the many small dimensions.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-mona-pca" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-pos="H" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mona-pca-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/mona-pca.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-fig-pos="H">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mona-pca-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.32: Re-construction of the Mona Lisa using 2, 3 , 4, 5, 10, 15, 20, 50, and 100 principal components.
</figcaption></figure>
</div>
</div>
</div>
<p>In this figure, with 4-5 components most people would recognize this as a blury image of the world’s most famous portrait. It is certainly clear that this is the Mona Lisa with 10–15 components. Details of the portrait and backgound features become recognizable with 20–50 components, and with 100 components it compares favorably with the original in <a href="#fig-MonaLisa" class="quarto-xref">Figure&nbsp;<span>5.30</span></a>. In numbers, the original <span class="math inline">\(640 \times 955\)</span>) image is of size 600 Kb. The 100 component version is only 93 Kb, 15.6% of this.</p>
</section><section id="sec-outlier-detection" class="level2" data-number="5.7"><h2 data-number="5.7" class="anchored" data-anchor-id="sec-outlier-detection">
<span class="header-section-number">5.7</span> Elliptical insights: Outlier detection</h2>
<p>The data ellipse (<a href="04-multivariate_plots.html#sec-data-ellipse" class="quarto-xref"><span>Section 4.2</span></a>), or ellipsoid in more than 2D is fundamental in regression. But, as Pearson showed, it is also key to understanding principal components analysis, where the principal component directions are simply the axes of the ellipsoid of the data. As such, observations that are unusual in data space may not stand out in univariate views of the variables, but will stand out in principal component space, usually on the <em>smallest</em> dimension.</p>
<p>As an illustration, I created a dataset of <span class="math inline">\(n = 100\)</span> observations with a linear relation, <span class="math inline">\(y = x + \mathcal{N}(0, 1)\)</span> and then added two discrepant points at (1.5, -1.5), (-1.5, 1.5).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb67" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123345</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,             <span class="fl">1.5</span>, <span class="op">-</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When these are plotted with a data ellipse in <a href="#fig-outlier-demo" class="quarto-xref">Figure&nbsp;<span>5.33</span></a> (left), you can see the discrepant points labeled 101 and 102, but they do not stand out as unusual on either <span class="math inline">\(x\)</span> or <span class="math inline">\(y\)</span>. The transformation to from data space to principal components space, shown in <a href="#fig-outlier-demo" class="quarto-xref">Figure&nbsp;<span>5.33</span></a> (right), is simply a rotation of <span class="math inline">\((x, y)\)</span> to a space whose coordinate axes are the major and minor axes of the data ellipse, <span class="math inline">\((PC_1, PC_2)\)</span>. In this view, the additional points appear a univariate outliers on the smallest dimension, <span class="math inline">\(PC_2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-outlier-demo" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-outlier-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/outlier-demo.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-outlier-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.33: <strong>Outlier demonstration</strong>: The left panel shows the original data and highlights the two discrepant points, which do not appear to be unusual on either x or y. The right panel shows the data rotated to principal components, where the labeled points stand out on the smallest PCA dimension.
</figcaption></figure>
</div>
</div>
</div>
<p>To see this more clearly, <a href="#fig-outlier-animation" class="quarto-xref">Figure&nbsp;<span>5.34</span></a> shows an animation of the rotation from data space to PCA space. This uses <code><a href="https://friendly.github.io/heplots/reference/interpPlot.html">heplots::interpPlot()</a></code> to interpolate linearly from the positions of the points in data space to their locations in PCA space.</p>
<!-- fig.code:  R/outlier-demo.R -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-outlier-animation" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-outlier-animation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/outlier-demo.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-outlier-animation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.34: Animation of rotation from data space to PCA space.
</figcaption></figure>
</div>
</div>
</div>
<section id="sec-dsq-penguin" class="level3" data-number="5.7.1"><h3 data-number="5.7.1" class="anchored" data-anchor-id="sec-dsq-penguin">
<span class="header-section-number">5.7.1</span> Example: Penguin data</h3>
<p>In <a href="04-multivariate_plots.html#sec-multnorm-penguin" class="quarto-xref"><span>Section 4.6.2</span></a> we examined the questions of multivariate normality and outliers for the penguin data. From a <span class="math inline">\(\chi^2\)</span> QQ plot (<a href="04-multivariate_plots.html#fig-peng-cqplot" class="quarto-xref">Figure&nbsp;<span>4.26</span></a>) of the Mahalanobis <span class="math inline">\(D^2\)</span> values, three Penguins (283, 10, 35) were identified as noteworthy, deserving a closer look to see why they are unusual. It was pointed out (<a href="04-multivariate_plots.html#fig-peng-ggplot-out" class="quarto-xref">Figure&nbsp;<span>4.27</span></a>) that 2D plots of the data variables were only partially revealing. Let’s see where they appear in biplots.</p>
<p>First, I find the noteworthy points with the three the largest <span class="math inline">\(D^2\)</span> values as before:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">peng</span>, package<span class="op">=</span><span class="st">"heplots"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find potential multivariate outliers</span></span>
<span><span class="va">DSQ</span> <span class="op">&lt;-</span> <span class="fu">heplots</span><span class="fu">::</span><span class="fu"><a href="https://friendly.github.io/heplots/reference/Mahalanobis.html">Mahalanobis</a></span><span class="op">(</span><span class="va">peng</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">noteworthy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">DSQ</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] 283  10  35</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The PCA shows that the first two components account for 88% of variance, so this is probably an adequate representation of the overall structure of our penguins:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb69" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">peng.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="va">bill_length</span> <span class="op">+</span> <span class="va">bill_depth</span> <span class="op">+</span> <span class="va">flipper_length</span> <span class="op">+</span> <span class="va">body_mass</span>,</span>
<span>                   data<span class="op">=</span><span class="va">peng</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">peng.pca</span><span class="op">)</span></span>
<span><span class="co"># Importance of components:</span></span>
<span><span class="co">#                          PC1   PC2    PC3   PC4</span></span>
<span><span class="co"># Standard deviation     1.657 0.882 0.6072 0.328</span></span>
<span><span class="co"># Proportion of Variance 0.686 0.195 0.0922 0.027</span></span>
<span><span class="co"># Cumulative Proportion  0.686 0.881 0.9730 1.000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-out-biplot1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-out-biplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/peng-out-biplot-12.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-out-biplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.35: Biplot of the first two dimensions of the Penguin data. The points for the three noteworthy cases are labeled, but none of these appear to be unusual in this view.
</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-peng-out-biplot1" class="quarto-xref">Figure&nbsp;<span>5.35</span></a> gives the biplot for the first two dimensions. It can be seen that:</p>
<ul>
<li><p>PC1 is largely determined by flipper length and body mass. We can interpret this as an overall measure of <strong>penguin size</strong>. On this dimension, Gentoos are the largest, by quite a lot, compared with Adélie and Chinstrap.</p></li>
<li><p>PC2 is mainly determined by variation in the two beak variables: bill length and depth. Chinstrap are lower than the other two species on bill length and depth, but bill length further distinguishes the Gentoos from the Adélies. A penguin biologist could almost certainly provide an explanation, but I’ll call this <strong>beak shape</strong>.</p></li>
<li><p>But, our three suspected outliers are well-within the bulk of their species.</p></li>
</ul>
<p>That’s the point of this exercise. The projection of the data into the space that accounts for the greatest <strong>total</strong> variance usually does not reveal a few unusual points.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show the code</summary><div class="sourceCode" id="cb70" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/penguin/penguin-colors.R"</span><span class="op">)</span></span>
<span><span class="co"># create vector of labels, blank except for the noteworthy</span></span>
<span><span class="va">lab</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">peng</span><span class="op">)</span></span>
<span><span class="va">lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">lab</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">noteworthy</span>, <span class="va">lab</span>, <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="http://friendly.github.io/ggbiplot/reference/ggbiplot.html">ggbiplot</a></span><span class="op">(</span><span class="va">peng.pca</span>,</span>
<span>         choices <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>         groups <span class="op">=</span> <span class="va">peng</span><span class="op">$</span><span class="va">species</span>, </span>
<span>         ellipse <span class="op">=</span> <span class="cn">TRUE</span>, ellipse.alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>         circle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         var.factor <span class="op">=</span> <span class="fl">1</span>,</span>
<span>         geom.ind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point"</span>, <span class="st">"text"</span><span class="op">)</span>,</span>
<span>         point.size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>         labels <span class="op">=</span> <span class="va">lab</span>, labels.size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>         varname.size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>         clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_penguins</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_shape.html">scale_shape_discrete</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.direction <span class="op">=</span> <span class="st">'horizontal'</span>, legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, plotting dimensions 3 and 4 gives <a href="#fig-peng-out-biplot2" class="quarto-xref">Figure&nbsp;<span>5.36</span></a>. Dimension 3, accounting for 9%, is largely determined by a contrast of bill length with bill depth and body mass, while dimension 4 involves a contrast between body mass and flipper length. The Chinstraps here have the longest, straightest beaks.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-peng-out-biplot2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-peng-out-biplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/peng-out-biplot-34.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-peng-out-biplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.36: Biplot of dimensions 3-4 of the Penguin data. The three noteworthy birds stand out in this view.
</figcaption></figure>
</div>
</div>
</div>
<p>Recall that the perpendicular projection of observation <span class="math inline">\(i\)</span> on the vector for variable <span class="math inline">\(j\)</span> gives an approximation of <span class="math inline">\(\hat{x}_{ij}\)</span> shown in that space. Our friend Cyrano (case 283), the only true multivariate outlier, lies at the extreme ends of both dimensions, with his exceptionally long, straight bill. Case 10 (Hook Nose) stands out at the high end of dimension 3 with a highly curved beak. case 35 is at the high end of dimension 4, so probably is much heavier than most and has short flippers.</p>
</section></section><section id="what-have-we-learned" class="level2" data-number="5.8"><h2 data-number="5.8" class="anchored" data-anchor-id="what-have-we-learned">
<span class="header-section-number">5.8</span> What have we learned?</h2>
<p>Welcome to the world of <strong>multivariate juicers</strong>–—those magical tools that squeeze the most meaningful information from high-dimensional data clouds! This chapter has taken us on a journey from Flatland to Spaceland, revealing how dimension reduction methods can transform overwhelming complexity into interpretable insights.</p>
<p>• <strong>PCA is your geometric friend, helping you compress N-dimensional data</strong>: Principal Components Analysis finds the directions of maximum variance in your data, creating uncorrelated orthogonal dimensions that capture the most “juice” from your multivariate cloud. Think of it as finding the best viewpoint to see a 3D sculpture when you can only look at a 2D photograph—PCA rotates and compresses your data to show you the best 2D viewing angle.</p>
<p>• <strong>Biplots are visualization gold, helping you view compressed N-dimensional data</strong>: These elegant displays build off of PCA by simultaneously showing both your observations (as points) and your variables (as vectors) in the same reduced space. The magic lies in the interpretation: variable vectors pointing in similar directions are correlated, and you can read approximate values by projecting points onto variable vectors. It’s like having X-ray vision for multivariate relationships!</p>
<p>• <strong>Eigenvalues tell the variance story</strong>: The screeplot becomes your guide for deciding how many dimensions to keep. Look for the “elbow” where the eigenvalues start to resemble scree (rubble) rather than meaningful signal. Generally, 80-90% cumulative variance gives you a solid foundation for interpretation.</p>
<p>• <strong>Supplementary variables enhance interpretation</strong>: Once you’ve found your reduced-dimension view, you can project additional variables into the space to aid interpretation—like adding helpful annotations to a map. This technique bridges the gap between statistical discovery and domain knowledge.</p>
<p>• <strong>Nonlinear methods reveal hidden structures</strong>: When relationships aren’t linear, techniques like multidimensional scaling (MDS) and t-SNE can uncover patterns that PCA might miss. These methods focus on preserving local neighborhoods and distances rather than global variance, often revealing clusters and nonlinear manifolds lurking in your data.</p>
<p>• <strong>Variable ordering creates visual clarity</strong>: When similar variables are placed adjacent to each other, patterns emerge and anomalies become visible—it’s like organizing a messy bookshelf by subject. In biplots, the angles of variable vectors provide a natural ordering that are used to make correlation matrices and other displays much more interpretable.</p>
<p>• <strong>Outlier detection gets multidimensional power</strong>: Points that seem normal in individual variables can reveal themselves as true multivariate outliers when viewed in principal component space, especially along the smallest dimensions. The data ellipse becomes your guide to understanding what’s typical versus what deserves a closer look.</p>
<p>• <strong>Real applications abound</strong>: From compressing the Mona Lisa using eigenfaces to understanding crime patterns across U.S. states, dimension reduction methods bridge the gap between statistical technique and practical insight. These aren’t just mathematical curiosities—they’re essential tools for making sense of our increasingly high-dimensional world.</p>
<!--
**Package summary**
-->


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Aluja-etal-2018" class="csl-entry" role="listitem">
Aluja, T., Morineau, A., &amp; Sanchez, G. (2018). <em>Principal component analysis for data science</em>. <a href="https://pca4ds.github.io/">https://pca4ds.github.io/</a>
</div>
<div id="ref-BorgGroenen2005" class="csl-entry" role="listitem">
Borg, I., &amp; Groenen, P. J. F. (2005). <em><span class="nocase">Modern Multidimensional Scaling: Theory and Applications</span></em>. Springer.
</div>
<div id="ref-Borg2018" class="csl-entry" role="listitem">
Borg, I., Groenen, P. J. F., &amp; Mair, P. (2018). Applied multidimensional scaling and unfolding. In <em>SpringerBriefs in Statistics</em>. Springer International Publishing. <a href="https://doi.org/10.1007/978-3-319-73471-2">https://doi.org/10.1007/978-3-319-73471-2</a>
</div>
<div id="ref-Cattell1966" class="csl-entry" role="listitem">
Cattell, R. B. (1966). The scree test for the number of factors. <em>Multivariate Behavioral Research</em>, <em>1</em>(2), 245–276. <a href="https://doi.org/10.1207/s15327906mbr0102_10">https://doi.org/10.1207/s15327906mbr0102_10</a>
</div>
<div id="ref-R-adegraphics" class="csl-entry" role="listitem">
Dray, S., &amp; Siberchicot, A. (2025). <em>Adegraphics: An S4 lattice-based package for the representation of multivariate data</em>. <a href="http://pbil.univ-lyon1.fr/ADE-4/">http://pbil.univ-lyon1.fr/ADE-4/</a>
</div>
<div id="ref-Euler:1758" class="csl-entry" role="listitem">
Euler, L. (1758). Elementa doctrinae solidorum. <em>Novi Commentarii Academiae Scientiarum Petropolitanae</em>, <em>4</em>, 109–140. <a href="https://scholarlycommons.pacific.edu/euler-works/230/">https://scholarlycommons.pacific.edu/euler-works/230/</a>
</div>
<div id="ref-R-matlib" class="csl-entry" role="listitem">
Friendly, M., Fox, J., &amp; Chalmers, P. (2024). <em>Matlib: Matrix functions for teaching and learning linear algebra and multivariate statistics</em>. <a href="https://github.com/friendly/matlib">https://github.com/friendly/matlib</a>
</div>
<div id="ref-FriendlyKwan:03:effect" class="csl-entry" role="listitem">
Friendly, M., &amp; Kwan, E. (2003). Effect ordering for data displays. <em>Computational Statistics and Data Analysis</em>, <em>43</em>(4), 509–539. <a href="https://doi.org/10.1016/S0167-9473(02)00290-6">https://doi.org/10.1016/S0167-9473(02)00290-6</a>
</div>
<div id="ref-FriendlyMeyer:2016:DDAR" class="csl-entry" role="listitem">
Friendly, M., &amp; Meyer, D. (2016). <em>Discrete data analysis with <span>R</span>: Visualization and modeling techniques for categorical and count data</em>. Chapman &amp; Hall/CRC.
</div>
<div id="ref-Friendly-etal:ellipses:2013" class="csl-entry" role="listitem">
Friendly, M., Monette, G., &amp; Fox, J. (2013). Elliptical insights: Understanding statistical methods through elliptical geometry. <em>Statistical Science</em>, <em>28</em>(1), 1–39. <a href="https://doi.org/10.1214/12-STS402">https://doi.org/10.1214/12-STS402</a>
</div>
<div id="ref-FriendlyWainer:2021:TOGS" class="csl-entry" role="listitem">
Friendly, M., &amp; Wainer, H. (2021). <em>A history of data visualization and graphic communication</em>. Harvard University Press. <a href="https://doi.org/10.4159/9780674259034">https://doi.org/10.4159/9780674259034</a>
</div>
<div id="ref-Gabriel:71" class="csl-entry" role="listitem">
Gabriel, K. R. (1971). The biplot graphic display of matrices with application to principal components analysis. <em>Biometrics</em>, <em>58</em>(3), 453–467. <a href="https://doi.org/10.2307/2334381">https://doi.org/10.2307/2334381</a>
</div>
<div id="ref-Gabriel:81" class="csl-entry" role="listitem">
Gabriel, K. R. (1981). Biplot display of multivariate matrices for inspection of data and diagnosis. In V. Barnett (Ed.), <em>Interpreting multivariate data</em> (pp. 147–173). John Wiley; Sons.
</div>
<div id="ref-Galton:1886" class="csl-entry" role="listitem">
Galton, F. (1886). Regression towards mediocrity in hereditary stature. <em>Journal of the Anthropological Institute</em>, <em>15</em>, 246–263. <a href="http://www.jstor.org/cgi-bin/jstor/viewitem/09595295/dm995266/99p0374f/0">http://www.jstor.org/cgi-bin/jstor/viewitem/09595295/dm995266/99p0374f/0</a>
</div>
<div id="ref-GowerHand:96" class="csl-entry" role="listitem">
Gower, J. C., &amp; Hand, D. J. (1996). <em>Biplots</em>. Chapman &amp; Hall.
</div>
<div id="ref-Gower-etal:2011" class="csl-entry" role="listitem">
Gower, J. C., Lubbe, S. G., &amp; Roux, N. J. L. (2011). <em>Understanding biplots</em>. Wiley. <a href="http://books.google.ca/books?id=66gQCi5JOKYC">http://books.google.ca/books?id=66gQCi5JOKYC</a>
</div>
<div id="ref-Greenacre:84" class="csl-entry" role="listitem">
Greenacre, M. (1984). <em>Theory and applications of correspondence analysis</em>. Academic Press.
</div>
<div id="ref-Greenacre:2010:biplots" class="csl-entry" role="listitem">
Greenacre, M. (2010). <em>Biplots in practice</em>. Fundaci<span>ó</span>n BBVA. <a href="https://books.google.ca/books?id=dv4LrFP7U\_EC">https://books.google.ca/books?id=dv4LrFP7U\_EC</a>
</div>
<div id="ref-R-seriation" class="csl-entry" role="listitem">
Hahsler, M., Buchta, C., &amp; Hornik, K. (2024). <em>Seriation: Infrastructure for ordering objects using seriation</em>. <a href="https://github.com/mhahsler/seriation">https://github.com/mhahsler/seriation</a>
</div>
<div id="ref-Husson-etal-2017" class="csl-entry" role="listitem">
Husson, F., Le, S., &amp; Pagès, J. (2017). <em>Exploratory multivariate analysis by example using r</em>. Chapman &amp; Hall. <a href="https://doi.org/10.1201/b21874">https://doi.org/10.1201/b21874</a>
</div>
<div id="ref-R-factoextra" class="csl-entry" role="listitem">
Kassambara, A., &amp; Mundt, F. (2020). <em>Factoextra: Extract and visualize the results of multivariate data analyses</em>. <a href="https://doi.org/10.32614/CRAN.package.factoextra">https://doi.org/10.32614/CRAN.package.factoextra</a>
</div>
<div id="ref-R-Rtsne" class="csl-entry" role="listitem">
Krijthe, J. (2023). <em>Rtsne: T-distributed stochastic neighbor embedding using a barnes-hut implementation</em>. <a href="https://github.com/jkrijthe/Rtsne">https://github.com/jkrijthe/Rtsne</a>
</div>
<div id="ref-Kruskal1964" class="csl-entry" role="listitem">
Kruskal, J. B. (1964). Multidimensional scaling by optimizing goodness of fit to a nonmetric hypothesis. <em>Psychometrika</em>, <em>29</em>(1), 1–27. <a href="https://doi.org/10.1007/bf02289565">https://doi.org/10.1007/bf02289565</a>
</div>
<div id="ref-R-FactoMineR" class="csl-entry" role="listitem">
Lê, S., Josse, J., &amp; Husson, F. (2008). <span>FactoMineR</span>: A package for multivariate analysis. <em>Journal of Statistical Software</em>, <em>25</em>(1), 1–18. <a href="https://doi.org/10.18637/jss.v025.i01">https://doi.org/10.18637/jss.v025.i01</a>
</div>
<div id="ref-MaatenHinton2008" class="csl-entry" role="listitem">
Maaten, L. van der, &amp; Hinton, G. (2008). Visualizing data using <span class="nocase">t-SNE</span>. <em>Journal of Machine Learning Research</em>, <em>9</em>, 2579–2605. <a href="http://www.jmlr.org/papers/v9/vandermaaten08a.html">http://www.jmlr.org/papers/v9/vandermaaten08a.html</a>
</div>
<div id="ref-R-rgl" class="csl-entry" role="listitem">
Murdoch, D., &amp; Adler, D. (2025). <em>Rgl: 3D visualization using OpenGL</em>. <a href="https://doi.org/10.32614/CRAN.package.rgl">https://doi.org/10.32614/CRAN.package.rgl</a>
</div>
<div id="ref-R-vegan" class="csl-entry" role="listitem">
Oksanen, J., Simpson, G. L., Blanchet, F. G., Kindt, R., Legendre, P., Minchin, P. R., O’Hara, R. B., Solymos, P., Stevens, M. H. H., Szoecs, E., Wagner, H., Barbour, M., Bedward, M., Bolker, B., Borcard, D., Borman, T., Carvalho, G., Chirico, M., De Caceres, M., … Weedon, J. (2025). <em>Vegan: Community ecology package</em>. <a href="https://doi.org/10.32614/CRAN.package.vegan">https://doi.org/10.32614/CRAN.package.vegan</a>
</div>
<div id="ref-Pearson:1896" class="csl-entry" role="listitem">
Pearson, K. (1896). Contributions to the mathematical theory of evolution—<span>III</span>, regression, heredity and panmixia. <em>Philosophical Transactions of the Royal Society of London</em>, <em>187</em>, 253–318.
</div>
<div id="ref-Pearson:1901" class="csl-entry" role="listitem">
Pearson, K. (1901). On lines and planes of closest fit to systems of points in space. <em>Philosophical Magazine</em>, <em>6</em>(2), 559–572.
</div>
<div id="ref-R-gganimate" class="csl-entry" role="listitem">
Pedersen, T. L., &amp; Robinson, D. (2025). <em>Gganimate: A grammar of animated graphics</em>. <a href="https://doi.org/10.32614/CRAN.package.gganimate">https://doi.org/10.32614/CRAN.package.gganimate</a>
</div>
<div id="ref-ReavenMiller:79" class="csl-entry" role="listitem">
Reaven, G. M., &amp; Miller, R. G. (1979). An attempt to define the nature of chemical diabetes using a multidimensional analysis. <em>Diabetologia</em>, <em>16</em>, 17–24.
</div>
<div id="ref-Shepard1962a" class="csl-entry" role="listitem">
Shepard, R. N. (1962a). The analysis of proximities: Multidimensional scaling with an unknown distance function. i. <em>Psychometrika</em>, <em>27</em>(2), 125–140. <a href="https://doi.org/10.1007/bf02289630">https://doi.org/10.1007/bf02289630</a>
</div>
<div id="ref-Shepard1962b" class="csl-entry" role="listitem">
Shepard, R. N. (1962b). The analysis of proximities: Multidimensional scaling with an unknown distance function. II. <em>Psychometrika</em>, <em>27</em>(3), 219–246. <a href="https://doi.org/10.1007/bf02289621">https://doi.org/10.1007/bf02289621</a>
</div>
<div id="ref-Shepard-etal-1972b" class="csl-entry" role="listitem">
Shepard, R. N., Romney, A. K., Nerlove, S. B., &amp; Board, M. S. S. (1972a). <em>Multidimensional scaling; theory and applications in the behavioral sciences: Vols. II. Applications</em>. Seminar Press. <a href="https://books.google.ca/books?id=PpFAAQAAIAAJ">https://books.google.ca/books?id=PpFAAQAAIAAJ</a>
</div>
<div id="ref-Shepard-etal-1972a" class="csl-entry" role="listitem">
Shepard, R. N., Romney, A. K., Nerlove, S. B., &amp; Board, M. S. S. (1972b). <em>Multidimensional scaling: Theory and applications in the behavioral sciences: Vols. I. Theory</em>. Seminar Press. <a href="https://books.google.ca/books?id=pJRAAQAAIAAJ">https://books.google.ca/books?id=pJRAAQAAIAAJ</a>
</div>
<div id="ref-Shoben1983" class="csl-entry" role="listitem">
Shoben, E. J. (1983). Applications of multidimensional scaling in cognitive psychology. <em>Applied Psychological Measurement</em>, <em>7</em>(4), 473–490. <a href="https://doi.org/10.1177/014662168300700406">https://doi.org/10.1177/014662168300700406</a>
</div>
<div id="ref-Torgerson1952" class="csl-entry" role="listitem">
Torgerson, W. S. (1952). Multidimensional scaling: I. Theory and method. <em>Psychometrika</em>, <em>17</em>(4), 401–419. <a href="https://doi.org/10.1007/bf02288916">https://doi.org/10.1007/bf02288916</a>
</div>
<div id="ref-Turk1991" class="csl-entry" role="listitem">
Turk, M., &amp; Pentland, A. (1991). Eigenfaces for recognition. <em>Journal of Cognitive Neuroscience</em>, <em>3</em>(1), 71–86. <a href="https://doi.org/10.1162/jocn.1991.3.1.71">https://doi.org/10.1162/jocn.1991.3.1.71</a>
</div>
<div id="ref-R-ggbiplot" class="csl-entry" role="listitem">
Vu, V. Q., &amp; Friendly, M. (2024). <em>Ggbiplot: A grammar of graphics implementation of biplots</em>. <a href="https://doi.org/10.32614/CRAN.package.ggbiplot">https://doi.org/10.32614/CRAN.package.ggbiplot</a>
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>This is Euler’s <span class="citation" data-cites="Euler:1758">(<a href="95-references.html#ref-Euler:1758" role="doc-biblioref">1758</a>)</span> formula, which states that any convex polyhedron must obey the formula <span class="math inline">\(V + F - E = 2\)</span> where <span class="math inline">\(V\)</span> is the number of vertexes (corners), <span class="math inline">\(F\)</span> is the number of faces and <span class="math inline">\(E\)</span> is the number of edges. For example, a tetrahedron or pyramid has <span class="math inline">\((V, F, E) = (4, 4, 6)\)</span> and a cube has <span class="math inline">\((V, F, E) = (8, 6, 12)\)</span>. Stated in words, for all solid bodies confined by planes, the sum of the number of vertexes and the number of faces is two less than the number of edges.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For example, if two variables in the analysis are height and weight, changing the unit of height from inches to centimeters would multiply its variance by <span class="math inline">\(2.54^2\)</span>; changing weight from pounds to kilograms would divide its variance by <span class="math inline">\(2.2^2\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The unfortunate default <code>scale. = FALSE</code> was for consistency with S, the precursor to R but in general scaling is usually advisable.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The <span style="color: brown;"><strong>vegan</strong></span> package <span class="citation" data-cites="R-vegan">(<a href="95-references.html#ref-R-vegan" role="doc-biblioref">Oksanen et al., 2025</a>)</span> provides <code><a href="https://vegandevs.github.io/vegan/reference/metaMDS.html">vegan::metaMDS()</a></code> which allows a wide range of distance measures …<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The usual default, <code>perplexity = 30</code> focuses on preserving the distances to the 30 nearest neighbors and puts virtually no weight on preserving distances to the remaining points. For data sets with a small number of points e.g.&nbsp;<span class="math inline">\(n=100\)</span>, this will uncover the global structure quite well since each point will preserve distances to a third of the data set. For larger problems, e.g., <span class="math inline">\(n = 10,000\)</span> points, using a higher perplexity value e.g.&nbsp;500, will do a much better job for of uncovering the global structure. (This description comes from https://opentsne.readthedocs.io/en/latest/parameters.html)<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>The general topic of arranging items (variables, factor values) in an orderly sequence is called <em>seriation</em>, and stems from methods of dating in archaeology, used to arrange stone tools, pottery fragments, and other artifacts in time order. In R, the <span style="color: brown;"><strong>seriation</strong></span> package <span class="citation" data-cites="R-seriation">(<a href="95-references.html#ref-R-seriation" role="doc-biblioref">Hahsler et al., 2024</a>)</span> provides a wide range of techniques. …<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>https://kieranhealy.org/blog/archives/2019/10/27/reconstructing-images-using-pca/<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/friendly\.github\.io\/Vis-MLM-book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./04-multivariate_plots.html" class="pagination-link" aria-label="Plots of Multivariate Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-linear_models.html" class="pagination-link" aria-label="Overview of Linear models">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>