<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Visualizing Multivariate Data and Models in R - 4&nbsp; PCA and Biplots</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./linear_models.html" rel="next">
<link href="./03-multivariate_plots.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-pca-biplot.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">PCA and Biplots</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">PCA and Biplots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlm-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Brief review of the multivariate linear model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Tests for Equality of Covariance Matrices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./90-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-spaceland" id="toc-sec-spaceland" class="nav-link active" data-scroll-target="#sec-spaceland"><span class="header-section-number">4.1</span> <em>Flatland</em> and <em>Spaceland</em></a>
  <ul class="collapse">
<li><a href="#multivariate-juicers" id="toc-multivariate-juicers" class="nav-link" data-scroll-target="#multivariate-juicers"><span class="header-section-number">4.1.1</span> Multivariate juicers</a></li>
  </ul>
</li>
  <li>
<a href="#sec-pca" id="toc-sec-pca" class="nav-link" data-scroll-target="#sec-pca"><span class="header-section-number">4.2</span> Principal components analysis</a>
  <ul class="collapse">
<li><a href="#pca-by-springs" id="toc-pca-by-springs" class="nav-link" data-scroll-target="#pca-by-springs"><span class="header-section-number">4.2.1</span> PCA by springs</a></li>
  <li><a href="#mathematics-and-geometry-of-pca" id="toc-mathematics-and-geometry-of-pca" class="nav-link" data-scroll-target="#mathematics-and-geometry-of-pca"><span class="header-section-number">4.2.2</span> Mathematics and geometry of PCA</a></li>
  <li><a href="#finding-principal-components" id="toc-finding-principal-components" class="nav-link" data-scroll-target="#finding-principal-components"><span class="header-section-number">4.2.3</span> Finding principal components</a></li>
  <li><a href="#visualizing-variance-proportions-screeplots" id="toc-visualizing-variance-proportions-screeplots" class="nav-link" data-scroll-target="#visualizing-variance-proportions-screeplots"><span class="header-section-number">4.2.4</span> Visualizing variance proportions: screeplots</a></li>
  <li><a href="#visualizing-pca-scores" id="toc-visualizing-pca-scores" class="nav-link" data-scroll-target="#visualizing-pca-scores"><span class="header-section-number">4.2.5</span> Visualizing PCA scores</a></li>
  <li><a href="#elliptical-insights-outlier-detection" id="toc-elliptical-insights-outlier-detection" class="nav-link" data-scroll-target="#elliptical-insights-outlier-detection"><span class="header-section-number">4.2.6</span> Elliptical insights: Outlier detection</a></li>
  </ul>
</li>
  <li><a href="#sec-biplot" id="toc-sec-biplot" class="nav-link" data-scroll-target="#sec-biplot"><span class="header-section-number">4.3</span> Biplots</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-pca-biplot" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">PCA and Biplots</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="sec-spaceland" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="sec-spaceland">
<span class="header-section-number">4.1</span> <em>Flatland</em> and <em>Spaceland</em>
</h2>
<blockquote class="blockquote">
<p>It is high time that I should pass from these brief and discursive notes about Flatland to the central event of this book, my initiation into the mysteries of Space. THAT is my subject; all that has gone before is merely preface — Edwin Abbott, <em>Flatland</em>, p.&nbsp;57.</p>
</blockquote>
<p>There was a cloud in the sky above <em>Flatland</em> one day. But it was a huge, multidimensional cloud of sparkly points that might contain some important message, perhaps like the hidden EUREKA (<a href="index.html#fig-pollen-eureka-fig">Figure&nbsp;<span>5</span></a>), or perhaps forecasting the upcoming harvest, if only Flatlanders could appreciate it.</p>
<p>A leading citizen, A SQUARE, who had traveled once to Spaceland and therefore had an inkling of its majesty beyond the simple world of his life in the plane looked at that cloud and had a brilliant thought, an OMG moment:</p>
<blockquote class="blockquote">
<p>“Oh, can I, in my imagination, rotate that cloud and squeeze its’ juice so that it rains down on Flatland with greatest joy?”</p>
</blockquote>
<p>As it happened, our Square friend, although he could never really <em>see</em> in three dimensions, he could now at least <em>think</em> of a world described by <strong>height</strong> as well as breadth and width, and think of the <strong>shadow</strong> cast by a cloud as something mutable, changing size and shape depending on its’ orientation over Flatland.</p>
<p>And what a world it was, inhabited by Pryamids, Cubes and wondrous creatures called Polyhedrons with many <span class="math inline">\(C\)</span>orners, <span class="math inline">\(F\)</span>aces and <span class="math inline">\(E\)</span>dges. Not only that, but all those Polyhedra were forced in Spaceland to obey a magic formula: <span class="math inline">\(C + F - E = 2\)</span>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> How cool was that!</p>
<p>Indeed, there were even exalted Spheres, having so many faces that its surface became as smooth as a baby’s bottom with no need for pointed corners or edges, just as Circles were the smoothest occupants of his world with far too many sides to count. It was his dream of a Sphere passing through Flatland (<a href="index.html#fig-flatland-spheres">Figure&nbsp;<span>1</span></a>) that first awakened him to a third dimension.</p>
<p>He also marveled at Ellipsoids, as smooth as Spheres, but in Spaceland having three natural axes of different extent and capable of being appearing fatter or slimmer when rotated from different views. An Ellipsoid had magical properties: it could appear as so thin in one or more dimensions that it became a simple 2D ellipse, or a 1D line, or even a 0D point <span class="citation" data-cites="Friendly-etal:ellipses:2013">(<a href="90-references.html#ref-Friendly-etal:ellipses:2013" role="doc-biblioref">Friendly, Monette, and Fox 2013</a>)</span>. <!-- **TODO**: somehow mention the `gellipsoid` package here. --></p>
<p>All of these now arose in Square’s richer 3D imagination. And, all of this came from just one more dimension than his life in Flatland.</p>
<section id="multivariate-juicers" class="level3" data-number="4.1.1"><h3 data-number="4.1.1" class="anchored" data-anchor-id="multivariate-juicers">
<span class="header-section-number">4.1.1</span> Multivariate juicers</h3>
<p>Up to now, we have also been living in Flatland. We have been trying to understand data in <strong>data space</strong> of possibly many dimensions, but confined to the 2D plane of a graph window. Scatterplot matrices and parallel coordinate plots provided some relief. The former did so by <strong>projecting</strong> the data into sets of 2D views in the coordinates of data space; the latter did so by providing multiple axes in a 2D space along which we could trace the paths of individual observations.</p>
<p>This chapter is about seeing data in a different space, a low-dimensional, usually 2D, space that which squeezes out the most juice from multidimensional data for a particular purpose (<a href="#fig-MV-juicer">Figure&nbsp;<span>4.1</span></a>), where what we want to understand can be more easily seen.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-MV-juicer" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/MV-juicer.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4.1: A multivariate juicer takes data from possibly high-dimensional data space and transforms it to a lower-dimenional space in which important effects can be more easily seen.</figcaption></figure>
</div>
</div>
</div>
<p>Here, I concentrate on <strong>principal components analysis</strong> (PCA), whose goal reflects A Square’s desire to see that sparkly cloud of points in <span class="math inline">\(nD\)</span> space in the plane showing the greatest variation among all other possible views.</p>
<p>This appealed to his sense of geometry, but left him wondering how the variables in that high-D cloud were related to the dimensions he could see in a best-fitting plane. The idea of a <strong>biplot</strong>, showing the data points in the plane, together with thick pointed arrows—variable vectors— in one view is the other topic explained in this chapter (<a href="#sec-biplot"><span>Section&nbsp;4.3</span></a>).</p>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/ggbiplot">ggbiplot</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-pca" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="sec-pca">
<span class="header-section-number">4.2</span> Principal components analysis</h2>
<p>When Francis Galton <span class="citation" data-cites="Galton:1886">(<a href="90-references.html#ref-Galton:1886" role="doc-biblioref">1886</a>)</span> first discovered the idea of regression toward the mean and presented his famous diagram (<a href="03-multivariate_plots.html#fig-galton-corr">Figure&nbsp;<span>3.9</span></a>), he had little thought that he had provided a window to a higher-dimensional world, beyond what even A Square could imagine. His friend, Karl Pearson <span class="citation" data-cites="Pearson:1896">(<a href="90-references.html#ref-Pearson:1896" role="doc-biblioref">1896</a>)</span> took that idea and developed it into a theory of regression and a measure of correlation that would bear his name, Pearson’s <span class="math inline">\(r\)</span>.</p>
<p>But then Pearson <span class="citation" data-cites="Pearson:1901">(<a href="90-references.html#ref-Pearson:1901" role="doc-biblioref">1901</a>)</span> had a further inspiration, akin to that of A Square. If he also had a cloud of sparkly points in <span class="math inline">\(2, 3, 4, ..., p\)</span> dimensions, could he find a point (<span class="math inline">\(0D\)</span>), or line (<span class="math inline">\(1D\)</span>), or plane (<span class="math inline">\(2D\)</span>), or even a hyperplane (<span class="math inline">\(nD\)</span>) that best summarized — squeezed out the most juice—from multivariate data? This was the first trully multivariate problem in the history of statistics <span class="citation" data-cites="FriendlyWainer:2021:TOGS">(<a href="90-references.html#ref-FriendlyWainer:2021:TOGS" role="doc-biblioref">Friendly and Wainer 2021, 186</a>)</span>.</p>
<p>The best <span class="math inline">\(0D\)</span> point was easy— it was simply the centroid, the means of each of the variables in the data, <span class="math inline">\((\bar{x}_1, \bar{x}_2, ..., \bar{x}_p)\)</span>, because that was “closest” to the data in the sense of minimizing the sum of squared differences, <span class="math inline">\(\Sigma_i\Sigma_j (x_{ij} - \bar{x}_j)^2\)</span>. In higher dimensions, his solution was also an application of the method of least squares, but he argued it geometrically and visually as shown in <a href="#fig-Pearson1901">Figure&nbsp;<span>4.2</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-Pearson1901" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Pearson1901.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4.2: Karl Pearson’s (1901) geometric, visual argument for finding the line or plane of closest fit to a collection of points, P1, P2, P3, …</figcaption></figure>
</div>
</div>
</div>
<p>For a <span class="math inline">\(1D\)</span> summary, the line of best fit to the points <span class="math inline">\(P_1, P_2, \dots P_n\)</span> is the line that goes through the centroid and made the average squared length of the <em>perpendicular</em> segments from those points to a line as small as possible. This was different from the case in linear regression, for fitting <span class="math inline">\(y\)</span> from <span class="math inline">\(x\)</span>, where the average squared length of the <em>vertical</em> segments, <span class="math inline">\(\Sigma_i (y_i - \hat{y}_i)^2\)</span> was minimized by least squares.</p>
<p>He went on to prove the visual insights from simple smoothing of <span class="citation" data-cites="Galton:1886">Galton (<a href="90-references.html#ref-Galton:1886" role="doc-biblioref">1886</a>)</span> (shown in <a href="03-multivariate_plots.html#fig-galton-corr">Figure&nbsp;<span>3.9</span></a>) regarding the regression lines of <code>y ~ x</code> and <code>x ~ y</code>. More importantly, he proved that the cloud of points is captured, for the purpose of finding a best line, plane or hyperplane, by the ellipsoid that encloses it, as seen in his diagram, <a href="#fig-Pearson1901-2">Figure&nbsp;<span>4.3</span></a>. The major axis of the 2D ellipse is the line of best fit, along which the data points have the smallest average squared distance from the line. The axis at right angles to that—the minor axis— is labeled “line of worst fit” with the largest average squared distance.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-Pearson1901-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Pearson1901_2.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4.3: Karl Pearson’s diagram showing the elliptical geometry of regression and principal components analysis … <em>Source</em>: Pearson (1901), p.&nbsp;566.</figcaption></figure>
</div>
</div>
</div>
<p>Even more importantly— and this is the basis for what we call <strong>principal components analysis</strong> (PCA)— he recognized that the two orthogonal axes of the ellipse gave new coordinates for the data which were uncorrelated, whatever the correlation of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>.</p>
<blockquote class="blockquote">
<p>Physically, the axes of the correlation type-ellipse are the directions of independent and uncorrelated variation. — <span class="citation" data-cites="Pearson:1901">Pearson (<a href="90-references.html#ref-Pearson:1901" role="doc-biblioref">1901</a>)</span>, p.&nbsp;566.</p>
</blockquote>
<p>It was but a small step to recognize that for two variables, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>:</p>
<ul>
<li>the line of best fit, the major axis (PC1) had the greatest variance of points projected onto it;</li>
<li>the line of worst fit, the minor axis (PC2), had the least variance;</li>
<li>these could be seen as a rotation of the data space of <span class="math inline">\((x, y)\)</span> to a new space (PC1, PC2) with uncorrelated variables;</li>
<li>the total variation of the points in data space, <span class="math inline">\(\text{Var}(x) + \text{Var}(y)\)</span>, being unchanged by rotation, was equally well expressed as the total variation <span class="math inline">\(\text{Var}(PC1) + \text{Var}(PC2)\)</span> of the scores on what are now called the principal component axes.</li>
</ul>
<section id="pca-by-springs" class="level3" data-number="4.2.1"><h3 data-number="4.2.1" class="anchored" data-anchor-id="pca-by-springs">
<span class="header-section-number">4.2.1</span> PCA by springs</h3>
<p>Before delving into the mathematics of PCA, it is useful to see how Pearson’s problem, and fitting by least squares generally, could be solved in a physical realization.</p>
<p>From elementary statistics, you may be familiar with a physical demonstration that the mean, <span class="math inline">\(\bar{x}\)</span>, of a sample is the value for which the sum of deviations, <span class="math inline">\(\Sigma_i (x_i - \bar{x})\)</span> is zero, so the mean can be visualized as the point of balance on a line where those differences <span class="math inline">\((x_i - \bar{x})\)</span> are placed. Equally well, there is a physical realization of the mean as the point along an axis where weights connected by springs will minimize the sum of squared differences, because springs with a constant stiffness, <span class="math inline">\(k\)</span>, exert forces proportional to <span class="math inline">\(k (x_i - \bar{x}) ^2\)</span>. That’s the reason is useful as a measure of central tendency: it minimizes the average squared error.</p>
<p>In two dimensions, imagine that we have points, <span class="math inline">\((x_i, y_i)\)</span> and these are attached by springs of equal stiffness <span class="math inline">\(k\)</span>, to a line anchored at the centroid, <span class="math inline">\((\bar{x}, \bar{y})\)</span> as shown in <a href="#fig-pca-springs">Figure&nbsp;<span>4.4</span></a>. If we rotate the line to some initial position and release it, the springs will pull the line clockwise or counterclockwise and the line will bounce around until the forces, proportional to the squares of the lengths of the springs, will eventually balance out at the position (shown by the <span style="color: red;">red</span> of the fixed line segments at the ends). This is the position that minimizes the the sum of squared lengths of the connecting springs, and also minimizes the kinetic energy in the system.</p>
<p>If you look closely at <a href="#fig-pca-springs">Figure&nbsp;<span>4.4</span></a> you will see something else: When the line is at its’ final position of minimum squared length and energy, the positions of the <span style="color: red;">red</span> points on this line are spread out furthest, i.e., have <strong>maximum</strong> variance. Conversely, when the line line is at right angles to its’ final position (shown by the black line) the projected points have the smallest possible variance.</p>
<div id="fig-pca-springs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div data-align="center">
<iframe width="412" height="364" src="images/pca-springs-cropped.gif">
</iframe>
</div>
<figcaption class="figure-caption">Figure&nbsp;4.4: Animation of PCA fitted by springs. The blue data points are connected to their projections on the <span style="color: red;">red</span> line by springs perpendicular to that line. From an initial position, the springs pull that line in proportion to their squared distances, until the line finally settles down to the position where the forces are balanced and the minimum is achieved. <em>source</em>: https://bit.ly/46tAicu.</figcaption></figure>
</div>
<!-- See: https://joshualoftus.com/posts/2020-11-23-least-squares-as-springs/least-squares-as-springs.html -->
<p><strong>TODO</strong>: Simple PCA example</p>
</section><section id="mathematics-and-geometry-of-pca" class="level3" data-number="4.2.2"><h3 data-number="4.2.2" class="anchored" data-anchor-id="mathematics-and-geometry-of-pca">
<span class="header-section-number">4.2.2</span> Mathematics and geometry of PCA</h3>
</section><section id="finding-principal-components" class="level3" data-number="4.2.3"><h3 data-number="4.2.3" class="anchored" data-anchor-id="finding-principal-components">
<span class="header-section-number">4.2.3</span> Finding principal components</h3>
<p>In R, principal components analysis is most easily carried out using <code><a href="https://rdrr.io/r/stats/prcomp.html">stats::prcomp()</a></code> or <code><a href="https://rdrr.io/r/stats/princomp.html">stats::princomp()</a></code> or similar functions in other packages such as <code>FactomineR::PCA()</code>. The <strong>FactoMineR</strong> package <span class="citation" data-cites="R-FactoMineR">(<a href="90-references.html#ref-R-FactoMineR" role="doc-biblioref"><strong>R-FactoMineR?</strong></a>)</span> has extensive capabilities for exploratory analysis of multivariate data (PCA, correspondence analysis, cluster analysis, …).</p>
<p>Unfortunately, although all of these performing similar calculations, the options for analysis and the details of the result they return differ …</p>
<p>The important options for analysis include:</p>
<ul>
<li>whether or not the data variables are <strong>centered</strong>, to a mean of 0</li>
<li>whether or not the data variables are <strong>scaled</strong>, to a variance of 1.</li>
</ul>
<section id="example-crime-data" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="example-crime-data">Example: Crime data</h4>
<p>The dataset <code>crime</code>, analysed in <a href="03-multivariate_plots.html#sec-corrgram"><span>Section&nbsp;3.2.2</span></a>, showed all positive correlations among the rates of various crimes in the corrgram, <a href="03-multivariate_plots.html#fig-crime-corrplot">Figure&nbsp;<span>3.27</span></a>. What can we see from a principal components analysis? Is it possible that a few dimensions can account for most of the juice in this data?</p>
<p>In this example, you can easily find the PCA solution using <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code> in a single line in base-R. You need to specify the numeric variables to analyze by their columns in the data frame. The most important option here is <code>scale. = TRUE</code> …</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">crime</span>, package <span class="op">=</span> <span class="st">"ggbiplot"</span><span class="op">)</span></span>
<span><span class="va">crime.pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">crime</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The tidy equivalent is more verbose, but also more expressive about what is being done. It selects the variables to analyze by a function, <code><a href="https://rdrr.io/r/base/numeric.html">is.numeric()</a></code> applied to each of the columns and feeds the result to <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crime.pca</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">crime</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span>scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As is typical with models in R, the result, <code>crime.pca</code> of <code><a href="https://rdrr.io/r/stats/prcomp.html">prcomp()</a></code> is an object of class <code>"prcomp"</code>, a list of components, and there are a variety of methods for <code>"prcomp"</code> objects. Among the simplest is <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, which gives the contributions of each component to the total variance in the dataset.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">crime.pca</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Importance of components:</span></span>
<span><span class="co">#&gt;                         PC1  PC2  PC3   PC4   PC5   PC6   PC7</span></span>
<span><span class="co">#&gt; Standard deviation     2.03 1.11 0.85 0.563 0.508 0.471 0.352</span></span>
<span><span class="co">#&gt; Proportion of Variance 0.59 0.18 0.10 0.045 0.037 0.032 0.018</span></span>
<span><span class="co">#&gt; Cumulative Proportion  0.59 0.76 0.87 0.914 0.951 0.982 1.000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="visualizing-variance-proportions-screeplots" class="level3" data-number="4.2.4"><h3 data-number="4.2.4" class="anchored" data-anchor-id="visualizing-variance-proportions-screeplots">
<span class="header-section-number">4.2.4</span> Visualizing variance proportions: screeplots</h3>
<p>For a high-D dataset, such as the crime data in seven dimensions, a natural question is how much of the variation in the data can be captured in 1D, 2D, 3D, … summaries and views. This is answered by considering the proportions of variance accounted by each of the dimensions, or their cumulative values. The components returned by various PCA methods have (confusingly) different names, so <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code> provides methods to unify extraction of these values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">crime.eig</span> <span class="op">&lt;-</span> <span class="va">crime.pca</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"eigenvalues"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 4</span></span>
<span><span class="co">#&gt;      PC std.dev percent cumulative</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1   2.03   0.588       0.588</span></span>
<span><span class="co">#&gt; 2     2   1.11   0.177       0.765</span></span>
<span><span class="co">#&gt; 3     3   0.852  0.104       0.868</span></span>
<span><span class="co">#&gt; 4     4   0.563  0.0452      0.914</span></span>
<span><span class="co">#&gt; 5     5   0.508  0.0368      0.951</span></span>
<span><span class="co">#&gt; 6     6   0.471  0.0317      0.982</span></span>
<span><span class="co">#&gt; 7     7   0.352  0.0177      1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, a simple visualization is a plot of the proportion of variance for each component (or cumulative proportion) against the component number, usually called a <strong>screeplot</strong>. The idea, introduced by <span class="citation" data-cites="Cattell1966">Cattell (<a href="90-references.html#ref-Cattell1966" role="doc-biblioref">1966</a>)</span>, is that after the largest, dominant components, the remainder should resemble the rubble, or scree formed by rocks falling from a cliff. From this plot, imagine drawing a straight line through the plotted eigenvalues, starting with the largest one. The typical rough guidance is that the last point to fall on this line represents the last component to extract, the idea being that beyond this, the amount of additional variance explained is non-meaningful. Another rule of thumb is to choose the number of components to extract a desired proportion of total variance, usually in the range of 80 - 90%.</p>
<p><code>stats::plot(crime.pca)</code> would give a bar plot of the variances of the components, however ggbiplot::ggscreeplot()` gives nicer and more flexible displays as shown in <a href="#fig-crime-ggscreeplot">Figure&nbsp;<span>4.5</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggbiplot/man/ggscreeplot.html">ggscreeplot</a></span><span class="op">(</span><span class="va">crime.pca</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crime.eig</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PC</span><span class="op">&gt;=</span><span class="fl">4</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC</span>, y<span class="op">=</span><span class="va">percent</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>              se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              fullrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggbiplot/man/ggscreeplot.html">ggscreeplot</a></span><span class="op">(</span><span class="va">crime.pca</span>, type <span class="op">=</span> <span class="st">"cev"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.9</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crime-ggscreeplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figs/fig-crime-ggscreeplot-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4.5: Screeplots for the PCA of the crime data. The left panel shows the traditional version, plotting variance proportions against component number, with linear guideline for the scree rule of thumb. The right panel plots cumulative proportions, showing cutoffs of 80%, 90%.</figcaption></figure>
</div>
</div>
</div>
<p>From this we might conclude that four components are necessary to satisfy the scree criterion or to account for 90% of the total variation in these crime statistics. However two components, giving 76.5%, might be enough juice to tell a reasonable story.</p>
</section><section id="visualizing-pca-scores" class="level3" data-number="4.2.5"><h3 data-number="4.2.5" class="anchored" data-anchor-id="visualizing-pca-scores">
<span class="header-section-number">4.2.5</span> Visualizing PCA scores</h3>
</section><section id="elliptical-insights-outlier-detection" class="level3" data-number="4.2.6"><h3 data-number="4.2.6" class="anchored" data-anchor-id="elliptical-insights-outlier-detection">
<span class="header-section-number">4.2.6</span> Elliptical insights: Outlier detection</h3>
<p>The data ellipse (<a href="03-multivariate_plots.html#sec-data-ellipse"><span>Section&nbsp;3.1.4</span></a>), or ellipsoid in more than 2D is fundamental in regression. But also, as Pearson showed, it is key to understanding principal components analysis, where the principal component directions are simply the axes of the ellipsoid of the data. As such, observations that are unusual in data space may not stand out in univariate views of the variables, but will stand out in principal component space, usually on the <em>smallest</em> dimension.</p>
<p>As an illustration, I created a dataset of <span class="math inline">\(n = 100\)</span> observations with a linear relation, <span class="math inline">\(y = x + \mathcal{N}(0, 1)\)</span> and then added two discrepant points at (1.5, -1.5), (-1.5, 1.5).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123345</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,             <span class="fl">1.5</span>, <span class="op">-</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When these are plotted with a data ellipse in <a href="#fig-outlier-demo">Figure&nbsp;<span>4.6</span></a> (left), you can see the discrepant points labeled 101 and 102, but they do not stand out as unusual on either <span class="math inline">\(x\)</span> or <span class="math inline">\(y\)</span>. The transformation to from data space to principal components space, shown in <a href="#fig-outlier-demo">Figure&nbsp;<span>4.6</span></a> (right), is simply a rotation of <span class="math inline">\((x, y)\)</span> to a space whose coordinate axes are the major and minor axes of the data ellipse, <span class="math inline">\((PC_1, PC_2)\)</span>. In this view, the additional points appear a univariate outliers on the smallest dimension, <span class="math inline">\(PC_2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-outlier-demo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/outlier-demo.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4.6: <strong>Outlier demonstration</strong>: The left panel shows the original data and highlights the two discrepant points, which do not appear to be unusual on either x or y. The right panel shows the data rotated to principal components, where the labeled points stand out on the smallest PCA dimension.</figcaption></figure>
</div>
</div>
</div>
<p>To see this more clearly, <a href="#fig-outlier-animation">Figure&nbsp;<span>4.7</span></a> shows an animation of the rotation from data space to PCA space. This uses <code><a href="https://friendly.github.io/heplots/reference/interpPlot.html">heplots::interpPlot()</a></code> …</p>
<div id="fig-outlier-animation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div data-align="center">
<iframe width="480" height="480" src="images/outlier-demo.gif">
</iframe>
</div>
<figcaption class="figure-caption">Figure&nbsp;4.7: Animation of rotation from data space to PCA space.</figcaption></figure>
</div>
</section></section><section id="sec-biplot" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="sec-biplot">
<span class="header-section-number">4.3</span> Biplots</h2>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Cattell1966" class="csl-entry" role="listitem">
Cattell, Raymond B. 1966. <span>“The Scree Test for the Number of Factors.”</span> <em>Multivariate Behavioral Research</em> 1 (2): 245–76. <a href="https://doi.org/10.1207/s15327906mbr0102_10">https://doi.org/10.1207/s15327906mbr0102_10</a>.
</div>
<div id="ref-Euler:1758" class="csl-entry" role="listitem">
Euler, Leonhard. 1758. <span>“Elementa Doctrinae Solidorum.”</span> <em>Novi Commentarii Academiae Scientiarum Petropolitanae</em> 4: 109–40. <a href="https://scholarlycommons.pacific.edu/euler-works/230/">https://scholarlycommons.pacific.edu/euler-works/230/</a>.
</div>
<div id="ref-Friendly-etal:ellipses:2013" class="csl-entry" role="listitem">
Friendly, Michael, Georges Monette, and John Fox. 2013. <span>“Elliptical Insights: Understanding Statistical Methods Through Elliptical Geometry.”</span> <em>Statistical Science</em> 28 (1): 1–39. <a href="https://doi.org/10.1214/12-STS402">https://doi.org/10.1214/12-STS402</a>.
</div>
<div id="ref-FriendlyWainer:2021:TOGS" class="csl-entry" role="listitem">
Friendly, Michael, and Howard Wainer. 2021. <em>A History of Data Visualization and Graphic Communication</em>. Cambridge, MA: Harvard University Press. <a href="https://doi.org/10.4159/9780674259034">https://doi.org/10.4159/9780674259034</a>.
</div>
<div id="ref-Galton:1886" class="csl-entry" role="listitem">
Galton, Francis. 1886. <span>“Regression Towards Mediocrity in Hereditary Stature.”</span> <em>Journal of the Anthropological Institute</em> 15: 246–63. <a href="http://www.jstor.org/cgi-bin/jstor/viewitem/09595295/dm995266/99p0374f/0">http://www.jstor.org/cgi-bin/jstor/viewitem/09595295/dm995266/99p0374f/0</a>.
</div>
<div id="ref-Pearson:1896" class="csl-entry" role="listitem">
Pearson, Karl. 1896. <span>“Contributions to the Mathematical Theory of Evolution—<span>III</span>, Regression, Heredity and Panmixia.”</span> <em>Philosophical Transactions of the Royal Society of London</em>, A, 187: 253–318.
</div>
<div id="ref-Pearson:1901" class="csl-entry" role="listitem">
———. 1901. <span>“On Lines and Planes of Closest Fit to Systems of Points in Space.”</span> <em>Philosophical Magazine</em> 6 (2): 559–72.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>This is Euler’s <span class="citation" data-cites="Euler:1758">(<a href="90-references.html#ref-Euler:1758" role="doc-biblioref">1758</a>)</span> formula, which states that any convex polyheron must obey the formula <span class="math inline">\(V + F - E = 2\)</span> where <span class="math inline">\(V\)</span> is the number of vertexes (corners), <span class="math inline">\(F\)</span> is the number of faces and <span class="math inline">\(E\)</span> is the number of edges. For example, a tetrahedron or pyramid has <span class="math inline">\((V, F, E) = (4, 4, 6)\)</span> and a cube has <span class="math inline">\((V, F, E) = (8, 6, 12)\)</span>. Stated in words, for all solid bodies confined by planes, the sum of the number of vertexes and the number of faces is two less than the number of edges.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./03-multivariate_plots.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./linear_models.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>