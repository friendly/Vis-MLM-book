<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>10&nbsp; Multivariate Linear Model – Visualizing Multivariate Data and Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-mlm-viz.html" rel="next">
<link href="./09-hotelling.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-mlm-review.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title"><span id="sec-mlm-review" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Model</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mlm-review.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./90-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#structure-of-the-mlm" id="toc-structure-of-the-mlm" class="nav-link active" data-scroll-target="#structure-of-the-mlm"><span class="header-section-number">10.1</span> Structure of the MLM</a>
  <ul class="collapse">
<li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions"><span class="header-section-number">10.1.1</span> Assumptions</a></li>
  </ul>
</li>
  <li>
<a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model"><span class="header-section-number">10.2</span> Fitting the model</a>
  <ul class="collapse">
<li><a href="#sums-of-squares" id="toc-sums-of-squares" class="nav-link" data-scroll-target="#sums-of-squares"><span class="header-section-number">10.2.1</span> Sums of squares</a></li>
  <li><a href="#test-statistics" id="toc-test-statistics" class="nav-link" data-scroll-target="#test-statistics"><span class="header-section-number">10.2.2</span> Test statistics</a></li>
  <li><a href="#testing-contrasts-and-linear-hypotheses" id="toc-testing-contrasts-and-linear-hypotheses" class="nav-link" data-scroll-target="#testing-contrasts-and-linear-hypotheses"><span class="header-section-number">10.2.3</span> Testing contrasts and linear hypotheses</a></li>
  </ul>
</li>
  <li>
<a href="#anova-rightarrow-manova" id="toc-anova-rightarrow-manova" class="nav-link" data-scroll-target="#anova-rightarrow-manova"><span class="header-section-number">10.3</span> ANOVA <span class="math inline">\(\rightarrow\)</span> MANOVA</a>
  <ul class="collapse">
<li><a href="#example-father-parenting-data" id="toc-example-father-parenting-data" class="nav-link" data-scroll-target="#example-father-parenting-data"><span class="header-section-number">10.3.1</span> Example: Father parenting data</a></li>
  </ul>
</li>
  <li><a href="#mra-rightarrow-mmra" id="toc-mra-rightarrow-mmra" class="nav-link" data-scroll-target="#mra-rightarrow-mmra"><span class="header-section-number">10.4</span> MRA <span class="math inline">\(\rightarrow\)</span> MMRA</a></li>
  <li><a href="#ancova-rightarrow-mancova" id="toc-ancova-rightarrow-mancova" class="nav-link" data-scroll-target="#ancova-rightarrow-mancova"><span class="header-section-number">10.5</span> ANCOVA <span class="math inline">\(\rightarrow\)</span> MANCOVA</a></li>
  <li><a href="#repeated-measures-designs" id="toc-repeated-measures-designs" class="nav-link" data-scroll-target="#repeated-measures-designs"><span class="header-section-number">10.6</span> Repeated measures designs</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \newcommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><p>\newcommand{HO}{_0}</p>
<!-- \newcommand*{\E}{\mathcal{E}} -->
<!-- % R stuff -->
<p><a href="09-hotelling.html" class="quarto-xref"><span>Chapter 9</span></a> introduced the essential ideas of multivariate analysis in the context of a two-group design using Hotelling’s <span class="math inline">\(T^2\)</span>. Here, I extend this to the to the general Multivariate Linear Model (MLM). This can be understood as a simple extension of the univariate linear model, with the main difference being that there are multiple response variables considered together, instead of just one, analysed alone. These outcomes might reflect several different ways or scales for measuring an underlying theoretical construct, or they might represent different aspects of some phenomenon that are better understood when studied jointly.</p>
<p>For example, in the first case of different measures, there are numerous psychological scales used to assess depression or anxiety and it may be important to include more than one measure to ensure that the construct has been measured adequately. In the second case of various aspects, student “aptitude” or “achievement” reflects competency in different various subjects (reading, math, history, science, …) that are better studied together.</p>
<p>In this context, there are multiple techniques that can be applied depending on the structure of the variables at hand. For instance, with one or more continuous predictors and multiple response variables, one could use multivariate multiple regression (MMRA) to obtain estimates useful for prediction. Instead, if the predictors are categorical, multivariate analysis of variance (MANOVA) can be applied to test for differences between groups. Again, this is akin to multiple regression and ANOVA in the univariate context – the same underlying model is utilized, but the tests for terms in the model are multivariate ones for the collection of all response variables, rather than univariate ones for a single response.</p>
<!-- **TODO** Use `\Epsilon` = $\Epsilon$ here, which is defined as `\boldsymbol{\large\varepsilon}` for residuals. -->
<!-- Could also use a larger version, `\boldsymbol{\Large\varepsilon}` = -->
<!-- $\boldsymbol{\Large\varepsilon}$ if that makes a difference. -->
<p>Before considering the details and examples that apply to MANOVA and MMRA, it is useful to consider the features of the multivariate linear model of which these cases are examples.</p>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://friendly.github.io/heplots/">heplots</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="structure-of-the-mlm" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="structure-of-the-mlm">
<span class="header-section-number">10.1</span> Structure of the MLM</h2>
<p>In each of these cases, the underlying MLM is given most compactly using the matrix equation, <!-- $$ --> <!-- \newcommand{\sizedmat}[2]{\mathord{\mathop{\mathbf{#1}\limits_{(#2)}}} --> <!-- $$ --></p>
<p><span id="eq-mlm"><span class="math display">\[
\mathord{\mathop{\mathbf{Y}}\limits_{n \times p}} =
\mathord{\mathop{\mathbf{X}}\limits_{n \times (q+1)}} \, \mathord{\mathop{\mathbf{B}}\limits_{(q+1) \times p}} + \mathord{\mathop{\mathbf{\boldsymbol{\Large\varepsilon}}}\limits_{n \times p}} \:\: ,
\tag{10.1}\]</span></span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(\mathbf{Y} = (\mathbf{y}_1 , \mathbf{y}_2, \dots , \mathbf{y}_j, \dots, \mathbf{y}_p )\)</span> is the matrix of <span class="math inline">\(n\)</span> observations on <span class="math inline">\(p\)</span> responses;</li>
<li>
<span class="math inline">\(\mathbf{X}\)</span> is the model matrix with columns <span class="math inline">\(\mathbf{x}_i\)</span> for <span class="math inline">\(q\)</span> regressors, which typically includes an initial column <span class="math inline">\(\mathbf{x}_0\)</span> of 1s for the intercept;</li>
<li>
<span class="math inline">\(\mathbf{B} = ( \mathbf{b}_1 , \mathbf{b}_2 , \dots \mathbf{b}_j \dots, \mathbf{b}_p )\)</span> is a matrix of regression coefficients, one column <span class="math inline">\(\mathbf{b}_j\)</span> for each response variable;</li>
<li>
<span class="math inline">\(\boldsymbol{\Large\varepsilon}\)</span> is a matrix of errors in predicting <span class="math inline">\(\mathbf{Y}\)</span>.</li>
</ul>
<p>When it is useful to refer symbolically to the <em>rows</em> <span class="math inline">\(\mathbf{b}_i^\top\)</span> of coefficients for the regressors <span class="math inline">\(x_0, x_1, x_2, \dots, x_i, \dots x_q\)</span>, these are expressed as <span class="math inline">\(\mathbf{B} = ( \mathbf{b}_0^\top^\top , \mathbf{b}_1^\top , \dots \mathbf{b}_j^\top \dots, \mathbf{b}_p )^\top\)</span>, or more explicitly</p>
<p><span class="math display">\[
\mathord{\mathop{\mathbf{B}}\limits_{(q+1) \times p}} =
\begin{pmatrix}
  b_{0}^\top \\
  b_{1}^\top  \\
  \vdots \\
  b_{i}^\top  \\
  \vdots \\
  b_{q}^\top  \\
\end{pmatrix}
\]</span></p>
<p>The structure of the model matrix <span class="math inline">\(\mathbf{X}\)</span> is the same as the univariate linear model, and may contain, therefore,</p>
<ul>
<li>
<strong>quantitative</strong> predictors, such as <code>age</code>, <code>income</code>, years of <code>education</code>
</li>
<li>
<strong>transformed predictors</strong> like <span class="math inline">\(\sqrt{\text{age}}\)</span> or <span class="math inline">\(\log{(\text{income})}\)</span>
</li>
<li>
<strong>polynomial terms</strong>: <span class="math inline">\(\text{age}^2\)</span>, <span class="math inline">\(\text{age}^3, \dots\)</span> (using <code>poly(age, k)</code> in R)</li>
<li>
<strong>categorical predictors</strong> (“factors”), such as treatment (Control, Drug A, drug B), or sex; internally a factor with <code>k</code> levels is transformed to <code>k-1</code> dummy (0, 1) variables, representing comparisons with a reference level, typically the first.</li>
<li>
<strong>interaction terms</strong>, involving either quantitative or categorical predictors, e.g., <code>age * sex</code>, <code>treatment * sex</code>.</li>
</ul>
<section id="assumptions" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="assumptions">
<span class="header-section-number">10.1.1</span> Assumptions</h3>
<p>Just as in univariate models, the assumptions of the multivariate linear model almost entirely concern the behavior of the errors (residuals). Let <span class="math inline">\(\mathbf{\epsilon}_{i}^{\prime}\)</span> represent the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(\boldsymbol{\Large\varepsilon}\)</span>. Then it is assumed that:</p>
<ul>
<li>
<strong>Normality</strong>: The residuals, <span class="math inline">\(\mathbf{\epsilon}_{i}^{\prime}\)</span> are distributed as multivariate normal, <span class="math inline">\(\mathcal{N}_{p}(\mathbf{0},\boldsymbol{\Sigma})\)</span>, where <span class="math inline">\(\mathbf{\Sigma}\)</span> is a non-singular error-covariance matrix. Statistical tests of multivariate normality of the residuals include the Shapiro-Wilk <span class="citation" data-cites="ShapiroWilk1965">(<a href="90-references.html#ref-ShapiroWilk1965" role="doc-biblioref">Shapiro &amp; Wilk, 1965</a>)</span> and Mardia <span class="citation" data-cites="Mardia:1970:MMS">(<a href="90-references.html#ref-Mardia:1970:MMS" role="doc-biblioref">Mardia, 1970</a>)</span> tests (in the <strong>MVN</strong> package); <!-- mshapiro.test( )[in the mvnormtest package] can be used to perform the Shapiro-Wilk test for multivariate normality --> however this is often better assessed visually using a <span class="math inline">\(\chi^2\)</span> QQ plot of Mahalanobis squared distance against their corresponding <span class="math inline">\(\chi^2_p\)</span> values using <code><a href="https://friendly.github.io/heplots/reference/cqplot.html">heplots::cqplot()</a></code>.</li>
<li>
<strong>Homoscedasticity</strong>: The error-covariance matrix <span class="math inline">\(\mathbf{\Sigma}\)</span> is constant across all observations and grouping factors. Graphical methods to determine if this assumption is met are described in <a href="eqcov.html" class="quarto-xref"><span>Chapter 12</span></a>.</li>
<li>
<strong>Independence</strong>: <span class="math inline">\(\mathbf{\epsilon}_{i}^{\prime}\)</span> and <span class="math inline">\(\mathbf{\epsilon}_{j}^{\prime}\)</span> are independent for <span class="math inline">\(i\neq j\)</span>, so knowing the data for case <span class="math inline">\(i\)</span> gives no information about case <span class="math inline">\(j\)</span> (as would be true if the data consisted of pairs of husbands and wives);</li>
<li>The predictors, <span class="math inline">\(\mathbf{X}\)</span>, are fixed and measured without error or at least they are independent of the errors, <span class="math inline">\(\boldsymbol{\Large\varepsilon}\)</span>.</li>
</ul>
<p>These statements are simply the multivariate analogs of the assumptions of normality, constant variance and independence of the errors in univariate models. Note that it is unnecessary to assume that the predictors (regressors, columns of <span class="math inline">\(\mathbf{X}\)</span>) are normally distributed.</p>
<p>Implicit in the above is perhaps the most important assumption—that the model has been correctly specified. This means:</p>
<ul>
<li><p><strong>Linearity</strong>: The form of the relations between each <span class="math inline">\(\mathbf{y}\)</span> and the <span class="math inline">\(\mathbf{x}\)</span>s is correct. Typically this means that the relations are <em>linear</em>, but if not, we have specified a correct transformation of <span class="math inline">\(\mathbf{y}\)</span> and/or <span class="math inline">\(\mathbf{x}\)</span>.</p></li>
<li><p><strong>Completeness</strong>: No relevant predictors have been omitted from the model.</p></li>
<li><p><strong>Additive effects</strong>: The combined effect of different predictors is the sum of their individual effects.</p></li>
</ul></section></section><section id="fitting-the-model" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="fitting-the-model">
<span class="header-section-number">10.2</span> Fitting the model</h2>
<p>The least squares (and also maximum likelihood) solution for the coefficients <span class="math inline">\(\mathbf{B}\)</span> is given by</p>
<!-- $$ -->
<!-- \widehat{\mathbf{B}} = (\mathbf{X}\trans \mathbf{X})^{-1} \mathbf{X}\trans \mathbf{Y} \period -->
<!-- $$ -->
<p><span class="math display">\[
\widehat{\mathbf{B}} = (\mathbf{X}^\top \mathbf{X})^{-1} \mathbf{X}^\top \mathbf{Y} \:\: .
\]</span></p>
<p>This is precisely the same as fitting the separate responses <span class="math inline">\(\mathbf{y}_1 , \mathbf{y}_2 , \dots , \mathbf{y}_p\)</span>, and placing the estimated coefficients <span class="math inline">\(\widehat{\mathbf{b}}_i\)</span> as columns in <span class="math inline">\(\widehat{\mathbf{B}}\)</span></p>
<p><span class="math display">\[
\widehat{\mathbf{B}} = [ \widehat{\mathbf{b}}_1, \widehat{\mathbf{b}}_2, \dots , \widehat{\mathbf{b}}_p] \:\: .
\]</span> In R, we fit the multivariate linear model with <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> simply by giving a collection of response variables <code>y1, y2, ...</code> on the left-hand side of the model formula, wrapped in <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code> which combines them to form a matrix response.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span>, <span class="va">y3</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">...</span>, data<span class="op">=</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the presence of possible outliers, robust methods are available for univariate linear models (e.g., <code>MASS::rlm()). So too,</code>heplots::robmlm()` provides robust estimation in the multivariate case.</p>
<section id="sums-of-squares" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="sums-of-squares">
<span class="header-section-number">10.2.1</span> Sums of squares</h3>
<p>In univariate response models, statistical tests and model summaries (like <span class="math inline">\(R^2\)</span>) are based on the familiar decomposition of the total sum of squares <span class="math inline">\(SS_T\)</span> into regression or hypothesis (<span class="math inline">\(SS_H\)</span>) and error (<span class="math inline">\(SS_E\)</span>) sums of squares. In the multivariate linear model each of these becomes a <span class="math inline">\(p \times p\)</span> matrix <span class="math inline">\(SSP\)</span> containing sums of squares for the <span class="math inline">\(p\)</span> responses on the diagonal and sums of cross products in the off-diagonal. elements. For the MLM this is expressed as</p>
<p><span class="math display">\[\begin{aligned}
\underset{(p\times p)}{\mathbf{SSP}_{T}}
&amp; = &amp;&amp; \mathbf{Y}^{\prime} \mathbf{Y} - n \overline{\mathbf{y}}\,\overline{\mathbf{y}}^{\prime} \\
&amp; = &amp;&amp; \left(\widehat {\mathbf{Y}}^{\prime}\widehat{\mathbf{Y}} - n\overline{\mathbf{y}}\,\overline{\mathbf{y}}^{\prime} \right) + \widehat{\boldsymbol{\Large\varepsilon}^{\prime}}\widehat{\boldsymbol{\Large\varepsilon}} \\
&amp; = &amp;&amp;  \mathbf{SSP}_{H} + \mathbf{SSP}_{E} \\
&amp; \equiv &amp;&amp; \mathbf{H} + \mathbf{E} \:\: ,
\end{aligned}\]</span></p>
<p>where <span class="math inline">\(\overline{\mathbf{y}}\)</span> is the <span class="math inline">\((p\times 1)\)</span> vector of means for the response variables; <span class="math inline">\(\widehat{\mathbf{Y}} = \mathbf{X}\widehat{\mathbf{B}}\)</span> is the matrix of fitted values; and <span class="math inline">\(\widehat{\boldsymbol{\Large\varepsilon}} = \mathbf{Y} -\widehat{\mathbf{Y}}\)</span> is the matrix of residuals. This is the decomposition that we visualize in HE plots, where the size and direction of <span class="math inline">\(\mathbf{H}\)</span> and <span class="math inline">\(\mathbf{E}\)</span> can be represented as ellipsoids.</p>
<p>The univariate <span class="math inline">\(F\)</span> test statistic, <span class="math display">\[F = \frac{\text{SS}_H/\text{df}_h}{\text{SS}_E/\text{df}_e} = \frac{\mathsf{Var}(H)}{\mathsf{Var}(E)} \:\: ,
\]</span> assesses “how big” <span class="math inline">\(\text{SS}_H\)</span> is, relative to <span class="math inline">\(\text{SS}_E\)</span>, the variance accounted for by a hypothesized model or model terms relative to error variance. In the multivariate analog <span class="math inline">\(\mathbf{H}\)</span> and <span class="math inline">\(\mathbf{E}\)</span> are both <span class="math inline">\(p \times p\)</span> matrices, and <span class="math inline">\(\mathbf{H}\)</span> “divided by” <span class="math inline">\(\mathbf{E}\)</span> becomes <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span>. The answer, “how big” is expressed in terms of the <span class="math inline">\(p\)</span> eigenvalues <span class="math inline">\(\lambda_i, i = 1, 2, \dots p\)</span> of <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span>. These are the values <span class="math inline">\(\lambda\)</span> for which <span class="math display">\[
\mathrm{det}(\mathbf{H}\mathbf{E}^{-1} - \lambda \mathbf{I}) = 0 \:\: .
\]</span> The solution gives the <span class="math inline">\(\lambda_i\)</span> as the eigenvalues, with vectors <span class="math inline">\(\mathbf{v}_i\)</span> as the corresponding eigenvectors, <span id="eq-he-eigen"><span class="math display">\[
\mathbf{H}\mathbf{E}^{-1} \; \lambda_i = \lambda_i \mathbf{v}_i \:\: .
\tag{10.2}\]</span></span></p>
<p>However, when the hypothesized model terms have <span class="math inline">\(\text{df}_h\)</span> degrees of freedom (columns of the <span class="math inline">\(\mathbf{X}\)</span> matrix for that term), <span class="math inline">\(\mathbf{H}\)</span> is of rank <span class="math inline">\(\text{df}_h\)</span>, so only <span class="math inline">\(s=\min(p, \text{df}_h)\)</span> eigenvalues can be non-zero. For example, a test for a hypothesis about a single quantitative predictor <span class="math inline">\(\mathbf{x}\)</span>, has <span class="math inline">\(\text{df}_h = 1\)</span> degree of freedom and <span class="math inline">\(\mathrm{rank} (\mathbf{H}) = 1\)</span>; for a factor with <span class="math inline">\(g\)</span> groups, <span class="math inline">\(\text{df}_h = \mathrm{rank} (\mathbf{H}) = g-1\)</span>.</p>
<!-- This -->
<!-- has a direct multivariate analog in terms of -->
<!-- the $s=\min(p, df_h)$ non-zero latent roots (eigenvalues), $\lambda_i$, of $\mat{H}\mat{E}^{-1}$ -->
<!-- ($\mathbf{H}$ "divided by" $\mathbf{E}$); that is, the values $\lambda_i$ that solve -->
<!-- $$ -->
<!--  \det{ ( \mathbf{H}\mathbf{E}^{-1} - \lambda \mathbf{I} )} = 0 \Longrightarrow  -->
<!--  \mathbf{H}\mathbf{E}^{-1} \lambda_i = \lambda_i \mathbf{v}_i \period -->
<!-- $$ -->
<p>The overall multivariate test for the model in <a href="#eq-mlm" class="quarto-xref">Equation&nbsp;<span>10.1</span></a> is essentially a test of the hypothesis <span class="math inline">\(\mathcal{H}_0: \mathbf{B} = 0\)</span> (excluding the row for the intercept). Equivalently, this is a test based on the <em>incremental</em> <span class="math inline">\(\mathbf{SSP}_{H}\)</span> for the hypothesized terms in the model—that is, the difference between the <span class="math inline">\(\mathbf{SSP}_{H}\)</span> for the full model and the null, intercept-only model. The same idea can be applied to test the difference between any pair of <em>nested</em> models—the added contribution of terms in a larger model relative to a smaller model containing a subset of terms.</p>
<p>The eigenvectors <span class="math inline">\(\mathbf{v}_i\)</span> in <a href="#eq-he-eigen" class="quarto-xref">Equation&nbsp;<span>10.2</span></a> are also important. These are the weights for the variables in a linear combination <span class="math inline">\(v_{i1} \mathbf{y}_1 + v_{i2} \mathbf{y}_2 + \cdots + v_{ip} \mathbf{y}_p\)</span> which produces the largest univariate <span class="math inline">\(F\)</span> statistic for the <span class="math inline">\(i\)</span>-th dimension. We exploit this in canonical discriminant analysis and the corresponding canonical HE plots (<strong>ref</strong>).</p>
</section><section id="test-statistics" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="test-statistics">
<span class="header-section-number">10.2.2</span> Test statistics</h3>
<p>In the univariate case, the overall <span class="math inline">\(F\)</span>-test of <span class="math inline">\(\mathcal{H}_0: \boldsymbol{\beta} = \mathbf{0}\)</span> is the uniformly most powerful invariant test when the assumptions are met. There is nothing better. This is not the case in the MLM.</p>
<p>The reason is that when there are <span class="math inline">\(p &gt; 1\)</span> response variables, and we are testing a hypothesis comprising <span class="math inline">\(\text{df}_h &gt;1\)</span> coefficients or degrees of freedom, there are <span class="math inline">\(s &gt; 1\)</span> possible dimensions in which <span class="math inline">\(\mathbf{H}\)</span> can be large relative to <span class="math inline">\(\mathbf{E}\)</span>, each measured by the eigenvalue <span class="math inline">\(\lambda_i\)</span>. There are several test statistics that combine these into a single measure, shown in <a href="#tbl-mstats" class="quarto-xref">Table&nbsp;<span>10.1</span></a>.</p>
<!-- $$ -->
<!-- \begin{align*} -->
<!-- \text{Wilks's Lambda} \quad & \Lambda = \prod^s_i \frac{1}{1+\lambda_i} \quad\quad  && \eta^2 = 1-\Lambda^{1/s} \\ -->
<!-- \text{Pillai trace} \quad &   V = \sum^s_i \frac{\lambda_i}{1+\lambda_i} \quad  && \eta^2 = \frac{V}{s}     \\ -->
<!-- \text{Hotelling-Lawley trace} \quad &  H = \sum^s_i \lambda_i \quad\quad   && \eta^2 = \frac{H}{H+s}   \\ -->
<!-- \text{Roy's maximum root} \quad &  R = \lambda_1   \quad\quad         &&  \eta^2 = \frac{\lambda_1}{1+\lambda_1}  \\ -->
<!-- \end{align*} -->
<!-- $$ -->
<div id="tbl-mstats" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mstats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.1: Test statistics for multivariate tests combine the size of dimensions of <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span> into a single measure.
</figcaption><div aria-describedby="tbl-mstats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="center">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;">Criterion</th>
<th style="text-align: left;">Formula</th>
<th style="text-align: left;">Partial <span class="math inline">\(\eta^2\)</span>
</th>
<th style="text-align: left;"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Wilks’s <span class="math inline">\(\Lambda\)</span>
</td>
<td style="text-align: left;"><span class="math inline">\(\Lambda = \prod^s_i \frac{1}{1+\lambda_i}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\eta^2 = 1-\Lambda^{1/s}\)</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Pillai trace</td>
<td style="text-align: left;"><span class="math inline">\(V = \sum^s_i \frac{\lambda_i}{1+\lambda_i}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\eta^2 = \frac{V}{s}\)</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hotelling-Lawley trace</td>
<td style="text-align: left;"><span class="math inline">\(H = \sum^s_i \lambda_i\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\eta^2 = \frac{H}{H+s}\)</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Roy maximum root</td>
<td style="text-align: left;"><span class="math inline">\(R = \lambda_1\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\eta^2 = \frac{\lambda_1}{1+\lambda_1}\)</span></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
<p>These correspond to different kinds of “means” of the <span class="math inline">\(\lambda_i\)</span>: arithmetic, geometric, harmonic and supremum. See <span class="citation" data-cites="Friendly-etal:ellipses:2013">Friendly et al. (<a href="90-references.html#ref-Friendly-etal:ellipses:2013" role="doc-biblioref">2013</a>)</span> for the geometry behind these measures.</p>
<p>Each of these statistics have different sampling distributions under the null hypothesis, but they can all be converted to <span class="math inline">\(F\)</span> statistics, which are exact when <span class="math inline">\(s \le 2\)</span>, and approximations otherwise. As well, each has an analog of the <span class="math inline">\(R^2\)</span>-like partial <span class="math inline">\(\eta^2\)</span> measure, giving the partial association accounted for by each term in the MLM.</p>
</section><section id="testing-contrasts-and-linear-hypotheses" class="level3" data-number="10.2.3"><h3 data-number="10.2.3" class="anchored" data-anchor-id="testing-contrasts-and-linear-hypotheses">
<span class="header-section-number">10.2.3</span> Testing contrasts and linear hypotheses</h3>
<p>Even more generally, these multivariate tests apply to <em>every</em> linear hypothesis concerning the coefficients in <span class="math inline">\(\mathbf{B}\)</span>. Suppose we want to test the hypothesis that a subset of rows (predictors) and/or columns (responses) simultaneously have null effects. This can be expressed in the general linear test, <span class="math display">\[
\mathcal{H}_0 : \mathbf{C}_{h \times q} \, \mathbf{B}_{q \times p} = \mathbf{0}_{h \times p} \:\: ,
\]</span> where <span class="math inline">\(\mathbf{C}\)</span> is a full rank <span class="math inline">\(h \le q\)</span> hypothesis matrix of constants, that selects subsets or linear combinations (contrasts) of the coefficients in <span class="math inline">\(\mathbf{B}\)</span> to be tested in a <span class="math inline">\(h\)</span> degree-of-freedom hypothesis.</p>
<p>In this case, the SSP matrix for the hypothesis has the form <span id="eq-hmat"><span class="math display">\[
\mathbf{H}  =
(\mathbf{C} \widehat{\mathbf{B}})^\mathsf{T}\,
[\mathbf{C} (\mathbf{X}^\mathsf{T}\mathbf{X} )^{-1} \mathbf{C}^\mathsf{T}]^{-1} \,
(\mathbf{C} \widehat{\mathbf{B}})
\tag{10.3}\]</span></span></p>
<p>where there are <span class="math inline">\(s = \min(h, p)\)</span> non-zero eigenvalues of <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span>. In <a href="#eq-hmat" class="quarto-xref">Equation&nbsp;<span>10.3</span></a>, <span class="math inline">\(\mathbf{H}\)</span> measures the (Mahalanobis) squared distances (and cross products) among the linear combinations <span class="math inline">\(\mathbf{C} \widehat{\mathbf{B}}\)</span> from the origin under the null hypothesis. <!-- An animated display of these ideas and the relations between data ellipses and HE plots can be seen at --> <!-- [https://www.datavis.ca/gallery/animation/manova/](https://www.datavis.ca/gallery/animation/manova/). --></p>
<p>For example, with three responses <span class="math inline">\(y_1, y_2, y_3\)</span> and three predictors <span class="math inline">\(x_1, x_2, x_3\)</span>, we can test the hypothesis that neither <span class="math inline">\(x_2\)</span> nor <span class="math inline">\(x_3\)</span> contribute at all to the predicting the <span class="math inline">\(y\)</span>s in terms of the hypothesis that the coefficients for the corresponding rows of <span class="math inline">\(\mathbf{B}\)</span> are zero using a 1-row <span class="math inline">\(\mathbf{C}\)</span> matrix that simply selects those rows:</p>
<!-- $$ -->
<!-- \mathcal{H}_0 : \mathbf{C} \mathbf{B} =  -->
<!-- \begin{bmatrix} -->
<!-- 0 & 1 & 1 & 0 -->
<!-- \end{bmatrix} -->
<!-- \begin{pmatrix} -->
<!--    \beta_{0,y_1} & \beta_{0,y_2} & \beta_{0,y_3} \\  -->
<!--    \beta_{1,y_1} & \beta_{1,y_2} & \beta_{1,y_3} \\  -->
<!--    \beta_{2,y_1} & \beta_{2,y_2} & \beta_{2,y_3} \\  -->
<!--    \beta_{3,y_1} & \beta_{3,y_2} & \beta_{3,y_3}  -->
<!-- \end{pmatrix} -->
<!-- = -->
<!-- \begin{bmatrix} -->
<!--    \beta_{1,y_1} & \beta_{1,y_2} & \beta_{1,y_3} \\  -->
<!--    \beta_{2,y_1} & \beta_{2,y_2} & \beta_{2,y_3} \\  -->
<!-- \end{bmatrix} -->
<!-- =  -->
<!-- \mathbf{0}_{(2 \times 3)} -->
<!-- $$ -->
<p><span class="math display">\[\begin{aligned}
\mathcal{H}_0 : \mathbf{C} \mathbf{B} &amp; =
\begin{bmatrix}
0 &amp; 1 &amp; 1 &amp; 0
\end{bmatrix}
\begin{pmatrix}
    \beta_{0,y_1} &amp; \beta_{0,y_2} &amp; \beta_{0,y_3} \\
    \beta_{1,y_1} &amp; \beta_{1,y_2} &amp; \beta_{1,y_3} \\
    \beta_{2,y_1} &amp; \beta_{2,y_2} &amp; \beta_{2,y_3} \\
    \beta_{3,y_1} &amp; \beta_{3,y_2} &amp; \beta_{3,y_3}
\end{pmatrix} \\ \\
&amp; =
\begin{bmatrix}
    \beta_{1,y_1} &amp; \beta_{1,y_2} &amp; \beta_{1,y_3} \\
    \beta_{2,y_1} &amp; \beta_{2,y_2} &amp; \beta_{2,y_3} \\
\end{bmatrix}
=
\mathbf{0}_{(2 \times 3)}
\end{aligned}\]</span></p>
</section></section><section id="anova-rightarrow-manova" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="anova-rightarrow-manova">
<span class="header-section-number">10.3</span> ANOVA <span class="math inline">\(\rightarrow\)</span> MANOVA</h2>
<p>Multivariate analysis of variance (MANOVA) generalizes the familiar ANOVA model to situations where there are two or more response variables. Unlike ANOVA, which focuses on discerning statistical differences in one continuous dependent variable influenced by an independent variable (or grouping variable), MANOVA considers several dependent variables at once. It integrates these variables into a single, composite variable through a weighted linear combination, allowing for a comprehensive analysis of how these dependent variables collectively vary with respect to the levels of the independent variable. Essentially, MANOVA investigates whether the grouping variable explains significant variations in the combined dependent variables.</p>
<p>The situation is illustrated in <a href="#fig-manova-diagram" class="quarto-xref">Figure&nbsp;<span>10.1</span></a> where there are two response measures, <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span> with data collected for three groups. For concreteness, <span class="math inline">\(Y_1\)</span> might be a score on a math test and <span class="math inline">\(Y_2\)</span> might be a reading score. Let’s also say that group 1 has been studying Shakespeare, while group 2 has concentrated on physics, but group 3 has done nothing beyond the normal curriculum.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-manova-diagram" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-manova-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/manova-diagram-anno.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-manova-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.1: Data from simple MANOVA design involving three groups and two response measures, <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span>, summarized by their data ellipses.
</figcaption></figure>
</div>
</div>
</div>
<p>As shown in the figure, the centroids, <span class="math inline">\((\mu_{1g}, \mu_{2g})\)</span>, clearly differ—the data ellipses barely overlap. A multivariate analysis would show a highly difference among groups. From a rough visual inspection, it seems that means differ on the math test <span class="math inline">\(Y_1\)</span>, with the physics group out-performing the other two. On the reading test <span class="math inline">\(Y_2\)</span> however it might turn out that the three group means don’t differ significantly in an ANOVA, although the Shakespeare group comes out best by a small amount. Doing separate ANOVAs on these variables would miss what is so obvious from <a href="#fig-manova-diagram" class="quarto-xref">Figure&nbsp;<span>10.1</span></a>.</p>
<p><a href="#fig-manova-response-dimensions" class="quarto-xref">Figure&nbsp;<span>10.2</span></a> illustrates a second important advantage of performing a multivariate analysis over separate ANOVAS: that of determining the number of dimensions or aspects along which groups differ. In the panel on the left, the means of the three groups increase nearly linearly on the combination of <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span>, to their differences can be ascribed to a single dimension. For example, the groups here might be patients diagnosed as normal, mild schizophrenia and profound schizophrenia, and the measures could be tests of memory and attention. The obvious multivariate interpretation from the figure is that of increasing impairment of cognitive functioning across the groups. Note also the positive association within each group: those who perform better on the memory task also do better on attention.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-manova-response-dimensions" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-manova-response-dimensions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/manova-response-dimensions-anno.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-manova-response-dimensions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.2: A simple MANOVA design involving three groups and two response measures, <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span>, but with different patterns of the differences among the group means. The red arrows suggest interpretations in terms of dimensions or aspects of the response variables.
</figcaption></figure>
</div>
</div>
</div>
<p>In contrast, the right panel of <a href="#fig-manova-response-dimensions" class="quarto-xref">Figure&nbsp;<span>10.2</span></a> shows a situation where the group means have a low correlation. Data like this might arise in a study of parental competency, where there are are measure of the degree of caring (<span class="math inline">\(Y_1\)</span>) and time spent in play (<span class="math inline">\(Y_2\)</span>) by fathers and groups consisting of fathers of children with no disability, or a physical disability or a mental ability. As can be seen in <a href="#fig-manova-response-dimensions" class="quarto-xref">Figure&nbsp;<span>10.2</span></a> fathers of the disabled children differ from those of the not disabled group in two different directions corresponding to being higher on either <span class="math inline">\(Y_1\)</span> or <span class="math inline">\(Y_2\)</span>. The <span style="color: red;">red</span> arrows suggest that the differences among groups could be interpreted in terms of two uncorrelated dimensions, perhaps labeled overall competency and emphasis on physical activity. (The pattern in <a href="#fig-manova-response-dimensions" class="quarto-xref">Figure&nbsp;<span>10.2</span></a> (right) is contrived for the sake of illustration; it does not reflect the data analyzed in the example below.)</p>
<section id="example-father-parenting-data" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="example-father-parenting-data">
<span class="header-section-number">10.3.1</span> Example: Father parenting data</h3>
<p>I use a simple example of a three-group multivariate design to illustrate the basic ideas of fitting MLMs in R and testing hypotheses. Visualization methods using HE plots are discussed in <span class="citation" data-cites="REF">(<a href="90-references.html#ref-REF" role="doc-biblioref"><strong>REF?</strong></a>)</span>.</p>
<p>The dataset <code><a href="https://friendly.github.io/heplots/reference/Parenting.html">heplots::Parenting</a></code> come from an exercise (10B) in <span class="citation" data-cites="Meyers-etal:2006">Meyers et al. (<a href="90-references.html#ref-Meyers-etal:2006" role="doc-biblioref">2006</a>)</span> and are probably contrived, but are modeled on a real study in which fathers were assessed on three subscales of a <em>Perceived Parenting Competence Scale</em>,</p>
<ul>
<li>
<code>caring</code>, caretaking responsibilities;</li>
<li>
<code>emotion</code>, emotional support provided to the child; and</li>
<li>
<code>play</code>, recreational time spent with the child.</li>
</ul>
<p>The dataset <code>Parenting</code> comprises 60 fathers selected from three <code>group</code>s of <span class="math inline">\(n = 20\)</span> each: (a) fathers of a child with <em>no disabilities</em> (<code>"Normal"</code>); (b) fathers with a <em>physically</em> disabled child; (c) fathers with a <em>mentally</em> disabled child. The design is thus a three-group MANOVA, with three response variables.</p>
<!-- NOTE: Use **typical** rather than "normal" -->
<p>The main questions concern whether the group means differ on these scales, and the nature of these differences. That is, do the means differ significantly on all three measures? Is there a consistent order of groups across these three aspects of parenting?</p>
<p>More specific questions are: (a) Do the fathers of typical children differ from the other two groups on average? (b) Do the physical and mental groups differ? These questions can be tested using contrasts, and are specified by assigning a matrix to <code>contrasts(Parenting$group)</code>; each column is a contrast whose values sum to zero. They are given labels <code>"group1"</code> (normal vs.&nbsp;other) and <code>"group2"</code> (physical vs.&nbsp;mental) in some output.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Parenting</span>, package<span class="op">=</span><span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="op">-</span><span class="fl">.5</span>,</span>
<span>              <span class="fl">0</span>,  <span class="fl">1</span>,  <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>            nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  1.0    0</span></span>
<span><span class="co">#&gt; [2,] -0.5    1</span></span>
<span><span class="co">#&gt; [3,] -0.5   -1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html">contrasts</a></span><span class="op">(</span><span class="va">Parenting</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">C</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exploratory-plots" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="exploratory-plots">Exploratory plots</h4>
<p>Before setting up a model and testing, it is well-advised to examine the data graphically. The simplest plots are side-by-side boxplots (or violin plots) for the three responses. With <code>ggplot2</code>, this is easily done by reshaping the data to long format and using faceting. In <a href="#fig-parenting-boxpl" class="quarto-xref">Figure&nbsp;<span>10.3</span></a>, I’ve also plotted the group means with white dots.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>See the ggplot code</summary><div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parenting_long</span> <span class="op">&lt;-</span> <span class="va">Parenting</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">caring</span><span class="op">:</span><span class="va">play</span>, names_to <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">parenting_long</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">group</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>outlier.size<span class="op">=</span><span class="fl">2.5</span>, </span>
<span>               alpha<span class="op">=</span><span class="fl">.5</span>, </span>
<span>               outlier.alpha <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">mean</span>, </span>
<span>               color<span class="op">=</span><span class="st">"white"</span>, </span>
<span>               geom<span class="op">=</span><span class="st">"point"</span>, </span>
<span>               size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_fill_hue</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># reverse default colors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Scale value"</span>, x <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">variable</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                                   hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-parenting-boxpl" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-parenting-boxpl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-parenting-boxpl-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-parenting-boxpl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.3: Faceted boxplots of scores on the three parenting scales, showing also the mean for each.
</figcaption></figure>
</div>
</div>
</div>
<p>In this figure, differences among the groups on <code>play</code> are most apparent, with fathers of non-disabled children scoring highest. Differences among the groups on <code>emotion</code> are very small, but one high outlier for the fathers of mentally disabled children is apparent. On <code>caring</code>, fathers of children with a physical disability stand out as highest.</p>
<p>For exploratory purposes, you might also make a scatterplot matrix. Here, because the MLM assumes homogeneity of the variances and covariance matrices <span class="math inline">\(\mathbf{S}_i\)</span>, I show only the data ellipses in scatterplot matrix format, using <code>heplots:covEllipses()</code> (with 50% coverage, for clarity):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># match color use in ggplot</span></span>
<span><span class="fu"><a href="https://friendly.github.io/heplots/reference/covEllipses.html">covEllipses</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">caring</span>, <span class="va">play</span>, <span class="va">emotion</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">Parenting</span>,</span>
<span>  variables <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  pooled <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.50</span>, </span>
<span>  col <span class="op">=</span> <span class="va">colors</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-parenting-covEllipses" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-parenting-covEllipses-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-parenting-covEllipses-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-parenting-covEllipses-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.4: Bivariate data ellipses for pairs of the three responses, showing the means, correlations and variances for the three groups.
</figcaption></figure>
</div>
</div>
</div>
<p>If the covariance matrices were all the same, the data ellipses would have roughly the same size and orientation, but that is not the case in <a href="#fig-parenting-covEllipses" class="quarto-xref">Figure&nbsp;<span>10.4</span></a>. The normal group shows greater variability overall and the correlations among the measures differ somewhat from group to group. We’ll assess later whether this makes a difference in the conclusions that can be drawn (<a href="eqcov.html" class="quarto-xref"><span>Chapter 12</span></a>). The group centroids also differ, but the pattern is not particularly clear. We’ll see an easier to understand view in HE plots and their canonical discriminant cousins.</p>
</section><section id="testing-the-model" class="level4 nunumbered" data-number="10.3.1.1"><h4 class="nunumbered anchored" data-number="10.3.1.1" data-anchor-id="testing-the-model">
<span class="header-section-number">10.3.1.1</span> Testing the model</h4>
<p>Let’s proceed to fit the multivariate model predicting all three scales from the <code>group</code> factor. <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> for a multivariate response returns an object of class <code>"mlm"</code>, for which there are many methods (use `methods(class=“mlm”) to find them).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parenting.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">caring</span>, <span class="va">play</span>, <span class="va">emotion</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, </span>
<span>                    data<span class="op">=</span><span class="va">Parenting</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = cbind(caring, play, emotion) ~ group, data = Parenting)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              caring   play     emotion</span></span>
<span><span class="co">#&gt; (Intercept)   5.8833   4.6333   5.9167</span></span>
<span><span class="co">#&gt; group1       -0.3833   2.4167  -0.0667</span></span>
<span><span class="co">#&gt; group2        1.7750  -0.2250  -0.6000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The coefficients in this model are the values of the contrasts set up above. <code>group1</code> is the mean of the typical group minus the average of the other two, which is negative on <code>caring</code> and <code>emotion</code> but positive for <code>play</code>. <code>group2</code> is the difference in means for the physical vs.&nbsp;mental groups.</p>
<p>Before doing multivariate tests, it is useful to see what would happen if we ran univariate ANOVAs on each of the responses. This can be extracted from an MLM using <code><a href="https://rdrr.io/r/stats/summary.aov.html">stats::summary.aov()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/summary.aov.html">summary.aov</a></span><span class="op">(</span><span class="va">parenting.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Response caring :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; group        2    130    65.2    18.6  6e-07 ***</span></span>
<span><span class="co">#&gt; Residuals   57    200     3.5                   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response play :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; group        2    177    88.6    27.6  4e-09 ***</span></span>
<span><span class="co">#&gt; Residuals   57    183     3.2                   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response emotion :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; group        2     15    7.27    1.02   0.37</span></span>
<span><span class="co">#&gt; Residuals   57    408    7.16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you like, you can also extract the univariate model fit statistics from the <code>"mlm"</code></p>
<p>From this, one might conclude that there are differences only in <code>caring</code> and <code>play</code> and therefore ignore <code>emotion</code>, but this would be short-sighted. <code><a href="https://rdrr.io/pkg/car/man/Anova.html">car::Anova()</a></code> gives the overall multivariate test <span class="math inline">\(\mathcal{H}_0: \mathbf{B} = 0\)</span> of the <code>group</code> effect. Note that this has a much smaller <span class="math inline">\(p\)</span>-value than any of the univariate <span class="math inline">\(F\)</span> tests.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">parenting.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;       Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; group  2     0.948     16.8      6    112  9e-14 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova()</a></code> returns an object of class <code>"Anova.mlm"</code> which has various methods. The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method for this gives more details, including all four test statistics. These tests have <span class="math inline">\(s = \min(p, \text{df}_h) = \min(3,2) = 2\)</span> dimensions and the <span class="math inline">\(F\)</span> approximations are not equivalent here. All four tests are highly significant</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parenting.summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">parenting.mod</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">parenting.summary</span>, SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Term: group </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: group</span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            2     0.948     16.8      6    112 9.0e-14 ***</span></span>
<span><span class="co">#&gt; Wilks             2     0.274     16.7      6    110 1.3e-13 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  2     1.840     16.6      6    108 1.8e-13 ***</span></span>
<span><span class="co">#&gt; Roy               2     1.108     20.7      3     56 3.8e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method by default prints the SSH = <span class="math inline">\(\mathbf{H}\)</span> and SSE = <span class="math inline">\(\mathbf{E}\)</span> matrices, but I suppressed them above. They can be extracted from the object using <code><a href="https://purrr.tidyverse.org/reference/pluck.html">purrr::pluck()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">H</span> <span class="op">&lt;-</span> <span class="va">parenting.summary</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"multivariate.tests"</span>, <span class="st">"group"</span>, <span class="st">"SSPH"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         caring    play emotion</span></span>
<span><span class="co">#&gt; caring   130.4 -43.767 -41.833</span></span>
<span><span class="co">#&gt; play     -43.8 177.233   0.567</span></span>
<span><span class="co">#&gt; emotion  -41.8   0.567  14.533</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="va">parenting.summary</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"multivariate.tests"</span>, <span class="st">"group"</span>, <span class="st">"SSPE"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         caring  play emotion</span></span>
<span><span class="co">#&gt; caring   199.8 -45.8    35.2</span></span>
<span><span class="co">#&gt; play     -45.8 182.7    80.6</span></span>
<span><span class="co">#&gt; emotion   35.2  80.6   408.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="linear-hypotheses-contrasts" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="linear-hypotheses-contrasts">Linear hypotheses &amp; contrasts</h4>
<p>With three or more groups or with a more complex MANOVA design, contrasts provide a way of testing questions of substantive interest regarding differences among group means.</p>
<p>The test of the contrast comparing the typical group to the average of the others is the test using the contrast <span class="math inline">\(c_1 = (1, -\frac12, -\frac12)\)</span> which produces the coefficients labeled <code>"group1"</code>. The function <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">car::linearHypothesis()</a></code> carries out the multivariate test that these are all zero. This is a 1 df test, and all four test statistics produce the same <span class="math inline">\(F\)</span> and <span class="math inline">\(p\)</span>-values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">parenting.mod</span><span class="op">)</span><span class="op">[</span><span class="st">"group1"</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;  caring    play emotion </span></span>
<span><span class="co">#&gt; -0.3833  2.4167 -0.0667</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">parenting.mod</span>, <span class="st">"group1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            1     0.521     19.9      3     55 7.1e-09 ***</span></span>
<span><span class="co">#&gt; Wilks             1     0.479     19.9      3     55 7.1e-09 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  1     1.088     19.9      3     55 7.1e-09 ***</span></span>
<span><span class="co">#&gt; Roy               1     1.088     19.9      3     55 7.1e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, the difference between the physical and mental groups uses the contrast <span class="math inline">\(c_2 = (0, 1, -1)\)</span> and the test that these means are equal is given by <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis()</a></code> applied to <code>group2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">parenting.mod</span><span class="op">)</span><span class="op">[</span><span class="st">"group2"</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;  caring    play emotion </span></span>
<span><span class="co">#&gt;   1.775  -0.225  -0.600</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">parenting.mod</span>, <span class="st">"group2"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            1     0.429     13.8      3     55  8e-07 ***</span></span>
<span><span class="co">#&gt; Wilks             1     0.571     13.8      3     55  8e-07 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  1     0.752     13.8      3     55  8e-07 ***</span></span>
<span><span class="co">#&gt; Roy               1     0.752     13.8      3     55  8e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis()</a></code> is very general. The second argument (<code>hypothesis.matrix</code>) corresponds to <span class="math inline">\(\mathbf{C}\)</span>, and can be specified as numeric matrix giving the linear combinations of coefficients by rows to be tested, or a character vector giving the hypothesis in symbolic form.</p>
<p>Because the contrasts used here are orthogonal, they comprise the overall test of <span class="math inline">\(\mathbf{B} = \mathbf{0}\)</span> which implies that the means of the three groups are all equal. The test below gives the same results as <code>Anova(parenting.mod)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">parenting.mod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            2     0.948     16.8      6    112 9.0e-14 ***</span></span>
<span><span class="co">#&gt; Wilks             2     0.274     16.7      6    110 1.3e-13 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  2     1.840     16.6      6    108 1.8e-13 ***</span></span>
<span><span class="co">#&gt; Roy               2     1.108     20.7      3     56 3.8e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section></section><section id="mra-rightarrow-mmra" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="mra-rightarrow-mmra">
<span class="header-section-number">10.4</span> MRA <span class="math inline">\(\rightarrow\)</span> MMRA</h2>
</section><section id="ancova-rightarrow-mancova" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="ancova-rightarrow-mancova">
<span class="header-section-number">10.5</span> ANCOVA <span class="math inline">\(\rightarrow\)</span> MANCOVA</h2>
</section><section id="repeated-measures-designs" class="level2" data-number="10.6"><h2 data-number="10.6" class="anchored" data-anchor-id="repeated-measures-designs">
<span class="header-section-number">10.6</span> Repeated measures designs</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Friendly-etal:ellipses:2013" class="csl-entry" role="listitem">
Friendly, M., Monette, G., &amp; Fox, J. (2013). Elliptical insights: Understanding statistical methods through elliptical geometry. <em>Statistical Science</em>, <em>28</em>(1), 1–39. <a href="https://doi.org/10.1214/12-STS402">https://doi.org/10.1214/12-STS402</a>
</div>
<div id="ref-Mardia:1970:MMS" class="csl-entry" role="listitem">
Mardia, K. V. (1970). Measures of multivariate skewness and kurtosis with applications. <em>Biometrika</em>, <em>57</em>(3), 519–530. https://doi.org/<a href="http://dx.doi.org/10.2307/2334770">http://dx.doi.org/10.2307/2334770</a>
</div>
<div id="ref-Meyers-etal:2006" class="csl-entry" role="listitem">
Meyers, L. S., Gamst, G., &amp; Guarino, A. J. (2006). <em>Applied multivariate research: Design and interpretation</em>. SAGE Publications.
</div>
<div id="ref-ShapiroWilk1965" class="csl-entry" role="listitem">
Shapiro, S. S., &amp; Wilk, M. B. (1965). An analysis of variance test for normality (complete samples). <em>Biometrika</em>, <em>52</em>(3–4), 591–611. <a href="https://doi.org/10.1093/biomet/52.3-4.591">https://doi.org/10.1093/biomet/52.3-4.591</a>
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./09-hotelling.html" class="pagination-link" aria-label="Hotelling's $T^2$">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-mlm-viz.html" class="pagination-link" aria-label="Visualizing Multivariate Models">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>