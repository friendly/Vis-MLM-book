<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>10&nbsp; Multivariate Linear Models – Visualizing Multivariate Data and Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-mlm-viz.html" rel="next">
<link href="./09-hotelling.html" rel="prev">
<link href="./images/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b5345210c3a79db27e5ded64c8911254.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-hotelling.html">Multivariate Linear Models</a></li><li class="breadcrumb-item"><a href="./10-mlm-review.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-hotelling.html">Multivariate Linear Models</a></li><li class="breadcrumb-item"><a href="./10-mlm-review.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></a></li></ol></nav>
      <h1 class="title"><span id="sec-mlm-review" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualizing Multivariate Data and Models in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/friendly/vis-MLM-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Orienting Ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Exploratory Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-multivariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plots of Multivariate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pca-biplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Univariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview of Linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear_models-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Plots for univariate response models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-lin-mod-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topics in Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-collinearity-ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Collinearity &amp; Ridge Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Multivariate Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-hotelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mlm-review.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-mlm-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-eqcov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualizing Equality of Covariance Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-infl-robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiviate Influence and Robust Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">End matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-colophon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colophon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./95-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#structure-of-the-mlm" id="toc-structure-of-the-mlm" class="nav-link active" data-scroll-target="#structure-of-the-mlm"><span class="header-section-number">10.1</span> Structure of the MLM</a>
  <ul class="collapse">
<li><a href="#sec-mlm-assumptions" id="toc-sec-mlm-assumptions" class="nav-link" data-scroll-target="#sec-mlm-assumptions"><span class="header-section-number">10.1.1</span> Assumptions</a></li>
  </ul>
</li>
  <li>
<a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model"><span class="header-section-number">10.2</span> Fitting the model</a>
  <ul class="collapse">
<li><a href="#sec-dogfood-data" id="toc-sec-dogfood-data" class="nav-link" data-scroll-target="#sec-dogfood-data"><span class="header-section-number">10.2.1</span> Example: Dog food data</a></li>
  <li><a href="#sums-of-squares" id="toc-sums-of-squares" class="nav-link" data-scroll-target="#sums-of-squares"><span class="header-section-number">10.2.2</span> Sums of squares</a></li>
  <li><a href="#how-big-is-ss_h-compared-to-ss_e" id="toc-how-big-is-ss_h-compared-to-ss_e" class="nav-link" data-scroll-target="#how-big-is-ss_h-compared-to-ss_e"><span class="header-section-number">10.2.3</span> How big is <span class="math inline">\(SS_H\)</span> compared to <span class="math inline">\(SS_E\)</span>?</a></li>
  </ul>
</li>
  <li>
<a href="#sec-multivar-tests" id="toc-sec-multivar-tests" class="nav-link" data-scroll-target="#sec-multivar-tests"><span class="header-section-number">10.3</span> Multivariate test statistics</a>
  <ul class="collapse">
<li><a href="#sec-contrasts2" id="toc-sec-contrasts2" class="nav-link" data-scroll-target="#sec-contrasts2"><span class="header-section-number">10.3.1</span> Testing contrasts and linear hypotheses</a></li>
  </ul>
</li>
  <li>
<a href="#anova-rightarrow-manova" id="toc-anova-rightarrow-manova" class="nav-link" data-scroll-target="#anova-rightarrow-manova"><span class="header-section-number">10.4</span> ANOVA <span class="math inline">\(\rightarrow\)</span> MANOVA</a>
  <ul class="collapse">
<li><a href="#example-father-parenting-data" id="toc-example-father-parenting-data" class="nav-link" data-scroll-target="#example-father-parenting-data"><span class="header-section-number">10.4.1</span> Example: Father parenting data</a></li>
  <li><a href="#ordered-factors" id="toc-ordered-factors" class="nav-link" data-scroll-target="#ordered-factors"><span class="header-section-number">10.4.2</span> Ordered factors</a></li>
  <li><a href="#example-adolescent-mental-health" id="toc-example-adolescent-mental-health" class="nav-link" data-scroll-target="#example-adolescent-mental-health"><span class="header-section-number">10.4.3</span> Example: Adolescent mental health</a></li>
  <li><a href="#factorial-manova" id="toc-factorial-manova" class="nav-link" data-scroll-target="#factorial-manova"><span class="header-section-number">10.4.4</span> Factorial MANOVA</a></li>
  </ul>
</li>
  <li>
<a href="#mra-rightarrow-mmra" id="toc-mra-rightarrow-mmra" class="nav-link" data-scroll-target="#mra-rightarrow-mmra"><span class="header-section-number">10.5</span> MRA <span class="math inline">\(\rightarrow\)</span> MMRA</a>
  <ul class="collapse">
<li><a href="#sec-NLSY-mmra" id="toc-sec-NLSY-mmra" class="nav-link" data-scroll-target="#sec-NLSY-mmra"><span class="header-section-number">10.5.1</span> Example: NLSY data</a></li>
  <li><a href="#sec-schooldata-mmra" id="toc-sec-schooldata-mmra" class="nav-link" data-scroll-target="#sec-schooldata-mmra"><span class="header-section-number">10.5.2</span> Example: School data</a></li>
  </ul>
</li>
  <li>
<a href="#model-diagnostics-for-mlms" id="toc-model-diagnostics-for-mlms" class="nav-link" data-scroll-target="#model-diagnostics-for-mlms"><span class="header-section-number">10.6</span> Model diagnostics for MLMs</a>
  <ul class="collapse">
<li><a href="#multivariate-normality-of-residuals" id="toc-multivariate-normality-of-residuals" class="nav-link" data-scroll-target="#multivariate-normality-of-residuals"><span class="header-section-number">10.6.1</span> Multivariate normality of residuals</a></li>
  <li><a href="#multivariate-influence" id="toc-multivariate-influence" class="nav-link" data-scroll-target="#multivariate-influence"><span class="header-section-number">10.6.2</span> Multivariate influence</a></li>
  </ul>
</li>
  <li>
<a href="#sec-ANCOVA-MANCOVA" id="toc-sec-ANCOVA-MANCOVA" class="nav-link" data-scroll-target="#sec-ANCOVA-MANCOVA"><span class="header-section-number">10.7</span> ANCOVA <span class="math inline">\(\rightarrow\)</span> MANCOVA</a>
  <ul class="collapse">
<li><a href="#sec-PA-tasks" id="toc-sec-PA-tasks" class="nav-link" data-scroll-target="#sec-PA-tasks"><span class="header-section-number">10.7.1</span> Example: Paired-associate tasks and academic performance</a></li>
  </ul>
</li>
  <li><a href="#what-weve-learned" id="toc-what-weve-learned" class="nav-link" data-scroll-target="#what-weve-learned"><span class="header-section-number">10.8</span> What we’ve learned</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!--- For HTML Only ---><!-- \require{newcommand} --><!-- %\renewcommand*{\det}[1]{\mathrm{det} (#1)} --><!-- %\renewcommand*{\det}[1]{|#1|} --><!-- \providecommand{\sizedmat}[2]{\mathord{\mathop{\mat{#1}}\limits_{(#2)}}} --><!-- \newcommand*{\E}{\mathcal{E}} --><!-- Index generation --><!-- % R packages:  indexed under both package name and packages! --><!-- % data sets:  --><!-- % R stuff --><p><a href="09-hotelling.html" class="quarto-xref"><span>Chapter 9</span></a> introduced the essential ideas of multivariate analysis in the context of a two-group design using Hotelling’s <span class="math inline">\(T^2\)</span>. Through the magical power of multivariate thinking, I extend this here to a “Holy of Holies”, inner sanctuary of the Tabernacle, the awed general <strong>Multivariate Linear Model</strong> (MLM).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>This can be understood as a simple extension of the univariate linear model, with the main difference being that there are multiple response variables considered <strong>together</strong>, instead of just one, analysed alone. These outcomes might reflect several different <em>ways</em> or scales for measuring an underlying theoretical construct, or they might represent different <em>aspects</em> of some phenomenon that we hope to better understand when they are studied jointly.</p>
<p>For example, in the case of different measures, there are numerous psychological scales used to assess depression or anxiety and it may be important to include more than one measure to ensure that the construct has been measured adequately. It would add considerably to our understanding to know if the different outcome measures all had essentially the <em>same</em> relations to the predictor variables, or if they differ across measures.</p>
<p>In the second case of various aspects, student “aptitude” or “achievement” reflects competency in different various subjects (reading, math, history, science, …) that are better studied together. We get a better understanding of the factors that influence each of aspects by testing them <em>jointly</em>.</p>
<p>Just as in univariate analysis there are variously named techniques (ANOVA, regression) that can be applied to several outcomes, depending on the structure of the predictors at hand. For instance, with one or more continuous predictors and multiple response variables, you could use <strong>multivariate</strong> multiple regression (MMRA) to obtain estimates useful for prediction.</p>
<p>Instead, if the predictors are categorical factors, multivariate analysis of variance (MANOVA) can be applied to test for differences between groups. Again, this is akin to ANOVA in the univariate context— the same underlying model is utilized, but the tests for terms in the model are multivariate ones for the collection of all response variables, rather than univariate ones for a single response.</p>
<p>The main goal of this chapter is to describe the details of the extension of univariate linear models to the case of multiple outcome measures. But the larger goal is to set the stage for the visualization methods using HE plots and low-D views discussed separately in <a href="11-mlm-viz.html" class="quarto-xref"><span>Chapter 11</span></a>. Some of the example datasets used here will re-appear there, and also in <a href="12-eqcov.html" class="quarto-xref"><span>Chapter 12</span></a> which concerns some model-diagnostic graphical methods.</p>
<p>However, before considering the details and examples that apply separately to MANOVA and MMRA, it is useful to consider the general features of the multivariate linear model of which these cases are examples.</p>
<p><strong>TODO</strong>: Offer defense against <span class="citation" data-cites="Huang2019">Huang (<a href="95-references.html#ref-Huang2019" role="doc-biblioref">2019</a>)</span> and others here; cite <span class="citation" data-cites="Huberty-Morris1989">Huberty &amp; Morris (<a href="95-references.html#ref-Huberty-Morris1989" role="doc-biblioref">1989</a>)</span>. Or, maybe not!</p>
<p><strong>Packages</strong></p>
<p>In this chapter I use the following packages. Load them now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://friendly.github.io/heplots">heplots</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/matlib">matlib</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/">ggrepel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/mvinfluence">mvinfluence</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://selcukorkmaz.github.io/mvn-tutorial/">MVN</a></span><span class="op">)</span></span>
<span><span class="co"># set ggplot theme</span></span>
<span><span class="co">#ggplot2::theme_set(theme_bw(base_size = 14))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="structure-of-the-mlm" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="structure-of-the-mlm">
<span class="header-section-number">10.1</span> Structure of the MLM</h2>
<!-- **TODO** Use `\Epsilon` = $\Epsilon$ here, which is defined as `\boldsymbol{\large\varepsilon}` for residuals. -->
<!-- Could also use a larger version, `\boldsymbol{\Large\varepsilon}` = -->
<!-- $\boldsymbol{\Large\varepsilon}$ if that makes a difference. -->
<p>With <span class="math inline">\(p\)</span> response variables, the multivariate linear model is most easily appreciated as the collection of <span class="math inline">\(p\)</span> linear models, one for each response. We have <span class="math inline">\(p\)</span> outcomes, so why not just consider a separate model for each?</p>
<p><span id="eq-mlm-models"><span class="math display">\[\begin{aligned}
\mathbf{y}_1 =&amp; \mathbf{X}\boldsymbol{\beta}_1 + \boldsymbol{\epsilon}_1 \\
\mathbf{y}_2 =&amp; \mathbf{X}\boldsymbol{\beta}_2 + \boldsymbol{\epsilon}_2 \\
  \vdots      &amp;  \\
\mathbf{y}_p =&amp; \mathbf{X}\boldsymbol{\beta}_p + \boldsymbol{\epsilon}_p \\
\end{aligned} \tag{10.1}\]</span></span></p>
<p>But the problems with fitting separate univariate models are that:</p>
<ul>
<li><p>They don’t give <em>simultaneous</em> tests for all regressions. The situation is similar to that in a one-way ANOVA, where an <em>overall</em> test for group differences is usually applied before testing individual comparisons to avoid problems of multiple testing: <span class="math inline">\(g\)</span> groups gives <span class="math inline">\(g \times (g-1)/2\)</span> pairwise tests.</p></li>
<li>
<p>More importantly, fitting separate univariate models does not take <em>correlations</em> among the <span class="math inline">\(\mathbf{y}\)</span>s into account.</p>
<ul>
<li>It might be the case that the response variables are all essentially measuring the same thing, but perhaps weakly. If so, the multivariate approach can pool strength across the outcomes to detect their common relations to the predictors, giving greater power.</li>
<li>On the other hand, perhaps the responses are related in <em>different ways</em> to the predictors. A multivariate approach can help you understand <em>how many</em> different ways there are, and characterize each.</li>
</ul>
</li>
</ul>
<p>The model matrix <span class="math inline">\(\mathbf{X}\)</span> in <a href="#eq-mlm-models" class="quarto-xref">Equation&nbsp;<span>10.1</span></a> is the same for all responses, but each one gets its own vector <span class="math inline">\(\boldsymbol{\beta}_j\)</span> of coefficients for how the predictors in <span class="math inline">\(\mathbf{X}\)</span> fit a given response <span class="math inline">\(\mathbf{y}_j\)</span>.</p>
<p>Among the beauties of multivariate thinking is that we can put these separate equations together in single equation by joining the responses <span class="math inline">\(\mathbf{y}_j\)</span> as columns in a matrix <span class="math inline">\(\mathbf{Y}\)</span> and similarly arranging the vectors of coefficients <span class="math inline">\(\boldsymbol{\beta}_j\)</span> as columns in a matrix <span class="math inline">\(\mathbf{B}\)</span>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p><strong>TODO</strong> Revise notation here, to be explicit about inclusion of <span class="math inline">\(\boldsymbol{\beta}_0\)</span></p>
<p>The MLM then becomes:</p>
<!-- $$ -->
<!-- \newcommand{\sizedmat}[2]{\mathord{\mathop{\mathbf{#1}\limits_{(#2)}}} -->
<!-- $$ -->
<p><span id="eq-mlm"><span class="math display">\[
\mathord{\mathop{\mathbf{Y}}\limits_{n \times p}} =
\mathord{\mathop{\mathbf{X}}\limits_{n \times (q+1)}} \, \mathord{\mathop{\mathbf{B}}\limits_{(q+1) \times p}} + \mathord{\mathop{\mathbf{\boldsymbol{\Large\varepsilon}}}\limits_{n \times p}} \:\: ,
\tag{10.2}\]</span></span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{Y} = (\mathbf{y}_1 , \mathbf{y}_2, \dots ,  \mathbf{y}_p )\)</span> is the matrix of <span class="math inline">\(n\)</span> observations on <span class="math inline">\(p\)</span> responses, with typical column <span class="math inline">\(\mathbf{y}_j\)</span>;</li>
<li>
<span class="math inline">\(\mathbf{X}\)</span> is the model matrix with columns <span class="math inline">\(\mathbf{x}_i\)</span> for <span class="math inline">\(q\)</span> regressors, which typically includes an initial column <span class="math inline">\(\mathbf{x}_0\)</span> of 1s for the intercept;</li>
<li>
<span class="math inline">\(\mathbf{B} = ( \mathbf{b}_1 , \mathbf{b}_2 , \dots,  \mathbf{b}_p )\)</span> is a matrix of regression coefficients, one column <span class="math inline">\(\mathbf{b}_j\)</span> for each response variable;</li>
<li>
<span class="math inline">\(\boldsymbol{\Large\varepsilon}\)</span> is a matrix of errors in predicting <span class="math inline">\(\mathbf{Y}\)</span>.</li>
</ul>
<p>Writing <a href="#eq-mlm" class="quarto-xref">Equation&nbsp;<span>10.2</span></a> in terms of its elements, we have</p>
<p><span class="math display">\[\begin{aligned}
\overset{\mathbf{Y}}
  {\begin{bmatrix}
  y_{11} &amp; y_{12} &amp; \cdots &amp; y_{1p} \\
  y_{21} &amp; y_{22} &amp; \cdots &amp; y_{2p} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
  y_{n1} &amp; y_{n2} &amp; \cdots &amp; y_{np}
  \end{bmatrix}
  }
&amp; =
\overset{\mathbf{X}}
  {\begin{bmatrix}
  1 &amp; x_{11} &amp; \cdots &amp; x_{1q} \\
  1 &amp; x_{21} &amp; \cdots &amp; x_{2q} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
  1 &amp; x_{n1} &amp; \cdots &amp; x_{nq}
  \end{bmatrix}
  }
\overset{\mathbf{B}}
  {\begin{bmatrix}
  \beta_{01} &amp; \beta_{02} &amp; \cdots &amp; \beta_{0p} \\
  \beta_{11} &amp; \beta_{12} &amp; \cdots &amp; \beta_{1p} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
  \beta_{q1} &amp; \beta_{q2} &amp; \cdots &amp; \beta_{qp}
  \end{bmatrix}
  } \\
&amp; + \quad\quad
\overset{\mathcal{\boldsymbol{\Large\varepsilon}}}
  {\begin{bmatrix}
  \epsilon_{11} &amp; \epsilon_{12} &amp; \cdots &amp; \epsilon_{1p} \\
  \epsilon_{21} &amp; \epsilon_{22} &amp; \cdots &amp; \epsilon_{2p} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
  \epsilon_{n1} &amp; \epsilon_{n2} &amp; \cdots &amp; \epsilon_{np}
  \end{bmatrix}
  }
\end{aligned}\]</span></p>
<p>The structure of the model matrix <span class="math inline">\(\mathbf{X}\)</span> is exactly the same as the univariate linear model, and may therefore contain,</p>
<ul>
<li>
<strong>quantitative</strong> predictors, such as <code>age</code>, <code>income</code>, years of <code>education</code>
</li>
<li>
<strong>transformed predictors</strong> like <span class="math inline">\(\sqrt{\text{age}}\)</span> or <span class="math inline">\(\log{(\text{income})}\)</span>
</li>
<li>
<strong>polynomial terms</strong>: <span class="math inline">\(\text{age}^2\)</span>, <span class="math inline">\(\text{age}^3, \dots\)</span> (using <code>poly(age, k)</code> in R)</li>
<li>
<strong>categorical predictors</strong> (“factors”), such as treatment (Control, Drug A, drug B), or sex; internally a factor with <code>k</code> levels is transformed to <code>k-1</code> dummy (0, 1) variables, representing comparisons with a reference level, typically the first.</li>
<li>
<strong>interaction terms</strong>, involving either quantitative or categorical predictors, e.g., <code>age * sex</code>, <code>treatment * sex</code>.</li>
</ul>
<section id="sec-mlm-assumptions" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="sec-mlm-assumptions">
<span class="header-section-number">10.1.1</span> Assumptions</h3>
<p>Just as in univariate models, the assumptions of the multivariate linear model almost entirely concern the behavior of the errors (residuals). Let <span class="math inline">\(\mathbf{\epsilon}_{i}^{\prime}\)</span> represent the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(\boldsymbol{\Large\varepsilon}\)</span>. Then it is assumed that:</p>
<ul>
<li>
<p><strong>Normality</strong>: The residuals, <span class="math inline">\(\mathbf{\epsilon}_{i}^{\prime}\)</span> are distributed as multivariate normal, <span class="math inline">\(\mathcal{N}_{p}(\mathbf{0},\boldsymbol{\Sigma})\)</span>, where <span class="math inline">\(\mathbf{\Sigma}\)</span> is a non-singular error-covariance matrix.</p>
<ul>
<li><p>Statistical tests of multivariate normality of the residuals include the Shapiro-Wilk <span class="citation" data-cites="ShapiroWilk1965">(<a href="95-references.html#ref-ShapiroWilk1965" role="doc-biblioref">Shapiro &amp; Wilk, 1965</a>)</span> and Mardia <span class="citation" data-cites="Mardia:1970:MMS Mardia:1974">(<a href="95-references.html#ref-Mardia:1970:MMS" role="doc-biblioref">1970</a>, <a href="95-references.html#ref-Mardia:1974" role="doc-biblioref">1974</a>)</span> tests (and others, in the <span style="color: brown;"><strong>MVN</strong></span> package). <!-- mshapiro.test( )[in the <span style='color: brown;'>**mvnormtest**</span>  package] can be used to perform the Shapiro-Wilk test for multivariate normality --></p></li>
<li><p>As in univariate models, the MLM is relatively robust, however this is often better assessed visually using a <span class="math inline">\(\chi^2\)</span> QQ plot of Mahalanobis squared distance against their corresponding <span class="math inline">\(\chi^2_p\)</span> values for <span class="math inline">\(p\)</span> degrees of freedom using <code><a href="https://friendly.github.io/heplots/reference/cqplot.html">heplots::cqplot()</a></code>.</p></li>
</ul>
</li>
<li><p><strong>Homoscedasticity</strong>: The error-covariance matrix <span class="math inline">\(\mathbf{\Sigma}\)</span> is constant across all observations and grouping factors. Graphical methods to show if this assumption is met are illustrated in <a href="12-eqcov.html" class="quarto-xref"><span>Chapter 12</span></a>.</p></li>
<li><p><strong>Independence</strong>: <span class="math inline">\(\mathbf{\epsilon}_{i}^{\prime}\)</span> and <span class="math inline">\(\mathbf{\epsilon}_{j}^{\prime}\)</span> are independent for <span class="math inline">\(i\neq j\)</span>, so knowing the data for case <span class="math inline">\(i\)</span> gives no information about case <span class="math inline">\(j\)</span> (as would be true if the data consisted of pairs of husbands and wives);</p></li>
<li><p>The predictors, <span class="math inline">\(\mathbf{X}\)</span>, are fixed and measured without error or at least they are independent of the errors, <span class="math inline">\(\boldsymbol{\Large\varepsilon}\)</span>.</p></li>
</ul>
<p>These statements are simply the multivariate analogs of the assumptions of normality, constant variance and independence of the errors in univariate models. Note that it is unnecessary to assume that the predictors (regressors, columns of <span class="math inline">\(\mathbf{X}\)</span>) are normally distributed.</p>
<p>Implicit in the above is perhaps the most important assumption—that the model has been <em>correctly specified</em>. This means:</p>
<ul>
<li><p><strong>Linearity</strong>: The form of the relations between each <span class="math inline">\(\mathbf{y}\)</span> and the <span class="math inline">\(\mathbf{x}\)</span>s is correct. Typically this means that the relations are <em>linear</em>, but if not, we have specified a correct transformation of <span class="math inline">\(\mathbf{y}\)</span> and/or <span class="math inline">\(\mathbf{x}\)</span>.</p></li>
<li><p><strong>Completeness</strong>: No relevant predictors have been omitted from the model. For example in the coffee, stress example (<a href="07-lin-mod-topics.html#sec-coffee-stress" class="quarto-xref"><span>Section 7.1.1</span></a>), omitting stress from the model biases the effect of coffee on heart disease.</p></li>
<li><p><strong>Additive effects</strong>: The combined effect of different predictors is the sum of their individual effects.</p></li>
</ul></section></section><section id="fitting-the-model" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="fitting-the-model">
<span class="header-section-number">10.2</span> Fitting the model</h2>
<p>The least squares (and also maximum likelihood) solution for the coefficients <span class="math inline">\(\mathbf{B}\)</span> is given by</p>
<!-- $$ -->
<!-- \widehat{\mathbf{B}} = (\mathbf{X}\trans \mathbf{X})^{-1} \mathbf{X}\trans \mathbf{Y} \period -->
<!-- $$ -->
<p><span class="math display">\[
\widehat{\mathbf{B}} = (\mathbf{X}^\mathsf{T} \mathbf{X})^{-1} \mathbf{X}^\mathsf{T} \mathbf{Y} \:\: .
\]</span></p>
<p>This is precisely the same as fitting the separate responses <span class="math inline">\(\mathbf{y}_1 , \mathbf{y}_2 , \dots , \mathbf{y}_p\)</span>, and placing the estimated coefficients <span class="math inline">\(\widehat{\mathbf{b}}_i\)</span> as columns in <span class="math inline">\(\widehat{\mathbf{B}}\)</span></p>
<p><span class="math display">\[
\widehat{\mathbf{B}} = [ \widehat{\mathbf{b}}_1, \widehat{\mathbf{b}}_2, \dots , \widehat{\mathbf{b}}_p] \:\: .
\]</span> In R, we fit the multivariate linear model with <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> simply by giving a collection of response variables <code>y1, y2, ...</code> on the left-hand side of the model formula, wrapped in <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code> which combines them to form a matrix response.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span>, <span class="va">y3</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">...</span>, data<span class="op">=</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the presence of possible outliers, robust methods are available for univariate linear models (e.g., <code><a href="https://rdrr.io/pkg/MASS/man/rlm.html">MASS::rlm()</a></code>). So too, <code><a href="https://friendly.github.io/heplots/reference/robmlm.html">heplots::robmlm()</a></code> provides robust estimation in the multivariate case as illustrated in <a href="13-infl-robust.html#sec-robust-estimation" class="quarto-xref"><span>Section 13.5</span></a>.</p>
<section id="sec-dogfood-data" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="sec-dogfood-data">
<span class="header-section-number">10.2.1</span> Example: Dog food data</h3>
<p>As a toy example to make these ideas concrete, consider the dataset <code>dogfood</code>. Here, a dogfood manufacturer wanted to study preference for different dogfood formulas, two of their own (“Old”, “New”) and two from other manufacturers (“Major”, “Alps”).</p>
<p>In a between-dog design, each of <span class="math inline">\(n=4\)</span> dogs were presented with a bowl of <em>one</em> formula and the time to <code>start</code> eating and <code>amount</code> eaten were recorded. Greater preference would be seen in a shorter delay to start eating and a greater amount, so these responses are expected to be negatively correlated.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">dogfood</span>, package <span class="op">=</span> <span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">dogfood</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':  16 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;  $ formula: Factor w/ 4 levels "Old","New","Major",..: 1 1 1 1 2 2 2 2 3 3 ...</span></span>
<span><span class="co">#&gt;  $ start  : int  0 1 1 0 0 1 2 3 1 5 ...</span></span>
<span><span class="co">#&gt;  $ amount : int  100 97 88 92 95 85 82 89 77 84 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this data, boxplots for the two responses provide an initial look, shown in <a href="#fig-dogfood-boxplot" class="quarto-xref">Figure&nbsp;<span>10.1</span></a>. Putting these side-by-side makes it easy to see the inverse relation between the medians on the two response variables.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dog_long</span> <span class="op">&lt;-</span> <span class="va">dogfood</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">amount</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dog_long</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">formula</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">formula</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-dogfood-boxplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dogfood-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-dogfood-boxplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dogfood-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.1: Boxplots for time to start eating and amount eaten by dogs given one of four dogfood formulas.
</figcaption></figure>
</div>
</div>
</div>
<p>As suggested above, the multivariate model for testing mean differences due to the dogfood <code>formula</code> is fit using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> on the matrix <span class="math inline">\(\mathbf{Y}\)</span> constructed with <code>cbind(start, amount)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dogfood.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">amount</span><span class="op">)</span> <span class="op">~</span> <span class="va">formula</span>, </span>
<span>                  data<span class="op">=</span><span class="va">dogfood</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = cbind(start, amount) ~ formula, data = dogfood)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               start   amount</span></span>
<span><span class="co">#&gt; (Intercept)     0.50   94.25</span></span>
<span><span class="co">#&gt; formulaNew      1.00   -6.50</span></span>
<span><span class="co">#&gt; formulaMajor    2.00  -12.25</span></span>
<span><span class="co">#&gt; formulaAlps     1.75  -16.00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, the factor <code>formula</code> is represented by three columns in the <span class="math inline">\(\mathbf{X}\)</span> matrix that correspond to treatment contrasts, which are comparisons of the Old formula (a baseline level) with each of the others. The coefficients, for example <code>formulaNEW</code>, are the difference in means from those for Old.</p>
<p>Then, the overall multivariate test that means on both variables do not differ is carried out using <code><a href="https://rdrr.io/pkg/car/man/Anova.html">car::Anova()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dogfood.aov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">dogfood.mod</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;         Df test stat approx F num Df den Df Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; formula  3     0.702     2.16      6     24  0.083 .</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The details of these analysis steps are explained below.</p>
</section><section id="sums-of-squares" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="sums-of-squares">
<span class="header-section-number">10.2.2</span> Sums of squares</h3>
<p>In univariate response models, statistical tests and model summaries (like <span class="math inline">\(R^2\)</span>) are based on the familiar decomposition of the total sum of squares <span class="math inline">\(SS_T\)</span> into regression or hypothesis (<span class="math inline">\(SS_H\)</span>) and error (<span class="math inline">\(SS_E\)</span>) sums of squares. In the multivariate linear model each of these becomes a <span class="math inline">\(p \times p\)</span> matrix <span class="math inline">\(SSP\)</span> containing sums of squares for the <span class="math inline">\(p\)</span> responses on the diagonal and sums of cross products in the off-diagonal. elements. For the MLM this is expressed as:</p>
<p><span id="eq-SSP"><span class="math display">\[\begin{aligned}
\underset{(p\times p)}{\mathbf{SSP}_{T}}
&amp; =  \mathbf{Y}^{\top} \mathbf{Y} - n \overline{\mathbf{y}}\,\overline{\mathbf{y}}^{\top} \\
&amp; =  \left(\widehat {\mathbf{Y}}^{\top}\widehat{\mathbf{Y}} - n\overline{\mathbf{y}}\,\overline{\mathbf{y}}^{\top} \right) + \widehat{\boldsymbol{\Large\varepsilon}}^{\top}\widehat{\boldsymbol{\Large\varepsilon}} \\
&amp; =   \mathbf{SSP}_{H} + \mathbf{SSP}_{E} \\
&amp; \equiv  \mathbf{H} + \mathbf{E} \:\: ,
\end{aligned} \tag{10.3}\]</span></span></p>
<p>where,</p>
<ul>
<li>
<span class="math inline">\(\overline{\mathbf{y}}\)</span> is the <span class="math inline">\((p\times 1)\)</span> vector of means for the response variables;</li>
<li>
<span class="math inline">\(\widehat{\mathbf{Y}} = \mathbf{X}\widehat{\mathbf{B}}\)</span> is the matrix of fitted values; and</li>
<li>
<span class="math inline">\(\widehat{\boldsymbol{\Large\varepsilon}} = \mathbf{Y} -\widehat{\mathbf{Y}}\)</span> is the matrix of residuals.</li>
</ul>
<p>We can visualize this decomposition in the simple case of a two-group design (for the <code>mathscore</code> data in <a href="09-hotelling.html#sec-t2-properties" class="quarto-xref"><span>Section 9.2</span></a>) as shown in <a href="#fig-visualizing-SSP" class="quarto-xref">Figure&nbsp;<span>10.2</span></a>. Let <span class="math inline">\(\mathbf{y}_{ij}\)</span> be the vector of <span class="math inline">\(p\)</span> responses for subject <span class="math inline">\(j\)</span> in group <span class="math inline">\(i, i=1,\dots g\)</span> for <span class="math inline">\(j = 1, \dots n_i\)</span>. Then, using <span class="math inline">\(.\)</span> to represent a subscript averaged over, <a href="#eq-SSP" class="quarto-xref">Equation&nbsp;<span>10.3</span></a> comes from the identity</p>
<p><span id="eq-THE-dev"><span class="math display">\[
\underbrace{(\mathbf{y}_{ij} - \mathbf{y}_{\cdot \cdot})}_T =
\underbrace{(\overline{\mathbf{y}}_{i \cdot} - \mathbf{y}_{\cdot \cdot})}_H +
\underbrace{(\mathbf{y}_{ij} - \overline{\mathbf{y}}_{i \cdot})}_E
\tag{10.4}\]</span></span></p>
<p>where each side of <a href="#eq-THE-dev" class="quarto-xref">Equation&nbsp;<span>10.4</span></a> is squared and summed over observations to give <a href="#eq-SSP" class="quarto-xref">Equation&nbsp;<span>10.3</span></a>. In <a href="#fig-visualizing-SSP" class="quarto-xref">Figure&nbsp;<span>10.2</span></a>,</p>
<ul>
<li><p>The total variance <span class="math inline">\(\mathbf{SSP}_T\)</span> reflects the deviations of the observations <span class="math inline">\(\mathbf{y}_{ij}\)</span> from the grand mean <span class="math inline">\(\overline{\mathbf{y}}_{. .}\)</span> and has the data ellipse shown in gray.</p></li>
<li><p>In the middle <span class="math inline">\(\mathbf{SSP}_H\)</span> panel, all the observations are represented at their group means, <span class="math inline">\(\overline{\mathbf{y}}_{i .}\)</span>, the fitted values. Their variance and covariance is then reflected by deviations of the group means (weighted for the number of observations per group) around the grand mean.</p></li>
<li><p>The right <span class="math inline">\(\mathbf{SSP}_E\)</span> panel then shows the residual variance, which is the variation of the observations <span class="math inline">\(\mathbf{y}_{ij}\)</span> around their group means, <span class="math inline">\(\overline{\mathbf{y}}_{i .}\)</span>. Centering the two data ellipses at the centroid <span class="math inline">\(\overline{\mathbf{y}}_{. .}\)</span> then gives the ellipse for the <span class="math inline">\(\mathbf{SSP}_E\)</span>, also called the pooled within-group covariance matrix.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-visualizing-SSP" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-visualizing-SSP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/VisualizingSSP.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-visualizing-SSP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.2: Breakdown of the total <span class="math inline">\(\mathbf{SSP}_{T}\)</span> into sums of squares and products for between-group hypothesis variance (<span class="math inline">\(\mathbf{SSP}_{H}\)</span>) and within-group, error variance (<span class="math inline">\(\mathbf{SSP}_{E}\)</span>).
</figcaption></figure>
</div>
</div>
</div>
<p>The formulas for these sum of squares and products matrices can be shown explicitly as follows, where the notation <span class="math inline">\(\mathbf{z} \mathbf{z}^\top\)</span> generates the <span class="math inline">\(p \times p\)</span> outer product of a vector <span class="math inline">\(\mathbf{z}\)</span>, giving <span class="math inline">\(z_k \times z_\ell\)</span> for all pairs of elements. <span class="math display">\[
\mathbf{SSP}_T =
\sum_{i=1}^{g} \sum_{j=1}^{n_{i}}\left(\mathbf{y}_{ij}-\overline{\mathbf{y}}_{\cdot \cdot}\right)\left(\mathbf{y}_{ij}-\overline{\mathbf{y}}_{\cdot \cdot}\right)^{\top}
\]</span></p>
<p><span class="math display">\[
\mathbf{SSP}_H =
\sum_{i=1}^{g} \mathbf{n}_{i}\left(\overline{\mathbf{y}}_{i \cdot}-\overline{\mathbf{y}}_{\cdot \cdot}\right)\left(\overline{\mathbf{y}}_{i \cdot}-\overline{\mathbf{y}}_{\cdot \cdot}\right)^{\top}
\]</span></p>
<p><span class="math display">\[
\mathbf{SSP}_E =
\sum_{i=1}^{g} \sum_{j=1}^{n_{i}} \left(\mathbf{y}_{ij}-\overline{\mathbf{y}}_{i \cdot}\right) \left(\mathbf{y}_{ij}-\overline{\mathbf{y}}_{i \cdot}\right)^{\top}
\]</span></p>
<p>This is the decomposition that we visualize in HE plots, where the size and direction of <span class="math inline">\(\mathbf{H}\)</span> and <span class="math inline">\(\mathbf{E}\)</span> can be represented as ellipsoids.</p>
<p>But first, let’s find these results for the example. The easy way is to get them from the result returned by <code><a href="https://rdrr.io/pkg/car/man/Anova.html">car::Anova()</a></code>, where the hypothesis <span class="math inline">\(\mathbf{SSP}_{H}\)</span> for each term in the model is returned as an element in a named list <code>SSP</code> and the error <span class="math inline">\(\mathbf{SSP}_{E}\)</span> is returned as the matrix <code>SSPE</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">SSP_H</span> <span class="op">&lt;-</span> <span class="va">dogfood.aov</span><span class="op">$</span><span class="va">SSP</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $formula</span></span>
<span><span class="co">#&gt;         start amount</span></span>
<span><span class="co">#&gt; start    9.69  -70.9</span></span>
<span><span class="co">#&gt; amount -70.94  585.7</span></span>
<span><span class="va">SSP_E</span> <span class="op">&lt;-</span> <span class="va">dogfood.aov</span><span class="op">$</span><span class="va">SSPE</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        start amount</span></span>
<span><span class="co">#&gt; start   25.8   11.8</span></span>
<span><span class="co">#&gt; amount  11.8  390.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can calculate these directly as shown below. <code><a href="https://rdrr.io/r/base/sweep.html">sweep()</a></code> is used to subtract the <code><a href="https://rdrr.io/r/base/colSums.html">colMeans()</a></code> from <span class="math inline">\(\mathbf{Y}\)</span> and <span class="math inline">\(\widehat{\mathbf{Y}}\)</span> and <code><a href="https://rdrr.io/r/base/crossprod.html">crossprod()</a></code> premultiplies a matrix by its’ transpose.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">dogfood</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"amount"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">Ydev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span><span class="op">(</span><span class="va">Y</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">SSP_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Ydev</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        start amount</span></span>
<span><span class="co">#&gt; start   35.4  -59.2</span></span>
<span><span class="co">#&gt; amount -59.2  975.9</span></span>
<span></span>
<span><span class="va">fitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">dogfood.mod</span><span class="op">)</span></span>
<span><span class="va">Yfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span><span class="op">(</span><span class="va">fitted</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">SSP_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span><span class="op">(</span><span class="va">Yfit</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         start amount</span></span>
<span><span class="co">#&gt; start    9.69  -70.9</span></span>
<span><span class="co">#&gt; amount -70.94  585.7</span></span>
<span></span>
<span><span class="va">residuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">dogfood.mod</span><span class="op">)</span></span>
<span><span class="va">SSP_E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span><span class="op">(</span><span class="va">residuals</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        start amount</span></span>
<span><span class="co">#&gt; start   25.8   11.8</span></span>
<span><span class="co">#&gt; amount  11.8  390.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The decomposition of the total sum of squares and products in <a href="#eq-SSP" class="quarto-xref">Equation&nbsp;<span>10.3</span></a> can be shown as:</p>
<p><span class="math display">\[
\overset{\mathbf{SSP}_T}
  {\begin{pmatrix}
   35.4 &amp; -59.2 \\
  -59.2 &amp; 975.9 \\
  \end{pmatrix}}
=
\overset{\mathbf{SSP}_H}
  {\begin{pmatrix}
    9.69 &amp; -70.94 \\
  -70.94 &amp; 585.69 \\
  \end{pmatrix}}
+
\overset{\mathbf{SSP}_E}
  {\begin{pmatrix}
   25.8 &amp;  11.8 \\
   11.8 &amp; 390.3 \\
  \end{pmatrix}}
\]</span></p>
</section><section id="how-big-is-ss_h-compared-to-ss_e" class="level3" data-number="10.2.3"><h3 data-number="10.2.3" class="anchored" data-anchor-id="how-big-is-ss_h-compared-to-ss_e">
<span class="header-section-number">10.2.3</span> How big is <span class="math inline">\(SS_H\)</span> compared to <span class="math inline">\(SS_E\)</span>?</h3>
<p>In a univariate response model, <span class="math inline">\(SS_H\)</span> and <span class="math inline">\(SS_E\)</span> are both scalar numbers and the univariate <span class="math inline">\(F\)</span> test statistic, <span class="math display">\[F = \frac{\text{SS}_H/\text{df}_h}{\text{SS}_E/\text{df}_e} = \frac{\mathsf{Var}(H)}{\mathsf{Var}(E)} \:\: ,
\]</span> assesses “how big” <span class="math inline">\(\text{SS}_H\)</span> is, relative to <span class="math inline">\(\text{SS}_E\)</span>, the variance accounted for by a hypothesized model or model terms relative to error variance. The measure <span class="math inline">\(R^2 = SS_H / (SS_H + SS_E) = SS_H / SS_T\)</span> gives the proportion of total variance accounted for by the model terms.</p>
<p>In the multivariate analog <span class="math inline">\(\mathbf{H}\)</span> and <span class="math inline">\(\mathbf{E}\)</span> are both <span class="math inline">\(p \times p\)</span> matrices, and <span class="math inline">\(\mathbf{H}\)</span> “divided by” <span class="math inline">\(\mathbf{E}\)</span> becomes <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span>. The answer, “how big” <span class="math inline">\(\text{SS}_H\)</span> is compared to <span class="math inline">\(\text{SS}_E\)</span> is expressed in terms of the <span class="math inline">\(p\)</span> eigenvalues <span class="math inline">\(\lambda_i, i = 1, 2, \dots p\)</span> of <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span>. These are the <span class="math inline">\(p\)</span> values <span class="math inline">\(\lambda\)</span> which solve the determinant equation <span class="math display">\[
\text{det}{(\mathbf{H}\mathbf{E}^{-1} - \lambda \mathbf{I}}) = 0 \:\: .
\]</span> The solution also gives the <span class="math inline">\(\lambda_i\)</span> as the eigenvalues, with vectors <span class="math inline">\(\mathbf{v}_i\)</span> as the corresponding eigenvectors, <span id="eq-he-eigen"><span class="math display">\[
\mathbf{H}\mathbf{E}^{-1} \; \lambda_i = \lambda_i \mathbf{v}_i \:\: .
\tag{10.5}\]</span></span></p>
<p>This can also be expressed in terms of the size of <span class="math inline">\(\mathbf{H}\)</span> relative to total variation <span class="math inline">\((\mathbf{H}+ \mathbf{E})\)</span> as</p>
<p><span id="eq-he-eigen2"><span class="math display">\[
\mathbf{H}(\mathbf{H}+\mathbf{E})^{-1} \; \rho_i = \rho_i \mathbf{v}_i \:\: ,
\tag{10.6}\]</span></span></p>
<p>which has the same eigenvectors as <a href="#eq-he-eigen" class="quarto-xref">Equation&nbsp;<span>10.5</span></a> and the eigenvalues are <span class="math inline">\(\rho_i = \lambda_i / (1 + \lambda_i)\)</span>.</p>
<p>However, when the hypothesized model terms have <span class="math inline">\(\text{df}_h\)</span> degrees of freedom (columns of the <span class="math inline">\(\mathbf{X}\)</span> matrix for that term), <span class="math inline">\(\mathbf{H}\)</span> is of rank <span class="math inline">\(\text{df}_h\)</span>, so only <span class="math inline">\(s=\min(p, \text{df}_h)\)</span> eigenvalues can be non-zero. For example, a test for a hypothesis about a single quantitative predictor <span class="math inline">\(\mathbf{x}\)</span>, has <span class="math inline">\(\text{df}_h = 1\)</span> degree of freedom and <span class="math inline">\(\mathrm{rank} (\mathbf{H}) = 1\)</span>; for a factor with <span class="math inline">\(g\)</span> groups, <span class="math inline">\(\text{df}_h = \mathrm{rank} (\mathbf{H}) = g-1\)</span>.</p>
<p>For the <code>dogfood</code> data, we get the following results:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">HEinv</span> <span class="op">&lt;-</span> <span class="va">SSP_H</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">SSP_E</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         start amount</span></span>
<span><span class="co">#&gt; start   0.466 -0.196</span></span>
<span><span class="co">#&gt; amount -3.488  1.606</span></span>
<span><span class="va">eig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">HEinv</span><span class="op">)</span></span>
<span><span class="va">eig</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="co">#&gt; [1] 2.0396 0.0317</span></span>
<span></span>
<span><span class="co"># as proportions</span></span>
<span><span class="va">eig</span><span class="op">$</span><span class="va">values</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">eig</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9847 0.0153</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The factor <code>formula</code> has four levels and therefore <span class="math inline">\(\text{df}_h = 3\)</span> degrees of freedom. But there are only <span class="math inline">\(p = 2\)</span> responses, so there are <span class="math inline">\(s=\min(p, \text{df}_h) = 2\)</span> eigenvalues (and corresponding eigenvectors). The eigenvalues tell us that 98.5% of the hypothesis variance due to <code>formula</code> can be accounted for by a single dimension.</p>
<!-- This -->
<!-- has a direct multivariate analog in terms of -->
<!-- the $s=\min(p, df_h)$ non-zero latent roots (eigenvalues), $\lambda_i$, of $\mat{H}\mat{E}^{-1}$ -->
<!-- ($\mathbf{H}$ "divided by" $\mathbf{E}$); that is, the values $\lambda_i$ that solve -->
<!-- $$ -->
<!--  \det{ ( \mathbf{H}\mathbf{E}^{-1} - \lambda \mathbf{I} )} = 0 \Longrightarrow  -->
<!--  \mathbf{H}\mathbf{E}^{-1} \lambda_i = \lambda_i \mathbf{v}_i \period -->
<!-- $$ -->
<p>The overall multivariate test for the model in <a href="#eq-mlm" class="quarto-xref">Equation&nbsp;<span>10.2</span></a> is essentially a test of the hypothesis <span class="math inline">\(\mathcal{H}_0: \mathbf{B} = 0\)</span> (excluding the row for the intercept). Equivalently, this is a test based on the <em>incremental</em> <span class="math inline">\(\mathbf{SSP}_{H}\)</span> for the hypothesized terms in the model—that is, the difference between the <span class="math inline">\(\mathbf{SSP}_{H}\)</span> for the full model and the null, intercept-only model. The same idea can be applied to test the difference between any pair of <em>nested</em> models—the added contribution of terms in a larger model relative to a smaller model containing a subset of terms.</p>
<p>The eigenvectors <span class="math inline">\(\mathbf{v}_i\)</span> in <a href="#eq-he-eigen" class="quarto-xref">Equation&nbsp;<span>10.5</span></a> are also important. These are the weights for the variables in a linear combination <span class="math inline">\(v_{i1} \mathbf{y}_1 + v_{i2} \mathbf{y}_2 + \cdots + v_{ip} \mathbf{y}_p\)</span> which produces the largest univariate <span class="math inline">\(F\)</span> statistic for the <span class="math inline">\(i\)</span>-th dimension. We exploit this in canonical discriminant analysis and the corresponding canonical HE plots (<a href="11-mlm-viz.html#sec-candisc" class="quarto-xref"><span>Section 11.7</span></a>).</p>
<p>The eigenvectors of <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span> for the dogfood model are shown below:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">eig</span><span class="op">$</span><span class="va">vectors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">HEinv</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">eig</span><span class="op">$</span><span class="va">vectors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Dim"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">eig</span><span class="op">$</span><span class="va">vectors</span></span>
<span><span class="co">#&gt;         Dim 1  Dim 2</span></span>
<span><span class="co">#&gt; start   0.123 -0.411</span></span>
<span><span class="co">#&gt; amount -0.992 -0.911</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first column corresponds to the weighted sum <span class="math inline">\(0.12 \times\text{start} - 0.99 \times \text{amount}\)</span>, which as we saw above accounts for 95.5% of the differences in the group means.</p>
</section></section><section id="sec-multivar-tests" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="sec-multivar-tests">
<span class="header-section-number">10.3</span> Multivariate test statistics</h2>
<p>In the univariate case, the overall <span class="math inline">\(F\)</span>-test of <span class="math inline">\(\mathcal{H}_0: \boldsymbol{\beta} = \mathbf{0}\)</span> is the uniformly most powerful invariant test when the assumptions are met. There is nothing better. This is not the case in the MLM.</p>
<p>The reason is that when there are <span class="math inline">\(p &gt; 1\)</span> response variables, and we are testing a hypothesis comprising <span class="math inline">\(\text{df}_h &gt;1\)</span> coefficients or degrees of freedom, there are <span class="math inline">\(s &gt; 1\)</span> possible dimensions in which <span class="math inline">\(\mathbf{H}\)</span> can be large relative to <span class="math inline">\(\mathbf{E}\)</span>, each measured by the eigenvalue <span class="math inline">\(\lambda_i\)</span>. There are several test statistics that combine these into a single measure, shown in <a href="#tbl-mstats" class="quarto-xref">Table&nbsp;<span>10.1</span></a>.</p>
<!-- $$ -->
<!-- \begin{align*} -->
<!-- \text{Wilks's Lambda} \quad & \Lambda = \prod^s_i \frac{1}{1+\lambda_i} \quad\quad  && \eta^2 = 1-\Lambda^{1/s} \\ -->
<!-- \text{Pillai trace} \quad &   V = \sum^s_i \frac{\lambda_i}{1+\lambda_i} \quad  && \eta^2 = \frac{V}{s}     \\ -->
<!-- \text{Hotelling-Lawley trace} \quad &  H = \sum^s_i \lambda_i \quad\quad   && \eta^2 = \frac{H}{H+s}   \\ -->
<!-- \text{Roy's maximum root} \quad &  R = \lambda_1   \quad\quad         &&  \eta^2 = \frac{\lambda_1}{1+\lambda_1}  \\ -->
<!-- \end{align*} -->
<!-- $$ -->
<div id="tbl-mstats" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mstats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.1: Test statistics for multivariate tests combine the size of dimensions of <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span> into a single measure.
</figcaption><div aria-describedby="tbl-mstats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="center">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;">Criterion</th>
<th style="text-align: left;">Formula</th>
<th style="text-align: left;">Partial <span class="math inline">\(\eta^2\)</span>
</th>
<th style="text-align: left;"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Wilks’s <span class="math inline">\(\Lambda\)</span>
</td>
<td style="text-align: left;"><span class="math inline">\(\Lambda = \prod^s_i \frac{1}{1+\lambda_i}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\eta^2 = 1-\Lambda^{1/s}\)</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Pillai trace</td>
<td style="text-align: left;"><span class="math inline">\(V = \sum^s_i \frac{\lambda_i}{1+\lambda_i}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\eta^2 = \frac{V}{s}\)</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hotelling-Lawley trace</td>
<td style="text-align: left;"><span class="math inline">\(H = \sum^s_i \lambda_i\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\eta^2 = \frac{H}{H+s}\)</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Roy maximum root</td>
<td style="text-align: left;"><span class="math inline">\(R = \lambda_1\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\eta^2 = \frac{\lambda_1}{1+\lambda_1}\)</span></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
<p>These correspond to different kinds of “means” of the <span class="math inline">\(\lambda_i\)</span>: geometric (Wilks), arithmetic (Pillai), harmonic (Hotelling-Lawley) and supremum (Roy). See <span class="citation" data-cites="Friendly-etal:ellipses:2013">Friendly et al. (<a href="95-references.html#ref-Friendly-etal:ellipses:2013" role="doc-biblioref">2013</a>)</span> for the geometry behind these measures.</p>
<p>Each of these statistics have different sampling distributions under the null hypothesis. But conveniently they can all be converted to <span class="math inline">\(F\)</span> statistics. These conversions are exact when the hypothesis has <span class="math inline">\(s \le 2\)</span> degrees of freedom, and approximations otherwise.</p>
<p>As well, each has an analog of the <span class="math inline">\(R^2\)</span>-like partial <span class="math inline">\(\eta^2\)</span> measure, giving the partial association accounted for by each term in the MLM. These reflect the proportion of total variation attributable to a given model term, partialling out (excluding) other factors from the total non-error variation. They can be used as a measure of effect size in a MLM.</p>
<section id="sec-contrasts2" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="sec-contrasts2">
<span class="header-section-number">10.3.1</span> Testing contrasts and linear hypotheses</h3>
<p>Even more generally, these multivariate tests apply to <em>every</em> linear hypothesis concerning the coefficients in <span class="math inline">\(\mathbf{B}\)</span>. Suppose we want to test the hypothesis that a subset of rows (predictors) and/or columns (responses) simultaneously have null effects. This can be expressed in the general linear test, <span class="math display">\[
\mathcal{H}_0 : \mathbf{C}_{h \times q} \, \mathbf{B}_{q \times p} = \mathbf{0}_{h \times p} \:\: ,
\]</span> where <span class="math inline">\(\mathbf{C}\)</span> is a full rank <span class="math inline">\(h \le q\)</span> hypothesis matrix of constants, that selects subsets or linear combinations (contrasts) of the coefficients in <span class="math inline">\(\mathbf{B}\)</span> to be tested in a <span class="math inline">\(h\)</span> degree-of-freedom hypothesis.</p>
<p>In this case, the SSP matrix for the hypothesis has the form <span id="eq-hmat"><span class="math display">\[
\mathbf{H}  =
(\mathbf{C} \widehat{\mathbf{B}})^\mathsf{T}\,
[\mathbf{C} (\mathbf{X}^\mathsf{T}\mathbf{X} )^{-1} \mathbf{C}^\mathsf{T}]^{-1} \,
(\mathbf{C} \widehat{\mathbf{B}}) \:\: ,
\tag{10.7}\]</span></span></p>
<p>where there are <span class="math inline">\(s = \min(h, p)\)</span> non-zero eigenvalues of <span class="math inline">\(\mathbf{H}\mathbf{E}^{-1}\)</span>. In <a href="#eq-hmat" class="quarto-xref">Equation&nbsp;<span>10.7</span></a>, <span class="math inline">\(\mathbf{H}\)</span> measures the (Mahalanobis) squared distances (and cross products) among the linear combinations <span class="math inline">\(\mathbf{C} \widehat{\mathbf{B}}\)</span> from the origin under the null hypothesis. <!-- An animated display of these ideas and the relations between data ellipses and HE plots can be seen at --> <!-- [https://www.datavis.ca/gallery/animation/manova/](https://www.datavis.ca/gallery/animation/manova/). --></p>
<p>For example, with three responses <span class="math inline">\(y_1, y_2, y_3\)</span> and three predictors <span class="math inline">\(x_1, x_2, x_3\)</span>, we can test the hypothesis that neither <span class="math inline">\(x_1\)</span> nor <span class="math inline">\(x_2\)</span> contribute at all to predicting the <span class="math inline">\(y\)</span>s in terms of the hypothesis that the coefficients for the corresponding rows of <span class="math inline">\(\mathbf{B}\)</span> are zero using a 1-row <span class="math inline">\(\mathbf{C}\)</span> matrix that simply selects those rows:</p>
<!-- $$ -->
<!-- \mathcal{H}_0 : \mathbf{C} \mathbf{B} =  -->
<!-- \begin{bmatrix} -->
<!-- 0 & 1 & 1 & 0 -->
<!-- \end{bmatrix} -->
<!-- \begin{pmatrix} -->
<!--  \beta_{0,y_1} & \beta_{0,y_2} & \beta_{0,y_3} \\  -->
<!--  \beta_{1,y_1} & \beta_{1,y_2} & \beta_{1,y_3} \\  -->
<!--  \beta_{2,y_1} & \beta_{2,y_2} & \beta_{2,y_3} \\  -->
<!--  \beta_{3,y_1} & \beta_{3,y_2} & \beta_{3,y_3}  -->
<!-- \end{pmatrix} -->
<!-- = -->
<!-- \begin{bmatrix} -->
<!--  \beta_{1,y_1} & \beta_{1,y_2} & \beta_{1,y_3} \\  -->
<!--  \beta_{2,y_1} & \beta_{2,y_2} & \beta_{2,y_3} \\  -->
<!-- \end{bmatrix} -->
<!-- =  -->
<!-- \mathbf{0}_{(2 \times 3)} -->
<!-- $$ -->
<p><span class="math display">\[\begin{aligned}
\mathcal{H}_0 : \mathbf{C} \mathbf{B} &amp; =
\begin{bmatrix}
0 &amp; 1 &amp; 1 &amp; 0
\end{bmatrix}
\begin{pmatrix}
  \beta_{0,y_1} &amp; \beta_{0,y_2} &amp; \beta_{0,y_3} \\
  \beta_{1,y_1} &amp; \beta_{1,y_2} &amp; \beta_{1,y_3} \\
  \beta_{2,y_1} &amp; \beta_{2,y_2} &amp; \beta_{2,y_3} \\
  \beta_{3,y_1} &amp; \beta_{3,y_2} &amp; \beta_{3,y_3}
\end{pmatrix} \\ \\
&amp; =
\begin{bmatrix}
  \beta_{1,y_1} &amp; \beta_{1,y_2} &amp; \beta_{1,y_3} \\
  \beta_{2,y_1} &amp; \beta_{2,y_2} &amp; \beta_{2,y_3} \\
\end{bmatrix}
=
\mathbf{0}_{(2 \times 3)}
\end{aligned}\]</span></p>
<p>In MANOVA designs, it is often desirable to follow up a significant effect for a factor with subsequent tests to determine which groups differ. While you can simply test for all pairwise differences among groups (using Bonferonni or other corrections for multiplicity), a more substantively-driven approach uses planned comparisons or <em>contrasts</em> among the factor levels as described in <a href="05-linear_models.html#sec-contrasts" class="quarto-xref"><span>Section 5.1.3</span></a>.</p>
<p><strong>TODO</strong>: This stuff was copied to <a href="05-linear_models.html#sec-contrasts" class="quarto-xref"><span>Section 5.1.3</span></a>. Delete it here</p>
<p>For a factor with <span class="math inline">\(g\)</span> groups, a contrast is simply a comparison of the mean of one subset of groups against the mean of another subset. This is specified as a weighted sum, <span class="math inline">\(L\)</span> of the means with weights <span class="math inline">\(\mathbf{c}\)</span> that sum to zero,</p>
<p><span class="math display">\[
L = \mathbf{c}^\mathsf{T} \boldsymbol{\mu} = \sum_i c_i \mu_i \quad\text{such that}\quad \Sigma c_i = 0
\]</span> Two contrasts, <span class="math inline">\(\mathbf{c}_1\)</span> and <span class="math inline">\(\mathbf{c}_2\)</span> are <em>orthogonal</em> if the sum of products of their weights is zero, i.e., <span class="math inline">\(\mathbf{c}_1^\mathsf{T} \mathbf{c}_2 = \Sigma c_{1i} \times c_{2i} = 0\)</span>. When contrasts are placed as columns of a matrix <span class="math inline">\(\mathbf{C}\)</span>, they are all <em>mutually orthogonal</em> if each pair is orthogonal, which means <span class="math inline">\(\mathbf{C}^\top \mathbf{C}\)</span> is a diagonal matrix. Orthogonal contrasts correspond to statistically independent tests. This is nice because they reflect separate, non-overlapping research questions. When these questions are posed <em>apriori</em>, in advance of analysis there is no need to correct for multiple testing, on the grounds that you shouldn’t be penalized for having more ideas!</p>
<!-- For example, with $g=4$ groups representing the combinations of two drugs, A and B -->
<!-- given at low and high doses, we might want to compare -->
<!-- (a) the average of the drug A groups vs. the average of drug B; -->
<!-- (b) low vs. high for drug A; -->
<!-- (c) low vs. high for drug B. The contrasts that do this are: -->
<!-- \begin{align*} -->
<!-- L_1 & = (\mu_1 + \mu_2) - (\mu_1 + \mu_2) & \rightarrow\: & \mathbf{c}_1 =  -->
<!--     \begin{pmatrix}  -->
<!--      1 &  1 & -1 & -1  -->
<!--     \end{pmatrix} \\ -->
<!-- L_2 & = \mu_1 - \mu_2                     & \rightarrow\: & \mathbf{c}_2 =  -->
<!--     \begin{pmatrix}  -->
<!--      1 &  -1 & 0 & 0  -->
<!--     \end{pmatrix} \\ -->
<!-- L_3 & = \mu_3 - \mu_4                     & \rightarrow\: & \mathbf{c}_3 =  -->
<!--     \begin{pmatrix}  -->
<!--      0 &  0 & 1 & -1  -->
<!--     \end{pmatrix} -->
<!-- \end{align*} -->
<!-- **TODO**: Should use $\frac12$ here so contrast L_1 is mean diff -->
<p>For example, with the <span class="math inline">\(g=4\)</span> groups for the <code>dogfood</code> data, the company might want to test the following comparisons among the formulas Old, New, Major and Alps: (a) Ours vs.&nbsp;Theirs: The average of (Old, New) compared to (Major, Alps); (b) Old vs.&nbsp;New; (c) Major vs.&nbsp;Alps. The contrasts that do this are:</p>
<p><span class="math display">\[\begin{aligned}
L_1 &amp; = \textstyle{\frac12} (\mu_O + \mu_N) -
        \textstyle{\frac12} (\mu_M + \mu_A) &amp; \rightarrow\: &amp; \mathbf{c}_1 =
\textstyle{\frac12}
     \begin{pmatrix}
      1 &amp;  1 &amp; -1 &amp; -1
     \end{pmatrix} \\
L_2 &amp; = \mu_O - \mu_N                     &amp; \rightarrow\: &amp; \mathbf{c}_2 =
    \begin{pmatrix}
     1 &amp;  -1 &amp; 0 &amp; 0
    \end{pmatrix} \\
L_3 &amp; = \mu_M - \mu_A                     &amp; \rightarrow\: &amp; \mathbf{c}_3 =
    \begin{pmatrix}
     0 &amp;  0 &amp; 1 &amp; -1
    \end{pmatrix}
\end{aligned}\]</span></p>
<p>Note that these correspond to <em>nested dichotomies</em> among the four groups: first we compare groups (Old and New) against groups (Major and Alps), then subsequently within each of these sets. Nested dicontomy contrasts are always <em>orthogonal</em>, and therefore correspond to statistically independent tests. We are effectively taking a three degree-of-freedom question, “do the means differ?” and breaking it down into three separate 1 df tests that answer specific parts of that overall question.</p>
<p>In R, contrasts for a factor are specified as columns of matrix, each of which sums to zero. For this example, we can set this up by creating each as a vector and joining them as columns using <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,  <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>    <span class="co"># Old,New vs. Major,Alps</span></span>
<span><span class="va">c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>,  <span class="fl">0</span>,  <span class="fl">0</span><span class="op">)</span>      <span class="co"># Old vs. New</span></span>
<span><span class="va">c3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,  <span class="fl">0</span>,  <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>      <span class="co"># Major vs. Alps</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">c1</span>,<span class="va">c2</span>,<span class="va">c3</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">dogfood</span><span class="op">$</span><span class="va">formula</span><span class="op">)</span></span>
<span></span>
<span><span class="va">C</span></span>
<span><span class="co">#&gt;         c1 c2 c3</span></span>
<span><span class="co">#&gt; Old    0.5  1  0</span></span>
<span><span class="co">#&gt; New    0.5 -1  0</span></span>
<span><span class="co">#&gt; Major -0.5  0  1</span></span>
<span><span class="co">#&gt; Alps  -0.5  0 -1</span></span>
<span></span>
<span><span class="co"># show they are mutually orthogonal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">C</span></span>
<span><span class="co">#&gt;    c1 c2 c3</span></span>
<span><span class="co">#&gt; c1  1  0  0</span></span>
<span><span class="co">#&gt; c2  0  2  0</span></span>
<span><span class="co">#&gt; c3  0  0  2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the <code>dogfood</code> data, with <code>formula</code> as the group factor, you can set up the analyses to use these contrasts by assigning the matrix <code>C</code> to <code><a href="https://rdrr.io/r/stats/contrasts.html">contrasts()</a></code> for that factor in the dataset itself. When the contrasts are changed, it is necessary to refit the model. The estimated coefficients then become the estimated mean differences for the contrasts.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html">contrasts</a></span><span class="op">(</span><span class="va">dogfood</span><span class="op">$</span><span class="va">formula</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">C</span></span>
<span><span class="va">dogfood.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">amount</span><span class="op">)</span> <span class="op">~</span> <span class="va">formula</span>, </span>
<span>                  data<span class="op">=</span><span class="va">dogfood</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">dogfood.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;              start amount</span></span>
<span><span class="co">#&gt; (Intercept)  1.688  85.56</span></span>
<span><span class="co">#&gt; formulac1   -1.375  10.88</span></span>
<span><span class="co">#&gt; formulac2   -0.500   3.25</span></span>
<span><span class="co">#&gt; formulac3    0.125   1.88</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, Ours vs.&nbsp;Theirs estimated by <code>formulac1</code> takes 0.69 less time to start eating and eats 5.44 more on average.</p>
<p>For multivariate tests, when all contrasts are pairwise orthogonal, the overall test of a factor with <span class="math inline">\(\text{df}_h = g-1\)</span> degrees of freedom can be broken down into <span class="math inline">\(g-1\)</span> separate 1 df tests. This gives rise to a set of <span class="math inline">\(\text{df}_h\)</span> rank 1 <span class="math inline">\(\mathbf{H}\)</span> matrices that additively decompose the overall hypothesis SSCP matrix,</p>
<p><span id="eq-H-contrasts"><span class="math display">\[
\mathbf{H} = \mathbf{H}_1 + \mathbf{H}_2 + \cdots + \mathbf{H}_{\text{df}_h} \:\: ,
\tag{10.8}\]</span></span></p>
<p>exactly as the univariate <span class="math inline">\(\text{SS}_H\)</span> can be decomposed using orthogonal contrasts in an ANOVA (<a href="05-linear_models.html#sec-contrasts" class="quarto-xref"><span>Section 5.1.3</span></a>)</p>
<p>You can test such contrasts or any other hypotheses involving linear combinations of the coefficients using <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">car::linearHypothesis()</a></code>. Here, <code>"formulac1"</code> refers to the contrast <code>c1</code> for the difference between Ours and Theirs. Note that because this is a 1 df test, all four test statistics yield the same <span class="math inline">\(F\)</span> values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hyp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">dogfood.mod</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "formulac1" "formulac2" "formulac3"</span></span>
<span><span class="va">H1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">dogfood.mod</span>, <span class="va">hyp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>                       title<span class="op">=</span><span class="st">"Ours vs. Theirs"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sum of squares and products for the hypothesis:</span></span>
<span><span class="co">#&gt;         start amount</span></span>
<span><span class="co">#&gt; start    7.56  -59.8</span></span>
<span><span class="co">#&gt; amount -59.81  473.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sum of squares and products for error:</span></span>
<span><span class="co">#&gt;        start amount</span></span>
<span><span class="co">#&gt; start   25.8   11.7</span></span>
<span><span class="co">#&gt; amount  11.7  390.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: Ours vs. Theirs</span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; Pillai            1     0.625     9.18      2     11 0.0045 **</span></span>
<span><span class="co">#&gt; Wilks             1     0.375     9.18      2     11 0.0045 **</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  1     1.669     9.18      2     11 0.0045 **</span></span>
<span><span class="co">#&gt; Roy               1     1.669     9.18      2     11 0.0045 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly we can test the other two contrasts within these each of these two subsets, but I don’t print the results</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">H2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">dogfood.mod</span>, <span class="va">hyp</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                       title<span class="op">=</span><span class="st">"Old vs. New"</span><span class="op">)</span></span>
<span><span class="va">H3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">dogfood.mod</span>, <span class="va">hyp</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, </span>
<span>                       title<span class="op">=</span><span class="st">"Alps vs. Major"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we can illustrate <a href="#eq-H-contrasts" class="quarto-xref">Equation&nbsp;<span>10.8</span></a> by extracting the 1 df <span class="math inline">\(\mathbf{H}\)</span> matrices (<code>SSPH</code>) from the results of <code>linearHypothesis</code>.</p>
<!-- this doesn't work -->
<p><span class="math display">\[
\overset{\mathbf{H}}
{\begin{pmatrix}
  9.7 &amp; -70.9 \\
-70.9 &amp; 585.7 \\
\end{pmatrix}}
=
\overset{\mathbf{H}_1}
{\begin{pmatrix}
  7.6 &amp; -59.8 \\
-59.8 &amp; 473.1 \\
\end{pmatrix}}
+
\overset{\mathbf{H}_2}
{\begin{pmatrix}
0.13 &amp;  1.88 \\
1.88 &amp; 28.12 \\
\end{pmatrix}}
+
\overset{\mathbf{H}_3}
{\begin{pmatrix}
  2 &amp; -13 \\
-13 &amp;  84 \\
\end{pmatrix}}
\]</span></p>
</section></section><section id="anova-rightarrow-manova" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="anova-rightarrow-manova">
<span class="header-section-number">10.4</span> ANOVA <span class="math inline">\(\rightarrow\)</span> MANOVA</h2>
<p>Multivariate analysis of variance (MANOVA) generalizes the familiar ANOVA model to situations where there are two or more response variables. Unlike ANOVA, which focuses on discerning statistical differences in one continuous dependent variable influenced by an independent variable (or grouping variable), MANOVA considers several dependent variables at once. It integrates these variables into a single, composite variable through a weighted linear combination, allowing for a comprehensive analysis of how these dependent variables collectively vary with respect to the levels of the independent variable. Essentially, MANOVA investigates whether the grouping variable explains significant variations in the combined dependent variables.</p>
<p>The situation is illustrated in <a href="#fig-manova-diagram" class="quarto-xref">Figure&nbsp;<span>10.3</span></a> where there are two response measures, <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span> with data collected for three groups. For concreteness, <span class="math inline">\(Y_1\)</span> might be a score on a math test and <span class="math inline">\(Y_2\)</span> might be a reading score. Let’s also say that group 1 has been studying Shakespeare, while group 2 has concentrated on physics, but group 3 has done nothing beyond the normal curriculum.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-manova-diagram" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-manova-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/manova-diagram-anno.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-manova-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.3: Data from simple MANOVA design involving three groups and two response measures, <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span>, summarized by their data ellipses.
</figcaption></figure>
</div>
</div>
</div>
<p>As shown in the figure, the centroids, <span class="math inline">\((\mu_{1g}, \mu_{2g})\)</span>, clearly differ—the data ellipses barely overlap. A multivariate analysis would show a highly difference among groups. From a rough visual inspection, it seems that means differ on the math test <span class="math inline">\(Y_1\)</span>, with the physics group out-performing the other two. On the reading test <span class="math inline">\(Y_2\)</span> however it might turn out that the three group means don’t differ significantly in an ANOVA, but the Shakespeare and physics groups appear to outperform the normal curriculum group. Doing separate ANOVAs on these variables would miss what is so obvious from <a href="#fig-manova-diagram" class="quarto-xref">Figure&nbsp;<span>10.3</span></a>: there is wide separation among the groups in the two tests considered <em>jointly</em>.</p>
<p><a href="#fig-manova-response-dimensions" class="quarto-xref">Figure&nbsp;<span>10.4</span></a> illustrates a second important advantage of performing a multivariate analysis over separate ANOVAS: that of determining the <em>number of dimensions</em> or aspects along which groups differ. In the panel on the left, the means of the three groups increase nearly linearly on the combination of <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span>, so their differences can be ascribed to a single dimension, which simplifies the interpretation: <em>both</em> memory and attention scores decrease together with degree of schizophrenia.</p>
<p>For example, the groups here might be patients diagnosed as normal, mild schizophrenia and profound schizophrenia, and the measures could be tests of memory and attention. The obvious multivariate interpretation from the figure is that of increasing impairment of cognitive functioning across the groups, comprised by memory and attention. Note also the positive association <em>within</em> each group: those who perform better on the memory task also do better on attention.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-manova-response-dimensions" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-manova-response-dimensions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/manova-response-dimensions-anno.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-manova-response-dimensions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.4: A simple MANOVA design involving three groups and two response measures, <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span>, but with different patterns of the differences among the group means. The red arrows suggest interpretations in terms of dimensions or aspects of the response variables.
</figcaption></figure>
</div>
</div>
</div>
<p>In contrast, the right panel of <a href="#fig-manova-response-dimensions" class="quarto-xref">Figure&nbsp;<span>10.4</span></a> shows a situation where the group means have a low correlation. Data like this might arise in a study of parental competency, where there are measures of both the degree of caring (<span class="math inline">\(Y_1\)</span>) and time spent in play (<span class="math inline">\(Y_2\)</span>) by fathers and groups consisting of fathers of children with no disability, or a physical disability or a mental ability.</p>
<p>As can be seen in <a href="#fig-manova-response-dimensions" class="quarto-xref">Figure&nbsp;<span>10.4</span></a> fathers of the disabled children differ from those of the not disabled group in two different directions corresponding to being higher on either <span class="math inline">\(Y_1\)</span> or <span class="math inline">\(Y_2\)</span>. The <span style="color: red;">red</span> arrows suggest that the differences among groups could be interpreted in terms of two uncorrelated dimensions, perhaps labeled overall competency and emphasis on physical activity. (The pattern in <a href="#fig-manova-response-dimensions" class="quarto-xref">Figure&nbsp;<span>10.4</span></a> (right) is contrived for the sake of illustration; it does not reflect the data analyzed in the example below.)</p>
<section id="example-father-parenting-data" class="level3" data-number="10.4.1"><h3 data-number="10.4.1" class="anchored" data-anchor-id="example-father-parenting-data">
<span class="header-section-number">10.4.1</span> Example: Father parenting data</h3>
<p>I use a simple example of a three-group multivariate design to illustrate the basic ideas of fitting MLMs in R and testing hypotheses. Visualization methods using HE plots are discussed in <a href="11-mlm-viz.html" class="quarto-xref"><span>Chapter 11</span></a>.</p>
<p>The dataset <code>Parenting</code> come from an exercise (10B) in <span class="citation" data-cites="Meyers-etal:2006">Meyers et al. (<a href="95-references.html#ref-Meyers-etal:2006" role="doc-biblioref">2006</a>)</span> and are probably contrived, but are modeled on a real study in which fathers were assessed on three subscales of a <em>Perceived Parenting Competence Scale</em>,</p>
<ul>
<li>
<code>caring</code>, caretaking responsibilities;</li>
<li>
<code>emotion</code>, emotional support provided to the child; and</li>
<li>
<code>play</code>, recreational time spent with the child.</li>
</ul>
<p>The dataset <code>Parenting</code> comprises 60 fathers selected from three <code>group</code>s of <span class="math inline">\(n = 20\)</span> each: (a) fathers of a child with <em>no disabilities</em> (<code>"Normal"</code>); (b) fathers with a <em>physically</em> disabled child; (c) fathers with a <em>mentally</em> disabled child. The design is thus a three-group MANOVA, with three response variables.</p>
<!-- NOTE: Use **typical** rather than "normal" -->
<p>The main questions concern whether the group means differ on these scales, and the nature of these differences. That is, do the means differ significantly on all three measures? Is there a consistent order of groups across these three aspects of parenting?</p>
<p>More specific questions are: (a) Do the fathers of typical children differ from the other two groups on average? (b) Do the physical and mental groups differ? These questions can be tested using contrasts, and are specified by assigning a matrix to <code>contrasts(Parenting$group)</code>; each column is a contrast whose values sum to zero. They are given labels <code>"group1"</code> (normal vs.&nbsp;other) and <code>"group2"</code> (physical vs.&nbsp;mental) in some output.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Parenting</span>, package<span class="op">=</span><span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="op">-</span><span class="fl">.5</span>,</span>
<span>              <span class="fl">0</span>,  <span class="fl">1</span>,  <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>            nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  1.0    0</span></span>
<span><span class="co">#&gt; [2,] -0.5    1</span></span>
<span><span class="co">#&gt; [3,] -0.5   -1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html">contrasts</a></span><span class="op">(</span><span class="va">Parenting</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">C</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exploratory-plots" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="exploratory-plots">Exploratory plots</h4>
<p>Before setting up a model and testing, it is well-advised to examine the data graphically. The simplest plots are side-by-side boxplots (or violin plots) for the three responses. With <code>ggplot2</code>, this is easily done by reshaping the data to long format and using faceting. In <a href="#fig-parenting-boxpl" class="quarto-xref">Figure&nbsp;<span>10.5</span></a>, I’ve also plotted the group means with white dots.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>See the ggplot code</summary><div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parenting_long</span> <span class="op">&lt;-</span> <span class="va">Parenting</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">caring</span><span class="op">:</span><span class="va">play</span>, </span>
<span>                      names_to <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">parenting_long</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">group</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>outlier.size<span class="op">=</span><span class="fl">2.5</span>, </span>
<span>               alpha<span class="op">=</span><span class="fl">.5</span>, </span>
<span>               outlier.alpha <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">mean</span>, </span>
<span>               color<span class="op">=</span><span class="st">"white"</span>, </span>
<span>               geom<span class="op">=</span><span class="st">"point"</span>, </span>
<span>               size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_fill_hue</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># reverse default colors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Scale value"</span>, x <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">variable</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                                   hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-parenting-boxpl" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-parenting-boxpl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-parenting-boxpl-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-parenting-boxpl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.5: Faceted boxplots of scores on the three parenting scales, showing also the mean for each.
</figcaption></figure>
</div>
</div>
</div>
<p>In this figure, differences among the groups on <code>play</code> are most apparent, with fathers of non-disabled children scoring highest. Differences among the groups on <code>emotion</code> are very small, but one high outlier for the fathers of mentally disabled children is apparent. On <code>caring</code>, fathers of children with a physical disability stand out as highest.</p>
<p>For exploratory purposes, you might also make a scatterplot matrix. Here, because the MLM assumes homogeneity of the variances and covariance matrices <span class="math inline">\(\mathbf{S}_i\)</span>, I show only the data ellipses in scatterplot matrix format, using <code>heplots:covEllipses()</code> (with 50% coverage, for clarity):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># match color use in ggplot</span></span>
<span><span class="fu"><a href="https://friendly.github.io/heplots/reference/covEllipses.html">covEllipses</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">caring</span>, <span class="va">play</span>, <span class="va">emotion</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, </span>
<span>  data<span class="op">=</span><span class="va">Parenting</span>,</span>
<span>  variables <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  pooled <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.50</span>, </span>
<span>  col <span class="op">=</span> <span class="va">colors</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-parenting-covEllipses" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-parenting-covEllipses-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-parenting-covEllipses-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-parenting-covEllipses-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.6: Bivariate data ellipses for pairs of the three responses, showing the means, correlations and variances for the three groups.
</figcaption></figure>
</div>
</div>
</div>
<p>If the covariance matrices were all the same, the data ellipses would have roughly the same size and orientation, but that is not the case in <a href="#fig-parenting-covEllipses" class="quarto-xref">Figure&nbsp;<span>10.6</span></a>. The normal group shows greater variability overall and the correlations among the measures differ somewhat from group to group. We’ll assess later whether this makes a difference in the conclusions that can be drawn (<a href="12-eqcov.html" class="quarto-xref"><span>Chapter 12</span></a>). The group centroids also differ, but the pattern is not particularly clear. We’ll see an easier to understand view in HE plots and their canonical discriminant cousins.</p>
</section><section id="testing-the-model" class="level4 nunumbered" data-number="10.4.1.1"><h4 class="nunumbered anchored" data-number="10.4.1.1" data-anchor-id="testing-the-model">
<span class="header-section-number">10.4.1.1</span> Testing the model</h4>
<p>Let’s proceed to fit the multivariate model predicting all three scales from the <code>group</code> factor. <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> for a multivariate response returns an object of class <code>"mlm"</code>, for which there are many methods (use <code>methods(class="mlm")</code> to find them).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parenting.mlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">caring</span>, <span class="va">play</span>, <span class="va">emotion</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, </span>
<span>                    data<span class="op">=</span><span class="va">Parenting</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = cbind(caring, play, emotion) ~ group, data = Parenting)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              caring   play     emotion</span></span>
<span><span class="co">#&gt; (Intercept)   5.8833   4.6333   5.9167</span></span>
<span><span class="co">#&gt; group1       -0.3833   2.4167  -0.0667</span></span>
<span><span class="co">#&gt; group2        1.7750  -0.2250  -0.6000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The coefficients in this model are the values of the contrasts set up above. <code>group1</code> is the mean of the typical group minus the average of the other two, which is negative on <code>caring</code> and <code>emotion</code> but positive for <code>play</code>. <code>group2</code> is the difference in means for the physical vs.&nbsp;mental groups.</p>
<p>Before doing multivariate tests, it is useful to see what would happen if we ran univariate ANOVAs on each of the responses. These can be extracted from an MLM using <code><a href="https://rdrr.io/r/stats/summary.aov.html">stats::summary.aov()</a></code> and they give tests of the model terms for each response variable separately:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/summary.aov.html">summary.aov</a></span><span class="op">(</span><span class="va">parenting.mlm</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Response caring :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; group        2    130    65.2    18.6  6e-07 ***</span></span>
<span><span class="co">#&gt; Residuals   57    200     3.5                   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response play :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; group        2    177    88.6    27.6  4e-09 ***</span></span>
<span><span class="co">#&gt; Residuals   57    183     3.2                   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response emotion :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; group        2     15    7.27    1.02   0.37</span></span>
<span><span class="co">#&gt; Residuals   57    408    7.16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a more condensed summary, you can instead extract the univariate model fit statistics from the <code>"mlm"</code> object using the <code>heplots::glance()</code> method for a multivariate model object. The code below selects just the <span class="math inline">\(R^2\)</span> and <span class="math inline">\(F\)</span>-statistic for the overall model for each response, together with the associated <span class="math inline">\(p\)</span>-value.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">parenting.mlm</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">response</span>, <span class="va">r.squared</span>, <span class="va">fstatistic</span>, <span class="va">p.value</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   response r.squared fstatistic       p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 caring      0.395       18.6  0.000000602  </span></span>
<span><span class="co">#&gt; 2 play        0.492       27.6  0.00000000405</span></span>
<span><span class="co">#&gt; 3 emotion     0.0344       1.02 0.369</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From this, one might conclude that there are differences only in <code>caring</code> and <code>play</code> and therefore ignore <code>emotion</code>, but this would be short-sighted. <code><a href="https://rdrr.io/pkg/car/man/Anova.html">car::Anova()</a></code>, shown below, gives the overall multivariate test <span class="math inline">\(\mathcal{H}_0: \mathbf{B} = 0\)</span> of the <code>group</code> effect, that the groups don’t differ on <em>any</em> of the response variables. Note that this has a much smaller <span class="math inline">\(p\)</span>-value than any of the univariate <span class="math inline">\(F\)</span> tests.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">parenting.mlm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;       Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; group  2     0.948     16.8      6    112  9e-14 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova()</a></code> returns an object of class <code>"Anova.mlm"</code> which has various methods. The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method for this gives more details, including all four test statistics. With <span class="math inline">\(p=3\)</span> responses, these tests have <span class="math inline">\(s = \min(p, \text{df}_h) = \min(3,2) = 2\)</span> dimensions and the <span class="math inline">\(F\)</span> approximations are <em>not</em> equivalent here. All four tests are highly significant, with Roy’s test giving the largest <span class="math inline">\(F\)</span> statistic.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parenting.summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">parenting.mlm</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">parenting.summary</span>, SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Term: group </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: group</span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            2     0.948     16.8      6    112 9.0e-14 ***</span></span>
<span><span class="co">#&gt; Wilks             2     0.274     16.7      6    110 1.3e-13 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  2     1.840     16.6      6    108 1.8e-13 ***</span></span>
<span><span class="co">#&gt; Roy               2     1.108     20.7      3     56 3.8e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method by default prints the SSH = <span class="math inline">\(\mathbf{H}\)</span> and SSE = <span class="math inline">\(\mathbf{E}\)</span> matrices, but I suppressed them above. The data structure returned contains nested elements which can be extracted more easily from the object using <code><a href="https://purrr.tidyverse.org/reference/pluck.html">purrr::pluck()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">H</span> <span class="op">&lt;-</span> <span class="va">parenting.summary</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"multivariate.tests"</span>, <span class="st">"group"</span>, <span class="st">"SSPH"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         caring    play emotion</span></span>
<span><span class="co">#&gt; caring   130.4 -43.767 -41.833</span></span>
<span><span class="co">#&gt; play     -43.8 177.233   0.567</span></span>
<span><span class="co">#&gt; emotion  -41.8   0.567  14.533</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="va">parenting.summary</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"multivariate.tests"</span>, <span class="st">"group"</span>, <span class="st">"SSPE"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         caring  play emotion</span></span>
<span><span class="co">#&gt; caring   199.8 -45.8    35.2</span></span>
<span><span class="co">#&gt; play     -45.8 182.7    80.6</span></span>
<span><span class="co">#&gt; emotion   35.2  80.6   408.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="linear-hypotheses-contrasts" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="linear-hypotheses-contrasts">Linear hypotheses &amp; contrasts</h4>
<p>With three or more groups or with a more complex MANOVA design, contrasts provide a way of testing questions of substantive interest regarding differences among group means.</p>
<p>The test of the contrast comparing the typical group to the average of the others is the test using the contrast <span class="math inline">\(c_1 = (1, -\frac12, -\frac12)\)</span> which produces the coefficients labeled <code>"group1"</code>. The function <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">car::linearHypothesis()</a></code> carries out the multivariate test that this difference is zero. This is a 1 df test, so all four test statistics produce the same <span class="math inline">\(F\)</span> and <span class="math inline">\(p\)</span>-values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">parenting.mlm</span><span class="op">)</span><span class="op">[</span><span class="st">"group1"</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;  caring    play emotion </span></span>
<span><span class="co">#&gt; -0.3833  2.4167 -0.0667</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">parenting.mlm</span>, <span class="st">"group1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            1     0.521     19.9      3     55 7.1e-09 ***</span></span>
<span><span class="co">#&gt; Wilks             1     0.479     19.9      3     55 7.1e-09 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  1     1.088     19.9      3     55 7.1e-09 ***</span></span>
<span><span class="co">#&gt; Roy               1     1.088     19.9      3     55 7.1e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, the difference between the physical and mental groups uses the contrast <span class="math inline">\(c_2 = (0, 1, -1)\)</span> and the test that these means are equal is given by <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis()</a></code> applied to <code>group2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">parenting.mlm</span><span class="op">)</span><span class="op">[</span><span class="st">"group2"</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;  caring    play emotion </span></span>
<span><span class="co">#&gt;   1.775  -0.225  -0.600</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">parenting.mlm</span>, <span class="st">"group2"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            1     0.429     13.8      3     55  8e-07 ***</span></span>
<span><span class="co">#&gt; Wilks             1     0.571     13.8      3     55  8e-07 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  1     0.752     13.8      3     55  8e-07 ***</span></span>
<span><span class="co">#&gt; Roy               1     0.752     13.8      3     55  8e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis()</a></code> is very general. The second argument (<code>hypothesis.matrix</code>) corresponds to <span class="math inline">\(\mathbf{C}\)</span>, and can be specified as numeric matrix giving the linear combinations of coefficients by rows to be tested, or a character vector giving the hypothesis in symbolic form; <code>"group1"</code> is equivalent to <code>"group1 = 0"</code>.</p>
<p>Because the two contrasts used here are orthogonal, they add together to give the overall test of <span class="math inline">\(\mathbf{B} = \mathbf{0}\)</span>, which implies that the means of the three groups are all equal. The test below gives the same results as <code>Anova(parenting.mlm)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">parenting.mlm</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            2     0.948     16.8      6    112 9.0e-14 ***</span></span>
<span><span class="co">#&gt; Wilks             2     0.274     16.7      6    110 1.3e-13 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  2     1.840     16.6      6    108 1.8e-13 ***</span></span>
<span><span class="co">#&gt; Roy               2     1.108     20.7      3     56 3.8e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="ordered-factors" class="level3" data-number="10.4.2"><h3 data-number="10.4.2" class="anchored" data-anchor-id="ordered-factors">
<span class="header-section-number">10.4.2</span> Ordered factors</h3>
<p>When groups are defined by an ordered factor, such as level of physical fitness (rated 1–5) or grade in school, it is tempting to treat that as a numeric variable and use a multivariate regression model. This would assume that the effect of that factor is linear and if not, we might consider adding polynomial terms. A different strategy, often preferable, is to make the group variable an <em>ordered factor</em>, for which R assigns <em>polynomial contrasts</em>. This gives separate tests of the linear, quadratic, cubic, … trends of the response, without the need to specify them separately in the model</p>
</section><section id="example-adolescent-mental-health" class="level3" data-number="10.4.3"><h3 data-number="10.4.3" class="anchored" data-anchor-id="example-adolescent-mental-health">
<span class="header-section-number">10.4.3</span> Example: Adolescent mental health</h3>
<p>The dataset <code>AddHealth</code> contains a large cross-sectional sample of participants from grades 7–12 from the National Longitudinal Study of Adolescent Health, described by <span class="citation" data-cites="Warne2014">Warne (<a href="95-references.html#ref-Warne2014" role="doc-biblioref">2014</a>)</span>. It contains responses to two Likert-scale (1–5) items, <code>anxiety</code> and <code>depression</code>. <code>grade</code> is an <em>ordered</em> factor, which means that the default contrasts are taken as orthogonal polynomials with linear (<code>grade.L</code>), quadratic (<code>grade.Q</code>), up to 5th degree (<code>grade^5</code>) trends, which decompose the total effect of grade.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">AddHealth</span>, package<span class="op">=</span><span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">AddHealth</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':  4344 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;  $ grade     : Ord.factor w/ 6 levels "7"&lt;"8"&lt;"9"&lt;"10"&lt;..: 5 4 6 1 2 2 2 3 3 3 ...</span></span>
<span><span class="co">#&gt;  $ depression: int  0 0 0 0 0 0 0 0 1 2 ...</span></span>
<span><span class="co">#&gt;  $ anxiety   : int  0 0 0 1 1 0 0 1 1 0 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The research questions are:</p>
<ul>
<li>How do the means for anxiety and depression vary separately with grade? Is there evidence for linear and nonlinear trends?</li>
<li>How do anxiety and depression vary <em>jointly</em> with grade?</li>
<li>How does the <em>association</em> (correlation, $R^2) of anxiety and depression vary with age?</li>
</ul>
<p>The first question can be answered by fitting separate linear models for each response (e.g., <code>lm(anxiety ~ grade))</code>). However the second question is more interesting because it considers the two responses together and takes their correlation into account. This would be fit as the MLM:</p>
<p><span id="eq-AH-mod"><span class="math display">\[
\mathbf{y} = \boldsymbol{\beta}_0 + \boldsymbol{\beta}_1 x + \boldsymbol{\beta}_2 x^2 + \cdots \boldsymbol{\beta}_5 x^5
\tag{10.9}\]</span></span></p>
<p>or, expressed in terms of the variables,</p>
<p><span id="eq-AH-mod2"><span class="math display">\[\begin{aligned}
\begin{bmatrix} y_{\text{anx}} \\y_{\text{dep}} \end{bmatrix} &amp; =
\begin{bmatrix} \beta_{0,\text{anx}} \\ \beta_{0,\text{dep}} \end{bmatrix} +
\begin{bmatrix} \beta_{1,\text{anx}} \\ \beta_{1,\text{dep}} \end{bmatrix} \text{grade} +
\begin{bmatrix} \beta_{2,\text{anx}} \\ \beta_{2,\text{dep}} \end{bmatrix} \text{grade}^2 \\
&amp; + \cdots +
\begin{bmatrix} \beta_{5,\text{anx}} \\ \beta_{5,\text{dep}} \end{bmatrix} \text{grade}^5
\end{aligned} \tag{10.10}\]</span></span></p>
<p>With<code>grade</code> represented as an ordered factor, the values of <span class="math inline">\(x\)</span> in <a href="#eq-AH-mod" class="quarto-xref">Equation&nbsp;<span>10.9</span></a> are those of the orthogonal polynomials given by <code>poly(grade,5)</code>.</p>
<section id="exploratory-plots-1" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="exploratory-plots-1">Exploratory plots</h4>
<p>Some exploratory analysis is useful before fitting and visualizing models. As a first step, we find the means, standard deviations, and standard errors of the means.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">means</span> <span class="op">&lt;-</span> <span class="va">AddHealth</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    dep_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">depression</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    anx_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">anxiety</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    dep_se <span class="op">=</span> <span class="va">dep_sd</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    anx_se <span class="op">=</span> <span class="va">anx_sd</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    depression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">depression</span><span class="op">)</span>,</span>
<span>    anxiety <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">anxiety</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">depression</span>, <span class="va">anxiety</span>, .after <span class="op">=</span> <span class="va">grade</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 8</span></span>
<span><span class="co">#&gt;   grade depression anxiety     n dep_sd anx_sd dep_se anx_se</span></span>
<span><span class="co">#&gt;   &lt;ord&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 7          0.881   0.751   622   1.11   1.05 0.0447 0.0420</span></span>
<span><span class="co">#&gt; 2 8          1.08    0.804   664   1.19   1.06 0.0461 0.0411</span></span>
<span><span class="co">#&gt; 3 9          1.17    0.934   778   1.19   1.08 0.0426 0.0387</span></span>
<span><span class="co">#&gt; 4 10         1.27    0.956   817   1.23   1.11 0.0431 0.0388</span></span>
<span><span class="co">#&gt; 5 11         1.37    1.12    790   1.20   1.16 0.0428 0.0411</span></span>
<span><span class="co">#&gt; 6 12         1.34    1.10    673   1.14   1.11 0.0439 0.0426</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, plot the means with <span class="math inline">\(\pm 1\)</span> error bars. It appears that average level of both depression and anxiety increase steadily with grade, except for grades 11 and 12 which don’t differ much. Alternatively, we could describe this as relationships that seem largely linear, with a hint of curvature at the upper end.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">grade</span>, y <span class="op">=</span> <span class="va">anxiety</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">anxiety</span> <span class="op">-</span> <span class="va">anx_se</span>, </span>
<span>                   ymax <span class="op">=</span> <span class="va">anxiety</span> <span class="op">+</span> <span class="va">anx_se</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">grade</span>, y <span class="op">=</span> <span class="va">depression</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">depression</span> <span class="op">-</span> <span class="va">dep_se</span>, </span>
<span>                    ymax <span class="op">=</span> <span class="va">depression</span> <span class="op">+</span> <span class="va">dep_se</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-addhealth-means-each" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-addhealth-means-each-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-addhealth-means-each-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-addhealth-means-each-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.7: Means of anxiety and depression by grade, with <span class="math inline">\(\pm 1\)</span> standard error bars.
</figcaption></figure>
</div>
</div>
</div>
<p>It is also useful to within-group correlations using <code><a href="https://friendly.github.io/heplots/reference/covEllipses.html">covEllipses()</a></code>, as shown in <a href="#fig-addhealth-covellipse" class="quarto-xref">Figure&nbsp;<span>10.8</span></a>. This also plots the bivariate means showing the form of the association , treating anxiety and depression as multivariate outcomes. (Because the variability of the scores within groups is so large compared to the range of the means, I show the data ellipses with coverage of only 10%.)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/covEllipses.html">covEllipses</a></span><span class="op">(</span><span class="va">AddHealth</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, group <span class="op">=</span> <span class="va">AddHealth</span><span class="op">$</span><span class="va">grade</span>,</span>
<span>            pooled <span class="op">=</span> <span class="cn">FALSE</span>, level <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>            center.cex <span class="op">=</span> <span class="fl">2.5</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-addhealth-covellipse" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-addhealth-covellipse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-addhealth-covellipse-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-addhealth-covellipse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.8: Within-group covariance ellipses for the <code>grade</code> groups.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="fit-the-mlm" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="fit-the-mlm">Fit the MLM</h4>
<p>Now, let’s fit the MLM for both responses jointly in relation to <code>grade</code>. The null hypothesis is that the means for anxiety and depression are the same at all six grades, <span class="math display">\[
\mathcal{H}_0: \mathbf{\mu}_7 = \mathbf{\mu}_8 = \cdots = \mathbf{\mu}_{12} \; ,
\]</span> or equivalently, that all coefficients except the intercept in the model <a href="#eq-AH-mod" class="quarto-xref">Equation&nbsp;<span>10.9</span></a> are zero, <span class="math display">\[
\mathcal{H}_0: \boldsymbol{\beta}_1 =  \boldsymbol{\beta}_2  = \cdots =  \boldsymbol{\beta}_5 = \boldsymbol{0} \; .
\]</span> We fit the MANOVA model, and test the grade effect using <code><a href="https://rdrr.io/pkg/car/man/Anova.html">car::Anova()</a></code>. The effect of <code>grade</code> is highly significant, as we could tell from <a href="#fig-addhealth-means-each" class="quarto-xref">Figure&nbsp;<span>10.7</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">AH.mlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">anxiety</span>, <span class="va">depression</span><span class="op">)</span> <span class="op">~</span> <span class="va">grade</span>, data <span class="op">=</span> <span class="va">AddHealth</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># overall test of `grade`</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">AH.mlm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;       Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; grade  5    0.0224     9.83     10   8676 &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, the overall test, with 5 degrees of freedom is diffuse, in that it can be rejected if any pair of means differ. Given that <code>grade</code> is an ordered factor, it makes sense to examine narrower hypotheses of linear and nonlinear trends, <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">car::linearHypothesis()</a></code> on the coefficients of model <code>AH.mlm</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">AH.mlm</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "(Intercept)" "grade.L"     "grade.Q"     "grade.C"    </span></span>
<span><span class="co">#&gt; [5] "grade^4"     "grade^5"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The joint test of the linear coefficients <span class="math inline">\(\boldsymbol{\beta}_1 = (\beta_{1,\text{anx}},  \beta_{1,\text{dep}})^\mathsf{T}\)</span> for anxiety and depression, <span class="math inline">\(\mathcal{H}_0 : \boldsymbol{\beta}_1 = \boldsymbol{0}\)</span> is highly significant,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## linear effect</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">AH.mlm</span>, <span class="st">"grade.L"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            1     0.019     42.5      2   4337 &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Wilks             1     0.981     42.5      2   4337 &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  1     0.020     42.5      2   4337 &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Roy               1     0.020     42.5      2   4337 &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The test of the quadratic coefficients <span class="math inline">\(\mathcal{H}_0 : \boldsymbol{\beta}_2 = \boldsymbol{0}\)</span> indicates significant curvature in trends across grade, as we saw in the plots of their means in <a href="#fig-addhealth-means-each" class="quarto-xref">Figure&nbsp;<span>10.7</span></a>. One interpretation might be that depression and anxiety after increasing steadily up to grade eleven could level off thereafter.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## quadratic effect</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">AH.mlm</span>, <span class="st">"grade.Q"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; Pillai            1     0.002     4.24      2   4337  0.014 *</span></span>
<span><span class="co">#&gt; Wilks             1     0.998     4.24      2   4337  0.014 *</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  1     0.002     4.24      2   4337  0.014 *</span></span>
<span><span class="co">#&gt; Roy               1     0.002     4.24      2   4337  0.014 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An advantage of linear hypotheses is that we can test several terms <em>jointly</em>. Of interest here is the hypothesis that all higher order terms beyond the quadratic are zero, <span class="math inline">\(\mathcal{H}_0 : \boldsymbol{\beta}_3 =  \boldsymbol{\beta}_4 =  \boldsymbol{\beta}_5 = \boldsymbol{0}\)</span>. Using <code>linearHypothesis</code> you can supply a vector of coefficient names to be tested for their joint effect when dropped from the model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">AH.mlm</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "(Intercept)" "grade.L"     "grade.Q"     "grade.C"    </span></span>
<span><span class="co">#&gt; [5] "grade^4"     "grade^5"</span></span>
<span><span class="co">## joint test of all higher terms</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">AH.mlm</span>, <span class="va">coefs</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>                 title <span class="op">=</span> <span class="st">"Higher-order terms"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: Higher-order terms</span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; Pillai            3     0.002     1.70      6   8676   0.12  </span></span>
<span><span class="co">#&gt; Wilks             3     0.998     1.70      6   8674   0.12  </span></span>
<span><span class="co">#&gt; Hotelling-Lawley  3     0.002     1.70      6   8672   0.12  </span></span>
<span><span class="co">#&gt; Roy               3     0.002     2.98      3   4338   0.03 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="factorial-manova" class="level3" data-number="10.4.4"><h3 data-number="10.4.4" class="anchored" data-anchor-id="factorial-manova">
<span class="header-section-number">10.4.4</span> Factorial MANOVA</h3>
<p>When there are two or more categorical factors, the general linear model provides a way to investigate the effects (differences in means) of each simultaneously. More importantly, this allows you to determine if factors <em>interact</em>, so the effect of one factor varies with the levels of another factor …</p>
<section id="example-penguins-data" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="example-penguins-data">Example: Penguins data</h4>
<p>In <a href="03-multivariate_plots.html" class="quarto-xref"><span>Chapter 3</span></a> we examined the Palmer penguins data graphically, using a mosaic plot (<a href="03-multivariate_plots.html#fig-peng-mosaic" class="quarto-xref">Figure&nbsp;<span>3.36</span></a>) of the frequencies of the three factors, <code>species</code>, <code>island</code> and <code>sex</code> and then <code>ggpairs()</code> scatterplot matrix (<a href="03-multivariate_plots.html#fig-peng-ggpairs1" class="quarto-xref">Figure&nbsp;<span>3.37</span></a>).</p>
</section></section></section><section id="mra-rightarrow-mmra" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="mra-rightarrow-mmra">
<span class="header-section-number">10.5</span> MRA <span class="math inline">\(\rightarrow\)</span> MMRA</h2>
<p>When all predictor variables are quantitative, the MLM <a href="#eq-mlm" class="quarto-xref">Equation&nbsp;<span>10.2</span></a> becomes the extension of univariate multiple regression analysis (MRA) to the situation where there are <span class="math inline">\(p\)</span> response variables (RA). Just as in univariate models, we might want to test hypotheses about subsets of the predictors, for example when some predictors are meant as controls or things you might want to adjust for in assessing the effects of predictors of main interest.</p>
<p>But first, there are a couple of aspects of statistical practice that should be mentioned.</p>
<p><strong>Model selection</strong> is one topic where univariate and multivariate approaches differ. When there are more than a few predictors, approaches like hierarchical regression, LASSO <span class="citation" data-cites="Tibshriani:regr:1996">(<a href="95-references.html#ref-Tibshriani:regr:1996" role="doc-biblioref">Tibshirani, 1996</a>)</span> and stepwise selection can be used to eliminate uninformative predictors for each response.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> But this gives a different models for each response, based on the predictors included, each with its own interpretation. In contrast, the multivariate approach considers the outcome variables collectively. You can eliminate predictors that are unimportant, but the mechanics are geared toward removing them from the models for <em>all</em> responses.</p>
<p><strong>Overall tests</strong> In a one-way ANOVA, to control for multiple testing, it is common practice to carry out an overall <span class="math inline">\(F\)</span>-test to see if the group means differ collectively before testing comparison between specific groups. Similarly, in univariate multiple regression, researchers sometimes report an overall <span class="math inline">\(F\)</span>-test or test of the <span class="math inline">\(R^2\)</span> so they can reject the hypothesis that <em>all</em> predictors have no effect, before considering them individually.</p>
<p>Similarly, the the case of multivariate linear models, some consider it necessary to reject the multivariate null hypothesis for a predictor term before considering how it contributes to each of the response variables. Some further suggest that the individual univariate models be tested after an overall significant effect. I believe the first of these is wise, but the second might be too much to require when the general goal is to understand the data.</p>
<section id="sec-NLSY-mmra" class="level3" data-number="10.5.1"><h3 data-number="10.5.1" class="anchored" data-anchor-id="sec-NLSY-mmra">
<span class="header-section-number">10.5.1</span> Example: NLSY data</h3>
<p>The dataset <code>NLSY</code> comes from a small part of the National Longitudinal Survey of Youth, a series of annual surveys conducted by the U.S. Department of Labor to examine the transition of young people into the labor force. This particular subset gives measures of 243 children on mathematics and reading achievement and also measures of behavioral problems (antisocial, hyperactivity). Also available are the yearly income and education of the child’s father.</p>
<p>In this analysis the <code>math</code> and <code>read</code> scores are taken at the outcome variables.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Among the remaining predictors, income and educ might be considered as background variables necessary to control for. Interest might then be focused on whether the behavioral variables antisoc and hyperact contribute beyond that.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">NLSY</span>, package <span class="op">=</span> <span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">NLSY</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':  243 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ math    : num  50 28.6 50 32.1 21.4 ...</span></span>
<span><span class="co">#&gt;  $ read    : num  45.2 28.6 53.6 34.5 22.6 ...</span></span>
<span><span class="co">#&gt;  $ antisoc : int  4 0 2 0 0 1 0 1 1 4 ...</span></span>
<span><span class="co">#&gt;  $ hyperact: int  3 0 2 2 2 0 1 4 3 5 ...</span></span>
<span><span class="co">#&gt;  $ income  : num  52.52 42.6 50 6.08 7.41 ...</span></span>
<span><span class="co">#&gt;  $ educ    : int  14 12 12 12 14 12 12 12 12 9 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exploratory-plots-2" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="exploratory-plots-2">Exploratory plots</h4>
<p>To begin, I would examine some scatterplots and univariate displays. I’ll start with density plots for all the variables to see the shapes of their distributions, wikh rug plots at the bottom to show where the observations are located. From <a href="#fig-NLSY-density" class="quarto-xref">Figure&nbsp;<span>10.9</span></a> we see that math and reading scores are positively skewed, anti-social and hyperactivity have distributions highly concentrated in the lower scores. As we would suspect, father’s income is quite positively skewed. Father’s education is reasonably symmetric, but highly peaked at 12 years of schooling in this sample. The spikes reflect the fact that education is measured in discrete years.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">NLSY_long</span> <span class="op">&lt;-</span> <span class="va">NLSY</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">math</span><span class="op">:</span><span class="va">educ</span>, names_to <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">NLSY_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NLSY-density" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-NLSY-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-NLSY-density-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NLSY-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.9: Density plots for the variables in the <code>NLSY</code> dataset.
</figcaption></figure>
</div>
</div>
</div>
<p>In terms of an analysis focused on <code>math</code> and <code>read</code> as outcomes, a scatterplot of one against the other is useful, as is collection of scatterplots of each against the remaining variables. The second of these is left as an exercise to the reader.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">47</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">NLSY</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">read</span>, y <span class="op">=</span> <span class="va">math</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">loess</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NLSY-scat1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-NLSY-scat1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-NLSY-scat1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NLSY-scat1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.10: Scatterplot of mathematics score against reading score in the NLSY data
</figcaption></figure>
</div>
</div>
</div>
<p>The non-linear trend in <a href="#fig-NLSY-scat1" class="quarto-xref">Figure&nbsp;<span>10.10</span></a> may be due to the sparsity of data in the upper range of reading, and there are also a few unusual points shown in this plot. The function <code><a href="https://friendly.github.io/heplots/reference/noteworthy.html">heplots::noteworthy()</a></code> provides a variety of methods to identify such noteworthy points in scatterplots. The default <code>method</code> uses Mahalanobis <span class="math inline">\(D^2\)</span>. The plot below labels the five largest observations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu">heplots</span><span class="fu">::</span><span class="fu"><a href="https://friendly.github.io/heplots/reference/noteworthy.html">noteworthy</a></span><span class="op">(</span><span class="va">NLSY</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"mahal"</span>, n<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">NLSY</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">read</span>, y <span class="op">=</span> <span class="va">math</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">NLSY</span><span class="op">[</span><span class="va">ids</span>, <span class="op">]</span>, label <span class="op">=</span> <span class="va">ids</span>, size <span class="op">=</span> <span class="fl">5</span>, nudge_y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NLSY-scat2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-NLSY-scat2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-NLSY-scat2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NLSY-scat2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.11: Scatterplot of mathematics score against reading score in the NLSY data, highlighting noteworthy points
</figcaption></figure>
</div>
</div>
</div>
</section><section id="fitting-models" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="fitting-models">Fitting models</h4>
<p>We could of course include all of the predictors in a single model, and perhaps be done with it. To develop some model-thinking, it is more useful to proceed in smaller steps to see what we can learn from each. If we view parents’ income and education as the most obvious predictors of reading and mathematics scores, those are the variables to fit first.</p>
<p><strong>TODO</strong>: Using log2(income) is more appropriate, but give HE plots in Ch 11 that are less dramatic. Consider using just income.</p>
<!-- I use `log2(income)` in the models below because of the extreme skew of father's income. -->
<!-- $\log_2()$ rather than natural $\ln()$ facilitates interpretation. We can interpret -->
<!-- the coefficient for reading as "a doubling of income" is associated with an increase of that value in reading". -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">NLSY.mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">read</span>, <span class="va">math</span><span class="op">)</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">educ</span>, </span>
<span>                data <span class="op">=</span> <span class="va">NLSY</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">NLSY.mod1</span><span class="op">)</span>  <span class="co"># Type II, partial test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;        Df test stat approx F num Df den Df Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; income  1    0.0345     4.27      2    239 0.0151 * </span></span>
<span><span class="co">#&gt; educ    1    0.0515     6.49      2    239 0.0018 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="overall-test" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="overall-test">Overall test</h4>
<p>The <code><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova()</a></code> results above give multivariate tests of the contributions of each predictor <em>separately</em> to explaining reading and math and how they vary together. To get an overall test of the global null hypothesis <span class="math inline">\(\mathcal{H}_0 : \mathbf{B} =(\boldsymbol{\beta}_{\text{inc}}, \boldsymbol{\beta}_{\text{educ}}) =\mathbf{0}\)</span> for <em>all</em> predictors together, you can use <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">NLSY.mod1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">NLSY.mod1</span>, <span class="va">coefs</span>, title <span class="op">=</span> <span class="st">"income, educ = 0"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: income, educ = 0</span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Pillai            2     0.117     7.44      4    480 8.1e-06 ***</span></span>
<span><span class="co">#&gt; Wilks             2     0.884     7.59      4    478 6.2e-06 ***</span></span>
<span><span class="co">#&gt; Hotelling-Lawley  2     0.130     7.75      4    476 4.7e-06 ***</span></span>
<span><span class="co">#&gt; Roy               2     0.123    14.79      2    240 8.7e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This joint multivariate test is more highly significant than either of those for the separate effects of the predictors, again because it pools strength.</p>
</section><section id="coefficient-plots" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="coefficient-plots">Coefficient plots</h4>
<p>As usual, you can display the coefficients using <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code>. The <code>tidy</code> method for <code>"mlm"</code> objects defined in <span style="color: brown;"><strong>heplots</strong></span> shows these in a tidy format with <span class="math inline">\(t\)</span>-tests for each coefficient., arranged by the response variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">NLSY.mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt;                read   math</span></span>
<span><span class="co">#&gt; (Intercept) 15.8848 8.7829</span></span>
<span><span class="co">#&gt; income       0.0137 0.0893</span></span>
<span><span class="co">#&gt; educ         0.9495 1.2755</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">NLSY.mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;   response term        estimate std.error statistic  p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 read     (Intercept)  15.9       4.25       3.74  0.000233</span></span>
<span><span class="co">#&gt; 2 read     income        0.0137    0.0325     0.420 0.675   </span></span>
<span><span class="co">#&gt; 3 read     educ          0.949     0.360      2.64  0.00894 </span></span>
<span><span class="co">#&gt; 4 math     (Intercept)   8.78      4.33       2.03  0.0437  </span></span>
<span><span class="co">#&gt; 5 math     income        0.0893    0.0331     2.70  0.00749 </span></span>
<span><span class="co">#&gt; 6 math     educ          1.28      0.367      3.47  0.000607</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, a bivariate plot of these coefficients is more useful, because it provides visual tests of multivariate hypotheses. <code><a href="https://friendly.github.io/heplots/reference/coefplot.html">heplots::coefplot.mlm()</a></code> gives displays of the coefficients for a given <em>pair</em> of response variables. For interpretation, it adds the bivariate confidence ellipse for the coefficients, as well as univariate confidence intervals for each response. The univariate intervals are simply the horizontal and vertical shadows of the ellipses on the response variable axes.</p>
<p>A wrinkle here, as in <a href="06-linear_models-plots.html#sec-coefficient-displays" class="quarto-xref"><span>Section 6.3</span></a>, is that the coefficients are measured in different units and so coefficient plots for different predictors are more easily compared for standardized variables. To do this, I first re-fit the model using <code>scale(NLSY)</code> …</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">NLSY_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">NLSY</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NLSY_std.mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">read</span>, <span class="va">math</span><span class="op">)</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">educ</span>, </span>
<span>                data <span class="op">=</span> <span class="va">NLSY_std</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/coefplot.html">coefplot</a></span><span class="op">(</span><span class="va">NLSY_std.mod1</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"brown"</span><span class="op">)</span>,</span>
<span>   lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>   cex.lab <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>   ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>   xlab <span class="op">=</span> <span class="st">"read coefficient (std)"</span>,</span>
<span>   ylab <span class="op">=</span> <span class="st">"math coefficient (std)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NLSY-coefplot1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-NLSY-coefplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-NLSY-coefplot1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NLSY-coefplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.12: Bivariate coefficient plot for reading and math with 95% confidence ellipses. The variables have been standardized to make their units comparable.
</figcaption></figure>
</div>
</div>
</div>
<p>In <a href="#fig-NLSY-coefplot1" class="quarto-xref">Figure&nbsp;<span>10.12</span></a>, the confidence ellipses for <code>income</code> and <code>educ</code> both exclude the origin, which represents the multivariate hypothesis <span class="math inline">\(\mathcal{H}_0 : ( \beta_\textrm{read}, \beta_\textrm{math} ) = (0, \, 0)\)</span>, so this hypothesis is rejected. Note that if we only examined the univariate tests for each of the four parameters, we would conclude that for reading, <code>income</code> is not a significant predictor. The orientation of the confidence ellipses indicates the positive correlation between reading and mathematics scores.</p>
</section><section id="behavioral-measures" class="level4 unnumberd" data-number="10.5.1.1"><h4 class="unnumberd anchored" data-number="10.5.1.1" data-anchor-id="behavioral-measures">
<span class="header-section-number">10.5.1.1</span> Behavioral measures</h4>
<p>Given that the parental background variables are highly predictive of student performance, we might want to know if the behavioral measures <code>antisoc</code> and <code>hyperact</code> add importantly to this. One way to do this is to add these predictors to the model and test for their additional contributions over and above the baseline model.</p>
<p>You can do this using <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code>. In the model formula, “<code>.</code>” on the left hand side corresponds to the previous <span class="math inline">\(y\)</span> variables; on the right-hand side it refers to the <span class="math inline">\(x\)</span>s in the previous model, so I just add the new predictors to that.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">NLSY.mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">NLSY.mod1</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">antisoc</span> <span class="op">+</span> <span class="va">hyperact</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">NLSY.mod2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;          Df test stat approx F num Df den Df Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; income    1    0.0383     4.72      2    237 0.0098 **</span></span>
<span><span class="co">#&gt; educ      1    0.0532     6.65      2    237 0.0015 **</span></span>
<span><span class="co">#&gt; antisoc   1    0.0193     2.34      2    237 0.0988 . </span></span>
<span><span class="co">#&gt; hyperact  1    0.0144     1.74      2    237 0.1784   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each of these new predictors are individually non-significant according to the Type II tests. Using <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis()</a></code> you can test them jointly:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">NLSY.mod2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "income"   "educ"     "antisoc"  "hyperact"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">NLSY.mod2</span>, <span class="va">coefs</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, </span>
<span>                 title <span class="op">=</span> <span class="st">"NLSY.mod2 | NLSY.mod1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>SSP <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: NLSY.mod2 | NLSY.mod1</span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; Pillai            2     0.024     1.45      4    476  0.218  </span></span>
<span><span class="co">#&gt; Wilks             2     0.976     1.44      4    474  0.218  </span></span>
<span><span class="co">#&gt; Hotelling-Lawley  2     0.024     1.44      4    472  0.218  </span></span>
<span><span class="co">#&gt; Roy               2     0.022     2.64      2    238  0.073 .</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-schooldata-mmra" class="level3" data-number="10.5.2"><h3 data-number="10.5.2" class="anchored" data-anchor-id="sec-schooldata-mmra">
<span class="header-section-number">10.5.2</span> Example: School data</h3>
<p><span class="citation" data-cites="Charnes-etal-1981">Charnes et al. (<a href="95-references.html#ref-Charnes-etal-1981" role="doc-biblioref">1981</a>)</span> describe a large scale “social experiment” in public school education. Seventy school sites across the U.S. participated and a number of variables related to attributes of parents and teachers were used to predict aspects of students’ success in academic indicators (reading, mathematics), but also in their self-esteem. It was conceived in the late 1960’s in relation to a federally sponsored program charged with providing remedial assistance to educationally disadvantaged early primary school students.</p>
<p>The study was focused on the management styles used to guide educational planning across schools. In particular, it was primarily designed to compare schools using Program Follow Through (PFT) management methods of taking actions to achieve goals with those of Non Follow Through (NFT).</p>
<p>Here, I simply focus on the relations between outcome scores on tests of reading, mathematics and self-esteem in relation to five explanatory variables related to parents and teachers:</p>
<ul>
<li>
<code>education</code> level of mother as measured by the percentage of high school graduates among female parents.</li>
<li>
<code>occupation</code>, highest occupation of a family member on a rating scale.</li>
<li>
<code>visit</code>, an index of the number of parental visits to the school site.</li>
<li>
<code>counseling</code>, a measure calculated from data on time spent with child on school-related topics such as reading together, etc.</li>
<li>
<code>teacher</code>, number of teachers at the given site.</li>
</ul>
<p>The dataset, given in <code>schooldata</code> contains observations for 70 schools.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<section id="exploratory-plots-3" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="exploratory-plots-3">Exploratory plots</h4>
<p>There are eight variables in this example, so a scatterplot matrix or even a corrgram might not be sufficiently revealing. As usual, I tried a number of different methods and found a couple that were interesting and useful.</p>
<p>Multivariate normality is <strong>not</strong> required for all the variables in <span class="math inline">\(\mathbf{Y}\)</span> and <span class="math inline">\(\mathbf{X}\)</span>— it is only required for the residuals, <span class="math inline">\(\boldsymbol{\Large\varepsilon}= \mathbf{Y} - \widehat{\mathbf{Y}}\)</span>. Yet, for MMRA problems, sometimes an initial <span class="math inline">\(\chi^2\)</span> QQ plot provides a handy way to flag possibly unusual values to pay attention to as the analysis proceeds. In <a href="#fig-schooldata-cqplot" class="quarto-xref">Figure&nbsp;<span>10.13</span></a> we see five cases outside the 95% confidence envelope.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">schooldata</span>, package <span class="op">=</span> <span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://friendly.github.io/heplots/reference/cqplot.html">cqplot</a></span><span class="op">(</span><span class="va">schooldata</span>, id.n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     DSQ quantile       p</span></span>
<span><span class="co">#&gt; 59 44.6     21.0 0.00714</span></span>
<span><span class="co">#&gt; 44 38.8     18.0 0.02143</span></span>
<span><span class="co">#&gt; 33 27.9     16.5 0.03571</span></span>
<span><span class="co">#&gt; 66 24.0     15.5 0.05000</span></span>
<span><span class="co">#&gt; 35 21.7     14.7 0.06429</span></span>
<span></span>
<span><span class="co"># save the case ID numbers</span></span>
<span><span class="va">outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-schooldata-cqplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-schooldata-cqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-schooldata-cqplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-schooldata-cqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.13: <span class="math inline">\(\chi^2\)</span> QQ plot of the <code>schooldata</code> variables.
</figcaption></figure>
</div>
</div>
</div>
<p>Rather than a complete <span class="math inline">\(8 \times 8\)</span> scatterplot matrix, it is useful here to examine the scatterplots <em>only</em> for each <span class="math inline">\(y\)</span> variable against each of the predictors in <span class="math inline">\(\mathbf{X}\)</span>.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> I’ll take steps to flag some of these possibly unusual cases to see where they appear in these pairwise relations.</p>
<p>To prepare for this with <code>ggplot2</code>, it is necessary to reshape the data to long format <em>twice</em>—once for the (<span class="math inline">\(q=5\)</span>) <span class="math inline">\(x\)</span> variables and again for the (<span class="math inline">\(p=3\)</span>) <span class="math inline">\(y\)</span> responses to get all of their <span class="math inline">\(q \times p\)</span> combinations. That way, we get a data set with variables <code>x</code> and <code>y</code> whose variable names are by <code>xvar</code> and <code>yvar</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot predictors vs each response</span></span>
<span><span class="va">xvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">schooldata</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="va">yvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">schooldata</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span></span>
<span><span class="va">school_long</span> <span class="op">&lt;-</span> <span class="va">schooldata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"site"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">xvars</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"xvar"</span>, values_to <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">yvars</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"yvar"</span>, values_to <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">xvar</span>, <span class="va">xvars</span><span class="op">)</span>, </span>
<span>         yvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">yvar</span>, <span class="va">yvars</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/some.html">some</a></span><span class="op">(</span><span class="va">school_long</span>, n<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 5</span></span>
<span><span class="co">#&gt;   site  xvar           x yvar            y</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;fct&gt;      &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 1     teacher     9    reading     54.5 </span></span>
<span><span class="co">#&gt; 2 18    education  28    mathematics 38.2 </span></span>
<span><span class="co">#&gt; 3 26    teacher     7    selfesteem  31.2 </span></span>
<span><span class="co">#&gt; 4 49    occupation  5.29 reading     12.2 </span></span>
<span><span class="co">#&gt; 5 53    counseling 26.3  mathematics 22.0 </span></span>
<span><span class="co">#&gt; 6 61    occupation  2.59 mathematics  7.1 </span></span>
<span><span class="co">#&gt; 7 62    visit       9.89 reading      9.35</span></span>
<span><span class="co">#&gt; 8 64    occupation  8.91 mathematics 24.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this data structure, each scatterplot is a plot of a <code>y</code> against and <code>x</code>, and we can facet this using <code>facet_grid(yvar ~ xvar)</code>, giving <a href="#fig-schooldata-scats" class="quarto-xref">Figure&nbsp;<span>10.14</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">school_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, </span>
<span>               level <span class="op">=</span> <span class="fl">0.95</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">yvar</span> <span class="op">~</span> <span class="va">xvar</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"predictor"</span>, y <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># label the 3 most unusual points in each panel</span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">school_long</span> <span class="op">|&gt;</span> </span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">site</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">outliers</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">site</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-schooldata-scats" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-schooldata-scats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-schooldata-scats-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-schooldata-scats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.14: Scatterplots of each of the three response variables against each of the five predictors in the <code>schooldata</code> dataset. Three of the points identified as possible multivariate outliers are labeled.
</figcaption></figure>
</div>
</div>
</div>
<p>All of the predictors except for number of teachers show very strong linear relations with the outcome scores. Among the identified points, cases 44 and 59 stand out in all the plots, case 59 being particularly high on all the measures. As well, there is a small cluster of unusual points in the plots for number of teachers.</p>
</section><section id="fiting-models" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="fiting-models">Fiting models</h4>
<p>Let’s proceed to fit the multivariate regression model. Here “<code>.</code>” on the right-hand side of the model formula means all the other variables in the dataset.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">school.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">reading</span>, <span class="va">mathematics</span>, <span class="va">selfesteem</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, </span>
<span>                 data<span class="op">=</span><span class="va">schooldata</span><span class="op">)</span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">school.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;            Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; education   1     0.376    12.43      3     62 1.8e-06 ***</span></span>
<span><span class="co">#&gt; occupation  1     0.567    27.02      3     62 2.7e-11 ***</span></span>
<span><span class="co">#&gt; visit       1     0.260     7.27      3     62 0.00029 ***</span></span>
<span><span class="co">#&gt; counseling  1     0.065     1.43      3     62 0.24297    </span></span>
<span><span class="co">#&gt; teacher     1     0.049     1.07      3     62 0.37003    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These multivariate tests have a seemingly simple interpretation: parent’s education and occupation and their visits to the schools are highly predictive of student’s outcomes; their counseling efforts and the number of teachers in the schools, not so much.</p>
<p>You can get an assessment of the <em>strength</em> of multivariate association from the <span class="math inline">\(R^2\)</span> for each of the responses using <code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code> for the MLM. All of these are very high.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">school.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 8</span></span>
<span><span class="co">#&gt;   response    r.squared sigma fstatistic numdf dendf  p.value  nobs</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 reading         0.929  4.83       167.     5    64 2.34e-35    70</span></span>
<span><span class="co">#&gt; 2 mathematics     0.917  6.16       141.     5    64 3.37e-33    70</span></span>
<span><span class="co">#&gt; 3 selfesteem      0.993  1.17      1852.     5    64 8.47e-68    70</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly <code><a href="https://friendly.github.io/heplots/reference/etasq.html">etasq()</a></code> for an MLM gives an <span class="math inline">\(R^2\)</span>-like measure called <span class="math inline">\(\eta^2\)</span> of the <em>partial association</em> accounted for each of the <em>predictor terms</em> in the model. These are analogous to the Type II tests from <code><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova()</a></code>, which test the additional contribution of each term in the model beyond all the others.</p>
<p>In spite of the overwhelming significance of the first three predictors, their variance accounted for is more modest. It is highest for parent’s occupation, followed by education. Parent counseling and teachers contribute very little.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/etasq.html">etasq</a></span><span class="op">(</span><span class="va">school.mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;             eta^2</span></span>
<span><span class="co">#&gt; education  0.3756</span></span>
<span><span class="co">#&gt; occupation 0.5666</span></span>
<span><span class="co">#&gt; visit      0.2603</span></span>
<span><span class="co">#&gt; counseling 0.0647</span></span>
<span><span class="co">#&gt; teacher    0.0491</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section></section><section id="model-diagnostics-for-mlms" class="level2" data-number="10.6"><h2 data-number="10.6" class="anchored" data-anchor-id="model-diagnostics-for-mlms">
<span class="header-section-number">10.6</span> Model diagnostics for MLMs</h2>
<p>Model building, visualization and interpretation is often an iterative process. You fit a model and calculate some goodness of fit measures (<span class="math inline">\(R^2\)</span> for responses, <span class="math inline">\(\eta^2\)</span> for predictors). If these are reasonably strong, you feel happy and proceed to graphical displays to help you understand what you’ve found and explain it to others.</p>
<p>But <strong>wait</strong>: did you check the assumptions of the MLM? As in univariate models, diagnostic plots can help you spot problems in the data (unusual cases) or in the model (nonlinear relations, omitted predictors or interactions). You sometimes need to go circle back and fit a revised model, starting the process again.</p>
<!-- Among the MLM assumptions, the question of homogeneity of covariance matrices is deferred until -->
<!-- @sec-eqcov.  -->
<p>For multivariate regression models, I consider the assumed multivariate normality of residuals and multivariate influence here.</p>
<section id="multivariate-normality-of-residuals" class="level3" data-number="10.6.1"><h3 data-number="10.6.1" class="anchored" data-anchor-id="multivariate-normality-of-residuals">
<span class="header-section-number">10.6.1</span> Multivariate normality of residuals</h3>
<p>One easy thing to do is to check for multivariate normality of the residuals. Given that we found a few noteworthy points in <a href="#fig-schooldata-cqplot" class="quarto-xref">Figure&nbsp;<span>10.13</span></a>, a <span class="math inline">\(\chi^2\)</span> QQ plot of the residuals in the model will tell us if any of these are really problematic. The pattern of points relative to the confidence band gives a rough indication of overall multivariate normality.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/cqplot.html">cqplot</a></span><span class="op">(</span><span class="va">school.mod</span>, id.n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-schoolmod-cqplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-schoolmod-cqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-schoolmod-cqplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-schoolmod-cqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.15: <span class="math inline">\(\chi^2\)</span> QQ plot of the residuals in the <code>schooldat</code> multivariate regression model.
</figcaption></figure>
</div>
</div>
</div>
<p>So, you can see that among the cases that stood out in the <code><a href="https://friendly.github.io/heplots/reference/cqplot.html">cqplot()</a></code> of the observed variables (<a href="#fig-schooldata-cqplot" class="quarto-xref">Figure&nbsp;<span>10.13</span></a>), only case 35 attracts attention here, and it is well within the confidence band. Case 59, which was the largest in all the pairwise scatterplots (<a href="#fig-schooldata-scats" class="quarto-xref">Figure&nbsp;<span>10.14</span></a>) seems not unusual in the fitted model. It is a high-leverage point, but appeared to be well-fitted in all the simple regressions, except in those for <code>teacher</code>.</p>
<p>It is useful to contrast this with what we get from formal tests that the residuals are <em>strictly</em> multivariate normal. The <span style="color: brown;"><strong>MVN</strong></span> package <span class="citation" data-cites="R-MVN">(<a href="95-references.html#ref-R-MVN" role="doc-biblioref">Korkmaz et al., 2025</a>)</span> provides <code><a href="https://rdrr.io/pkg/MVN/man/mvn.html">mvn()</a></code> for this, which performs a wide variety of normality tests. The most widely used of these is due to <span class="citation" data-cites="Mardia:1974">Mardia (<a href="95-references.html#ref-Mardia:1974" role="doc-biblioref">1974</a>)</span>, which gives multivariate tests of skewness (lack of symmetry) and kurtosis (length of the tails).</p>
<p>Applying this to the <strong>residuals</strong> from the schools multivariate regression shows that multivariate normality is rejected here. Based on other evidence, this doesn’t seem particularly troubling.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">school.mvn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MVN/man/mvn.html">mvn</a></span><span class="op">(</span><span class="va">residuals</span>, mvn_test <span class="op">=</span> <span class="st">"mardia"</span><span class="op">)</span></span>
<span><span class="co"># print multivariate and univariate tests</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">school.mvn</span>, select <span class="op">=</span> <span class="st">"mvn"</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Test Statistic p.value     Method      MVN</span></span>
<span><span class="co">#&gt; 1 Mardia Skewness      1.92   0.750 asymptotic ✓ Normal</span></span>
<span><span class="co">#&gt; 2 Mardia Kurtosis     -1.16   0.244 asymptotic ✓ Normal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">school.mvn</span>, select <span class="op">=</span> <span class="st">"univariate"</span><span class="op">)</span></span>
<span><span class="co">#&gt;               Test Variable Statistic p.value Normality</span></span>
<span><span class="co">#&gt; 1 Anderson-Darling    start     0.307   0.524  ✓ Normal</span></span>
<span><span class="co">#&gt; 2 Anderson-Darling   amount     0.625   0.085  ✓ Normal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/pkg/MVN/man/mvn.html">mvn()</a></code> also provides a variety of tests for univariate normality for each of the response variables. These are all OK.</p>
</section><section id="multivariate-influence" class="level3" data-number="10.6.2"><h3 data-number="10.6.2" class="anchored" data-anchor-id="multivariate-influence">
<span class="header-section-number">10.6.2</span> Multivariate influence</h3>
<p>Again, what we see in simple scatterplots can be misleading because they ignore all the other variables in a model. But looking back after fitting a model and examining diagnostic plots can often be illuminating. Among the ideas we inherit from univariate models, the influence of particular observations on the results of analysis should be high on your list.</p>
<p>The multivariate extension of the diagnostic measures of leverage and influence, and influence plots (<a href="06-linear_models-plots.html#sec-leverage" class="quarto-xref"><span>Section 6.6</span></a>) is provided by the <span style="color: brown;"><strong>mvinfluence</strong></span> package <span class="citation" data-cites="R-mvinfluence">(<a href="95-references.html#ref-R-mvinfluence" role="doc-biblioref">Friendly, 2025</a>)</span>. The theory behind this is due to <span class="citation" data-cites="BarrettLing:92">Barrett &amp; Ling (<a href="95-references.html#ref-BarrettLing:92" role="doc-biblioref">1992</a>)</span> and better illustrated in <span class="citation" data-cites="Barrett:2003">Barrett (<a href="95-references.html#ref-Barrett:2003" role="doc-biblioref">2003</a>)</span>. Mathematical details of this generalization are given in <code><a href="http://friendly.github.io/mvinfluence/reference/mvinfluence-package.html">help("mvinfluence-package")</a></code>.</p>
<p><a href="#fig-schoolmod-infl" class="quarto-xref">Figure&nbsp;<span>10.16</span></a> shows one form of an influence plot for the <code>school.mod</code> model. Because multiple response variables are involved, this plots a measure of the <em>squared</em> studentized residuals for each observation against a generalized version of hat values, so potentially “bad” observations appear in the upper left corner. The size of the bubble symbol is proportional to a generalization of Cook’s distance, the measure of influence based on the change in all coefficients if each case was deleted from the analysis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb55" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/influencePlot.html">influencePlot</a></span><span class="op">(</span><span class="va">school.mod</span>, id.n<span class="op">=</span><span class="fl">4</span>, </span>
<span>              type<span class="op">=</span><span class="st">"stres"</span>,</span>
<span>              cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co">#&gt;        H      Q  CookD     L      R</span></span>
<span><span class="co">#&gt; 33 0.328 0.2017 0.7054 0.488 0.3001</span></span>
<span><span class="co">#&gt; 35 0.101 0.2825 0.3038 0.112 0.3142</span></span>
<span><span class="co">#&gt; 44 0.503 0.2984 1.6022 1.014 0.6009</span></span>
<span><span class="co">#&gt; 59 0.568 0.4937 2.9938 1.317 1.1441</span></span>
<span><span class="co">#&gt; 66 0.355 0.0174 0.0657 0.551 0.0269</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-schoolmod-infl" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-schoolmod-infl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-schoolmod-infl-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-schoolmod-infl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.16: Influence plot for the <code>schooldat</code> multivariate regression model. Five cases are labeled as “noteworthy” on either axis.
</figcaption></figure>
</div>
</div>
</div>
<p>That does not look good! You can see that cases 44 and 59 are actually quite troublesome here, but it turns out for different reasons. Take another look at <a href="#fig-schooldata-scats" class="quarto-xref">Figure&nbsp;<span>10.14</span></a>. You can see that case 59 is the most extreme on all the predictors, giving it very high leverage and therefore pulling the regression lines toward it in most of the plots, except those for number of teachers, where it also has large residuals. Case 44, on the other hand, stands out as high-leverage on only a few of the predictor–response combinations, but enough to give it a large multivariate hat value. It is also a point that is furthest from the regression lines.</p>
<p>What should be done? An appropriate action would be to re-fit the model, reducing the impact of these cases, in what I call a <strong>sensitivity test</strong>:</p>
<ul>
<li>Do the main conclusions change with those cases removed? That is, do any model terms change in significance tests or do coefficients change sign?</li>
<li>Do the relative sizes of effects for predictors change enough to affect interpretation? That is, how much do the coefficients change?</li>
</ul>
<p>The easiest solution is to just omit these troubling cases. You can do this using <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code>, specifying the <code>data</code> argument to be the subset of rows without the bad boys.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb56" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">44</span>, <span class="fl">59</span><span class="op">)</span></span>
<span><span class="va">OK</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">schooldata</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">bad</span><span class="op">)</span></span>
<span><span class="va">school.mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">school.mod</span>, data <span class="op">=</span> <span class="va">schooldata</span><span class="op">[</span><span class="va">OK</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">school.mod2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;            Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; education   1     0.211     5.35      3     60  0.0025 ** </span></span>
<span><span class="co">#&gt; occupation  1     0.422    14.62      3     60 2.9e-07 ***</span></span>
<span><span class="co">#&gt; visit       1     0.191     4.73      3     60  0.0050 ** </span></span>
<span><span class="co">#&gt; counseling  1     0.053     1.13      3     60  0.3459    </span></span>
<span><span class="co">#&gt; teacher     1     0.064     1.37      3     60  0.2618    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results of <code><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova()</a></code> on this model tell us that the three significant predictors— occupation, education and visit— are still so, but slightly less so for the last two of these. To compare the coefficients in the new model compared to the old you can calculate the <em>relative difference</em>, <span class="math inline">\(| \mathbf{B}_1 - \mathbf{B}_2 | / \mathbf{B}_1\)</span>, which are</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reldiff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">pct</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="va">x</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">pct</span><span class="op">)</span> <span class="va">res</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">res</span></span>
<span>  <span class="va">res</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">reldiff</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">school.mod</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">school.mod2</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;            reading mathematics selfesteem</span></span>
<span><span class="co">#&gt; education     10.1        19.8      -75.7</span></span>
<span><span class="co">#&gt; occupation    11.0        10.2       19.4</span></span>
<span><span class="co">#&gt; visit       -103.6       -76.8        2.8</span></span>
<span><span class="co">#&gt; counseling  -332.2       305.3     -115.4</span></span>
<span><span class="co">#&gt; teacher       -7.5        -5.6        7.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see, the effects on the coefficients for <code>visit</code> and counseling` are dramatic.</p>
</section></section><section id="sec-ANCOVA-MANCOVA" class="level2" data-number="10.7"><h2 data-number="10.7" class="anchored" data-anchor-id="sec-ANCOVA-MANCOVA">
<span class="header-section-number">10.7</span> ANCOVA <span class="math inline">\(\rightarrow\)</span> MANCOVA</h2>
<p><strong>TODO</strong>: Consider moving this to <a href="11-mlm-viz.html" class="quarto-xref"><span>Chapter 11</span></a> and use much of the heplots MMRA vignette.</p>
<p>In univariate linear models, analysis of covariance (ANCOVA) is most often used in a situation where we want to compare the mean response, <span class="math inline">\(\bar{y}_j\)</span> for different groups (defined by one or more factors), but where there are one or more quantitative predictors <span class="math inline">\(\mathbf{x}_1, \dots\)</span> that should be taken into account for our comparisons to make sense. The simplest case is when <span class="math inline">\(\mathbf{x}\)</span> is a pre-test score on the same measure, or when it is a background measure like age or level of education that we want to control for, to adjust for differences among the groups.</p>
<p>More generally, ANCOVA and its’ multivariate MANCOVA brother are used for situations where the model matrix <span class="math inline">\(\mathbf{X}\)</span> contains a mixture of factor variables and quantitative predictors, called “covariates”. In this wider context, there are two flavors of analysis with different emphasis on the factors or the covariates:</p>
<ul>
<li><p><strong>true ANCOVA/MANOVA</strong>: Attention is centered on the differences between the group means, but controlling for any difference in the covariate(s). This requires assuming that the slopes for the groups are all the same.</p></li>
<li><p><strong>homogeneity of regression</strong>: Here the focus is on the regression relations between the <span class="math inline">\(\mathbf{y}\)</span>s and the predictor <span class="math inline">\(\mathbf{x}\)</span>s, but we might also want to determine if the regression slopes are the same for all groups defined by the factors.</p></li>
</ul>
<p>In the ANCOVA flavor, the model fits additive effects of the group factor(s) and the covariate(s), while the homogeneity of regression flavor adds interaction terms between groups and the <span class="math inline">\(\mathbf{x}\)</span>s. The test for homogeneity of regression is the added effect of the interaction terms:</p>
<pre data-code-line-numbers=""><code>mod1 &lt;- lm(y ~ Group + x)            # ANCOVA model
mod2 &lt;- lm(y ~ Group + x + Group:x)  # allow separate slopes
mod2 &lt;- lm(y ~ Group * x)            # same as above

anova(mod1, mod2)            # test homogeneity of regression</code></pre>
<!-- **TODO**: Complete this, explaining how MANCOVA requires equal slopes for covariates, while homogeneity of regression tests that. ... -->
<p><a href="#fig-ANCOVA-ex" class="quarto-xref">Figure&nbsp;<span>10.17</span></a> illustrates these cases for a hypothetical two-group design studying the the effect of an exercise program treatment on weight, recorded pre- (<span class="math inline">\(x\)</span>) and post- (<span class="math inline">\(y\)</span>) compared to a control group given no treatment. In panel (a) the slopes for the two groups are approximately equal, so the effect of treatment can be estimated by the difference in the fitted values of <span class="math inline">\(\hat{y}_i\)</span> at the average value of <span class="math inline">\(x\)</span>. In panel (b), the slope for the treated group is considerably greater than that for the control group, so the difference between the groups varies with <span class="math inline">\(x\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ANCOVA-ex" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ANCOVA-ex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/ANCOVA-ex.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ANCOVA-ex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.17: Two possible outcome patterns for a two-group design assessing the effect of a treatment on weight, measured pre- and post-treatment. (a) Additive effects of Group and <span class="math inline">\(x\)</span>; (b) Different slopes for the two groups. Plus signs show the means <span class="math inline">\((\bar{x}_i, \bar{y}_i)\)</span> for the two groups.
</figcaption></figure>
</div>
</div>
</div>
<!-- Useful univariate example: 
data('teengamb', package='faraway')
Analysis in https://bookdown.org/dereksonderegger/571/5-ANCOVA-Chapter.html
-->
<section id="sec-PA-tasks" class="level3" data-number="10.7.1"><h3 data-number="10.7.1" class="anchored" data-anchor-id="sec-PA-tasks">
<span class="header-section-number">10.7.1</span> Example: Paired-associate tasks and academic performance</h3>
<p>To what extent can simple tests of paired-associate learning<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> predict measures of aptitude and achievement in kindergarten children? This was the question behind an experiment by William Rohwer at the University of California, Berkeley.</p>
<p>There were three outcome measures, one verbal and two visually-based:</p>
<ul>
<li>A student achievement test (<code>SAT</code>),</li>
<li>Peabody Picture Vocabulary test (<code>PPVT</code>),</li>
<li>Raven Progressive Matrices test (<code>Raven</code>).</li>
</ul>
<p>Four paired-associate tasks were used, which differed in the syntactic and semantic relationship between the stimulus and response terms in each pair. These are called <em>named</em> (<code>n</code>), <em>still</em> (<code>s</code>), <em>named still</em> (<code>ns</code>), <em>named action</em> (<code>na</code>), and <em>sentence still</em> (<code>ss</code>).</p>
<p>Rohwer’s data, taken from <span class="citation" data-cites="Timm:75">Timm (<a href="95-references.html#ref-Timm:75" role="doc-biblioref">1975</a>)</span>, is given in <code>Rohwer</code>. But there’s a MANCOVA wrinkle: Performance on the academic tasks is well-known to vary with socioeconomic status of the parents or the school they attend. A simple design was to collect data from children in two schools, one in a low SES neighborhood (<span class="math inline">\(n=37\)</span>) and the other an upper-class high SES one (<span class="math inline">\(n=32\)</span>). The data look like this:</p>
<!-- Rohwer & PA tasks: track down a reference, and the PA tasks, n, na, ss, ... 
See: https://files.eric.ed.gov/fulltext/ED053807.pdf.
Maybe its:
Rohwer, W.D., Jr., & Levin, J.R. Action, meaning and stimulus selection
in paired-associate learning. Journal
of Verbal Learning and Verbal Behavior,
1968, 7: 137-141.
-->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Rohwer</span>, package <span class="op">=</span> <span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">Rohwer</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt;    group SES SAT PPVT Raven n  s ns na ss</span></span>
<span><span class="co">#&gt; 49     2  Hi  88  105    21 2 11 10 26 22</span></span>
<span><span class="co">#&gt; 65     2  Hi  50   96    13 5  8 20 28 26</span></span>
<span><span class="co">#&gt; 25     1  Lo   6   57    10 0  1 16 15 17</span></span>
<span><span class="co">#&gt; 18     1  Lo  45   54    10 0  6  6 14 16</span></span>
<span><span class="co">#&gt; 69     2  Hi  50   78    19 5 10 18 27 26</span></span>
<span><span class="co">#&gt; 64     2  Hi  24  102    16 4 17 21 27 31</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Following the scheme for reshaping the data used in <a href="#fig-schooldata-scats" class="quarto-xref">Figure&nbsp;<span>10.14</span></a>, a set of scatterplots of each predictor against each response will give a useful initial look at the data. There’s a lot to see here, so the plot in <a href="#fig-Rohwer-scats" class="quarto-xref">Figure&nbsp;<span>10.18</span></a> focuses attention on the regression lines for the two groups and their data ellipses.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb60" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">yvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SAT"</span>, <span class="st">"PPVT"</span>, <span class="st">"Raven"</span> <span class="op">)</span>      <span class="co"># outcome variables</span></span>
<span><span class="va">xvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"s"</span>, <span class="st">"ns"</span>, <span class="st">"na"</span>, <span class="st">"ss"</span><span class="op">)</span>   <span class="co"># predictors</span></span>
<span></span>
<span><span class="va">Rohwer_long</span> <span class="op">&lt;-</span> <span class="va">Rohwer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">xvars</span><span class="op">)</span>, </span>
<span>                      names_to <span class="op">=</span> <span class="st">"xvar"</span>, values_to <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">yvars</span><span class="op">)</span>, </span>
<span>                      names_to <span class="op">=</span> <span class="st">"yvar"</span>, values_to <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">xvar</span>, levels <span class="op">=</span> <span class="va">xvars</span><span class="op">)</span>,</span>
<span>                yvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">yvar</span>, levels <span class="op">=</span> <span class="va">yvars</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Rohwer_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">SES</span>, shape <span class="op">=</span> <span class="va">SES</span>, fill <span class="op">=</span> <span class="va">SES</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>              se <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, </span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predictor (PA task)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Response (Academic)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">yvar</span> <span class="op">~</span> <span class="va">xvar</span>,            <span class="co"># plot matrix of Y by X</span></span>
<span>             scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-Rohwer-scats" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Rohwer-scats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-Rohwer-scats-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Rohwer-scats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.18: Scatterplots of each of the three response variables against each of the five predictors in the <code>Rohwer</code> dataset.
</figcaption></figure>
</div>
</div>
</div>
<p>You can see here that the high-SES group generally performs better than the low group. The regression lines have similar slopes in some of the panels, but not all. The low SES group also appears to have larger variance on most of the PA tasks.</p>
<section id="mancova-model" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="mancova-model">MANCOVA model</h4>
<p>Nevertheless, I fit the MANCOVA model that allows a test of different means for the two SES groups on the responses, but constrains the slopes for the PA covariates to be equal. Only two of the PA tasks (<code>na</code> and <code>ns</code>) show individually significant effects in the multivariate tests.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb61" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make SES == 'Lo' the reference category</span></span>
<span><span class="va">Rohwer</span><span class="op">$</span><span class="va">SES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="va">Rohwer</span><span class="op">$</span><span class="va">SES</span>, ref <span class="op">=</span> <span class="st">"Lo"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Rohwer.mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">SAT</span>, <span class="va">PPVT</span>, <span class="va">Raven</span><span class="op">)</span> <span class="op">~</span> <span class="va">SES</span> <span class="op">+</span> <span class="va">n</span> <span class="op">+</span> <span class="va">s</span> <span class="op">+</span> <span class="va">ns</span> <span class="op">+</span> <span class="va">na</span> <span class="op">+</span> <span class="va">ss</span>, </span>
<span>                  data<span class="op">=</span><span class="va">Rohwer</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">Rohwer.mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;     Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; SES  1     0.379    12.18      3     60 2.5e-06 ***</span></span>
<span><span class="co">#&gt; n    1     0.040     0.84      3     60  0.4773    </span></span>
<span><span class="co">#&gt; s    1     0.093     2.04      3     60  0.1173    </span></span>
<span><span class="co">#&gt; ns   1     0.193     4.78      3     60  0.0047 ** </span></span>
<span><span class="co">#&gt; na   1     0.231     6.02      3     60  0.0012 ** </span></span>
<span><span class="co">#&gt; ss   1     0.050     1.05      3     60  0.3770    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also examine the tests of the univariate ANCOVA models for each of the responses using <code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code> or <code><a href="https://friendly.github.io/heplots/reference/uniStats.html">heplots::uniStats()</a></code>. All are significantly related, but the <code>PPVT</code> measure has the largest <span class="math inline">\(R^2\)</span> by far.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb62" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/uniStats.html">uniStats</a></span><span class="op">(</span><span class="va">Rohwer.mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate tests for responses in the multivariate linear model Rohwer.mod1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         R^2     F df1 df2 Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; SAT   0.295  4.33   6  62  0.001 ** </span></span>
<span><span class="co">#&gt; PPVT  0.628 17.47   6  62  1e-11 ***</span></span>
<span><span class="co">#&gt; Raven 0.211  2.76   6  62  0.019 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To help interpret these effects, bivariate coefficient plots for the paired associate tasks are shown in <a href="#fig-rohwer-mod1-coef" class="quarto-xref">Figure&nbsp;<span>10.19</span></a>. (The coefficients for the group variable <code>SES</code> are on a different scale and so are omitted here.) From this you can see that the named still and named action tasks have opposite signs: contrary to expectations, <code>ns</code> is negatively associated with the measures of aptitude and achievement (when the other predictors are adjusted for).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb63" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/coefplot.html">coefplot</a></span><span class="op">(</span><span class="va">Rohwer.mod1</span>, parm <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>         fill <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         level <span class="op">=</span> <span class="fl">0.68</span>,</span>
<span>         cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://friendly.github.io/heplots/reference/coefplot.html">coefplot</a></span><span class="op">(</span><span class="va">Rohwer.mod1</span>, parm <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>         fill <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         level <span class="op">=</span> <span class="fl">0.68</span>,</span>
<span>         cex.lab <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rohwer-mod1-coef" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-rohwer-mod1-coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figs/ch10/fig-rohwer-mod1-coef-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rohwer-mod1-coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.19: Bivariate coefficient plots for the MANCOVA model with confidence ellipses of 68% coverage.
</figcaption></figure>
</div>
</div>
</div>
<p><strong>TODO</strong>: For interpretation, it would be nice to know how many items were used for each of the PA tasks. The range of <code>na</code> goes up to 35, but others are less.</p>
</section><section id="adjusted-means" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="adjusted-means">Adjusted means</h4>
<p>From the analysis of covariance perspective, interest is often centered on estimating the differences between the group means, but adjusting or controlling for differences on the covariates. From the table of means below, you can see that the high SES group performs better on all three response variables, but this group also has higher scores on the paired associate tasks.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb64" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">means</span> <span class="op">&lt;-</span> <span class="va">Rohwer</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SES</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 10</span></span>
<span><span class="co">#&gt;   SES   group   SAT  PPVT Raven     n     s    ns    na    ss</span></span>
<span><span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Lo        1  31.3  62.6  13.2  2.54  6.92  13.5  22.4  18.4</span></span>
<span><span class="co">#&gt; 2 Hi        2  47.7  83.1  15    4.59  7.25  14.5  24.3  21.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The adjusted mean differences are simply the values estimated by the coefficients for <code>SES</code> in the model. These are smaller than the differences between the observed means.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb65" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">means</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">-</span> <span class="va">means</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>  </span>
<span><span class="co">#&gt;    SAT PPVT Raven</span></span>
<span><span class="co">#&gt; 1 16.4 20.4  1.76</span></span>
<span></span>
<span><span class="co"># adjusted means</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">Rohwer.mod1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;   SAT  PPVT Raven </span></span>
<span><span class="co">#&gt;  8.80 16.88  1.59</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>TODO</strong>: do this with a CI for the effects</p>
</section><section id="homogeneity-of-regression" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="homogeneity-of-regression">Homogeneity of regression</h4>
<p>The MANCOVA model, <code>Rohwer.mod1</code>, has relatively simple interpretations (a large effect of <code>SES</code>, with <code>ns</code> and <code>na</code> as the major predictors) but the test of the <code>SES</code> effect relies on the assumption of homogeneity of slopes for the predictors. We can test this assumption as follows, by adding interactions of <code>SES</code> with each of the covariates:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb66" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Rohwer.mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">SAT</span>, <span class="va">PPVT</span>, <span class="va">Raven</span><span class="op">)</span> <span class="op">~</span> <span class="va">SES</span> <span class="op">*</span> <span class="op">(</span><span class="va">n</span> <span class="op">+</span> <span class="va">s</span> <span class="op">+</span> <span class="va">ns</span> <span class="op">+</span> <span class="va">na</span> <span class="op">+</span> <span class="va">ss</span><span class="op">)</span>,</span>
<span>                  data<span class="op">=</span><span class="va">Rohwer</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">Rohwer.mod2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;        Df test stat approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; SES     1     0.391    11.78      3     55 4.5e-06 ***</span></span>
<span><span class="co">#&gt; n       1     0.079     1.57      3     55 0.20638    </span></span>
<span><span class="co">#&gt; s       1     0.125     2.62      3     55 0.05952 .  </span></span>
<span><span class="co">#&gt; ns      1     0.254     6.25      3     55 0.00100 ***</span></span>
<span><span class="co">#&gt; na      1     0.307     8.11      3     55 0.00015 ***</span></span>
<span><span class="co">#&gt; ss      1     0.060     1.17      3     55 0.32813    </span></span>
<span><span class="co">#&gt; SES:n   1     0.072     1.43      3     55 0.24417    </span></span>
<span><span class="co">#&gt; SES:s   1     0.099     2.02      3     55 0.12117    </span></span>
<span><span class="co">#&gt; SES:ns  1     0.118     2.44      3     55 0.07383 .  </span></span>
<span><span class="co">#&gt; SES:na  1     0.148     3.18      3     55 0.03081 *  </span></span>
<span><span class="co">#&gt; SES:ss  1     0.057     1.12      3     55 0.35094    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It appears from the above that there is only weak evidence of unequal slopes from the separate <code>SES:</code> terms; only that for <code>SES:na</code> is individually significant. The evidence for heterogeneity is stronger, however, when these terms are tested <em>collectively</em> using <code><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis()</a></code>. I use a small <code><a href="https://rdrr.io/r/base/grep.html">grep()</a></code> trick here to find the interaction terms, which have a “:” in their names.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb67" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># test interaction terms jointly</span></span>
<span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">Rohwer.mod2</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">interactions</span> <span class="op">&lt;-</span> <span class="va">coefs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">":"</span>, <span class="va">coefs</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/linearHypothesis.html">linearHypothesis</a></span><span class="op">(</span><span class="va">Rohwer.mod2</span>, <span class="va">interactions</span><span class="op">)</span>, SSP<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Tests: </span></span>
<span><span class="co">#&gt;                  Df test stat approx F num Df den Df Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; Pillai            5     0.418     1.85     15    171 0.0321 * </span></span>
<span><span class="co">#&gt; Wilks             5     0.624     1.89     15    152 0.0277 * </span></span>
<span><span class="co">#&gt; Hotelling-Lawley  5     0.539     1.93     15    161 0.0240 * </span></span>
<span><span class="co">#&gt; Roy               5     0.385     4.38      5     57 0.0019 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="separate-models" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="separate-models">Separate models</h4>
<p>Model <code>Rohwer.mod2</code> with all interaction terms essentially fits a separate slope for each of the low and high SES groups for all responses with each of the predictor PA tasks. This is similar in spirit to what we would get if we fit a separate multivariate regression model for each of the groups, but parameterized differently: The heterogeneous regression model gives, for the interaction terms estimates of the difference in slopes between groups, while the separate-regressions approach gives separate slope estimates for each of the groups. These are equivalent, in the sense that the estimates for each approach can be derived from the other.</p>
<p>They are not equivalent in testing however, because the full model uses a combined pooled within-group error covariance, allows hypotheses about equality of slopes and intercepts to be tested directly and has greater power because it uses the total sample size. Here, I simply illustrate the mechanics of fitting separate models using the <code>subset</code> argument to <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Rohwer.sesHi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">SAT</span>, <span class="va">PPVT</span>, <span class="va">Raven</span><span class="op">)</span> <span class="op">~</span> <span class="va">n</span> <span class="op">+</span> <span class="va">s</span> <span class="op">+</span> <span class="va">ns</span> <span class="op">+</span> <span class="va">na</span> <span class="op">+</span> <span class="va">ss</span>, </span>
<span>                   data<span class="op">=</span><span class="va">Rohwer</span>, subset <span class="op">=</span> <span class="va">SES</span><span class="op">==</span><span class="st">"Hi"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">Rohwer.sesHi</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;    Df test stat approx F num Df den Df Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; n   1     0.202     2.02      3     24 0.1376   </span></span>
<span><span class="co">#&gt; s   1     0.310     3.59      3     24 0.0284 * </span></span>
<span><span class="co">#&gt; ns  1     0.358     4.46      3     24 0.0126 * </span></span>
<span><span class="co">#&gt; na  1     0.465     6.96      3     24 0.0016 **</span></span>
<span><span class="co">#&gt; ss  1     0.089     0.78      3     24 0.5173   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span></span>
<span><span class="va">Rohwer.sesLo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">SAT</span>, <span class="va">PPVT</span>, <span class="va">Raven</span><span class="op">)</span> <span class="op">~</span> <span class="va">n</span> <span class="op">+</span> <span class="va">s</span> <span class="op">+</span> <span class="va">ns</span> <span class="op">+</span> <span class="va">na</span> <span class="op">+</span> <span class="va">ss</span>, </span>
<span>                   data<span class="op">=</span><span class="va">Rohwer</span>, subset <span class="op">=</span> <span class="va">SES</span><span class="op">==</span><span class="st">"Lo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">Rohwer.sesLo</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">#&gt;    Df test stat approx F num Df den Df Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; n   1    0.0384     0.39      3     29  0.764  </span></span>
<span><span class="co">#&gt; s   1    0.1118     1.22      3     29  0.321  </span></span>
<span><span class="co">#&gt; ns  1    0.2252     2.81      3     29  0.057 .</span></span>
<span><span class="co">#&gt; na  1    0.2675     3.53      3     29  0.027 *</span></span>
<span><span class="co">#&gt; ss  1    0.1390     1.56      3     29  0.220  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The strength of evidence for the predictors <code>na</code> and <code>ns</code> is weaker here than when tested in the full heterogeneous model.</p>
<!--
## Repeated measures designs

**TODO**: Include this, if at all, for the multivariate formulation of repeated measures...

Of all the assumptions described in @sec-mlm-assumptions the most fundamental is that
of independence of the observations: There are no reasons to suspect that knowing the
scores of subject $i$ tells you anything about subject $j$, so that their residuals
$\epsilon_i$ and $\epsilon_j$ are uncorrelated. 

That assumption goes out the window in so-called _repeated measures designs_, where each person
is observed on the same task(s) over as series of trials, that vary by time or circumstance.
-->
</section></section></section><section id="what-weve-learned" class="level2" data-number="10.8"><h2 data-number="10.8" class="anchored" data-anchor-id="what-weve-learned">
<span class="header-section-number">10.8</span> What we’ve learned</h2>
<ul>
<li><p>The multivariate linear model is an extension of the (univariate) general linear model. Three major forms of the multivariate linear model are the MANOVA, MMRA and MANCOVA, all of which have their equivalents in ANOVA, MRA and ANCOVA.</p></li>
<li><p>What the multivariate linear model offers over the univariate linear model is not just more powerful statistical tests, but also examinations of how the associations amongst the response variables varies with the explanatory variables.</p></li>
<li><p>Just as with the general linear model, model diagnostics transfer to the multivariate linear model and are important for identifying potential issues in the validity of the estimated statistical model.</p></li>
<li><p>Given that the multivariate linear model can do everything that the general linear model does, there is no reason to not consider the multivariate linear model. Confining discussions of multivariate response models to structural equation modeling may pedagogically create a cognitive blind spot that the association amongst response variables even <em>can</em> vary with the explanatory variables. Rather than something separate, for the purposes of causal inference, it would be better to use structural equation modeling as a more confirmatory statistical model than the multivariate linear model, which is perfectly well suited for exploratory purposes.</p></li>
<li><p>Overall, we also see a glimpse of the importance of data visualization in the analysis of data using the multivariate linear model. The following chapter will explore this issue in more depth.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<p><strong>Packages used here</strong>:</p>
<p>13 packages used here: broom, car, carData, dplyr, ggplot2, ggrepel, heplots, knitr, matlib, mvinfluence, MVN, patchwork, tidyr</p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Barrett:2003" class="csl-entry" role="listitem">
Barrett, B. E. (2003). Understanding influence in multivariate regression. <em>Communications in Statistics - Theory and Methods</em>, <em>32</em>(3), 667–680. <a href="https://doi.org/10.1081/STA-120018557">https://doi.org/10.1081/STA-120018557</a>
</div>
<div id="ref-BarrettLing:92" class="csl-entry" role="listitem">
Barrett, B. E., &amp; Ling, R. F. (1992). General classes of influence measures for multivariate regression. <em>Journal of the American Statistical Association</em>, <em>87</em>(417), 184–191. <a href="https://www.jstor.org/stable/i314301">https://www.jstor.org/stable/i314301</a>
</div>
<div id="ref-Charnes-etal-1981" class="csl-entry" role="listitem">
Charnes, A., Cooper, W. W., &amp; Rhodes, E. (1981). Evaluating program and managerial efficiency: An application of data envelopment analysis to program follow through. <em>Management Science</em>, <em>27</em>(6), 668–697. <a href="http://www.jstor.org/stable/2631155">http://www.jstor.org/stable/2631155</a>
</div>
<div id="ref-R-mvinfluence" class="csl-entry" role="listitem">
Friendly, M. (2025). <em>Mvinfluence: Influence measures and diagnostic plots for multivariate linear models</em>. <a href="https://github.com/friendly/mvinfluence">https://github.com/friendly/mvinfluence</a>
</div>
<div id="ref-FriendlyMeyer:2016:DDAR" class="csl-entry" role="listitem">
Friendly, M., &amp; Meyer, D. (2016). <em>Discrete data analysis with <span>R</span>: Visualization and modeling techniques for categorical and count data</em>. Chapman &amp; Hall/CRC.
</div>
<div id="ref-Friendly-etal:ellipses:2013" class="csl-entry" role="listitem">
Friendly, M., Monette, G., &amp; Fox, J. (2013). Elliptical insights: Understanding statistical methods through elliptical geometry. <em>Statistical Science</em>, <em>28</em>(1), 1–39. <a href="https://doi.org/10.1214/12-STS402">https://doi.org/10.1214/12-STS402</a>
</div>
<div id="ref-Harrell2015RMS" class="csl-entry" role="listitem">
Harrell, F. E. (2015). <em>Regression modeling strategies: With applications to linear models, logistic and ordinal regression, and survival analysis</em>. Springer International Publishing. <a href="https://books.google.ca/books?id=sQ90rgEACAAJ">https://books.google.ca/books?id=sQ90rgEACAAJ</a>
</div>
<div id="ref-Huang2019" class="csl-entry" role="listitem">
Huang, F. L. (2019). <span>MANOVA</span>: A procedure whose time has passed? <em>Gifted Child Quarterly</em>, <em>64</em>(1), 56–60. <a href="https://doi.org/10.1177/0016986219887200">https://doi.org/10.1177/0016986219887200</a>
</div>
<div id="ref-Huberty-Morris1989" class="csl-entry" role="listitem">
Huberty, C. J., &amp; Morris, J. D. (1989). Multivariate analysis versus multiple univariate analyses. <em>Psychological Bulletin</em>, <em>105</em>(2), 302–308. <a href="https://doi.org/10.1037/0033-2909.105.2.302">https://doi.org/10.1037/0033-2909.105.2.302</a>
</div>
<div id="ref-R-MVN" class="csl-entry" role="listitem">
Korkmaz, S., Goksuluk, D., &amp; Zararsiz, G. (2025). <em>MVN: Multivariate normality tests</em>. <a href="https://selcukorkmaz.github.io/mvn-tutorial/">https://selcukorkmaz.github.io/mvn-tutorial/</a>
</div>
<div id="ref-Mardia:1970:MMS" class="csl-entry" role="listitem">
Mardia, K. V. (1970). Measures of multivariate skewness and kurtosis with applications. <em>Biometrika</em>, <em>57</em>(3), 519–530. https://doi.org/<a href="http://dx.doi.org/10.2307/2334770">http://dx.doi.org/10.2307/2334770</a>
</div>
<div id="ref-Mardia:1974" class="csl-entry" role="listitem">
Mardia, K. V. (1974). Applications of some measures of multivariate skewness and kurtosis in testing normality and robustness studies. <em>Sankhya: The Indian Journal of Statistics, Series B</em>, <em>36</em>(2), 115–128. <a href="http://www.jstor.org/stable/25051892">http://www.jstor.org/stable/25051892</a>
</div>
<div id="ref-Meyers-etal:2006" class="csl-entry" role="listitem">
Meyers, L. S., Gamst, G., &amp; Guarino, A. J. (2006). <em>Applied multivariate research: Design and interpretation</em>. SAGE Publications.
</div>
<div id="ref-ShapiroWilk1965" class="csl-entry" role="listitem">
Shapiro, S. S., &amp; Wilk, M. B. (1965). An analysis of variance test for normality (complete samples). <em>Biometrika</em>, <em>52</em>(3–4), 591–611. <a href="https://doi.org/10.1093/biomet/52.3-4.591">https://doi.org/10.1093/biomet/52.3-4.591</a>
</div>
<div id="ref-Tibshriani:regr:1996" class="csl-entry" role="listitem">
Tibshirani, R. (1996). Regression shrinkage and selection via the lasso. <em>Journal of the Royal Statistical Society, Series B: Methodological</em>, <em>58</em>, 267–288.
</div>
<div id="ref-Timm:75" class="csl-entry" role="listitem">
Timm, N. H. (1975). <em>Multivariate analysis with applications in education and psychology</em>. Wadsworth (Brooks/Cole).
</div>
<div id="ref-Warne2014" class="csl-entry" role="listitem">
Warne, F. T. (2014). A primer on multivariate analysis of variance(MANOVA) for behavioral scientists. <em>Practical Assessment, Research &amp; Evaluation</em>, <em>19</em>(1). <a href="https://scholarworks.umass.edu/pare/vol19/iss1/17/">https://scholarworks.umass.edu/pare/vol19/iss1/17/</a>
</div>
<div id="ref-Yee2015" class="csl-entry" role="listitem">
Yee, T. W. (2015). <em>Vector generalized linear and additive models: With an implementation in r</em>. Springer.
</div>
<div id="ref-R-VGAM" class="csl-entry" role="listitem">
Yee, T. W. (2025). <em><span>VGAM</span>: Vector generalized linear and additive models</em>. <a href="https://CRAN.R-project.org/package=VGAM">https://CRAN.R-project.org/package=VGAM</a>
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>There’s a bit of a puzzle here, and therefore a gap in methods and therefore an opportunity. The classical linear models fit by <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> extend naturally to non-gaussian data via <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> which provides for other families (binary: Bernoulli, count data: Poisson). The standard <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> extends quite naturally to a multivariate responses. Yet the combination of these ideas— non-gaussian multivariate models— remains elusive. The <span style="color: brown;"><strong>VGAM</strong></span> (<span class="citation" data-cites="Yee2015">Yee (<a href="95-references.html#ref-Yee2015" role="doc-biblioref">2015</a>)</span>, <span class="citation" data-cites="R-VGAM">Yee (<a href="95-references.html#ref-R-VGAM" role="doc-biblioref">2025</a>)</span>) handles the bivariate cases of logistic (and probit) regression, but not much more. See <span class="citation" data-cites="FriendlyMeyer:2016:DDAR">Friendly &amp; Meyer (<a href="95-references.html#ref-FriendlyMeyer:2016:DDAR" role="doc-biblioref">2016</a>)</span>, Sec. 10.4 for an example and graphs of odds ratios in these models. There is a lot more to do on this topic.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>A slight hiccup in notation is that the <em>uppercase</em> for the Greek Beta (<span class="math inline">\(\boldsymbol{\beta}\)</span>) is the same as the uppercase Roman <span class="math inline">\(\mathbf{B}\)</span>, so I use <span class="math inline">\(\mathbf{b}_1 , \mathbf{b}_2 , \dots\)</span> below to refer to its’ columns.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>“Automatic” model selection procedures like stepwise regression, while seemingly attractive are dangerous in that can increase false positives or drop variables that should, on logical grounds, be included in the model. See <a href="https://freerangestats.info/blog/2024/09/14/stepwise">Stepwise selection of variables in regression is Evil</a> and Harrell <span class="citation" data-cites="Harrell2015RMS">(<a href="95-references.html#ref-Harrell2015RMS" role="doc-biblioref">Harrell, 2015</a>)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Other choices are possible: we could instead try to model the behavioral variables, <code>antisocial</code> and <code>hyperact</code> first, and then determine if the parental variables add appreciably to this. Modeling choices aren’t arbitrary. They should reflect the aims of a study and the story you want to tell about the result.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>In this, schools 1–49 were PFT sites and the remaining sites 50–70 were NFT. A separate dataset <code>schoolsites</code> provides other information on the schools, such as the general education style, region of the U.S., size of the city and that of the student population.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p><span style="color: brown;"><strong>GGally</strong></span> has a function <code>ggduo()</code> that does something similar, plotting each of one set of variables against another. Like <code>ggpairs()</code> it allows for generalizations of a scatterplot where combinations of discrete factors and continuous variables can be displayed with appropriate visualizations for each.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Paired-associate learning are among the simplest tests of memory and learning. The subject is given a list of pairs of words or nonsense syllables, like “banana - house” or “YYZ - Toronto” to learn. On subsequent trials she is given the stimulus term of each pair (“banana”, “YYZ”) and asked to reply with the correct response (“house”, “Toronto”).<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/friendly\.github\.io\/Vis-MLM-book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./09-hotelling.html" class="pagination-link" aria-label="Hotelling's $T^2$">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hotelling’s <span class="math inline">\(T^2\)</span></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-mlm-viz.html" class="pagination-link" aria-label="Visualizing Multivariate Models">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualizing Multivariate Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/friendly/vis-MLM-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>