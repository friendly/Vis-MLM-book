
<!-- **Packages** -->
<!-- In this chapter we use the following packages. Load them now -->
<!-- ```{r} -->
<!-- library(car) -->
<!-- library(heplots) -->
<!-- library(Hotelling) -->
<!-- library(ggplot2) -->
<!-- library(dplyr) -->
<!-- library(tidyr) -->
<!-- ``` -->

## Neuro- and Social-cognitive measures in psychiatric groups

A Ph.D. dissertation by Laura Hartman [-@Hartman:2016] at York University was designed to evaluate whether and
how clinical patients diagnosed (on the DSM-IV) as schizophrenic or with schizoaffective disorder could be
distinguished from each other and from a normal, control sample on collections of standardized
tests in the following domains:

* **Neuro-cognitive**: processing speed, attention, verbal learning, visual learning and problem solving;

* **Social-cognitive**: managing emotions, theory of mind, externalizing, personalizing bias.

The study is an important contribution to clinical research because the two diagnostic categories
are subtly different and their symptoms often overlap. Yet, theyâ€™re very different and often require different treatments. A key difference between schizoaffective disorder and schizophrenia is the prominence of mood disorder involving bipolar, manic and depressive moods.
With schizoaffective disorder, mood disorders are front and center. With schizophrenia, that is not a dominant part of the disorder, but psychotic ideation (hearing voices, seeing imaginary people) is.

### Research questions

This example is concerned with the following substantitive questions:

* To what extent can patients diagnosed as schizophrenic or with schizoaffective disorder  be distinguished from each other and from a normal control sample using a well-validated, comprehensive neurocognitive battery specifically designed for individuals with psychosis  [@Heinrichs-etal:2015] ?

* If the groups differ, do any of the cognitive domains show particularly larger or smaller differences among these groups? 

* Do the neurocognitive measures discriminate among the in the same or different ways?
If different, how many separate aspects or dimensions are distinguished?

Apart from the research interest, it could aid diagnosis and treatment if these similar mental disorders could be distinguished by tests in the cognitive domain.


### Data

The clinical sample comprised 116 male and female patients who met the following criteria: 1) a diagnosis of schizophrenia ($n$ = 70) or schizoaffective disorder ($n$ = 46) confirmed by the Structured Clinical Interview for DSM-IV-TR Axis I Disorders; 2) were outpatients; 3) a history free of developmental or learning disability; 4) age 18-65; 5) a history free of neurological or endocrine disorder; and 6) no concurrent diagnosis of substance use disorder.
Non-psychiatric control participants ($n$ = 146) were screened for medical and psychiatric illness and history of substance abuse and were recruited from three outpatient clinics.

```{r NC-data}
data(NeuroCog, package="heplots")
glimpse(NeuroCog)
```

The diagnostic classification variable is called `Dx` in the data set. To facilitate answering questions regarding group differences, the following contrasts were applied:
the first column compares the control group to the average of the diagnosed groups, the second
compares the schizophrenia group against the schizoaffective group.

```{r NC-contrasts}
contrasts(NeuroCog$Dx)
```


In this analysis, we ignore the `SocialCog` variable. The primary focus is on
the variables `Attention : ProbSolv`.

### A first look

As always, plot the data first! We want an overview of the distributions of the variables to see
the centers, spread,  shape and possible outliers for each group on each variable.

The plot below combines the use of boxplots and violin plots to give an informative display.
As we saw earlier (Chapter XXX), doing this with `ggplot2` requires reshaping the data to
long format.

```{r NC-long}
# Reshape from wide to long
NC_long <- NeuroCog |>
  dplyr::select(-SocialCog, -Age, -Sex) |>
  tidyr::gather(key = response, value = "value", Speed:ProbSolv)
# view 3 observations per group and measure
NC_long |>
  group_by(Dx) |>
  sample_n(3) |> ungroup()
```

In the plot, we take care to adjust the transparency (`alpha`) values for the points,
violin plots and boxplots so that all can be seen. Options for `geom_boxplot()`
are used to give these greater visual prominence.

```{r}
#| label: fig-NC-boxplot
#| fig-align: center
#| out-width: "120%"
#| fig-cap: "Boxplots and violin plots of the `NeuroCog` data."
ggplot(NC_long, aes(x=Dx, y=value, fill=Dx)) +
  geom_jitter(shape=16, alpha=0.8, size=1, width=0.2) +
  geom_violin(alpha = 0.1) +
  geom_boxplot(width=0.5, alpha=0.4, 
               outlier.alpha=1, outlier.size = 3, outlier.color = "red") +
  scale_x_discrete(labels = c("Schizo", "SchizAff", "Control")) +
  facet_wrap(~response, scales = "free_y", as.table = FALSE) +
  theme_bw() +
  theme(legend.position="bottom",
        axis.title = element_text(size = rel(1.2)),
        axis.text  = element_text(face = "bold"),
        strip.text = element_text(size = rel(1.2)))
```

We can see that the control participants score higher on all measures, but there is no consistent
pattern of medians for the two patient groups. But these univariate summaries do not inform
about the relations among variables.

### Bivariate views

#### Corrgram {.unnumbered}

A corrgram [@Friendly:02:corrgram] provides a useful reconnaisance plot of the bivariate correlations in the data set. It suppresses details, and allows focus on the overall pattern.
The `corrgram::corrgram()` function has the ability to enhance perception by
permuting the variables in the order of their variable vectors in a biplot, so more highly correlated variables are adjacent in the plot, and example of _effect ordering_ for
data displays [@FriendlyKwan:02:effect].

The plot below includes all variables except for `Dx` group.
There are a number of `panel.*` functions for choosing how the correlation for each pair is
rendered.

```{r}
#| label: fig-NC-corrgram
#| fig-align: center
#| fig-asp: 1
#| out-width: "90%"
#| fig-cap: "corrgram of the `NeuroCog` data. The upper and lower triangles use two different ways of encoding the value of the correlation for each pair of variables."
NeuroCog |>
  select(-Dx) |>
  corrgram(order = TRUE,
           diag.panel = panel.density,
           upper.panel = panel.pie)
```

In this plot you can see that adjacent variables are more highly correlated than those
more widely separated.  The diagonal panels show that most variables are reasonably
symmetric in their distributions. `Age`, not included in this analysis is negatively
correlated with the others: older participants tend to do less well on these tests.

#### Scatterplot matrix {.unnumbered}

A scatterplot matrix gives a more detailed overview of all pairwise relations.
The plot below suppresses the data points and summarizes the relation using
data ellipses and regression lines.
The model syntax, `~ Speed + ... |Dx`, treats `Dx` as a conditioning variable
(similar to the use of the `color` aestheic in `ggplot2`)
giving a separate data ellipse and regression line for each group.
(The legend is suppressed here. The groups are 
`r colorize("Schizophrenic", "red")`,
`r colorize("SchizoAffective", "green")`,
`r colorize("Normal", "blue")`.)

```{r}
#| label: fig-NC-scatmat
#| fig-align: center
#| fig-asp: 1
#| out-width: "100%"
#| fig-cap: "Scatterplot matrix of the `NeuroCog` data. Points are suppressed here, focusing on the data ellipses and regression lines. Colors for the groups: Schizophrenic (red), SchizoAffective (green), Normal (blue)"
scatterplotMatrix(~ Speed + Attention + Memory + Verbal + Visual + ProbSolv | Dx,
  data=NeuroCog,
  plot.points = FALSE,
  smooth = FALSE,
  legend = FALSE,
  col = scales::hue_pal()(3),
  ellipse=list(levels=0.68))
```

In this figure, we can see that the regression lines have similar slopes and similar data ellipses
for the groups, though with a few exceptions. 

**TODO**: Should we add biplot here?

## Fitting the MLM

We proceed to fit the one-way MANOVA model.

```{r NC-lm}
NC.mlm <- lm(cbind(Speed, Attention, Memory, Verbal, Visual, ProbSolv) ~ Dx,
             data=NeuroCog)
Anova(NC.mlm)
```

The first research question is captured by the contrasts for the `Dx` factor shown above.
We can test these with `car::linearHypothesis()`.
The contrast `Dx1` for control vs. the diagnosed groups is highly significant, 

```{r NC-linhyp}
# control vs. patients
print(linearHypothesis(NC.mlm, "Dx1"), SSP=FALSE)
```

but the second
contrast, `Dx2`, comparing the schizophrenic and schizoaffective group, is not.

```{r NC-linhyp2}
# Schizo vs SchizAff
print(linearHypothesis(NC.mlm, "Dx2"), SSP=FALSE)
```

### HE plot
So the question becomes: how to understand these results.  
`heplot()` shows the visualization of the multivariate model in the space
of two response variables (the first two by default).
The result (@fig-NC-HEplot) tells a very simple story:
The control group performs higher on higher measures than the diagnosed groups, which do
not differ between themselves. 

(For technical reasons, to abbreviate the group labels in the plot, we need to `update()` the MLM model after the labels are reassigned.)

```{r}
# abbreviate levels for plots
NeuroCog$Dx <- factor(NeuroCog$Dx, 
                      labels = c("Schiz", "SchAff", "Contr"))
NC.mlm <- update(NC.mlm)
```
 

```{r}
#| label: fig-NC-HEplot
#| fig-align: center
#| out-width: "70%"
#| fig-cap: "HE plot of Speed and Attention in the MLM for the `NeuroCog` data. The labeled points show the means of the groups on the two variables. The blue H ellipse for groups indicates the strong positive correlation of the group means."
#| fig-show: hold
op <- par(mar=c(5,4,1,1)+.1)
heplot(NC.mlm, 
       fill=TRUE, fill.alpha=0.1,
       cex.lab=1.3, cex=1.25)
par(op)
```

This pattern is consistent across all of the response variables,
as we see from a plot of `pairs(NC.mlm)`:

```{r}
#| label: fig-NC-HE-pairs
#| fig-align: center
#| out-width: "100%"
#| fig-cap: "HE plot matrix of the MLM for `NeuroCog` data."
#| fig-show: hold
pairs(NC.mlm, 
      fill=TRUE, fill.alpha=0.1,
      var.cex=2)
```

### Canonical space

We can gain further insight, and a simplified plot showing all the response variables by projecting the MANOVA into the canonical space, which is entirely 2-dimensional (because $df_h=2$).
However, the output from \func{candisc} shows that 98.5% of the mean differences among groups
can be accounted for in one canonical dimension.
```{r NC-can}
NC.can <- candisc(NC.mlm)
NC.can
```

@fig-NC-candisc is the result of the `plot()` method for class `"candisc"` objects,
that is, the result of calling `plot(NC.can, ...)`.
It plots the two canonical scores, $\mathbf{Z}_{n \times 2}$ for the subjects,
together with data ellipses for each of the three groups.

```{r}
#| label: fig-NC-candisc
#| fig-align: center
#| out-width: "100%"
#| fig-cap: "Canonical discriminant plot for the `NeuroCog` data MANOVA. Scores on the two canonical dimensions are plotted, together with 68% data ellipses for each group."
#| fig-show: hold
pos <- c(4, 1, 4, 4, 1, 3)
col <- c("red", "darkgreen", "blue")
op <- par(mar=c(5,4,1,1)+.1)
plot(NC.can, 
     ellipse=TRUE, 
     rev.axes=c(TRUE,FALSE), 
     pch=c(7,9,10),
     var.cex=1.2, cex.lab=1.5, var.lwd=2,  scale=4.5, 
     col=col,
	   var.col="black", var.pos=pos,
     prefix="Canonical dimension ")
par(op)
```

The interpretation of @fig-NC-candisc is again fairly straightforward.
As noted earlier (REF???), the projections of the variable vectors in this plot on the coordinate axes are proportional to the correlations of the responses with the canonical scores.
From this, we see that the normal group differs from the two patient groups, having higher scores on all the neurocognitive variables, most of which are highyl correlated. The problem solving measure is slightly different, and this, compared to the cluster of memory, verbal and attention, is what distinguishes the schizophrenic group from the schizoaffectives.

The separation of the groups is essentially one-dimensional, with the control group higher on all measures. Moreover, the variables processing speed and visual memory are the purest measures of this dimension, but all variables contribute positively.
The second canonical dimension accounts for only 1.5% of group mean differences and is non-significant
(by a likelihood ratio test).  Yet, if we were to interpret it, we would note that the schizophrenia group is slightly higher on this dimension, scoring better in problem solving and slightly worse on working memory, attention, and verbal learning tasks.

**Summary**

This analysis gives a very simple description of the data, in relation to the research questions posed earlier:

* On the basis of these neurocognitive tests, the schizophrenic and schizoaffective groups do not differ significantly overall, but these groups differ greatly from the normal controls.

* All cognitive domains distinguish the groups in the same direction, with the greatest differences shown for the variables most closely aligned with the horizontal axis in @fig-NC-candisc.



