<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>data-ellipse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="data-ellipse_files/libs/clipboard/clipboard.min.js"></script>
<script src="data-ellipse_files/libs/quarto-html/quarto.js"></script>
<script src="data-ellipse_files/libs/quarto-html/popper.min.js"></script>
<script src="data-ellipse_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="data-ellipse_files/libs/quarto-html/anchor.min.js"></script>
<link href="data-ellipse_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="data-ellipse_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="data-ellipse_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="data-ellipse_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="data-ellipse_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="the-data-ellipse" class="level3">
<h3 class="anchored" data-anchor-id="the-data-ellipse">The Data Ellipse</h3>
<p>The <em>data ellipse</em> <span class="citation" data-cites="Monette:90">[@Monette:90]</span>, or <em>concentration ellipse</em> <span class="citation" data-cites="Dempster:69">[@Dempster:69]</span> is a remarkably simple and effective display for viewing and understanding bivariate relationships in multivariate data. The data ellipse is typically used to add a visual summary to a scatterplot, that shows all together the means, standard deviations, correlation, and slope of the regression line for two variables. Under the classical assumption that the data are bivariate normally distributed, the data ellipse is also a <strong>sufficient</strong> visual summary, in the sense that it captures <strong>all</strong> relevant features of the data. See <span class="citation" data-cites="Friendly-etal:ellipses:2013">@Friendly-etal:ellipses:2013</span> for a complete discussion of the role of ellipsoids in statistical data visualization.</p>
<p>It is based on the idea that in a bivariate normal distribution, the contours of equal probability form a series of concentric ellipses. If the variables were uncorrelated and had the same variances, these would be circles, and Euclidean distance would measure the distance of each observation from the mean. When the variables are correlated, a different measure, <em>Mahalanobis distance</em> is the proper measure of how far a point is from the mean.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-mahalanobis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/mahalanobis.png" class="img-fluid figure-img" style="width:50.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: 2D data with curves of constant distance from the centroid. Which of the points A and B is further from the mean (X)? <em>Source</em>: <a href="https://ouzhang.rbind.io/2020/11/16/outliers-part4/">Ou Zhang</a></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>To illustrate, <strong>?@fig-mahanalobis</strong> shows a scatterplot with labels for two points, “A” and “B”. Which is further from the mean, “X”? A contour of constant Euclidean distance, shown by the red dashed circle, ignores the apparent negative correlation, so point “A” is further. The blue ellipse for Mahalanobis distance takes the correlation into account, so point “B” has a greater distance from the mean.</p>
<p>Mathematically, Euclidean (squared) distance for <span class="math inline">\(p\)</span> variables, <span class="math inline">\(j = 1, 2, \dots , p\)</span>, is just a generalization of the square of a univariate standardized (<span class="math inline">\(z\)</span>) score, <span class="math inline">\(z^2 = [(y - \bar{y}) / s]^2\)</span>,</p>
<p><span class="math display">\[
D_E^2 (\mathbf{y}) = \sum_j^p z_j^2 = \mathbf{z}^T  \mathbf{z} = (\mathbf{y} - \bar{\mathbf{y}})^T \operatorname{diag}(\mathbf{S})^{-1} (\mathbf{y} - \bar{\mathbf{y}}) \; ,
\]</span> where <span class="math inline">\(\mathbf{S}\)</span> is the sample variance-covariance matrix, <span class="math inline">\(\mathbf{S} = ({n-1})^{-1} \sum_{i=1}^n (\mathbf{y}_i - \bar{\mathbf{y}})^T (\mathbf{y}_i - \bar{\mathbf{y}})\)</span>.</p>
<p>Mahalanobis’ distance takes the correlations into account simply by using the covariances as well as the variances. <span class="math display">\[
D_M^2 (\mathbf{y}) = (\mathbf{y} - \bar{\mathbf{y}})^T S^{-1} (\mathbf{y} - \bar{\mathbf{y}})
\]</span> For <span class="math inline">\(p\)</span> variables, the data <em>ellipsoid</em> <span class="math inline">\(\mathcal{E}_c\)</span> of size <span class="math inline">\(c\)</span> is a <span class="math inline">\(p\)</span>-dimensional ellipse, defined as the set of points <span class="math inline">\(\mathbf{y} = (y_1, y_2, \dots y_p)\)</span> whose squared Mahalanobis distance, <span class="math inline">\(D_M^2 ( \mathbf{y} )\)</span> is less than or equal to <span class="math inline">\(c^2\)</span>.</p>
<p>When <span class="math inline">\(\mathbf{y}\)</span> is (at least approximately) bivariate normal, <span class="math inline">\(D^2(\mathbf{y})\)</span> has a large-sample <span class="math inline">\(\chi^2_2\)</span> distribution (<span class="math inline">\(\chi^2\)</span> with 2 df), so taking <span class="math inline">\(c^2 = \chi^2_2 (0.68) = 2.28\)</span> gives a “1 standard deviation bivariate ellipse,” an analog of the standard interval <span class="math inline">\(\bar{y} \pm 1 s\)</span>, while <span class="math inline">\(c^2 = \chi^2_2 (0.95) = 5.99 \approx 6\)</span> gives a data ellipse of 95% coverage.</p>
<section id="properties" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="properties">Properties</h4>
<p>For two variables, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, the remarkable properties of the data ellipse are illustrated in <a href="#fig-galton-ellipse-r">Figure&nbsp;2</a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-galton-ellipse-r" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/galton-ellipse-r.jpg" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Sunflower plot of Galton’s data on heights of parents and their children (in.), with 40%, 68% and 95% data ellipses and the regression lines of <span class="math inline">\(y\)</span> on <span class="math inline">\(x\)</span> (black) and <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> (grey).</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>The ellipses have the mean vector <span class="math inline">\((\bar{x}, \bar{y})\)</span> as their center.</p></li>
<li><p>The lengths of arms of the central cross show the standard deviations of the variables, which correspond to the shadows of the ellipse covering 40% of the data. These are the bivariate analogs of the standard intervals <span class="math inline">\(\bar{x} \pm 1 s_x\)</span> and <span class="math inline">\(\bar{y} \pm 1 s_y\)</span>.</p></li>
<li><p>More generally, shadows (projections) on the coordinate axes, or any linear combination of them, give any standard interval, <span class="math inline">\(\bar{x} \pm k s_x\)</span> and <span class="math inline">\(\bar{y} \pm k s_y\)</span>. Those with <span class="math inline">\(k=1, 1.5, 2.45\)</span>, have bivariate coverage 40%, 68% and 95%, corresponding to these quantiles of the <span class="math inline">\(\chi^2\)</span> distribution with 2 degrees of freedom, i.e., <span class="math inline">\(\chi^2_2 (.40) \approx 1^2\)</span>, <span class="math inline">\(\chi^2_2 (.68) \approx 1.5^2\)</span>, and <span class="math inline">\(\chi^2_2 (.95) \approx 2.45\)</span>. <!-- and univariate coverage 68\%, 87\% and 98.6\% respectively. --></p></li>
<li><p>The regression line predicting <span class="math inline">\(y\)</span> from <span class="math inline">\(x\)</span> goes through the points where the ellipses have vertical tangents. The <em>other</em> regression line, predicting <span class="math inline">\(x\)</span> from <span class="math inline">\(y\)</span> goes through the points of horizontal tangency.</p></li>
<li><p>The correlation <span class="math inline">\(r(x, y)\)</span> is the ratio of the vertical segment from the mean of <span class="math inline">\(y\)</span> to the regression line to the vertical segment going to the top of the ellipse as shown at the right of the figure. It is <span class="math inline">\(r = 0.46\)</span> in this example.</p></li>
<li><p>The residual standard deviation, <span class="math inline">\(s_e = \sqrt{MSE} = \sqrt{\Sigma (y - \bar{y})^2 / n-2}\)</span>, is the half-length of the ellipse at the mean <span class="math inline">\(\bar{x}\)</span></p></li>
</ul>
<p>Because Galton’s values of <code>parent</code> and <code>child</code> height were recorded in class intervals of 1 in., they are shown as sunflower symbols with multiple ‘petals’ reflecting the number of observations at each location. This plot is constructed using <code>sunflowerplot()</code> and <code>car::dataEllipse()</code> for the ellipses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Galton, <span class="at">package =</span> <span class="st">"HistData"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sunflowerplot</span>(parent <span class="sc">~</span> child, <span class="at">data=</span>Galton, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">61</span>,<span class="dv">75</span>), </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">61</span>,<span class="dv">75</span>), </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">seg.col=</span><span class="st">"black"</span>, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">"Child height"</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab=</span><span class="st">"Mid Parent height"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>y.x <span class="ot">&lt;-</span> <span class="fu">lm</span>(parent <span class="sc">~</span> child, <span class="at">data=</span>Galton)     <span class="co"># regression of y on x</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(y.x, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>x.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(child <span class="sc">~</span> parent, <span class="at">data=</span>Galton)     <span class="co"># regression of x on y</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="fu">coef</span>(x.y)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="sc">-</span>cc[<span class="dv">1</span>]<span class="sc">/</span>cc[<span class="dv">2</span>], <span class="dv">1</span><span class="sc">/</span>cc[<span class="dv">2</span>], <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Galton, </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>     car<span class="sc">::</span><span class="fu">dataEllipse</span>(child, parent, </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">plot.points=</span><span class="cn">FALSE</span>, </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">levels=</span><span class="fu">c</span>(<span class="fl">0.40</span>, <span class="fl">0.68</span>, <span class="fl">0.95</span>), </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>